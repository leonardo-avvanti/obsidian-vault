/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var r0=Object.create;var ki=Object.defineProperty;var o0=Object.getOwnPropertyDescriptor;var n0=Object.getOwnPropertyNames;var s0=Object.getPrototypeOf,i0=Object.prototype.hasOwnProperty;var a0=(o,e,t)=>e in o?ki(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var iu=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),au=(o,e)=>{for(var t in e)ki(o,t,{get:e[t],enumerable:!0})},gh=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of n0(e))!i0.call(o,n)&&n!==t&&ki(o,n,{get:()=>e[n],enumerable:!(r=o0(e,n))||r.enumerable});return o};var an=(o,e,t)=>(t=o!=null?r0(s0(o)):{},gh(e||!o||!o.__esModule?ki(t,"default",{value:o,enumerable:!0}):t,o)),l0=o=>gh(ki({},"__esModule",{value:!0}),o);var yt=(o,e,t)=>(a0(o,typeof e!="symbol"?e+"":e,t),t);var Nn=iu((jD,bh)=>{"use strict";function co(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function yh(o,e){for(var t="",r=0,n=-1,s=0,i,a=0;a<=o.length;++a){if(a<o.length)i=o.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,a):t=o.slice(n+1,a),r=a-n-1;n=a,s=0}else i===46&&s!==-1?++s:s=-1}return t}function c0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var hs={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),co(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=yh(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(co(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=yh(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return co(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];co(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":hs.normalize(e)},relative:function(e,t){if(co(e),co(t),e===t||(e=hs.resolve(e),t=hs.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var a=t.length,l=a-i,c=s<l?s:l,u=-1,f=0;f<=c;++f){if(f===c){if(l>c){if(t.charCodeAt(i+f)===47)return t.slice(i+f+1);if(f===0)return t.slice(i+f)}else s>c&&(e.charCodeAt(r+f)===47?u=f:f===0&&(u=0));break}var d=e.charCodeAt(r+f),p=t.charCodeAt(i+f);if(d!==p)break;d===47&&(u=f)}var m="";for(f=r+u+1;f<=n;++f)(f===n||e.charCodeAt(f)===47)&&(m.length===0?m+="..":m+="/..");return m.length>0?m+t.slice(i+u):(i+=u,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(co(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!s){n=i;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');co(e);var r=0,n=-1,s=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(c===47){if(!s){r=i+1;break}}else l===-1&&(s=!1,l=i+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(n=i):(a=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!s){r=i+1;break}}else n===-1&&(s=!1,n=i+1);return n===-1?"":e.slice(r,n)}},extname:function(e){co(e);for(var t=-1,r=0,n=-1,s=!0,i=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}n===-1&&(s=!1,n=a+1),l===46?t===-1?t=a:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||n===-1||i===0||i===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return c0("/",e)},parse:function(e){co(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var i=-1,a=0,l=-1,c=!0,u=e.length-1,f=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?i===-1?i=u:f!==1&&(f=1):i!==-1&&(f=-1)}return i===-1||l===-1||f===0||f===1&&i===l-1&&i===a+1?l!==-1&&(a===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&n?(t.name=e.slice(1,i),t.base=e.slice(1,l)):(t.name=e.slice(a,i),t.base=e.slice(a,l)),t.ext=e.slice(i,l)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};hs.posix=hs;bh.exports=hs});var Lf=iu((D4,Gs)=>{var he=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},ct=-1,ut=1,je=0;he.Diff=function(o,e){return[o,e]};he.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new he.Diff(je,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,i=this.diff_commonPrefix(o,e),a=o.substring(0,i);o=o.substring(i),e=e.substring(i),i=this.diff_commonSuffix(o,e);var l=o.substring(o.length-i);o=o.substring(0,o.length-i),e=e.substring(0,e.length-i);var c=this.diff_compute_(o,e,s,n);return a&&c.unshift(new he.Diff(je,a)),l&&c.push(new he.Diff(je,l)),this.diff_cleanupMerge(c),c};he.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new he.Diff(ut,e)];if(!e)return[new he.Diff(ct,o)];var s=o.length>e.length?o:e,i=o.length>e.length?e:o,a=s.indexOf(i);if(a!=-1)return n=[new he.Diff(ut,s.substring(0,a)),new he.Diff(je,i),new he.Diff(ut,s.substring(a+i.length))],o.length>e.length&&(n[0][0]=n[2][0]=ct),n;if(i.length==1)return[new he.Diff(ct,o),new he.Diff(ut,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],u=l[1],f=l[2],d=l[3],p=l[4],m=this.diff_main(c,f,t,r),v=this.diff_main(u,d,t,r);return m.concat([new he.Diff(je,p)],v)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};he.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new he.Diff(je,""));for(var i=0,a=0,l=0,c="",u="";i<s.length;){switch(s[i][0]){case ut:l++,u+=s[i][1];break;case ct:a++,c+=s[i][1];break;case je:if(a>=1&&l>=1){s.splice(i-a-l,a+l),i=i-a-l;for(var f=this.diff_main(c,u,!1,t),d=f.length-1;d>=0;d--)s.splice(i,0,f[d]);i=i+f.length}l=0,a=0,c="",u="";break}i++}return s.pop(),s};he.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),i=s,a=2*s,l=new Array(a),c=new Array(a),u=0;u<a;u++)l[u]=-1,c[u]=-1;l[i+1]=0,c[i+1]=0;for(var f=r-n,d=f%2!=0,p=0,m=0,v=0,g=0,k=0;k<s&&!(new Date().getTime()>t);k++){for(var L=-k+p;L<=k-m;L+=2){var I=i+L,C;L==-k||L!=k&&l[I-1]<l[I+1]?C=l[I+1]:C=l[I-1]+1;for(var M=C-L;C<r&&M<n&&o.charAt(C)==e.charAt(M);)C++,M++;if(l[I]=C,C>r)m+=2;else if(M>n)p+=2;else if(d){var A=i+f-L;if(A>=0&&A<a&&c[A]!=-1){var E=r-c[A];if(C>=E)return this.diff_bisectSplit_(o,e,C,M,t)}}}for(var P=-k+v;P<=k-g;P+=2){var A=i+P,E;P==-k||P!=k&&c[A-1]<c[A+1]?E=c[A+1]:E=c[A-1]+1;for(var T=E-P;E<r&&T<n&&o.charAt(r-E-1)==e.charAt(n-T-1);)E++,T++;if(c[A]=E,E>r)g+=2;else if(T>n)v+=2;else if(!d){var I=i+f-P;if(I>=0&&I<a&&l[I]!=-1){var C=l[I],M=i+C-I;if(E=r-E,C>=E)return this.diff_bisectSplit_(o,e,C,M,t)}}}}return[new he.Diff(ct,o),new he.Diff(ut,e)]};he.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),i=e.substring(0,r),a=o.substring(t),l=e.substring(r),c=this.diff_main(s,i,!1,n),u=this.diff_main(a,l,!1,n);return c.concat(u)};he.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",u=0,f=-1,d=t.length;f<l.length-1;){f=l.indexOf(`
`,u),f==-1&&(f=l.length-1);var p=l.substring(u,f+1);(r.hasOwnProperty?r.hasOwnProperty(p):r[p]!==void 0)?c+=String.fromCharCode(r[p]):(d==s&&(p=l.substring(u),f=l.length),c+=String.fromCharCode(d),r[p]=d,t[d++]=p),u=f+1}return c}var s=4e4,i=n(o);s=65535;var a=n(e);return{chars1:i,chars2:a,lineArray:t}};he.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};he.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};he.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};he.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,i=1;;){var a=o.substring(n-i),l=e.indexOf(a);if(l==-1)return s;i+=l,(l==0||o.substring(n-i)==e.substring(0,i))&&(s=i,i++)}};he.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(m,v,g){for(var k=m.substring(g,g+Math.floor(m.length/4)),L=-1,I="",C,M,A,E;(L=v.indexOf(k,L+1))!=-1;){var P=n.diff_commonPrefix(m.substring(g),v.substring(L)),T=n.diff_commonSuffix(m.substring(0,g),v.substring(0,L));I.length<T+P&&(I=v.substring(L-T,L)+v.substring(L,L+P),C=m.substring(0,g-T),M=m.substring(g+P),A=v.substring(0,L-T),E=v.substring(L+P))}return I.length*2>=m.length?[C,M,A,E,I]:null}var i=s(t,r,Math.ceil(t.length/4)),a=s(t,r,Math.ceil(t.length/2)),l;if(!i&&!a)return null;a?i?l=i[4].length>a[4].length?i:a:l=a:l=i;var c,u,f,d;o.length>e.length?(c=l[0],u=l[1],f=l[2],d=l[3]):(f=l[0],d=l[1],c=l[2],u=l[3]);var p=l[4];return[c,u,f,d,p]};he.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=0,a=0,l=0,c=0;s<o.length;)o[s][0]==je?(t[r++]=s,i=l,a=c,l=0,c=0,n=o[s][1]):(o[s][0]==ut?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(i,a)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new he.Diff(ct,n)),o[t[r-1]+1][0]=ut,r--,r--,s=r>0?t[r-1]:-1,i=0,a=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==ct&&o[s][0]==ut){var u=o[s-1][1],f=o[s][1],d=this.diff_commonOverlap_(u,f),p=this.diff_commonOverlap_(f,u);d>=p?(d>=u.length/2||d>=f.length/2)&&(o.splice(s,0,new he.Diff(je,f.substring(0,d))),o[s-1][1]=u.substring(0,u.length-d),o[s+1][1]=f.substring(d),s++):(p>=u.length/2||p>=f.length/2)&&(o.splice(s,0,new he.Diff(je,u.substring(0,p))),o[s-1][0]=ut,o[s-1][1]=f.substring(0,f.length-p),o[s+1][0]=ct,o[s+1][1]=u.substring(p),s++),s++}s++}};he.prototype.diff_cleanupSemanticLossless=function(o){function e(p,m){if(!p||!m)return 6;var v=p.charAt(p.length-1),g=m.charAt(0),k=v.match(he.nonAlphaNumericRegex_),L=g.match(he.nonAlphaNumericRegex_),I=k&&v.match(he.whitespaceRegex_),C=L&&g.match(he.whitespaceRegex_),M=I&&v.match(he.linebreakRegex_),A=C&&g.match(he.linebreakRegex_),E=M&&p.match(he.blanklineEndRegex_),P=A&&m.match(he.blanklineStartRegex_);return E||P?5:M||A?4:k&&!I&&C?3:I||C?2:k||L?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==je&&o[t+1][0]==je){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],i=this.diff_commonSuffix(r,n);if(i){var a=n.substring(n.length-i);r=r.substring(0,r.length-i),n=a+n.substring(0,n.length-i),s=a+s}for(var l=r,c=n,u=s,f=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,n)+e(n,s);d>=f&&(f=d,l=r,c=n,u=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};he.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;he.whitespaceRegex_=/\s/;he.linebreakRegex_=/[\r\n]/;he.blanklineEndRegex_=/\n\r?\n$/;he.blanklineStartRegex_=/^\r?\n\r?\n/;he.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=!1,a=!1,l=!1,c=!1;s<o.length;)o[s][0]==je?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,i=l,a=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==ct?c=!0:l=!0,n&&(i&&a&&l&&c||n.length<this.Diff_EditCost/2&&i+a+l+c==3)&&(o.splice(t[r-1],0,new he.Diff(ct,n)),o[t[r-1]+1][0]=ut,r--,n=null,i&&a?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};he.prototype.diff_cleanupMerge=function(o){o.push(new he.Diff(je,""));for(var e=0,t=0,r=0,n="",s="",i;e<o.length;)switch(o[e][0]){case ut:r++,s+=o[e][1],e++;break;case ct:t++,n+=o[e][1],e++;break;case je:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(s,n),i!==0&&(e-t-r>0&&o[e-t-r-1][0]==je?o[e-t-r-1][1]+=s.substring(0,i):(o.splice(0,0,new he.Diff(je,s.substring(0,i))),e++),s=s.substring(i),n=n.substring(i)),i=this.diff_commonSuffix(s,n),i!==0&&(o[e][1]=s.substring(s.length-i)+o[e][1],s=s.substring(0,s.length-i),n=n.substring(0,n.length-i))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new he.Diff(ct,n)),e++),s.length&&(o.splice(e,0,new he.Diff(ut,s)),e++),e++):e!==0&&o[e-1][0]==je?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var a=!1;for(e=1;e<o.length-1;)o[e-1][0]==je&&o[e+1][0]==je&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),a=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),a=!0)),e++;a&&this.diff_cleanupMerge(o)};he.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,i;for(i=0;i<o.length&&(o[i][0]!==ut&&(t+=o[i][1].length),o[i][0]!==ct&&(r+=o[i][1].length),!(t>e));i++)n=t,s=r;return o.length!=i&&o[i][0]===ct?s:s+(e-n)};he.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,i=0;i<o.length;i++){var a=o[i][0],l=o[i][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(a){case ut:e[i]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case ct:e[i]='<del style="background:#ffe6e6;">'+c+"</del>";break;case je:e[i]="<span>"+c+"</span>";break}}return e.join("")};he.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==ut&&(e[t]=o[t][1]);return e.join("")};he.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==ct&&(e[t]=o[t][1]);return e.join("")};he.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],i=o[n][1];switch(s){case ut:t+=i.length;break;case ct:r+=i.length;break;case je:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};he.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case ut:e[t]="+"+encodeURI(o[t][1]);break;case ct:e[t]="-"+o[t][1].length;break;case je:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};he.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),i=0;i<s.length;i++){var a=s[i].substring(1);switch(s[i].charAt(0)){case"+":try{t[r++]=new he.Diff(ut,decodeURI(a))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);var c=o.substring(n,n+=l);s[i].charAt(0)=="="?t[r++]=new he.Diff(je,c):t[r++]=new he.Diff(ct,c);break;default:if(s[i])throw new Error("Invalid diff operation in diff_fromDelta: "+s[i])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};he.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};he.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(C,M){var A=C/e.length,E=Math.abs(t-M);return n.Match_Distance?A+E/n.Match_Distance:E?1:A}var i=this.Match_Threshold,a=o.indexOf(e,t);a!=-1&&(i=Math.min(s(0,a),i),a=o.lastIndexOf(e,t+e.length),a!=-1&&(i=Math.min(s(0,a),i)));var l=1<<e.length-1;a=-1;for(var c,u,f=e.length+o.length,d,p=0;p<e.length;p++){for(c=0,u=f;c<u;)s(p,t+u)<=i?c=u:f=u,u=Math.floor((f-c)/2+c);f=u;var m=Math.max(1,t-u+1),v=Math.min(t+u,o.length)+e.length,g=Array(v+2);g[v+1]=(1<<p)-1;for(var k=v;k>=m;k--){var L=r[o.charAt(k-1)];if(p===0?g[k]=(g[k+1]<<1|1)&L:g[k]=(g[k+1]<<1|1)&L|((d[k+1]|d[k])<<1|1)|d[k+1],g[k]&l){var I=s(p,k-1);if(I<=i)if(i=I,a=k-1,a>t)m=Math.max(1,2*t-a);else break}}if(s(p+1,t)>i)break;d=g}return a};he.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};he.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new he.Diff(je,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new he.Diff(je,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};he.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],i=new he.patch_obj,a=0,l=0,c=0,u=r,f=r,d=0;d<n.length;d++){var p=n[d][0],m=n[d][1];switch(!a&&p!==je&&(i.start1=l,i.start2=c),p){case ut:i.diffs[a++]=n[d],i.length2+=m.length,f=f.substring(0,c)+m+f.substring(c);break;case ct:i.length1+=m.length,i.diffs[a++]=n[d],f=f.substring(0,c)+f.substring(c+m.length);break;case je:m.length<=2*this.Patch_Margin&&a&&n.length!=d+1?(i.diffs[a++]=n[d],i.length1+=m.length,i.length2+=m.length):m.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(i,u),s.push(i),i=new he.patch_obj,a=0,u=f,l=c);break}p!==ut&&(l+=m.length),p!==ct&&(c+=m.length)}return a&&(this.patch_addContext_(i,u),s.push(i)),s};he.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new he.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new he.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};he.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var i=o[s].start2+r,a=this.diff_text1(o[s].diffs),l,c=-1;if(a.length>this.Match_MaxBits?(l=this.match_main(e,a.substring(0,this.Match_MaxBits),i),l!=-1&&(c=this.match_main(e,a.substring(a.length-this.Match_MaxBits),i+a.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,a,i),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-i;var u;if(c==-1?u=e.substring(l,l+a.length):u=e.substring(l,c+this.Match_MaxBits),a==u)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+a.length);else{var f=this.diff_main(a,u,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(f)/a.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(f);for(var d=0,p,m=0;m<o[s].diffs.length;m++){var v=o[s].diffs[m];v[0]!==je&&(p=this.diff_xIndex(f,d)),v[0]===ut?e=e.substring(0,l+p)+v[1]+e.substring(l+p):v[0]===ct&&(e=e.substring(0,l+p)+e.substring(l+this.diff_xIndex(f,d+v[1].length))),v[0]!==ct&&(d+=v[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};he.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=je)s.unshift(new he.Diff(je,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var i=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=je)s.push(new he.Diff(je,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var i=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,i),n.length1+=i,n.length2+=i}return t};he.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,i="";r.diffs.length!==0;){var a=new he.patch_obj,l=!0;for(a.start1=n-i.length,a.start2=s-i.length,i!==""&&(a.length1=a.length2=i.length,a.diffs.push(new he.Diff(je,i)));r.diffs.length!==0&&a.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],u=r.diffs[0][1];c===ut?(a.length2+=u.length,s+=u.length,a.diffs.push(r.diffs.shift()),l=!1):c===ct&&a.diffs.length==1&&a.diffs[0][0]==je&&u.length>2*e?(a.length1+=u.length,n+=u.length,l=!1,a.diffs.push(new he.Diff(c,u)),r.diffs.shift()):(u=u.substring(0,e-a.length1-this.Patch_Margin),a.length1+=u.length,n+=u.length,c===je?(a.length2+=u.length,s+=u.length):l=!1,a.diffs.push(new he.Diff(c,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}i=this.diff_text2(a.diffs),i=i.substring(i.length-this.Patch_Margin);var f=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);f!==""&&(a.length1+=f.length,a.length2+=f.length,a.diffs.length!==0&&a.diffs[a.diffs.length-1][0]===je?a.diffs[a.diffs.length-1][1]+=f:a.diffs.push(new he.Diff(je,f))),l||o.splice(++t,0,a)}}};he.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};he.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var i=new he.patch_obj;for(e.push(i),i.start1=parseInt(s[1],10),s[2]===""?(i.start1--,i.length1=1):s[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(s[2],10)),i.start2=parseInt(s[3],10),s[4]===""?(i.start2--,i.length2=1):s[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(s[4],10)),r++;r<t.length;){var a=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(a=="-")i.diffs.push(new he.Diff(ct,l));else if(a=="+")i.diffs.push(new he.Diff(ut,l));else if(a==" ")i.diffs.push(new he.Diff(je,l));else{if(a=="@")break;if(a!=="")throw new Error('Invalid patch mode "'+a+'" in: '+l)}r++}}return e};he.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};he.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case ut:r="+";break;case ct:r="-";break;case je:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};Gs.exports=he;Gs.exports.diff_match_patch=he;Gs.exports.DIFF_DELETE=ct;Gs.exports.DIFF_INSERT=ut;Gs.exports.DIFF_EQUAL=je});var Zy=iu((wU,Yy)=>{var Ky=require("url").parse,qI=require("events"),zI=require("https"),jI=require("http"),WI=require("util"),KI=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],Qy=[239,187,191],GI=58,JI=32,Gy=10,QI=13,Jy=1024*256,YI=/^(cookie|authorization)$/i;function ZI(o){return Qy.every(function(e,t){return o[t]===e})}function xt(o,e){var t=xt.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function i(g){t!==xt.CLOSED&&(t=xt.CONNECTING,m("error",new Xi("error",{message:g})),d&&(o=d,d=null,n=!1),setTimeout(function(){t!==xt.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,p())},s.reconnectInterval))}var a,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,u="",f="",d=null;function p(){var g=Ky(o),k=g.protocol==="https:";if(g.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(g.headers["Last-Event-ID"]=l),r){var L=n?eC(r):r;for(var I in L){var C=L[I];C&&(g.headers[I]=C)}}g.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(g.createConnection=e.createConnection);var M=e&&e.proxy;if(M){var A=Ky(e.proxy);k=A.protocol==="https:",g.protocol=k?"https:":"http:",g.path=o,g.headers.Host=g.host,g.hostname=A.hostname,g.host=A.host,g.port=A.port}if(e&&e.https){for(var E in e.https)if(KI.indexOf(E)!==-1){var P=e.https[E];P!==void 0&&(g[E]=P)}}e&&e.withCredentials!==void 0&&(g.withCredentials=e.withCredentials),a=(k?zI:jI).request(g,function(T){if(s.connectionInProgress=!1,T.statusCode===500||T.statusCode===502||T.statusCode===503||T.statusCode===504){m("error",new Xi("error",{status:T.statusCode,message:T.statusMessage})),i();return}if(T.statusCode===301||T.statusCode===302||T.statusCode===307){var $=T.headers.location;if(!$){m("error",new Xi("error",{status:T.statusCode,message:T.statusMessage}));return}var J=new URL(o).origin,N=new URL($).origin;n=J!==N,T.statusCode===307&&(d=o),o=$,process.nextTick(p);return}if(T.statusCode!==200)return m("error",new Xi("error",{status:T.statusCode,message:T.statusMessage})),s.close();t=xt.OPEN,T.on("close",function(){T.removeAllListeners("close"),T.removeAllListeners("end"),i()}),T.on("end",function(){T.removeAllListeners("close"),T.removeAllListeners("end"),i()}),m("open",new Xi("open"));var O,te,Z=0,Y=-1,ge=0,j=0;T.on("data",function(H){O?(H.length>O.length-j&&(ge=O.length*2+H.length,ge>Jy&&(ge=O.length+H.length+Jy),te=Buffer.alloc(ge),O.copy(te,0,0,j),O=te),H.copy(O,j),j+=H.length):(O=H,ZI(O)&&(O=O.slice(Qy.length)),j=O.length);for(var X=0,ue=j;X<ue;){c&&(O[X]===Gy&&++X,c=!1);for(var z=-1,ee=Y,re,fe=Z;z<0&&fe<ue;++fe)re=O[fe],re===GI?ee<0&&(ee=fe-X):re===QI?(c=!0,z=fe-X):re===Gy&&(z=fe-X);if(z<0){Z=ue-X,Y=ee;break}else Z=0,Y=-1;v(O,X,ee,z),X+=z+1}X===ue?(O=void 0,j=0):X>0&&(O=O.slice(X,j),j=O.length)})}),a.on("error",function(T){s.connectionInProgress=!1,i(T.message)}),a.setNoDelay&&a.setNoDelay(!0),a.end()}p();function m(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==xt.CLOSED&&(t=xt.CLOSED,a.abort&&a.abort(),a.xhr&&a.xhr.abort&&a.xhr.abort())};function v(g,k,L,I){if(I===0){if(u.length>0){var C=f||"message";m(C,new XI(C,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}f=void 0}else if(L>0){var M=L<0,A=0,E=g.slice(k,k+(M?I:L)).toString();M?A=I:g[k+L+1]!==JI?A=L+1:A=L+2,k+=A;var P=I-A,T=g.slice(k,k+P).toString();if(E==="data")u+=T+`
`;else if(E==="event")f=T;else if(E==="id")l=T;else if(E==="retry"){var $=parseInt(T,10);Number.isNaN($)||(s.reconnectInterval=$)}}}}Yy.exports=xt;WI.inherits(xt,qI.EventEmitter);xt.prototype.constructor=xt;["open","error","message"].forEach(function(o){Object.defineProperty(xt.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(xt,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(xt,"OPEN",{enumerable:!0,value:1});Object.defineProperty(xt,"CLOSED",{enumerable:!0,value:2});xt.prototype.CONNECTING=0;xt.prototype.OPEN=1;xt.prototype.CLOSED=2;xt.prototype.close=function(){this._close()};xt.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};xt.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};xt.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Xi(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function XI(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function eC(o){var e={};for(var t in o)YI.test(t)||(e[t]=o[t]);return e}});var qD={};au(qD,{default:()=>su});module.exports=l0(qD);var rt=require("obsidian"),B1=require("obsidian"),V1=an(Nn());var tt=require("obsidian");var Ut=()=>new Map,Ea=o=>{let e=Ut();return o.forEach((t,r)=>{e.set(r,t)}),e},zr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},vh=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},_h=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var uo=()=>new Set;var Pa=o=>o[o.length-1];var xh=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},jr=Array.from;var cu=Array.isArray;var Ra=class{constructor(){this._observers=Ut()}on(e,t){return zr(this._observers,e,uo).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return jr((this._observers.get(e)||Ut()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ut()}},gs=class{constructor(){this._observers=Ut()}on(e,t){zr(this._observers,e,uo).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return jr((this._observers.get(e)||Ut()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ut()}};var lr=Math.floor;var ys=Math.abs;var bs=(o,e)=>o<e?o:e,Wr=(o,e)=>o>e?o:e,KD=Number.isNaN;var Da=o=>o!==0?o<0:1/o<0;var fu=Number.MAX_SAFE_INTEGER,GD=Number.MIN_SAFE_INTEGER,JD=1<<31;var wh=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&lr(o)===o),QD=Number.isNaN,YD=Number.parseInt;var u0=String.fromCharCode,ZD=String.fromCodePoint,XD=u0(65535),f0=o=>o.toLowerCase(),d0=/^\s*/g,p0=o=>o.replace(d0,""),m0=/([A-Z])/g,du=(o,e)=>p0(o.replace(m0,t=>`${e}${f0(t)}`));var h0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},xs=typeof TextEncoder!="undefined"?new TextEncoder:null,g0=o=>xs.encode(o),kh=xs?g0:h0;var _s=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_s&&_s.decode(new Uint8Array).length===1&&(_s=null);var $n=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Vn=()=>new $n;var y0=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var vr=o=>{let e=new Uint8Array(y0(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},b0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Wr(t,e)*2),o.cpos=0)},Ot=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Oa=Ot;var He=(o,e)=>{for(;e>127;)Ot(o,128|127&e),e=lr(e/128);Ot(o,127&e)},Na=(o,e)=>{let t=Da(e);for(t&&(e=-e),Ot(o,(e>63?128:0)|(t?64:0)|63&e),e=lr(e/64);e>0;)Ot(o,(e>127?128:0)|127&e),e=lr(e/128)},mu=new Uint8Array(3e4),v0=mu.length/3,_0=(o,e)=>{if(e.length<v0){let t=xs.encodeInto(e,mu).written||0;He(o,t);for(let r=0;r<t;r++)Ot(o,mu[r])}else Nt(o,kh(e))},x0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;He(o,r);for(let n=0;n<r;n++)Ot(o,t.codePointAt(n))},Po=xs&&xs.encodeInto?_0:x0;var Li=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=bs(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Wr(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},Nt=(o,e)=>{He(o,e.byteLength),Li(o,e)},hu=(o,e)=>{b0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},w0=(o,e)=>hu(o,4).setFloat32(0,e,!1),S0=(o,e)=>hu(o,8).setFloat64(0,e,!1),k0=(o,e)=>hu(o,8).setBigInt64(0,e,!1);var Ch=new DataView(new ArrayBuffer(4)),I0=o=>(Ch.setFloat32(0,o),Ch.getFloat32(0)===o),Ss=(o,e)=>{switch(typeof e){case"string":Ot(o,119),Po(o,e);break;case"number":wh(e)&&ys(e)<=2147483647?(Ot(o,125),Na(o,e)):I0(e)?(Ot(o,124),w0(o,e)):(Ot(o,123),S0(o,e));break;case"bigint":Ot(o,122),k0(o,e);break;case"object":if(e===null)Ot(o,126);else if(cu(e)){Ot(o,117),He(o,e.length);for(let t=0;t<e.length;t++)Ss(o,e[t])}else if(e instanceof Uint8Array)Ot(o,116),Nt(o,e);else{Ot(o,118);let t=Object.keys(e);He(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];Po(o,n),Ss(o,e[n])}}break;case"boolean":Ot(o,e?120:121);break;default:Ot(o,127)}},Ci=class extends $n{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&He(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var Lh=o=>{o.count>0&&(Na(o.encoder,o.count===1?o.s:-o.s),o.count>1&&He(o.encoder,o.count-2))},Bn=class{constructor(){this.encoder=new $n,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Lh(this),this.count=1,this.s=e)}toUint8Array(){return Lh(this),vr(this.encoder)}};var Mh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Na(o.encoder,e),o.count>1&&He(o.encoder,o.count-2)}},ks=class{constructor(){this.encoder=new $n,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Mh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Mh(this),vr(this.encoder)}},Ua=class{constructor(){this.sarr=[],this.s="",this.lensE=new Bn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new $n;return this.sarr.push(this.s),this.s="",Po(e,this.sarr.join("")),Li(e,this.lensE.toUint8Array()),vr(e)}};var Ar=o=>new Error(o),Kr=()=>{throw Ar("Method unimplemented")},Fr=()=>{throw Ar("Unexpected case")};var Th=Ar("Unexpected end of array"),Ah=Ar("Integer out of Range"),Is=class{constructor(e){this.arr=e,this.pos=0}},Jr=o=>new Is(o),Fh=o=>o.pos!==o.arr.length;var C0=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},zt=o=>C0(o,Be(o));var Hn=o=>o.arr[o.pos++];var Be=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>fu)throw Ah}throw Th},Ba=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>fu)throw Ah}throw Th};var L0=o=>{let e=Be(o);if(e===0)return"";{let t=String.fromCodePoint(Hn(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Hn(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},M0=o=>_s.decode(zt(o)),Gr=_s?M0:L0;var bu=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},T0=o=>bu(o,4).getFloat32(0,!1),A0=o=>bu(o,8).getFloat64(0,!1),F0=o=>bu(o,8).getBigInt64(0,!1);var E0=[o=>{},o=>null,Ba,T0,A0,F0,o=>!1,o=>!0,Gr,o=>{let e=Be(o),t={};for(let r=0;r<e;r++){let n=Gr(o);t[n]=Cs(o)}return t},o=>{let e=Be(o),t=[];for(let r=0;r<e;r++)t.push(Cs(o));return t},zt],Cs=o=>E0[127-Hn(o)](o),Mi=class extends Is{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Fh(this)?this.count=Be(this)+1:this.count=-1),this.count--,this.s}};var qn=class extends Is{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ba(this);let e=Da(this.s);this.count=1,e&&(this.s=-this.s,this.count=Be(this)+2)}return this.count--,this.s}};var Ls=class extends Is{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Ba(this),t=e&1;this.diff=lr(e/2),this.count=1,t&&(this.count=Be(this)+2)}return this.s+=this.diff,this.count--,this.s}},$a=class{constructor(e){this.decoder=new qn(e),this.str=Gr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var r3=crypto.subtle,Eh=crypto.getRandomValues.bind(crypto);var Ti=()=>Eh(new Uint32Array(1))[0];var P0=[1e7]+-1e3+-4e3+-8e3+-1e11,Ms=()=>P0.replace(/[018]/g,o=>(o^Ti()&15>>o/4).toString(16));var zn=Date.now;var Ro=o=>new Promise(o);var R0=Promise.all.bind(Promise);var _u=o=>o===void 0?null:o;var xu=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Dh=new xu,U0=!0;try{typeof localStorage!="undefined"&&localStorage&&(Dh=localStorage,U0=!1)}catch(o){}var Uh=Dh;var Oh=Object.assign,N0=Object.keys,Nh=(o,e)=>{for(let t in o)e(o[t],t)};var Ai=o=>N0(o).length;var $h=o=>{for(let e in o)return!1;return!0},$0=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},wu=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),Su=(o,e)=>o===e||Ai(o)===Ai(e)&&$0(o,(t,r)=>(t!==void 0||wu(e,r))&&e[r]===t);var Fi=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Fi(o,e,t+1)}};var Vh=o=>o,B0=(o,e)=>o===e;var Ts=(o,e)=>{if(o==null||e==null)return B0(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!Ts(o.get(t),e.get(t)))return!1;break}case Object:if(Ai(o)!==Ai(e))return!1;for(let t in o)if(!wu(o,t)||!Ts(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!Ts(o[t],e[t]))return!1;break;default:return!1}return!0},Hh=(o,e)=>e.includes(o);var Ei=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var s3=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,fo,V0=[],H0=()=>{if(fo===void 0)if(Ei){fo=Ut();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&fo.set(e,""),e=r):e!==null?(fo.set(e,r),e=null):V0.push(r)}e!==null&&fo.set(e,"")}else typeof location=="object"?(fo=Ut(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");fo.set(`--${du(e,"-")}`,t),fo.set(`-${du(e,"-")}`,t)}})):fo=Ut();return fo},Iu=o=>H0().has(o);var Cu=o=>Ei?_u(process.env[o.toUpperCase().replaceAll("-","_")]):_u(Uh.getItem(o));var q0=o=>Iu("--"+o)||Cu(o)!==null,i3=q0("production"),qh=Ei&&Hh(process.env.FORCE_COLOR,["true","1","2"]),zh=!Iu("no-colors")&&(!Ei||process.stdout.isTTY||qh)&&(!Ei||Iu("color")||qh||Cu("COLORTERM")!==null||(Cu("TERM")||"").includes("color"));var j0=o=>new Uint8Array(o);var jh=o=>{let e=j0(o.byteLength);return e.set(o),e};var Lu=class{constructor(e,t){this.left=e,this.right=t}},Zt=(o,e)=>new Lu(o,e);var Wh=(o,e)=>o.forEach(t=>e(t.left,t.right));var po=typeof document!="undefined"?document:{},K0=o=>po.createElement(o),G0=()=>po.createDocumentFragment(),J0=o=>po.createTextNode(o),a3=typeof DOMParser!="undefined"?new DOMParser:null;var Q0=(o,e)=>(Wh(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var Y0=o=>{let e=G0();for(let t=0;t<o.length;t++)Jh(e,o[t]);return e},Kh=(o,e)=>(Jh(o,Y0(e)),o);var Pi=(o,e=[],t=[])=>Kh(Q0(K0(o),e),t);var As=J0;var Gh=o=>vh(o,(e,t)=>`${t}:${e};`).join("");var Jh=(o,e)=>o.appendChild(e),l3=po.ELEMENT_NODE,c3=po.TEXT_NODE,u3=po.CDATA_SECTION_NODE,f3=po.COMMENT_NODE,d3=po.DOCUMENT_NODE,p3=po.DOCUMENT_TYPE_NODE,m3=po.DOCUMENT_FRAGMENT_NODE;var mo=Symbol;var Ri=mo(),Di=mo(),Tu=mo(),Au=mo(),Fu=mo(),Ui=mo(),Eu=mo(),Oi=mo(),Pu=mo(),Yh=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var h3=zn();var eS={[Ri]:Zt("font-weight","bold"),[Di]:Zt("font-weight","normal"),[Tu]:Zt("color","blue"),[Fu]:Zt("color","green"),[Au]:Zt("color","grey"),[Ui]:Zt("color","red"),[Eu]:Zt("color","purple"),[Oi]:Zt("color","orange"),[Pu]:Zt("color","black")},tS=o=>{var i;o.length===1&&((i=o[0])==null?void 0:i.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Ut(),n=[],s=0;for(;s<o.length;s++){let a=o[s],l=eS[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){let c=Gh(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let a=o[s];a instanceof Symbol||n.push(a)}return n},rS=zh?tS:Yh,Zh=(...o)=>{console.log(...rS(o)),oS.forEach(e=>e.print(o))};var oS=uo();var Xh=o=>({[Symbol.iterator](){return this},next:o}),eg=(o,e)=>Xh(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Ha=(o,e)=>Xh(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var $i=class{constructor(e,t){this.clock=e,this.len=t}},jn=class{constructor(){this.clients=new Map}},hg=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let i=0;i<r.length;i++){let a=r[i];kg(o,s,a.clock,a.len,t)}}),lS=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=lr((t+r)/2),s=o[n],i=s.clock;if(i<=e){if(e<i+s.len)return n;t=n+1}else r=n-1}return null},Ju=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&lS(t,e.clock)!==null},Qu=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=Wr(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},Du=o=>{let e=new jn;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let i=t+1;i<o.length;i++)xh(s,o[i].clients.get(n)||[]);e.clients.set(n,s)}});return Qu(e),e},Ja=(o,e,t,r)=>{zr(o.clients,e,()=>[]).push(new $i(t,r))},Yu=()=>new jn,cS=o=>{let e=Yu();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let i=t[s];if(i.deleted){let a=i.id.clock,l=i.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new $i(a,l))}}n.length>0&&e.clients.set(r,n)}),e},dn=(o,e)=>{He(o.restEncoder,e.clients.size),jr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),He(o.restEncoder,t);let n=r.length;He(o.restEncoder,n);for(let s=0;s<n;s++){let i=r[s];o.writeDsClock(i.clock),o.writeDsLen(i.len)}})},Bi=o=>{let e=new jn,t=Be(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Be(o.restDecoder),s=Be(o.restDecoder);if(s>0){let i=zr(e.clients,n,()=>[]);for(let a=0;a<s;a++)i.push(new $i(o.readDsClock(),o.readDsLen()))}}return e},og=(o,e,t)=>{let r=new jn,n=Be(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let i=Be(o.restDecoder),a=Be(o.restDecoder),l=t.clients.get(i)||[],c=Lt(t,i);for(let u=0;u<a;u++){let f=o.readDsClock(),d=f+o.readDsLen();if(f<c){c<d&&Ja(r,i,c,d-c);let p=go(l,f),m=l[p];for(!m.deleted&&m.id.clock<f&&(l.splice(p+1,0,nl(e,m,f-m.id.clock)),p++);p<l.length&&(m=l[p++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&l.splice(p,0,nl(e,m,d-m.id.clock)),m.delete(e))}else Ja(r,i,f,d-f)}}if(r.clients.size>0){let s=new Do;return He(s.restEncoder,0),dn(s,r),s.toUint8Array()}return null};var gg=Ti,Er=class extends Ra{constructor({guid:e=Ms(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=gg(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new el,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Ro(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Ro(c=>{let u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&nt(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(jr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return nt(this,e,t)}get(e,t=Rt){let r=zr(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==Rt&&n!==t)if(n===Rt){let s=new t;s._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=s}),s._start=r._start;for(let i=s._start;i!==null;i=i.right)i.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,ho)}getText(e=""){return this.get(e,hn)}getMap(e=""){return this.get(e,Uo)}getXmlElement(e=""){return this.get(e,gn)}getXmlFragment(e=""){return this.get(e,Oo)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){jr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new Er({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,nt(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Ps=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Be(this.restDecoder)}readDsLen(){return Be(this.restDecoder)}},Qa=class extends Ps{readLeftID(){return We(Be(this.restDecoder),Be(this.restDecoder))}readRightID(){return We(Be(this.restDecoder),Be(this.restDecoder))}readClient(){return Be(this.restDecoder)}readInfo(){return Hn(this.restDecoder)}readString(){return Gr(this.restDecoder)}readParentInfo(){return Be(this.restDecoder)===1}readTypeRef(){return Be(this.restDecoder)}readLen(){return Be(this.restDecoder)}readAny(){return Cs(this.restDecoder)}readBuf(){return jh(zt(this.restDecoder))}readJSON(){return JSON.parse(Gr(this.restDecoder))}readKey(){return Gr(this.restDecoder)}},Uu=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Be(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Be(this.restDecoder)+1;return this.dsCurrVal+=e,e}},pn=class extends Uu{constructor(e){super(e),this.keys=[],Be(e),this.keyClockDecoder=new Ls(zt(e)),this.clientDecoder=new qn(zt(e)),this.leftClockDecoder=new Ls(zt(e)),this.rightClockDecoder=new Ls(zt(e)),this.infoDecoder=new Mi(zt(e),Hn),this.stringDecoder=new $a(zt(e)),this.parentInfoDecoder=new Mi(zt(e),Hn),this.typeRefDecoder=new qn(zt(e)),this.lenDecoder=new qn(zt(e))}readLeftID(){return new fn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new fn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Cs(this.restDecoder)}readBuf(){return zt(this.restDecoder)}readJSON(){return Cs(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Rs=class{constructor(){this.restEncoder=Vn()}toUint8Array(){return vr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){He(this.restEncoder,e)}writeDsLen(e){He(this.restEncoder,e)}},Wn=class extends Rs{writeLeftID(e){He(this.restEncoder,e.client),He(this.restEncoder,e.clock)}writeRightID(e){He(this.restEncoder,e.client),He(this.restEncoder,e.clock)}writeClient(e){He(this.restEncoder,e)}writeInfo(e){Oa(this.restEncoder,e)}writeString(e){Po(this.restEncoder,e)}writeParentInfo(e){He(this.restEncoder,e?1:0)}writeTypeRef(e){He(this.restEncoder,e)}writeLen(e){He(this.restEncoder,e)}writeAny(e){Ss(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){Po(this.restEncoder,JSON.stringify(e))}writeKey(e){Po(this.restEncoder,e)}},Ya=class{constructor(){this.restEncoder=Vn(),this.dsCurrVal=0}toUint8Array(){return vr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,He(this.restEncoder,t)}writeDsLen(e){e===0&&Fr(),He(this.restEncoder,e-1),this.dsCurrVal+=e}},Do=class extends Ya{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ks,this.clientEncoder=new Bn,this.leftClockEncoder=new ks,this.rightClockEncoder=new ks,this.infoEncoder=new Ci(Oa),this.stringEncoder=new Ua,this.parentInfoEncoder=new Ci(Oa),this.typeRefEncoder=new Bn,this.lenEncoder=new Bn}toUint8Array(){let e=Vn();return He(e,0),Nt(e,this.keyClockEncoder.toUint8Array()),Nt(e,this.clientEncoder.toUint8Array()),Nt(e,this.leftClockEncoder.toUint8Array()),Nt(e,this.rightClockEncoder.toUint8Array()),Nt(e,vr(this.infoEncoder)),Nt(e,this.stringEncoder.toUint8Array()),Nt(e,vr(this.parentInfoEncoder)),Nt(e,this.typeRefEncoder.toUint8Array()),Nt(e,this.lenEncoder.toUint8Array()),Li(e,vr(this.restEncoder)),vr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ss(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){Ss(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},uS=(o,e,t,r)=>{r=Wr(r,e[0].id.clock);let n=go(e,r);He(o.restEncoder,e.length-n),o.writeClient(t),He(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let i=n+1;i<e.length;i++)e[i].write(o,0)},Zu=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{Lt(e,s)>n&&r.set(s,n)}),sl(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),He(o.restEncoder,r.size),jr(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{uS(o,e.clients.get(n),n,s)})},fS=(o,e)=>{let t=Ut(),r=Be(o.restDecoder);for(let n=0;n<r;n++){let s=Be(o.restDecoder),i=new Array(s),a=o.readClient(),l=Be(o.restDecoder);t.set(a,{i:0,refs:i});for(let c=0;c<s;c++){let u=o.readInfo();switch(31&u){case 0:{let f=o.readLen();i[c]=new cr(We(a,l),f),l+=f;break}case 10:{let f=Be(o.restDecoder);i[c]=new ur(We(a,l),f),l+=f;break}default:{let f=(u&192)===0,d=new ht(We(a,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,f?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,f&&(u&32)===32?o.readString():null,qg(o,u));i[c]=d,l+=d.length}}}}return t},dS=(o,e,t)=>{let r=[],n=jr(t.keys()).sort((p,m)=>p-m);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let p=t.get(n[n.length-1]);for(;p.refs.length===p.i;)if(n.pop(),n.length>0)p=t.get(n[n.length-1]);else return null;return p},i=s();if(i===null)return null;let a=new el,l=new Map,c=(p,m)=>{let v=l.get(p);(v==null||v>m)&&l.set(p,m)},u=i.refs[i.i++],f=new Map,d=()=>{for(let p of r){let m=p.id.client,v=t.get(m);v?(v.i--,a.clients.set(m,v.refs.slice(v.i)),t.delete(m),v.i=0,v.refs=[]):a.clients.set(m,[p]),n=n.filter(g=>g!==m)}r.length=0};for(;;){if(u.constructor!==ur){let m=zr(f,u.id.client,()=>Lt(e,u.id.client))-u.id.clock;if(m<0)r.push(u),c(u.id.client,u.id.clock-1),d();else{let v=u.getMissing(o,e);if(v!==null){r.push(u);let g=t.get(v)||{refs:[],i:0};if(g.refs.length===g.i)c(v,Lt(e,v)),d();else{u=g.refs[g.i++];continue}}else(m===0||m<u.length)&&(u.integrate(o,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(i!==null&&i.i<i.refs.length)u=i.refs[i.i++];else{if(i=s(),i===null)break;u=i.refs[i.i++]}}if(a.clients.size>0){let p=new Do;return Zu(p,a,new Map),He(p.restEncoder,0),{missing:l,update:p.toUint8Array()}}return null},pS=(o,e)=>Zu(o,e.doc.store,e.beforeState),mS=(o,e,t,r=new pn(o))=>nt(e,n=>{n.local=!1;let s=!1,i=n.doc,a=i.store,l=fS(r,i),c=dS(n,a,l),u=a.pendingStructs;if(u){for(let[d,p]of u.missing)if(p<Lt(a,d)){s=!0;break}if(c){for(let[d,p]of c.missing){let m=u.missing.get(d);(m==null||m>p)&&u.missing.set(d,p)}u.update=tl([u.update,c.update])}}else a.pendingStructs=c;let f=og(r,n,a);if(a.pendingDs){let d=new pn(Jr(a.pendingDs));Be(d.restDecoder);let p=og(d,n,a);f&&p?a.pendingDs=tl([f,p]):a.pendingDs=f||p}else a.pendingDs=f;if(s){let d=a.pendingStructs.update;a.pendingStructs=null,yg(n.doc,d)}},t,!1);var yg=(o,e,t,r=pn)=>{let n=Jr(e);mS(n,o,t,new r(n))},yo=(o,e,t)=>yg(o,e,t,Qa),hS=(o,e,t=new Map)=>{Zu(o,e.store,t),dn(o,cS(e.store))},gS=(o,e=new Uint8Array([0]),t=new Do)=>{let r=bg(e);hS(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(TS(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===Wn)return LS(n.map((s,i)=>i===0?s:FS(s)));if(t.constructor===Do)return tl(n)}return n[0]},Ki=(o,e)=>gS(o,e,new Wn),yS=o=>{let e=new Map,t=Be(o.restDecoder);for(let r=0;r<t;r++){let n=Be(o.restDecoder),s=Be(o.restDecoder);e.set(n,s)}return e},bg=o=>yS(new Ps(Jr(o))),vg=(o,e)=>(He(o.restEncoder,e.size),jr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{He(o.restEncoder,t),He(o.restEncoder,r)}),o),bS=(o,e)=>vg(o,sl(e.store)),vS=(o,e=new Ya)=>(o instanceof Map?vg(e,o):bS(e,o),e.toUint8Array()),_g=o=>vS(o,new Rs),Ou=class{constructor(){this.l=[]}},ng=()=>new Ou,sg=(o,e)=>o.l.push(e),ig=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},xg=(o,e,t)=>Fi(o.l,[e,t]),fn=class{constructor(e,t){this.client=e,this.clock=t}},Es=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,We=(o,e)=>new fn(o,e);var wg=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Fr()};var Za=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,i)=>{let a=s.get("ds"),l=s.get("ids"),c=u=>this.clients.set(u,i);a.observe(u=>{u.changes.added.forEach(f=>{f.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(i,Du([this.dss.get(i)||Yu(),Bi(new Ps(Jr(d)))]))})})}),this.dss.set(i,Du(a.map(u=>Bi(new Ps(Jr(u)))))),l.observe(u=>u.changes.added.forEach(f=>f.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(i=>n(t.get(i),i))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,i=s.get(r);i||(i=new Uo,i.set("ids",new ho),i.set("ds",new ho),s.set(r,i)),i.get("ids").push([t]),s.observe(a=>{setTimeout(()=>{let l=s.get(r);if(l!==i){i=l,this.clients.forEach((f,d)=>{r===f&&i.get("ids").push([d])});let c=new Rs,u=this.dss.get(r);u&&(dn(c,u),i.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",a=>{setTimeout(()=>{let l=i.get("ds"),c=a.deleteSet;if(a.local&&c.clients.size>0&&n(a,c)){let u=new Rs;dn(u,c),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Ju(r,e))return t;return null}},Xa=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var Xu=o=>new Xa(o.type==null?null:We(o.type.client,o.type.clock),o.tname||null,o.item==null?null:We(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Nu=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},_S=(o,e,t=0)=>new Nu(o,e,t),qa=(o,e,t)=>{let r=null,n=null;return o._item===null?n=wg(o):r=We(o._item.id.client,o._item.id.clock),new Xa(r,n,e,t)},ef=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return qa(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return qa(o,We(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return qa(o,r.lastId,t);r=r.right}return qa(o,null,t)};var tf=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,i=o.assoc,a=null,l=0;if(r!==null){if(Lt(t,r.client)<=r.clock)return null;let c=mg(t,r),u=c.item;if(!(u instanceof ht))return null;if(a=u.parent,a._item===null||!a._item.deleted){l=u.deleted||!u.countable?0:c.diff+(i>=0?0:1);let f=u.left;for(;f!==null;)!f.deleted&&f.countable&&(l+=f.length),f=f.left}}else{if(s!==null)a=e.get(s);else if(n!==null){if(Lt(t,n.client)<=n.clock)return null;let{item:c}=mg(t,n);if(c instanceof ht&&c.content instanceof Rr)a=c.content.type;else return null}else throw Fr();i>=0?l=a._length:l=0}return _S(a,l,o.assoc)},rf=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&Es(o.item,e.item)&&Es(o.type,e.type)&&o.assoc===e.assoc,$u=class{constructor(e,t){this.ds=e,this.sv=t}};var xS=(o,e)=>new $u(o,e),I3=xS(Yu(),new Map);var Fs=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Ju(e.ds,o.id),Bu=(o,e)=>{let t=zr(o.meta,Bu,uo),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<Lt(r,s)&&mn(o,We(s,n))}),hg(o,e.ds,n=>{}),t.add(e))};var el=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},sl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},Lt=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},Sg=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Fr()}t.push(e)},go=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let i=lr(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[i],s=n.id.clock,s<=e){if(e<s+n.length)return i;t=i+1}else r=i-1;i=lr((t+r)/2)}throw Fr()},wS=(o,e)=>{let t=o.clients.get(e.client);return t[go(t,e.clock)]},Wa=wS,Vu=(o,e,t)=>{let r=go(e,t),n=e[r];return n.id.clock<t&&n instanceof ht?(e.splice(r+1,0,nl(o,n,t-n.id.clock)),r+1):r},mn=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[Vu(o,t,e.clock)]},ag=(o,e,t)=>{let r=e.clients.get(t.client),n=go(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==cr&&r.splice(n+1,0,nl(o,s,t.clock-s.id.clock+1)),s},SS=(o,e,t)=>{let r=o.clients.get(e.id.client);r[go(r,e.id.clock)]=t},kg=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,i=Vu(o,e,t),a;do a=e[i++],s<a.id.clock+a.length&&Vu(o,e,s),n(a);while(i<e.length&&e[i].id.clock<s)},Hu=class{constructor(e,t,r){this.doc=e,this.deleteSet=new jn,this.beforeState=sl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},lg=(o,e)=>e.deleteSet.clients.size===0&&!_h(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Qu(e.deleteSet),pS(o,e),dn(o,e.deleteSet),!0),cg=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&zr(o.changed,e,uo).add(t)},Ka=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ht&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},kS=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){let a=n[i],l=a.clock+a.len;for(let c=go(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){let f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof ht&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},IS=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let i=t[s],a=bs(n.length-1,1+go(n,i.clock+i.len-1));for(let l=a,c=n[l];l>0&&c.id.clock>=i.clock;c=n[l])l-=1+Ka(n,l)}})};var Ig=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,i=t._mergeStructs;try{Qu(s),t.afterState=sl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),xg(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Fi(a,[]),t._needFormattingCleanup&&HS(t)}finally{r.gc&&kS(s,n,r.gcFilter),IS(s,n),t.afterState.forEach((u,f)=>{let d=t.beforeState.get(f)||0;if(d!==u){let p=n.clients.get(f),m=Wr(go(p,d),1);for(let v=p.length-1;v>=m;)v-=1+Ka(p,v)}});for(let u=i.length-1;u>=0;u--){let{client:f,clock:d}=i[u].id,p=n.clients.get(f),m=go(p,d);m+1<p.length&&Ka(p,m+1)>1||m>0&&Ka(p,m)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Zh(Oi,Ri,"[yjs] ",Di,Ui,"Changed the client-id because another client seems to be using it."),r.clientID=gg()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new Wn;lg(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new Do;lg(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):Ig(o,e+1)}}},nt=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,i=null;o._transaction===null&&(s=!0,o._transaction=new Hu(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{i=e(o._transaction)}finally{if(s){let a=o._transaction===n[0];o._transaction=null,a&&Ig(n,0)}}return i};function*CS(o){let e=Be(o.restDecoder);for(let t=0;t<e;t++){let r=Be(o.restDecoder),n=o.readClient(),s=Be(o.restDecoder);for(let i=0;i<r;i++){let a=o.readInfo();if(a===10){let l=Be(o.restDecoder);yield new ur(We(n,s),l),s+=l}else if(31&a){let l=(a&192)===0,c=new ht(We(n,s),null,(a&128)===128?o.readLeftID():null,null,(a&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(a&32)===32?o.readString():null,qg(o,a));yield c,s+=c.length}else{let l=o.readLen();yield new cr(We(n,s),l),s+=l}}}}var Vi=class{constructor(e,t){this.gen=CS(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ur);return this.curr}};var Hi=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},LS=o=>tl(o,Qa,Wn);var MS=(o,e)=>{if(o.constructor===cr){let{client:t,clock:r}=o.id;return new cr(We(t,r+e),o.length-e)}else if(o.constructor===ur){let{client:t,clock:r}=o.id;return new ur(We(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new ht(We(r,n+e),null,We(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},tl=(o,e=pn,t=Do)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Jr(u))),n=r.map(u=>new Vi(u,!0)),s=null,i=new t,a=new Hi(i);for(;n=n.filter(d=>d.curr!==null),n.sort((d,p)=>{if(d.curr.id.client===p.curr.id.client){let m=d.curr.id.clock-p.curr.id.clock;return m===0?d.curr.constructor===p.curr.constructor?0:d.curr.constructor===ur?1:-1:m}else return p.curr.id.client-d.curr.id.client}),n.length!==0;){let u=n[0],f=u.curr.id.client;if(s!==null){let d=u.curr,p=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),p=!0;if(d===null||d.id.client!==f||p&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)cn(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===ur)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{cn(a,s.struct,s.offset);let m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ur(We(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{let m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===ur?s.struct.length-=m:d=MS(d,m)),s.struct.mergeWith(d)||(cn(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==ur;d=u.next())cn(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(cn(a,s.struct,s.offset),s=null),of(a);let l=r.map(u=>Bi(u)),c=Du(l);return dn(i,c),i.toUint8Array()},TS=(o,e,t=pn,r=Do)=>{let n=bg(e),s=new r,i=new Hi(s),a=new t(Jr(o)),l=new Vi(a,!1);for(;l.curr;){let u=l.curr,f=u.id.client,d=n.get(f)||0;if(l.curr.constructor===ur){l.next();continue}if(u.id.clock+u.length>d)for(cn(i,u,Wr(d-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===f;)cn(i,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===f&&l.curr.id.clock+l.curr.length<=d;)l.next()}of(i);let c=Bi(a);return dn(s,c),s.toUint8Array()};var Cg=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:vr(o.encoder.restEncoder)}),o.encoder.restEncoder=Vn(),o.written=0)},cn=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&Cg(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),He(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},of=o=>{Cg(o);let e=o.encoder.restEncoder;He(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];He(e,r.written),Li(e,r.restEncoder)}},AS=(o,e,t,r)=>{let n=new t(Jr(o)),s=new Vi(n,!1),i=new r,a=new Hi(i);for(let c=s.curr;c!==null;c=s.next())cn(a,e(c),0);of(a);let l=Bi(n);return dn(i,l),i.toUint8Array()};var FS=o=>AS(o,Vh,pn,Wn),ug="You must not compute changes after the event-handler fired.",Ds=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ES(this.currentTarget,this.target))}deletes(e){return Ju(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ar(ug);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),i,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))i="delete",a=Pa(l.content.getContent());else return;else l!==null&&this.deletes(l)?(i="update",a=Pa(l.content.getContent())):(i="add",a=void 0)}else if(this.deletes(s))i="delete",a=Pa(s.content.getContent());else return;e.set(n,{action:i,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ar(ug);let t=this.target,r=uo(),n=uo(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null,l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,n.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}},ES=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},Lg=80,nf=0,qu=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=nf++}},PS=o=>{o.timestamp=nf++},Mg=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=nf++},RS=(o,e,t)=>{if(o.length>=Lg){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return Mg(r,e,t),r}else{let r=new qu(e,t);return o.push(r),r}},il=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,i)=>ys(e-s.index)<ys(e-i.index)?s:i),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,PS(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&ys(t.index-n)<r.parent.length/Lg?(Mg(t,r,n),t):RS(o._searchMarker,r,n)},qi=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=Wr(e,n.index+t))}};var al=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;zr(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;xg(r._eH,t,e)},Rt=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ng(),this._dEH=ng(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Kr()}clone(){throw Kr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){sg(this._eH,e)}observeDeep(e){sg(this._dEH,e)}unobserve(e){ig(this._eH,e)}unobserveDeep(e){ig(this._dEH,e)}toJSON(){}},Tg=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let i=s.content.getContent();if(i.length<=e)e-=i.length;else{for(let a=e;a<i.length&&r>0;a++)n.push(i[a]),r--;e=0}}s=s.right}return n},Ag=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var zi=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},Fg=(o,e)=>{let t=[];return zi(o,(r,n)=>{t.push(e(r,n,o))}),t},DS=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},Eg=(o,e)=>{let t=il(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},rl=(o,e,t,r)=>{let n=t,s=o.doc,i=s.clientID,a=s.store,l=t===null?e._start:t.right,c=[],u=()=>{c.length>0&&(n=new ht(We(i,Lt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new $o(c)),n.integrate(o,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:n=new ht(We(i,Lt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Kn(new Uint8Array(f))),n.integrate(o,0);break;case Er:n=new ht(We(i,Lt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Jn(f)),n.integrate(o,0);break;default:if(f instanceof Rt)n=new ht(We(i,Lt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Rr(f)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Pg=()=>Ar("Length exceeded!"),Rg=(o,e,t,r)=>{if(t>e._length)throw Pg();if(t===0)return e._searchMarker&&qi(e._searchMarker,t,r.length),rl(o,e,null,r);let n=t,s=il(e,t),i=e._start;for(s!==null&&(i=s.p,t-=s.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&mn(o,We(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&qi(e._searchMarker,n,r.length),rl(o,e,i,r)},US=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,i)=>i.index>s.index?i:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return rl(o,e,n,t)},Dg=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,i=il(e,t),a=e._start;for(i!==null&&(a=i.p,t-=i.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&mn(o,We(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&mn(o,We(a.id.client,a.id.clock+r)),a.delete(o),r-=a.length),a=a.right;if(r>0)throw Pg();e._searchMarker&&qi(e._searchMarker,n,-s+r)},ol=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},sf=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,i=s.clientID,a;if(r==null)a=new $o([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new $o([r]);break;case Uint8Array:a=new Kn(r);break;case Er:a=new Jn(r);break;default:if(r instanceof Rt)a=new Rr(r);else throw new Error("Unexpected content type")}new ht(We(i,Lt(s.store,i)),n,n&&n.lastId,null,null,e,t,a).integrate(o,0)},af=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Ug=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Og=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var OS=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Fs(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},za=o=>eg(o.entries(),e=>!e[1].deleted),zu=class extends Ds{constructor(e,t){super(e,t),this._transaction=t}},ho=class extends Rt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new ho;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ho}clone(){let e=new ho;return e.insert(0,this.toArray().map(t=>t instanceof Rt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),al(this,e,new zu(this,e))}insert(e,t){this.doc!==null?nt(this.doc,r=>{Rg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?nt(this.doc,t=>{US(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?nt(this.doc,r=>{Dg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Eg(this,e)}toArray(){return Ag(this)}slice(e=0,t=this.length){return Tg(this,e,t)}toJSON(){return this.map(e=>e instanceof Rt?e.toJSON():e)}map(e){return Fg(this,e)}forEach(e){zi(this,e)}[Symbol.iterator](){return DS(this)}_write(e){e.writeTypeRef(nk)}},NS=o=>new ho,ju=class extends Ds{constructor(e,t,r){super(e,t),this.keysChanged=r}},Uo=class extends Rt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new Uo}clone(){let e=new Uo;return this.forEach((t,r)=>{e.set(r,t instanceof Rt?t.clone():t)}),e}_callObserver(e,t){al(this,e,new ju(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof Rt?n.toJSON():n}}),e}get size(){return[...za(this._map)].length}keys(){return Ha(za(this._map),e=>e[0])}values(){return Ha(za(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Ha(za(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?nt(this.doc,t=>{ol(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?nt(this.doc,r=>{sf(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return af(this,e)}has(e){return Og(this,e)}clear(){this.doc!==null?nt(this.doc,e=>{this.forEach(function(t,r,n){ol(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(sk)}},$S=o=>new Uo,un=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&Su(o,e),ji=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Fr(),this.right.content.constructor){case St:this.right.deleted||$s(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},fg=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case St:e.right.deleted||$s(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&mn(o,We(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ja=(o,e,t,r)=>{let n=new Map,s=r?il(e,t):null;if(s){let i=new ji(s.p.left,s.p,s.index,n);return fg(o,i,t-s.index)}else{let i=new ji(null,e._start,0,n);return fg(o,i,t)}},Ng=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===St&&un(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((i,a)=>{let l=t.left,c=t.right,u=new ht(We(s,Lt(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new St(a,i));u.integrate(o,0),t.right=u,t.forward()})},$s=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},$g=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===St&&un((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Bg=(o,e,t,r)=>{var a;let n=o.doc,s=n.clientID,i=new Map;for(let l in r){let c=r[l],u=(a=t.currentAttributes.get(l))!=null?a:null;if(!un(u,c)){i.set(l,u);let{left:f,right:d}=t;t.right=new ht(We(s,Lt(n.store,s)),f,f&&f.lastId,d,d&&d.id,e,null,new St(l,c)),t.right.integrate(o,0),t.forward()}}return i},Ru=(o,e,t,r,n)=>{t.currentAttributes.forEach((d,p)=>{n[p]===void 0&&(n[p]=null)});let s=o.doc,i=s.clientID;$g(t,n);let a=Bg(o,e,t,n),l=r.constructor===String?new Pr(r):r instanceof Rt?new Rr(r):new No(r),{left:c,right:u,index:f}=t;e._searchMarker&&qi(e._searchMarker,t.index,l.getLength()),u=new ht(We(i,Lt(s.store,i)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=f,t.forward(),Ng(o,e,t,a)},dg=(o,e,t,r,n)=>{let s=o.doc,i=s.clientID;$g(t,n);let a=Bg(o,e,t,n);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===St));){if(!t.right.deleted)switch(t.right.content.constructor){case St:{let{key:l,value:c}=t.right.content,u=n[l];if(u!==void 0){if(un(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&mn(o,We(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ht(We(i,Lt(s.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Pr(l)),t.right.integrate(o,0),t.forward()}Ng(o,e,t,a)},Vg=(o,e,t,r,n)=>{var c,u;let s=e,i=Ut();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===St){let f=s.content;i.set(f.key,f)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let f=e.content;switch(f.constructor){case St:{let{key:d,value:p}=f,m=(c=r.get(d))!=null?c:null;(i.get(d)!==f||m===p)&&(e.delete(o),a++,!l&&((u=n.get(d))!=null?u:null)===p&&m!==p&&(m===null?n.delete(d):n.set(d,m))),!l&&!e.deleted&&$s(n,f);break}}}e=e.right}return a},BS=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===St){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},VS=o=>{let e=0;return nt(o.doc,t=>{let r=o._start,n=o._start,s=Ut(),i=Ea(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case St:$s(i,n.content);break;default:e+=Vg(t,r,n,s,i),s=Ea(i),r=n;break}n=n.right}}),e},HS=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&kg(o,t.store.clients.get(r),s,n,i=>{!i.deleted&&i.content.constructor===St&&i.constructor!==cr&&e.add(i.parent)})}nt(t,r=>{hg(o,o.deleteSet,n=>{if(n instanceof cr||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===St?e.add(s):BS(r,n)});for(let n of e)VS(n)})},pg=(o,e,t)=>{let r=t,n=Ea(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Rr:case No:case Pr:t<e.right.length&&mn(o,We(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&Vg(o,s,e.right,n,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&qi(i._searchMarker,e.index,-r+t),e},Wu=class extends Ds{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];nt(e,r=>{var p,m,v;let n=new Map,s=new Map,i=this.target._start,a=null,l={},c="",u=0,f=0,d=()=>{if(a!==null){let g=null;switch(a){case"delete":f>0&&(g={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(g={insert:c},n.size>0&&(g.attributes={},n.forEach((k,L)=>{k!==null&&(g.attributes[L]=k)}))),c="";break;case"retain":u>0&&(g={retain:u},$h(l)||(g.attributes=Oh({},l))),u=0;break}g&&t.push(g),a=null}};for(;i!==null;){switch(i.content.constructor){case Rr:case No:this.adds(i)?this.deletes(i)||(d(),a="insert",c=i.content.getContent()[0],d()):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),f+=1):i.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Pr:this.adds(i)?this.deletes(i)||(a!=="insert"&&(d(),a="insert"),c+=i.content.str):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),f+=i.length):i.deleted||(a!=="retain"&&(d(),a="retain"),u+=i.length);break;case St:{let{key:g,value:k}=i.content;if(this.adds(i)){if(!this.deletes(i)){let L=(p=n.get(g))!=null?p:null;un(L,k)?k!==null&&i.delete(r):(a==="retain"&&d(),un(k,(m=s.get(g))!=null?m:null)?delete l[g]:l[g]=k)}}else if(this.deletes(i)){s.set(g,k);let L=(v=n.get(g))!=null?v:null;un(L,k)||(a==="retain"&&d(),l[g]=L)}else if(!i.deleted){s.set(g,k);let L=l[g];L!==void 0&&(un(L,k)?L!==null&&i.delete(r):(a==="retain"&&d(),k===null?delete l[g]:l[g]=k))}i.deleted||(a==="insert"&&d(),$s(n,i.content));break}}i=i.right}for(d();t.length>0;){let g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},hn=class extends Rt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new hn}clone(){let e=new hn;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Wu(this,e,t);al(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Pr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?nt(this.doc,r=>{let n=new ji(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let i=e[s];if(i.insert!==void 0){let a=!t&&typeof i.insert=="string"&&s===e.length-1&&n.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof a!="string"||a.length>0)&&Ru(r,this,n,a,i.attributes||{})}else i.retain!==void 0?dg(r,this,n,i.retain,i.attributes||{}):i.delete!==void 0&&pg(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,i=this.doc,a="",l=this._start;function c(){if(a.length>0){let f={},d=!1;s.forEach((m,v)=>{d=!0,f[v]=m});let p={insert:a};d&&(p.attributes=f),n.push(p),a=""}}let u=()=>{for(;l!==null;){if(Fs(l,e)||t!==void 0&&Fs(l,t))switch(l.content.constructor){case Pr:{let f=s.get("ychange");e!==void 0&&!Fs(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Fs(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case Rr:case No:{c();let f={insert:l.content.getContent()[0]};if(s.size>0){let d={};f.attributes=d,s.forEach((p,m)=>{d[m]=p})}n.push(f);break}case St:Fs(l,e)&&(c(),$s(s,l.content));break}l=l.right}c()};return e||t?nt(i,f=>{e&&Bu(f,e),t&&Bu(f,t),u()},"cleanup"):u(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?nt(n,s=>{let i=ja(s,this,e,!r);r||(r={},i.currentAttributes.forEach((a,l)=>{r[l]=a})),Ru(s,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?nt(n,s=>{let i=ja(s,this,e,!r);Ru(s,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?nt(r,n=>{pg(n,ja(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?nt(n,s=>{let i=ja(s,this,e,!1);i.right!==null&&dg(s,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?nt(this.doc,t=>{ol(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?nt(this.doc,r=>{sf(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return af(this,e)}getAttributes(){return Ug(this)}_write(e){e.writeTypeRef(ik)}},qS=o=>new hn,Ni=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===gn||t.constructor===Oo)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Oo=class extends Rt{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Oo}clone(){let e=new Oo;return e.insert(0,this.toArray().map(t=>t instanceof Rt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ni(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ni(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),jr(new Ni(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){al(this,e,new Ku(this,t,e))}toString(){return Fg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),zi(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?nt(this.doc,r=>{Rg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)nt(this.doc,r=>{let n=e&&e instanceof Rt?e._item:e;rl(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw Ar("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?nt(this.doc,r=>{Dg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Ag(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Eg(this,e)}slice(e=0,t=this.length){return Tg(this,e,t)}forEach(e){zi(this,e)}_write(e){e.writeTypeRef(lk)}},zS=o=>new Oo,gn=class extends Oo{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new gn(this.nodeName)}clone(){let e=new gn(this.nodeName),t=this.getAttributes();return Nh(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof Rt?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let a in e)r.push(a);r.sort();let n=r.length;for(let a=0;a<n;a++){let l=r[a];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?nt(this.doc,t=>{ol(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?nt(this.doc,r=>{sf(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return af(this,e)}hasAttribute(e){return Og(this,e)}getAttributes(e){return e?OS(this,e):Ug(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let i in s){let a=s[i];typeof a=="string"&&n.setAttribute(i,a)}return zi(this,i=>{n.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(ak),e.writeKey(this.nodeName)}},jS=o=>new gn(o.readKey()),Ku=class extends Ds{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},Us=class extends Uo{constructor(e){super(),this.hookName=e}_copy(){return new Us(this.hookName)}clone(){let e=new Us(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(ck),e.writeKey(this.hookName)}},WS=o=>new Us(o.readKey()),Os=class extends hn{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Os}clone(){let e=new Os;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let i in e.attributes[n])s.push({key:i,value:e.attributes[n][i]});s.sort((i,a)=>i.key<a.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let i=0;i<s.attrs.length;i++){let a=s.attrs[i];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(uk)}},KS=o=>new Os,Wi=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Kr()}mergeWith(e){return!1}write(e,t,r){throw Kr()}integrate(e,t){throw Kr()}},GS=0,cr=class extends Wi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Sg(e.doc.store,this)}write(e,t){e.writeInfo(GS),e.writeLen(this.length-t)}getMissing(e,t){return null}},Kn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Kn(this.content)}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},JS=o=>new Kn(o.readBuf()),Gn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Gn(this.len)}splice(e){let t=new Gn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Ja(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},QS=o=>new Gn(o.readLen()),Hg=(o,e)=>new Er({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Jn=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Jn(Hg(this.doc.guid,this.opts))}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},YS=o=>new Jn(Hg(o.readString(),o.readAny())),No=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new No(this.embed)}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},ZS=o=>new No(o.readJSON()),St=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new St(this.key,this.value)}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},XS=o=>new St(o.readKey(),o.readJSON()),Ns=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ns(this.arr)}splice(e){let t=new Ns(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},ek=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new Ns(t)},$o=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $o(this.arr)}splice(e){let t=new $o(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},tk=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new $o(t)},Pr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Pr(this.str)}splice(e){let t=new Pr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},rk=o=>new Pr(o.readString()),ok=[NS,$S,qS,jS,zS,WS,KS],nk=0,sk=1,ik=2,ak=3,lk=4,ck=5,uk=6,Rr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Rr(this.type._copy())}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},fk=o=>new Rr(ok[o.readTypeRef()](o)),mg=(o,e)=>{let t=e,r=0,n;do r>0&&(t=We(t.client,t.clock+r)),n=Wa(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof ht);return{item:n,diff:r}};var nl=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new ht(We(r,n+t),e,We(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=We(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var ht=class extends Wi{constructor(e,t,r,n,s,i,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=i,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Lt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Lt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===fn&&this.id.client!==this.parent.client&&this.parent.clock>=Lt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ag(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=mn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===cr||this.right&&this.right.constructor===cr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ht&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ht&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===fn){let r=Wa(t,this.parent);r.constructor===cr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=ag(e,e.doc.store,We(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,i=new Set;for(;n!==null&&n!==this.right;){if(i.add(n),s.add(n),Es(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(Es(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&i.has(Wa(e.doc.store,n.origin)))s.has(Wa(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Sg(e.doc.store,this),this.content.integrate(e,this),cg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new cr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:We(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Es(e.origin,this.lastId)&&this.right===e&&Es(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Ja(e.deleteSet,this.id.client,this.id.clock,this.length),cg(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Fr();this.content.gc(e),t?SS(e,this,new cr(this.id,this.length)):this.content=new Gn(this.length)}write(e,t){let r=t>0?We(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let a=this.parent;if(a._item!==void 0){let l=a._item;if(l===null){let c=wg(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===fn?(e.writeParentInfo(!1),e.writeLeftID(a)):Fr();s!==null&&e.writeString(s)}this.content.write(e,t)}},qg=(o,e)=>dk[e&31](o),dk=[()=>{Fr()},QS,ek,JS,rk,ZS,XS,fk,tk,YS,()=>{Fr()}],pk=10,ur=class extends Wi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Fr()}write(e,t){e.writeInfo(pk),He(e.restEncoder,this.length-t)}getMissing(e,t){return null}},zg=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},jg="__ $YJS$ __";zg[jg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");zg[jg]=!0;var Yn=o=>Ro((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Wg=(o,e)=>Ro((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(Ar(s.target.error)),n.onsuccess=s=>{let i=s.target.result;i.onversionchange=()=>{i.close()},t(i)}}),Kg=o=>Yn(indexedDB.deleteDatabase(o)),Gg=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),Dr=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>yk(r,n))},Bo=(o,e)=>Yn(o.count(e)),Jg=(o,e)=>Yn(o.get(e)),lf=(o,e)=>Yn(o.delete(e)),Qg=(o,e,t)=>Yn(o.put(e,t));var ll=(o,e)=>Yn(o.add(e)),Yg=(o,e,t)=>Yn(o.getAll(e,t));var mk=(o,e,t)=>{let r=null;return gk(o,e,n=>(r=n,!1),t).then(()=>r)},Zg=(o,e=null)=>mk(o,e,"prev");var hk=(o,e)=>Ro((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var gk=(o,e,t,r="next")=>hk(o.openKeyCursor(e,r),n=>t(n.key)),yk=(o,e)=>o.objectStore(e);var Xg=(o,e)=>IDBKeyRange.upperBound(o,e),ey=(o,e)=>IDBKeyRange.lowerBound(o,e);var cf="custom",ty="updates",ry=500,oy=(o,e=()=>{},t=()=>{})=>{let[r]=Dr(o.db,[ty]);return Yg(r,ey(o._dbref,!1)).then(n=>{o._destroyed||(e(r),nt(o.doc,()=>{n.forEach(s=>yo(o.doc,s))},o,!1),t(r))}).then(()=>Zg(r).then(n=>{o._dbref=n+1})).then(()=>Bo(r).then(n=>{o._dbsize=n})).then(()=>r)},bk=(o,e=!0)=>oy(o).then(t=>{(e||o._dbsize>=ry)&&ll(t,Ki(o.doc)).then(()=>lf(t,Xg(o._dbref,!0))).then(()=>Bo(t).then(r=>{o._dbsize=r}))});var yn=class extends gs{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Wg(e,r=>Gg(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Ro(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,oy(this,i=>ll(i,Ki(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=Dr(this.db,[ty]);ll(s,r),++this._dbsize>=ry&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{bk(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Kg(this.name)})}get(e){return this._db.then(t=>{let[r]=Dr(t,[cf],"readonly");return Jg(r,e)})}set(e,t){return this._db.then(r=>{let[n]=Dr(r,[cf]);return Qg(n,t,e)})}del(e){return this._db.then(t=>{let[r]=Dr(t,[cf]);return lf(r,e)})}};var wr=an(Nn());var ny=0,ul=1,sy=2,fl=(o,e)=>{He(o,ny);let t=_g(e);Nt(o,t)},uf=(o,e,t)=>{He(o,ul),Nt(o,Ki(e,t))},vk=(o,e,t)=>uf(e,t,zt(o)),iy=(o,e,t)=>{try{yo(e,zt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},ay=(o,e)=>{He(o,sy),Nt(o,e)},_k=iy,ly=(o,e,t,r)=>{let n=Be(o);switch(n){case ny:vk(o,e,t);break;case ul:iy(o,t,r);break;case sy:_k(o,t,r);break;default:throw new Error("Unknown message type")}return n};var wk=0;var cy=(o,e,t)=>{switch(Be(o)){case wk:t(e,Gr(o))}};var ff=3e4,dl=class extends gs{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=zn();this.getLocalState()!==null&&ff/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&ff<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&pl(this,r,"timeout")},lr(ff/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:zn()});let i=[],a=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&i.push(t):(a.push(t),Ts(s,e)||l.push(t)),(i.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:i,updated:l,removed:c},"local"]),this.emit("update",[{added:i,updated:a,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},pl=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let i=o.meta.get(s);o.meta.set(s,{clock:i.clock+1,lastUpdated:zn()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Bs=(o,e,t=o.states)=>{let r=e.length,n=Vn();He(n,r);for(let s=0;s<r;s++){let i=e[s],a=t.get(i)||null,l=o.meta.get(i).clock;He(n,i),He(n,l),Po(n,JSON.stringify(a))}return vr(n)};var uy=(o,e,t)=>{let r=Jr(e),n=zn(),s=[],i=[],a=[],l=[],c=Be(r);for(let u=0;u<c;u++){let f=Be(r),d=Be(r),p=JSON.parse(Gr(r)),m=o.meta.get(f),v=o.states.get(f),g=m===void 0?0:m.clock;(g<d||g===d&&p===null&&o.states.has(f))&&(p===null?f===o.clientID&&o.getLocalState()!=null?d++:o.states.delete(f):o.states.set(f,p),o.meta.set(f,{clock:d,lastUpdated:n}),m===void 0&&p!==null?s.push(f):m!==void 0&&p===null?l.push(f):p!==null&&(Ts(p,v)||a.push(f),i.push(f)))}(s.length>0||a.length>0||l.length>0)&&o.emit("change",[{added:s,updated:a,removed:l},t]),(s.length>0||i.length>0||l.length>0)&&o.emit("update",[{added:s,updated:i,removed:l},t])};var Hs=()=>new Map,hy=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},gy=()=>new Set,Ik=Array.from,T3=Array.isArray,yy=String.fromCharCode,A3=String.fromCodePoint,F3=yy(65535),Ck=o=>o.toLowerCase(),Lk=/^\s*/g,Mk=o=>o.replace(Lk,""),Tk=/([A-Z])/g,fy=(o,e)=>Mk(o.replace(Tk,t=>`${e}${Ck(t)}`)),Ak=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Gi=typeof TextEncoder!="undefined"?new TextEncoder:null,Fk=o=>Gi.encode(o),Ek=Gi?Fk:Ak,df=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});df&&df.decode(new Uint8Array).length===1&&(df=null);var dy=o=>o===void 0?null:o,Pk=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},by=new Pk,bf=!0;try{typeof localStorage!="undefined"&&(by=localStorage,bf=!1)}catch(o){}var vy=by,Rk=o=>bf||addEventListener("storage",o),Dk=o=>bf||removeEventListener("storage",o),Uk=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},Ok=(o,e)=>e.includes(o),js=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),_y=typeof window!="undefined"&&typeof document!="undefined"&&!js,E3=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,bo,Nk=[],$k=()=>{if(bo===void 0)if(js){bo=Hs();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&bo.set(e,""),e=r):e!==null?(bo.set(e,r),e=null):Nk.push(r)}e!==null&&bo.set(e,"")}else typeof location=="object"?(bo=Hs(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");bo.set(`--${fy(e,"-")}`,t),bo.set(`-${fy(e,"-")}`,t)}})):bo=Hs();return bo},mf=o=>$k().has(o),hf=o=>dy(js?process.env[o.toUpperCase()]:vy.getItem(o)),Bk=o=>mf("--"+o)||hf(o)!==null,P3=Bk("production"),py=js&&Ok(process.env.FORCE_COLOR,["true","1","2"]),R3=!mf("no-colors")&&(!js||process.stdout.isTTY||py)&&(!js||mf("color")||py||hf("COLORTERM")!==null||(hf("TERM")||"").includes("color")),xy=Math.floor,wy=(o,e)=>o<e?o:e,Vk=(o,e)=>o>e?o:e,D3=Number.isNaN,Hk=Math.pow,Sy=128,qk=1<<17,zk=1<<18,jk=1<<19,Wk=1<<20,Kk=1<<21,Gk=1<<22,Jk=1<<23,Qk=1<<24,Yk=1<<25,Zk=1<<26,Xk=1<<27,eI=1<<28,tI=1<<29,rI=1<<30,U3=1<<31,ml=127,O3=qk-1,N3=zk-1,$3=jk-1,B3=Wk-1,V3=Kk-1,H3=Gk-1,q3=Jk-1,z3=Qk-1,j3=Yk-1,W3=Zk-1,K3=Xk-1,G3=eI-1,J3=tI-1,Q3=rI-1,oI=Number.MAX_SAFE_INTEGER,Y3=Number.MIN_SAFE_INTEGER,Z3=1<<31,X3=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&xy(o)===o),e4=Number.isNaN,t4=Number.parseInt,nI=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Qr=()=>new nI,vf=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Ur=o=>{let e=new Uint8Array(vf(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(Cy(o.cbuf.buffer,0,o.cpos),t),e},hl=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Xt=(o,e)=>{for(;e>ml;)hl(o,Sy|ml&e),e=xy(e/128);hl(o,ml&e)},gf=new Uint8Array(3e4),sI=gf.length/3,iI=(o,e)=>{if(e.length<sI){let t=Gi.encodeInto(e,gf).written||0;Xt(o,t);for(let r=0;r<t;r++)hl(o,gf[r])}else qs(o,Ek(e))},aI=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Xt(o,r);for(let n=0;n<r;n++)hl(o,t.codePointAt(n))},r4=Gi&&Gi.encodeInto?iI:aI,lI=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=wy(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Vk(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},qs=(o,e)=>{Xt(o,e.byteLength),lI(o,e)},o4=new DataView(new ArrayBuffer(4)),ky=o=>new Error(o),cI=ky("Unexpected end of array"),uI=ky("Integer out of Range"),fI=class{constructor(o){this.arr=o,this.pos=0}},dI=o=>new fI(o),pI=(o,e)=>{let t=Cy(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},mI=o=>pI(o,Iy(o)),Iy=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&ml)*t,t*=128,n<Sy)return e;if(e>oI)throw uI}throw cI},hI=o=>new Uint8Array(o),Cy=(o,e,t)=>new Uint8Array(o,e,t),gI=o=>new Uint8Array(o),yI=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=yy(o[t]);return btoa(e)},bI=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),vI=o=>{let e=atob(o),t=hI(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},_I=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},xI=_y?yI:bI,wI=_y?vI:_I,Ly=new Map,SI=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:wI(e.newValue||"")}),Rk(this._onChange)}postMessage(o){vy.setItem(this.room,xI(gI(o)))}close(){Dk(this._onChange)}},kI=typeof BroadcastChannel=="undefined"?SI:BroadcastChannel,_f=o=>hy(Ly,o,()=>{let e=gy(),t=new kI(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),II=(o,e)=>(_f(o).subs.add(e),e),CI=(o,e)=>{let t=_f(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),Ly.delete(o)),r},Vs=(o,e,t=null)=>{let r=_f(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},yf=Date.now,LI=class{constructor(){this._observers=Hs()}on(o,e){hy(this._observers,o,gy).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return Ik((this._observers.get(o)||Hs()).values()).forEach(t=>t(...e))}destroy(){this._observers=Hs()}},MI=o=>Uk(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Zn=0,My=3,zs=1,TI=2,Ji=[];Ji[Zn]=(o,e,t,r,n)=>{Xt(o,Zn);let s=ly(e,o,t.doc,t);r&&s===ul&&!t.synced&&(t.synced=!0)};Ji[My]=(o,e,t,r,n)=>{Xt(o,zs),qs(o,Bs(t.awareness,Array.from(t.awareness.getStates().keys())))};Ji[zs]=(o,e,t,r,n)=>{uy(t.awareness,mI(e),t)};Ji[TI]=(o,e,t,r,n)=>{cy(e,t.doc,(s,i)=>AI(t,i))};var my=3e4,AI=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Ty=(o,e,t)=>{let r=dI(e),n=Qr(),s=Iy(r),i=o.messageHandlers[s];return i?i(n,r,o,t,s):console.error("Unable to compute message"),n},Ay=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=yf();let r=Ty(o,new Uint8Array(t.data),!0);vf(r)>1&&e.send(Ur(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,pl(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Ay,wy(Hk(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=yf(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Qr();if(Xt(t,Zn),fl(t,o.doc),e.send(Ur(t)),o.awareness.getLocalState()!==null){let r=Qr();Xt(r,zs),qs(r,Bs(o.awareness,[o.doc.clientID])),e.send(Ur(r))}},o.emit("status",[{status:"connecting"}])}},pf=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Vs(o.bcChannel,e,o)},Fy=class extends LI{constructor(o,e,t,{connect:r=!0,awareness:n=new dl(t),params:s={},WebSocketPolyfill:i=WebSocket,resyncInterval:a=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=MI(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=i,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Ji.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,a>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let f=Qr();Xt(f,Zn),fl(f,t),this.ws.send(Ur(f))}},a)),this._bcSubscriber=(f,d)=>{if(d!==this){let p=Ty(this,new Uint8Array(f),!1);vf(p)>1&&Vs(this.bcChannel,Ur(p),this)}},this._updateHandler=(f,d)=>{if(d!==this){let p=Qr();Xt(p,Zn),ay(p,f),pf(this,Ur(p))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:f,updated:d,removed:p},m)=>{let v=f.concat(d).concat(p),g=Qr();Xt(g,zs),qs(g,Bs(n,v)),pf(this,Ur(g))},this._unloadHandler=()=>{pl(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var f;this.wsconnected&&my<yf()-this.wsLastMessageReceived&&((f=this.ws)==null||f.close())},my/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(II(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Qr();Xt(o,Zn),fl(o,this.doc),Vs(this.bcChannel,Ur(o),this);let e=Qr();Xt(e,Zn),uf(e,this.doc),Vs(this.bcChannel,Ur(e),this);let t=Qr();Xt(t,My),Vs(this.bcChannel,Ur(t),this);let r=Qr();Xt(r,zs),qs(r,Bs(this.awareness,[this.doc.clientID])),Vs(this.bcChannel,Ur(r),this)}disconnectBc(){let o=Qr();Xt(o,zs),qs(o,Bs(this.awareness,[this.doc.clientID],new Map)),pf(this,Ur(o)),this.bcconnected&&(CI(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Ay(this),this.connectBc())}};var $t=new WeakMap,Ey=!1;function yl(o){Ey=o}var Or={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3,allowStackTraces:!1},er,tr,gl=[];function Py(o,e,t,r){tr=o,er=t,r&&(Or={...Or,...r}),e.setInterval(wf,Or.batchInterval)}async function wf(){if(gl.length===0)return;let o=[...gl];gl.length=0;for(let e=0;e<Or.maxRetries;e++)try{await FI();let t=o.map(xf).join(`
`)+`
`;await tr.append(er,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Or.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function FI(){let o=await tr.stat(er);if(o&&o.size>Or.maxFileSize){for(let e=Or.maxBackups;e>0;e--){let t=`${er}.${e}`,r=`${er}.${e+1}`;await tr.exists(t)&&(e===Or.maxBackups?await tr.remove(t):await tr.rename(t,r))}await tr.exists(er)&&await tr.rename(er,`${er}.1`),await tr.write(er,"")}}function xf(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}var EI=["token","authorization","email","key"];function PI(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&EI.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Fe(o,e="log"){return(...t)=>{if(Ey){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",i=t.map(PI).join(" "),a={timestamp:r,level:e,message:`${o}: ${i}`,callerInfo:s};if(!Or.disableConsole)if(Or.allowStackTraces||e==="debug"||e==="log")console[e](xf(a));else{let l={warn:"color: #ff8c00; background: rgba(255, 140, 0, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;",error:"color: #ff5555; background: rgba(255, 85, 85, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;"};console.log(`%c${xf(a)}`,l[e])}gl.push(a)}}}async function bl(){let o=[];await tr.exists(er)&&o.push(er);for(let e=1;e<=Or.maxBackups;e++){let t=`${er}.${e}`;await tr.exists(t)&&o.push(t)}return o}async function Ry(){let o=[];if(await tr.exists(er)){let e=await tr.read(er);o.push(e)}for(let e=1;e<=Or.maxBackups;e++){let t=`${er}.${e}`;if(await tr.exists(t)){let r=await tr.read(t);o.push(r)}}return o.reverse().join(`
`)}var Mt=class{constructor(e){let t=e||this.constructor.name;this.debug=Fe(`[${t}]`,"debug"),this.log=Fe(`[${t}]`,"log"),this.warn=Fe(`[${t}]`,"warn"),this.error=Fe(`[${t}]`,"error")}setLoggers(e){this.debug=Fe(`[${e}]`,"debug"),this.log=Fe(`[${e}]`,"log"),this.warn=Fe(`[${e}]`,"warn"),this.error=Fe(`[${e}]`,"error")}};var Sf=class{constructor(){this.platform="s3rn";this.product="relay"}},kf=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Vo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},vo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},Yr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},_o=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},If=class{constructor(e,t,r,n,s,i){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=n;this.contentType=s;this.contentLength=i;this.platform="s3rn";this.product="relay"}},Nr=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Ho=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Xn=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},Ws=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},bt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,i,a,l,c,u,f,d,p,m,v]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(a&&!this.validateUUID(a))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&i==="folder"&&l==="doc")return new vo(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="canvas")return new Yr(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file"&&u==="hash"&&d==="contentType"&&m==="contentLength")return new If(s,a,c,f,p,v);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file")return new _o(s,a,c);if(r==="relay"&&n==="relay"&&i=="folder")return new Vo(s,a);if(r==="relay"&&n==="folder"&&i==="document")return new Ho(s,a);if(r==="relay"&&n==="folder"&&i==="canvas")return new Xn(s,a);if(r==="relay"&&n==="folder")return new Nr(s);if(r==="relay"&&n==="relay")return new kf(s);if(n===void 0)return new Sf;throw new Error("Invalid s3rn format for the given product type")}};function RI(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Dy(o){let e=JSON.stringify(o),t=RI(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Qi={enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableNetworkLogging:!1,enableCanvasSync:!1,enableVerifyUploads:!1,enableAutomaticDiffResolution:!1,enableDiscordLogin:!1,enableSelfManageHosts:!0,enableToasts:!1};function vl(o){return o in Qi}function DI(){return new Proxy({},{get:(o,e)=>e})}var qo=DI();var Ks=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var jt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return jt.instance||(jt.instance=new jt(new Ks),$t.set(this.instance,"postie")),jt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Fe("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Fe("[postie]","warn")(`All Mail Log:
`+this.prettyPrintMailLog(this.allMailLog))}prettyPrintDeliveredMailLog(){Fe("[postie]","warn")(`Delivered Mail Log:
`+this.prettyPrintMailLog(this.deliveredMailLog))}prettyPrintMailLog(e){let t="",r=n=>{t+=`${n}
`};return e.forEach((n,s)=>{r(`Mail #${s+1}:`),r(`  Timestamp: ${new Date(n.timestamp).toISOString()}`),r(`  Transaction ID: ${n.transactionId}`),r(`  Sender: ${n.sender.observableName||n.sender.constructor.name}`),r(`  Recipient: ${n.recipient.name||"Anonymous function"}`),r(`  Recipient Origin: ${n.recipientOrigin||"Unknown"}`),r("---")}),t}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){jt.instance&&(jt.instance.mailboxes=null,jt.instance.allMailLog=[],jt.instance.deliveredMailLog=[],jt.instance.timeProvider.destroy(),jt.instance.timeProvider=null,jt.instance.isDelivering=!1,jt.instance.isInTransaction=!1,jt.instance.currentTransactionId=0,jt._destroyed=!0,jt.instance=void 0)}},$r=jt;$r._destroyed=!1;var Cf=new Map;function Uy(){for(let[,o]of Cf)o();Cf.clear()}var st=class extends Mt{constructor(t){super();this.observableName=t;this.destroyed=!1;Cf.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)$r.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),$r.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Ze(){return{..._t.getInstance().flags}}function bn(o,e,t=()=>{}){_t.getInstance().flags[o]?e():t()}function Oy(o,e,t=()=>{}){o.forEach(r=>{if(_t.getInstance().flags[r]){e();return}}),t()}var _t=class extends st{constructor(){super("FeatureFlagManager");this.flags=Qi}async applyServerFlags(t){if(!this.settings)return;let n=t.filter(s=>s.override).reduce((s,i)=>(s[i.name]=i.value,s),{});this.log("applying server flags",n),await this.settings.update(s=>({...s,...n}),!0)}static getInstance(){return _t.instance||(_t.instance=new _t),_t.instance}setSettings(t){this.settings=t,this.unsubscribes.push(this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()}))}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(n=>({...n,[t]:r}))}static destroy(){_t.instance&&_t.instance.destroy(),_t.instance=null}};var UI={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Ny(o,e,t){let r={token:o.token},n=new Fy(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,id:t.id,color:t.color.color,colorLight:t.color.light}),n}var zo=class extends Mt{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let i=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new Er,Ze().enableDocumentHistory&&(this.ydoc.gc=!1),i&&new Za(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,i.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(bt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Ny(this.clientToken,this.ydoc,i);let a=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let f=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),f&&this.connect()});a.on(),this._offConnectionError=a.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Dy(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(bt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var i;this.clientToken=t;let r=new Er,n=Ny(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let a=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${a}`),(i=this._provider.ws)==null||i.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:UI[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.ws&&(this._provider.ws.onopen=null,this._provider.ws.onmessage=null,this._provider.ws.onerror=null,this._provider.ws.onclose=null,(this._provider.ws.readyState===WebSocket.OPEN||this._provider.ws.readyState===WebSocket.CONNECTING)&&this._provider.ws.close(1e3,"Destroyed"),this._provider.ws=null),this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var jo=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},_l=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(i){s(i)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r(a.result?a.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r()}catch(s){n(s)}})}};var Zr=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{Fe("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[i,a]=this.checkFunction();i&&r(a)},3e3),this.promiseFunction().then(i=>{this.timeoutId&&clearTimeout(this.timeoutId),n(i)},i=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(i)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},xl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Fe("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function $y(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{Fe("[Promise]","debug")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var OI={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function vn(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return OI[e]||"application/octet-stream"}var By=an(Lf());function Js(o,e,t){let r=o.getText("contents"),n=r.toString(),s=new By.diff_match_patch,i=s.diff_main(n,e);s.diff_cleanupSemantic(i);let a=0,l=Ze().enableDeltaLogging?Fe("[diffMatchPatch]","debug"):(...c)=>{};l("Updating YDoc:"),l("Current content length:",n.length),l("Disk buffer length:",e.length),i.length!=0&&(o.transact(()=>{for(let[c,u]of i){switch(c){case 1:l(`Inserting "${u}" at position ${a}`),r.insert(a,u),a+=u.length;break;case 0:l(`Keeping "${u}" (length: ${u.length})`),a+=u.length;break;case-1:l(`Deleting "${u}" at position ${a}`),r.delete(a,u.length);break}l("intermediate",r.toString())}},t),l("result",r.toString()),l("Update complete. New content length:",r.toString().length))}function Xr(o){return o instanceof Tt}var Tt=class extends zo{constructor(t,r,n,s){let i=s.relayId?new vo(s.relayId,s.guid,r):new Ho(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this.pendingOps=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new yn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{let a=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(a),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(a)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),bn(qo.enableDeltaLogging,()=>{let a=l=>{var u,f;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(f=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:f.name}
`;for(let d of l.changes.delta)c+=`insert: ${d.insert}

retain: ${d.retain}

delete: ${d.delete}
`;this.debug(c)};this.ytext.observe(a),this.unsubscribes.push(()=>{this.ytext.unobserve(a)})}),this._tfile=null}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}async process(t){this.tfile&&Ze().enableAutomaticDiffResolution&&this.pendingOps.push(t)}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this.getTFile()),this._tfile}getTFile(){var t;return(t=this._parent)==null?void 0:t.getTFile(this)}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new jo(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=await this.sharedFolder.backgroundSync.downloadItem(this),s=new Uint8Array(n.arrayBuffer);yo(this.ydoc,s);let i=this.text!==r,a=this.text,l=a,c=[];for(let u of this.pendingOps)if(l=u(l),c.push(u),l==r){if(this.clearDiskBuffer(),a==this.text)Js(this.ydoc,l,this);else return Ze().enableDeltaLogging?this.warn("diffMatchPatch solution is stale an cannot be applied",l,this.text):this.log("diffMatchPatch solution is stale an cannot be applied"),!0;return this.pendingOps=[],!0}return this.pendingOps=[],i||this.clearDiskBuffer(),i}async connect(){return this.sharedFolder.s3rn instanceof Nr?!1:(this.s3rn instanceof Ho&&(this.sharedFolder.relayId?this.s3rn=new vo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ho(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Zr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Zr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return vn(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Dr(this._persistence.db,["updates"],"readonly"),r=await Bo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,this._parent=null}async read(){return this.text}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var _n=class extends st{constructor(){super();this._set=new Set}add(t){let r=this._set.size;return this._set.add(t),this._set.size>r&&this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var Wo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var Mf=require("obsidian");function Tf(o){return o instanceof xn}var xn=class extends Mt{constructor(t,r,n){super();this.path=t;this.guid=r;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let s=()=>{let i=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));return i instanceof Mf.TFolder?(this._tfolder=i,this.ready=!0,!0):!1};s()||(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0}).catch(()=>{s()})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r){return console.log("virtualpath for new syncfolder",t.getVirtualPath(r.path)),new xn(t.getVirtualPath(r.path),Ms(),t)}disconnect(){this.connected=!1}move(t,r){t!==this.path&&(this._parent=r,this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Mf.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this._tfolder=null}};var xo=an(Nn());var wl,NI=new Uint8Array(16);function Af(){if(!wl&&(wl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wl(NI)}var Wt=[];for(let o=0;o<256;++o)Wt.push((o+256).toString(16).slice(1));function Vy(o,e=0){return Wt[o[e+0]]+Wt[o[e+1]]+Wt[o[e+2]]+Wt[o[e+3]]+"-"+Wt[o[e+4]]+Wt[o[e+5]]+"-"+Wt[o[e+6]]+Wt[o[e+7]]+"-"+Wt[o[e+8]]+Wt[o[e+9]]+"-"+Wt[o[e+10]]+Wt[o[e+11]]+Wt[o[e+12]]+Wt[o[e+13]]+Wt[o[e+14]]+Wt[o[e+15]]}var $I=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ff={randomUUID:$I};function BI(o,e,t){if(Ff.randomUUID&&!e&&!o)return Ff.randomUUID();o=o||{};let r=o.random||(o.rng||Af)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return Vy(r)}var Qs=BI;var VI={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function Sl(o){return(o==null?void 0:o.type)==="markdown"}function Hy(o){return(o==null?void 0:o.type)==="folder"}function qy(o){return(o==null?void 0:o.type)==="file"}function Zi(o){return{version:0,id:o,type:"markdown"}}function zy(o){return{version:0,id:o,type:"canvas"}}function kl(o){return{version:0,id:o,type:"folder"}}function jy(o,e,t,r,n){return n||(n=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:n,hash:r}}var Ef=class extends st{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||Ef.defaults,r.forEach(([n,s])=>this.protocols.set(n,s)),this.unsubscribes.push(t.subscribe(n=>{this.updateFromSettings(n)}))}setEnabled(t,r){let n=this.protocols.get(t);n&&this.protocols.set(t,{...n,enabled:r})}canSync(t,r){var i,a;if(t.endsWith(".md")||Ze().enableCanvasSync&&t.endsWith(".canvas")||!((i=t.split("/").pop())==null?void 0:i.includes(".")))return!0;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let s=this.getTypeForPath(t);return!!((a=this.protocols.get(s))!=null&&a.enabled)}updateFromSettings(t){Object.entries(VI).forEach(([r,n])=>{this.setEnabled(n,t[r])})}getEnabledFileSyncTypes(){let t=[];return this.protocols.forEach((r,n)=>{r!=null&&r.enabled&&n!=="folder"&&t.push(n)}),t}getTypeForPath(t){let r=vn(t);for(let[n,s]of this.protocols)if(s.mimetypes.includes(r))return!Ze().enableCanvasSync&&n==="canvas"?"file":n;return"file"}},Yi=Ef;Yi.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var Il=class extends st{constructor(t,r,n,s){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.syncSettingsManager=s;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new Yi(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+xo.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let i=this.meta.get(t);Hy(i)?this.moveFolder(t,r):i&&(this.set(r,i),this.delete(t))}new(t){this.assertVPath(t);let r=Qs();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}willSet(t,r){if(this.assertVPath(t),Sl(r)&&this.legacyIds.get(t)!==r.id)return this.log("legacy vpath set to a different ID",this.legacyIds.get(t),r.id),!0;let n=this.meta.get(t);return n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash?!1:(this.log("new meta diff",n,r),!0)}set(t,r){this.assertVPath(t),Sl(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let n=this.meta.get(t);n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,n,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,i)=>{if(s.action==="delete"){let a=s.oldValue;(a==null?void 0:a.type)==="folder"&&r.set(a.id,i)}else if(s.action==="add"||s.action==="update"){let a=this.meta.get(i);(a==null?void 0:a.type)==="folder"&&n.set(a.id,i)}}),r.forEach((s,i)=>{let a=n.get(i);if(a&&s!==a){this.log(`Detected folder move from ${s} to ${a}`);let l=new Map;this.meta.forEach((c,u)=>{u.startsWith(a+xo.sep)&&l.set(u,c)}),this.renames.set(s,a),this.log("setting alias",s,a),this.log("paths to move",l),l.forEach((c,u)=>{let f=u.slice(a.length),d=s+f;this.renames.set(d,u),this.log("setting alias",d,u)})}})}start(){bn(qo.enableDeltaLogging,()=>{let n=s=>{var a,l;let i="";i+=`Transaction origin: ${s.transaction.origin}${(l=(a=s.transaction.origin)==null?void 0:a.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((c,u)=>{c.action==="add"&&(i+=`Added ${u}: ${this.get(u)}
`),c.action==="update"&&(i+=`Updated ${u}: ${this.get(u)}
`),c.action==="delete"&&(i+=`Deleted ${u}
`)}),this.debug(i)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),i=Zi(s);return this.overlay.set(t,i),i}if(r){if(Sl(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,i)=>{let a;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===s&&c!==i&&(a=c)}),a){let l=(0,xo.dirname)(a),c=(0,xo.dirname)(i);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([s],[i])=>i.length-s.length).forEach(([s,i])=>{r.has(s)||(this.moveFolder(s,i),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((i,a)=>{(a===t||a.startsWith(t+xo.sep))&&n.set(a,i)}),this.overlay.forEach((i,a)=>{(a===t||a.startsWith(t+xo.sep))&&n.set(a,i)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((i,a)=>{if(a===t)return;let l=a.slice(t.length),c=r+l;this.move(a,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var a;if(this.assertVPath(r),((a=this.meta.get(r))==null?void 0:a.id)===t)return;let n=new Set,s=r.split(xo.sep),i="";for(let l=0;l<s.length-1;l++)i=s.slice(0,l+1).join(xo.sep),n.add(i);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,Zi(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=Qs();console.log("creating folder path",l,c),this.overlay.set(l,kl(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function Wy(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...i){return i.length>0&&typeof i[0]=="string"&&(i[0]=t(i[0],e)),s.apply(r,i)}:s}})}var Xy=require("obsidian"),eb=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkfetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(eb.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=Zy()));var it=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.6.1"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},i;if(i=await(0,Xy.requestUrl)(s),!i.arrayBuffer.byteLength)return new Response(null,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});let a=new Response(i.arrayBuffer,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});if(Object.defineProperty(a,"json",{value:async()=>JSON.parse(i.text)}),Ze().enableNetworkLogging){let c=i.status>=500?"error":i.status>=400?"warn":"debug",u=i.text,f;if((i.headers["content-type"]||"").includes("application/json"))try{f=JSON.parse(u)}catch(p){}Fe("[CustomFetch]",c)(i.status.toString(),r,t,f||u)}if(i.status>=500)throw new Error(i.text);return a};var rr=class extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,rr.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof rr||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Cl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function tC(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||rC,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let i=o.indexOf(";",n);if(i===-1)i=o.length;else if(i<s){n=o.lastIndexOf(";",s-1)+1;continue}let a=o.slice(n,s).trim();if(t[a]===void 0){let l=o.slice(s+1,i).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[a]=r(l)}catch(c){t[a]=l}}n=i+1}return t}function tb(o,e,t){let r=Object.assign({},t||{}),n=r.encode||oC;if(!Cl.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!Cl.test(s))throw new TypeError("argument val is invalid");let i=o+"="+s;if(r.maxAge!=null){let a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!Cl.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!Cl.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function rC(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function oC(o){return encodeURIComponent(o)}var nb;function Ll(o){if(o)try{let e=decodeURIComponent(nb(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function sb(o,e=0){let t=Ll(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}nb=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,i="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?i+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var rb="pb_auth",ea=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!sb(this.token)}get isAdmin(){return Ll(this.token).type==="admin"}get isAuthRecord(){return Ll(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=rb){let r=tC(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=rb){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=Ll(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=tb(t,JSON.stringify(s),e),a=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(s.model&&a>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let u=["collectionId","username","verified"];for(let f in this.model)u.includes(f)&&(s.model[f]=this.model[f]);i=tb(t,JSON.stringify(s),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Rf=class extends ea{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Ko=class{constructor(e){this.client=e}},Df=class extends Ko{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,s,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},ta=class extends Ko{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var s;return n.items=((s=n.items)==null?void 0:s.map(i=>this.decode(i)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new rr({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new rr({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then(i=>{let a=i.items;return r=r.concat(a),a.length==i.perPage?n(s+1):r});return n(1)}};function _r(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Pf(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Uf=class extends ta{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=_r("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let i=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||Pf(this.client);let a=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return a=this.authResponse(a),i&&function(c,u,f,d){Pf(c);let p=c.beforeSend,m=c.authStore.model,v=c.authStore.onChange((g,k)=>{(!g||(k==null?void 0:k.id)!=(m==null?void 0:m.id)||(k!=null&&k.collectionId||m!=null&&m.collectionId)&&(k==null?void 0:k.collectionId)!=(m==null?void 0:m.collectionId))&&Pf(c)});c._resetAutoRefresh=function(){v(),c.beforeSend=p,delete c._resetAutoRefresh},c.beforeSend=async(g,k)=>{var M;let L=c.authStore.token;if((M=k.query)!=null&&M.autoRefresh)return p?p(g,k):{url:g,sendOptions:k};let I=c.authStore.isValid;if(I&&sb(c.authStore.token,u))try{await f()}catch(A){I=!1}I||await d();let C=k.headers||{};for(let A in C)if(A.toLowerCase()=="authorization"&&L==C[A]&&c.authStore.token){C[A]=c.authStore.token;break}return k.headers=C,p?p(g,k):{url:g,sendOptions:k}}}(this.client,i,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s))),a}async authRefresh(e,t){let r={method:"POST"};return r=_r("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=_r("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then(()=>!0)}},nC=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function ib(o){if(o){o.query=o.query||{};for(let e in o)nC.includes(e)||(o.query[e]=o[e],delete o[e])}}var Ml=class extends Ko{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let n=e;if(r){ib(r);let a="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+a}let s=function(a){let l=a,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(u){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let i of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,i);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let i in n){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let a=!1;for(let l=this.subscriptions[i].length-1;l>=0;l--)this.subscriptions[i][l]===t&&(a=!0,delete this.subscriptions[i][l],this.subscriptions[i].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(i,t));a&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new rr(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Of=class extends ta{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i,a;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s,i;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=_r("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then(i=>this.authResponse(i))}async authWithOAuth2Code(e,t,r,n,s,i,a){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=_r("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,i,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new rr(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new Ml(this.client),i=null;function a(){i==null||i.close(),s.unsubscribe()}return t.urlCallback||(i=ob(void 0)),new Promise(async(l,c)=>{var u;try{await s.subscribe("@oauth2",async m=>{let v=s.clientId;try{if(!m.state||v!==m.state)throw new Error("State parameters don't match.");let g=Object.assign({},t);delete g.provider,delete g.scopes,delete g.createData,delete g.urlCallback;let k=await this.authWithOAuth2Code(r.name,m.code,r.codeVerifier,n,t.createData,g);l(k)}catch(g){c(new rr(g))}a()});let f={state:s.clientId};(u=t.scopes)!=null&&u.length&&(f.scope=t.scopes.join(" "));let d=this._replaceQueryParams(r.authUrl+n,f);await(t.urlCallback||function(m){i?i.location.href=m:i=ob(m)})(d)}catch(f){a(),c(new rr(f))}})}async authRefresh(e,t){let r={method:"POST"};return r=_r("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=_r("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=_r("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=_r("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=_r("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},i=n.split("&");for(let a of i){if(a=="")continue;let l=a.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete s[a]:s[a]=t[a]);n="";for(let a in s)s.hasOwnProperty(a)&&(n!=""&&(n+="&"),n+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(s[a].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function ob(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new rr(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,i=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+i+",left="+s+",resizable,menubar=no")}var Nf=class extends ta{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},$f=class extends Ko{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new rr({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Bf=class extends Ko{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Vf=class extends Ko{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+i}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Hf=class extends Ko{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},es=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Rf,this.admins=new Uf(this),this.collections=new Nf(this),this.files=new Vf(this),this.logs=new $f(this),this.settings=new Df(this),this.realtime=new Ml(this),this.health=new Bf(this),this.backups=new Hf(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Of(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let s={};try{s=await n.json()}catch(i){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new rr({url:n.url,status:n.status,data:s});return s}).catch(n=>{throw new rr(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),ib(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let i of s)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let i of n)t.push(s+"="+encodeURIComponent(i));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var Tl=class extends Mt{constructor(t){super();this.sharedFolder=t;let r=t.loginManager.getEndpointManager().getAuthUrl();this.pb=new es(r,t.loginManager.authStore),this.tokenStore=t.tokenStore}async verify(t){if(!t.meta)throw new Error("cannot head file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(bt.encode(t.s3rn),r,t.mimetype,0);return(await it(n.baseUrl,{method:"HEAD",headers:{Authorization:`Bearer ${n.token}`}})).status===200}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(bt.encode(t.s3rn),r,t.mimetype,0),s=await it(n.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(s.status===404)throw new Error(`[${this.sharedFolder.path}] File is missing: ${t.guid} ${t.meta.hash} ${t.meta.type}`);let a=(await s.json()).downloadUrl;return(await it(a)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),n=await t.caf.hash();if(this.log("writeFile",n),!(r&&n))throw new Error("invalid caf");let s=await this.tokenStore.getFileToken(bt.encode(t.s3rn),n,t.mimetype,r.byteLength),i=await it(s.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${s.token}`}}),a=await i.json();if(i.status!==200)throw new Error(a.error);let l=a.uploadUrl;await it(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null,this.sharedFolder=null}};var fr=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Al=class extends st{constructor(t,r){super("Settings");this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},or=class extends st{constructor(t,r){super(`NamespacedSettings[${r}]`);this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new fr("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new fr(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([a])=>s.test(a)).reduce((a,[l,c])=>(a[l]=c,a),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new fr("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([u,f])=>{l.test(u)&&(c[u]=f)}),c}let s={...r},i=s;this.path.forEach(l=>{i[l]=i[l]||{},i=i[l]});let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{a.test(l)&&(i[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new fr(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(a=>a),n=[],s=[],i=[];return r.forEach((a,l)=>{let c=a.match(/^\[(\w+)=(.+)\]$/),u=a.match(/^\((.+?)\)$/);if(c){let[,f,d]=c,p=l>0?s[l-1]:a.split("[")[0];i.push({type:"arrayMatch",key:f,value:d,level:l}),n.push(a),s.push(p)}else if(u){let[,f]=u;i.push({type:"wildcard",wildcardPattern:this.createPatternRegex(f),level:l}),n.push(a),s.push(a)}else n.push(a),s.push(a)}),[n,s,i]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>i.test(l)).reduce((l,[c,u])=>(l[c]=u,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let i=this.basePath[0];if(!Array.isArray(r[i]))return;let a=r[i].find(c=>c[s.key]===s.value);if(!a)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=a;for(let u of l){if(!c||typeof c!="object")return;c=c[u]}return c}return a}for(let i=0;i<this.basePath.length;i++){if(!r)return;r=r[this.basePath[i]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(f=>f[s.key]===s.value),u=this.basePath.slice(s.level+1);if(c>=0)if(u.length>0){let f=n[l][c];for(let p=0;p<u.length-1;p++){let m=u[p];f[m]=f[m]||{},f=f[m]}let d=u[u.length-1];f[d]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(u.length>0){let f={[s.key]:s.value},d=f;for(let m=0;m<u.length-1;m++){let v=u[m];d[v]={},d=d[v]}let p=u[u.length-1];d[p]=r,n[l].push(f)}else n[l].push({...r,[s.key]:s.value});return n}let i=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];i[c]=i[c]||{},i=i[c]}let a=this.basePath[this.basePath.length-1];return i[a]=r,n}getParent(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new or(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new or(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,i=this.basePath.slice(0,-1);for(let l of i){if(!s[l])return r;s=s[l]}let a=this.basePath[this.basePath.length-1];return delete s[a],r})}subscribe(t){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var wn=class extends or{constructor(t,r,n=!0){super(t,r);this.enabled=n}isExtensionEnabled(t){var s,i;let n=(t.split(".").pop()||"").toLowerCase();if(n==="md"||Ze().enableCanvasSync&&n==="canvas")return!0;if(!this.enabled)return!1;for(let[a,l]of Object.entries(wn.schema)){let c=a;if(((s=this.get()[c])!=null?s:l.defaultEnabled)&&l.extensions.includes(n))return!0}return(i=this.get().otherTypes)!=null?i:wn.schema.otherTypes.defaultEnabled}getCategory(t){var s;let r=wn.schema[t];return{enabled:(s=this.get()[t])!=null?s:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(wn.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(n=>({...n,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...wn.defaultFlags}))}},Sn=wn;Sn.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},Sn.defaultFlags=Object.fromEntries(Object.entries(wn.schema).map(([t,r])=>[t,r.defaultEnabled]));var ra=require("obsidian");async function qf(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function xr(o){return!!o&&o instanceof kn}var Fl=class extends Mt{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let n=indexedDB.open(this.dbName,1);n.onupgradeneeded=s=>{let i=n.result;i.objectStoreNames.contains("files")||i.createObjectStore("files",{keyPath:"path"})},n.onsuccess=s=>{this.db=n.result,t()},n.onerror=s=>{this.error("Error opening ContentAddressedFile database:",n.error),r(n.error)}})}async saveHash(t,r,n){if(await this.ready,!!this.db)return new Promise((s,i)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:n});c.onsuccess=()=>s(),c.onerror=()=>{this.error("Error saving hash:",c.error),i(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readonly").objectStore("files").get(t);a.onsuccess=()=>{r(a.result||null)},a.onerror=()=>{this.error("Error retrieving hash:",a.error),n(a.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);a.onsuccess=()=>r(),a.onerror=()=>{this.error("Error removing hash:",a.error),n(a.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},zf=class extends Mt{constructor(t,r,n){super();this.vault=t;this.path=r;this.store=n;this.content=null;this._tfile=null;let s=this.vault.getAbstractFileByPath(r);s&&s instanceof ra.TFile&&(this._tfile=s)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof ra.TFile)this._tfile=t;else throw new Error(`missing tfile: ${this.path}`)}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await qf(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return r}async _hash(){let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await qf(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return n}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof ra.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();return t||(t=await this._hash(),t)}destroy(){this.vault=null,this._tfile=null}},kn=class extends st{constructor(t,r,n,s){super();this.path=t;this._guid=r;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=s.relayId?new _o(s.relayId,s.guid,r):new Ws(s.guid,r),this._parent=s,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new zf(this.vault,this.sharedFolder.getPath(t),this.hashStore),this.log("created")}get guid(){return this._guid}set guid(t){this._guid=t,this.s3rn=this._parent.relayId?new _o(this._parent.relayId,this._parent.guid,t):new Ws(this._parent.guid,t)}get mimetype(){return vn(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}get pending(){return!!this.sharedFolder.syncStore.pendingUpload.has(this.path)}get tag(){return this.inMeta?"":this.uploadError?this.uploadError:this.pending?"pending":"unknown"}move(t,r){t!==this.path&&(this._parent=r,this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}_refreshMeta(){let t=this.sharedFolder.syncStore.getMeta(this.path);return this.meta=t,t}async push(t=!1){if(this.log("push"),!this.sharedFolder.connected){this.log("skipping push -- folder is disconnected");return}if(!this.sharedFolder.syncStore.canSync(this.path)){this.log("skipping push -- filetype is disabled");return}let r=await this.caf.hash();if(this._refreshMeta(),!this.meta||r&&this.meta.hash!==r||t)try{await this.sharedFolder.cas.writeFile(this),await this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(n){let s="Failed to push file";try{s=n.toString()}catch(i){}this.uploadError=s.replace(/^Error:/,"").trim(),this.notifyListeners()}}async sync(){var t;if(this.log("sync"),this._refreshMeta(),this.caf.exists()){if(!this.meta){await this.push();return}}else{if(!this.meta)throw new Error("unexpected case");await this.pull();return}try{let r=await this.caf.hash();if(Ze().enableVerifyUploads)try{this.verifyUpload()||(this.warn("file in metadata, but not on the server!"),await this.push())}catch(n){}if(r!==this.meta.hash){if(this.stat.mtime>this.meta.synctime){await this.push();return}this.warn("synctime",this.meta.synctime,(t=this.meta)==null?void 0:t.synctime,this.stat.mtime),await this.pull();return}}catch(r){this.warn("unable to compute hash",r)}}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async verifyUpload(){if(this.log("verify upload"),this._refreshMeta(),!this.meta)throw new Error("cannot verify upload without meta");return this.sharedFolder.cas.verify(this)}async pull(){if(this.log("pull"),this._refreshMeta(),!this.meta)throw new Error("cannot pull without meta");if(!(this.caf.exists()&&await this.caf.hash()===this.meta.hash))try{let t=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),t),await this.caf.hash()}catch(t){this.log(t);return}}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof ra.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof Nr?!1:(this.s3rn instanceof Ho&&(this.sharedFolder.relayId?this.s3rn=new _o(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ws(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.caf.destroy()}};function In(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!In(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function Go(o){return o instanceof wt}var wt=class extends zo{constructor(t,r,n,s){let i=s.relayId?new Yr(s.relayId,s.guid,r):new Xn(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new yn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(a){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),n=t.getMap("nodes"),s=[],i=[];for(let[,a]of r.entries())s.push({...a});for(let[,a]of n.entries()){let l=t.getText(a.id);i.push({...a,text:l.toString()||a.text})}return{edges:s,nodes:i}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof Nr?!1:(this.s3rn instanceof Xn&&(this.sharedFolder.relayId?this.s3rn=new Yr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Xn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Dr(this._persistence.db,["updates"],"readonly"),r=await Bo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Zr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Zr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}static checkExtension(t){return t.endsWith(".canvas")&&Ze().enableCanvasSync}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&t.file===this.tfile)return await this.applyData(t.canvas.getData())}async applyData(t){let r=this.yedges,n=this.ynodes,s=new Set,i=new Map,a=new Set,l=new Map,c=new Set;t.nodes.forEach(u=>{s.add(u.id);let f=n.get(u.id);f?In(f,u)||i.set(u.id,u):(i.set(u.id,u),u.type==="text"&&this.textNode(u))});for(let u of n.keys())s.has(u)||a.add(u);t.edges.forEach(u=>{s.add(u.id);let f=r.get(u.id);f&&In(f,u)||l.set(u.id,u)});for(let u of r.keys())s.has(u)||c.add(u);(i.size>0||a.size>0||l.size>0||c.size>0)&&nt(this.ydoc,()=>{for(let u of i.values())this.ynodes.set(u.id,u);for(let u of a)this.ynodes.delete(u);for(let u of l.values())this.yedges.set(u.id,u);for(let u of c)this.yedges.delete(u)},this)}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return vn(this.path)}get json(){let t=wt.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};var jf=class extends _n{constructor(){super(...arguments);this.notifyListeners=(0,tt.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},El=class extends zo{constructor(t,r,n,s,i,a,l,c,u,f,d,p,m=!0){var g;let v=p?new Vo(p,r):new Nr(r);super(r,v,l,s);this.appId=t;this.hashStore=u;this.backgroundSync=f;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let i=this.getVirtualPath(s.path),a=n.contains(i);if(s instanceof tt.TFolder){let l=this.getSyncFolder(i,!1);r.push(l)}else if(Tt.checkExtension(i))if(a){let l=this.uploadDoc(i,!1);r.push(l)}else{let l=this.getDoc(i,!1);r.push(l)}else if(wt.checkExtension(i))if(a){let l=this.uploadCanvas(i,!1);r.push(l)}else{let l=this.getCanvas(i,!1);r.push(l)}else if(this.syncStore.canSync(i))if(a){let l=this.uploadSyncFile(i,!1);r.push(l)}else{let l=this.syncFile(i,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=a,this.vault=i,this.files=new Map,this.fset=new jf,this.pendingUpload=new Wo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.pendingUpload.forEach((k,L)=>{this.existsSync(L)||(this.warn("deleting pending upload record because file is missing",L,k),this.pendingUpload.delete(L))}),this.relayManager=c,this.relayId=p,this.diskBufferStore=new _l,this._shouldConnect=(g=this.settings.connect)!=null?g:!0,this.authoritative=!m,this.syncSettingsManager=this._settings.getChild("sync",(k,L)=>new Sn(k,L)),this.syncStore=new Il(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(k=>{this.remote=k.find(L=>L.guid==this.guid)})),this.unsubscribes.push(this.relayManager.storageQuotas.subscribe(async k=>{let L=k.find(I=>{var C;return I.id===((C=this._remote)==null?void 0:C.relay.storageQuotaId)});L!==void 0&&this.storageQuota!==L.quota&&(this.storageQuota!==void 0&&L.quota!==void 0&&L.quota>this.storageQuota&&(this.debug("storage quota increase",this.storageQuota,L.quota),await this.netSync()),this.debug("storage quota update",this.storageQuota,L.quota),this.storageQuota=L.quota)})),this.proxy=Wy(this,this.path,k=>this.getVirtualPath(k));try{this._persistence=new yn(this.guid,this.ydoc)}catch(k){throw this.warn("Unable to open persistence.",this.guid),console.error(k),k}s.loggedIn&&this.connect(),this.cas=new Tl(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(k){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),$t.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let n=[];this.fset.forEach(s=>{s instanceof zo&&(s.connected&&n.push(s),s.reset())}),this.tokenStore.clear(s=>{var i;return!!(this.relayId&&((i=s.token)!=null&&i.docId.startsWith(this.relayId)))}),r&&(this.connect(),n.forEach(s=>{s.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof tt.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path),n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n);if(t instanceof tt.TFolder)return r&&s;let i=this.syncSettingsManager.isExtensionEnabled(n);return r&&s&&i}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof tt.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return tt.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Vo&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Vo(this.relayId,this.guid):new Nr(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(n=>{n.guid===this.relayId&&(this.server=n.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Dr(this._persistence.db,["updates"],"readonly"),r=await Bo(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Zr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new Zr(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof tt.TFile){let i=(0,wr.dirname)(r);this.existsSync(i)||(await this.mkdir(i),s==null||s.push(`creating directory ${i}`))}await this.fileManager.renameFile(n,(0,tt.normalizePath)(this.getPath(r))).then(()=>{t.move(r,this)})}async _handleServerCreate(t,r,n){let s=(0,wr.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),n==null||n.push(`creating directory ${s}`)),r.type==="markdown")return n==null||n.push(`created local .md file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(r.type==="canvas")return n==null||n.push(`created local .canvas file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(r.type==="folder")return n==null||n.push(`created local folder for remotely added folder ${t}`),this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return n==null||n.push(`created local file for remotely added file ${t}`),this.downloadSyncFile(t,!1);throw new Error(`${t}: Unexpected file type ${r.type} ${r.mimetype}`)}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let i=this.files.get(t),a=this.syncStore.getMeta(r);if(!a)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r)){if(i&&xr(i)&&i.shouldPull(a))return{op:"update",path:r,promise:i.pull()};if(!i&&qy(a)){let c=this.syncStore.get(r),u=c?this.files.get(c):null;if(c&&u&&xr(u)){let f=this.remapIfHashMatches(u,c,t,r,a);return{op:"update",path:r,promise:f}}}return{op:"noop",path:r,promise:Promise.resolve()}}if(n.has(t)&&i){let c=this.getPath(i.path),u=this.vault.getAbstractFileByPath(c);if(u){let f=this._handleServerRename(i,r,u,s);return{op:"rename",path:r,from:c,to:r,promise:f}}}let l=this._handleServerCreate(r,a,s);return{op:"create",path:r,promise:l}}async remapIfHashMatches(t,r,n,s,i){try{await t.caf.hash()===i.hash&&(this.files.delete(r),this.pendingUpload.delete(s),this.files.set(n,t),t.guid=n,this.log(`Remapped file ${s} from local GUID ${r} to remote GUID ${n}`))}catch(a){throw this.error("Error during GUID remapping:",a),a}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],i=n.filter(c=>c instanceof tt.TFolder),a=n.filter(c=>c instanceof tt.TFile),l=c=>{var g,k;let u=this.isSyncableTFile(c),f=this.checkPath(c.path),d=t.contains(c.path.slice(this.path.length)),p=this.pendingUpload.has(this.getVirtualPath(c.path)),m=this.getVirtualPath(c.path),v=((g=this._provider)==null?void 0:g.synced)&&((k=this._persistence)==null?void 0:k.synced);if(f&&u&&!d&&!p&&v){r.push(`deleted local file ${m} for remotely deleted doc`);let L=this.vault.adapter.trashLocal(c.path);s.push({op:"delete",path:m,promise:L})}};return a.forEach(l),i.forEach(l),s}syncByType(t,r,n,s){t.forEach((i,a)=>{this._assertNamespacing(a),s.contains(i.type)&&(this._assertNamespacing(a),n.push(this.applyRemoteState(i.id,a,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let i=n.filter(u=>u.op==="create"),a=n.filter(u=>u.op==="rename"),l=n.map(u=>u.path);await Promise.all([...i,...a].map(u=>$y(u.promise,u)));let c=this.cleanupExtraLocalFiles(l,s);[...n,...c].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...c])),(a.length>0||i.length>0||c.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new xl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,wr.join)(this.path,t.path);return this.vault.adapter.read((0,tt.normalizePath)(r))}existsSync(t){let r=(0,tt.normalizePath)((0,wr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,wr.join)(this.path,t.path);return this.vault.adapter.exists((0,tt.normalizePath)(r))}flush(t,r){let n=(0,wr.join)(this.path,t.path);return this.log("writing to ",(0,tt.normalizePath)(n)),this.vault.adapter.write((0,tt.normalizePath)(n),r)}getPath(t){return(0,wr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,wr.join)(this.path,t);return this.vault.adapter.mkdir((0,tt.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+wr.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof tt.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!Xr(s))throw new Error("getDoc(): unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof tt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!Go(s))throw new Error("getCanvas(): unexpected ifile type");return s}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof tt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){let r=(n,s)=>{this.syncStore&&this.syncStore.willSet(n.path,s)&&(this.log("new meta",n.path,s),this.ydoc.transact(()=>{this.syncStore.markUploaded(n.path,s)},this))};if(Xr(t)){let n=Zi(t.guid);r(t,n);return}if(Go(t)){let n=zy(t.guid);r(t,n);return}if(Tf(t)){let n=kl(t.guid);r(t,n);return}if(xr(t)){let n=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!n)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let i=jy(n,t.guid,t.mimetype,s,t.stat.mtime);r(t,i);return}}getFile(t,r=!0){let n=this.getVirtualPath(t.path),s=this.syncStore.get(n);if(s){let i=this.files.get(s);if(i)return i}if(t instanceof tt.TFolder)return this.getSyncFolder(n,r);if(t instanceof tt.TFile){if(Tt.checkExtension(n))return this.getDoc(n);if(wt.checkExtension(n))return this.getCanvas(n);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}return null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.log("place hold new",s),this.syncStore.new(s),r.push(s))})},this),r}getOrCreateCanvas(t,r){let n=this.files.get(t)||new wt(r,t,this.loginManager,this);if(!Go(n))throw new Error("getOrCreateCanvas(): unexpected ifile type");return n.move(r,this),n}async downloadCanvas(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateCanvas(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueCanvasDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadCanvas(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,f]=await Promise.all([this.read(s),i,a]);!f&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{s.applyJSON(c)}catch(d){throw console.warn(c),d}},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createCanvas(t,r){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t);return(async()=>this.whenReady().then(async()=>{let i=await s.getServerSynced();s.stat.size===0&&!i?this.backgroundSync.enqueueCanvasDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!Xr(n))throw new Error("viewDoc(): unexpected ifile type");return n}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!xr(n))throw new Error(`viewSyncFile(): unexpected ifile type, guid=${r}, vpath=${t}`);return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new Tt(r,t,this.loginManager,this);if(!Xr(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadDoc(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,f]=await Promise.all([this.read(s),i,a]),d=s.ydoc.getText("contents");!f&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{d.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var a;let i=await s.getServerSynced();((a=s.tfile)==null?void 0:a.stat.size)===0&&!i?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new xn(r,t,this);if(!Tf(n))throw new Error("unexpected ifile type");return n.move(r,this),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFile(t,r,n){let s=this.files.get(t)||new kn(r,t,this.hashStore,this);if(!xr(s))throw new Error(`getOrCreateSyncFile(): unexpected ifile type, guid=${t}`);return s.move(r,this),this.files.set(t,s),s}syncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called sync on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueSync(i),this.files.set(n,i),this.fset.add(i,r),i}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueDownload(i),this.files.set(n,i),this.fset.add(i,r),i}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof tt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.backgroundSync.enqueueSync(i),this.fset.add(i,r),i}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof tt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.syncStore.getMeta(t)?i.pull():(this.log("get syncfile missing meta"),i.push()),this.files.set(n,i),this.fset.add(i,r),i}uploadFile(t,r=!0){let n=this.getVirtualPath(t.path);if(t instanceof tt.TFolder)return this.getSyncFolder(n,r);if(t instanceof tt.TFile){if(Tt.checkExtension(n))return this.uploadDoc(n,r);if(wt.checkExtension(n))return this.uploadCanvas(n,r);if(this.syncStore.canSync(n))return this.uploadSyncFile(n,r)}throw new Error("unexpectedly unable to upload")}deleteFile(t){var n;let r=(n=this.syncStore)==null?void 0:n.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",i="";try{s=this.getVirtualPath(n)}catch(a){this.log("Moving out of shared folder")}try{i=this.getVirtualPath(r)}catch(a){this.log("Moving in from outside of shared folder")}if(!(!s&&!i))if(i){let a=this.syncStore.get(i);if(!a)return;let l=this.files.get(a);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(i)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(a);else{if(!this.syncStore.get(i))return;let u=[];l instanceof xn&&this.syncStore.forEach((f,d)=>{if(d.startsWith(i+wr.sep)){let p=d.replace(i,s);u.push([f.id,d,p])}}),this.ydoc.transact(()=>{this.syncStore.move(i,s),l&&l.move(s,this),u.forEach(f=>{let[d,p,m]=f;this.syncStore.move(p,m);let v=this.files.get(d);v&&v.move(m,this)})},this),this.syncStore.resolveMove(i)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(t)}}destroy(){var t,r,n;this.destroyed=!0,this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},Pl=class extends _n{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,tt.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(i=>{let a=!1;this.items().forEach(l=>{let c=i.find(u=>u.guid==l.guid);l.remote!=c&&(a=!0),l.remote=c}),a&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let i=this.find(u=>u.path==t&&u.guid==r);if(i)return i;let a=this.find(u=>u.guid==r);if(a)throw new Error(`This folder is already mounted at ${a.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let i=this._new(t,r,n,s);return this.notifyListeners(),i}};var nc=require("@codemirror/state"),ai=require("obsidian");function q(){}var oa=o=>o;function ie(o,e){for(let t in e)o[t]=e[t];return o}function ab(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function Wf(o){return o()}function Dl(){return Object.create(null)}function we(o){o.forEach(Wf)}function Ge(o){return typeof o=="function"}function W(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Rl;function dr(o,e){return o===e?!0:(Rl||(Rl=document.createElement("a")),Rl.href=e,o===Rl.href)}function lb(o){return Object.keys(o).length===0}function At(o,...e){if(o==null){for(let r of e)r(void 0);return q}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function wo(o){let e;return At(o,t=>e=t)(),e}function le(o,e,t){o.$$.on_destroy.push(At(e,t))}function ye(o,e,t,r){if(o){let n=cb(o,e,t,r);return o[0](n)}}function cb(o,e,t,r){return o[1]&&r?ie(t.ctx.slice(),o[1](r(e))):t.ctx}function be(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],i=Math.max(e.dirty.length,n.length);for(let a=0;a<i;a+=1)s[a]=e.dirty[a]|n[a];return s}return e.dirty|n}return e.dirty}function ve(o,e,t,r,n,s){if(n){let i=cb(e,t,r,s);o.p(i,n)}}function _e(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Se(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Kf(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function kt(o){return o==null?"":o}function Ys(o,e,t){return o.set(t),e}function ts(o){return o&&Ge(o.destroy)?o.destroy:q}var ub=typeof window!="undefined",Gf=ub?()=>window.performance.now():()=>Date.now(),na=ub?o=>requestAnimationFrame(o):q;var Zs=new Set;function fb(o){Zs.forEach(e=>{e.c(o)||(Zs.delete(e),e.f())}),Zs.size!==0&&na(fb)}function Jf(o){let e;return Zs.size===0&&na(fb),{promise:new Promise(t=>{Zs.add(e={c:o,f:t})}),abort(){Zs.delete(e)}}}var rs=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Xs=class{constructor(e){yt(this,"_listeners","WeakMap"in rs?new WeakMap:void 0);yt(this,"_observer");yt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)Xs.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};Xs.entries="WeakMap"in rs?new WeakMap:void 0;var db=!1;function pb(){db=!0}function mb(){db=!1}function y(o,e){o.appendChild(e)}function Ce(o,e,t){let r=Ul(o);if(!r.getElementById(e)){let n=_("style");n.id=e,n.textContent=t,gb(r,n)}}function Ul(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function hb(o){let e=_("style");return e.textContent="/* empty */",gb(Ul(o),e),e.sheet}function gb(o,e){return y(o.head||o,e),e.sheet}function w(o,e,t){o.insertBefore(e,t||null)}function x(o){o.parentNode&&o.parentNode.removeChild(o)}function qe(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function _(o){return document.createElement(o)}function Kt(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function B(o){return document.createTextNode(o)}function F(){return B(" ")}function pe(){return B("")}function V(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function Ol(o){return function(e){return e.preventDefault(),o.call(this,e)}}function Nl(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}var iC=["width","height"];function aC(o,e){let t=Object.getOwnPropertyDescriptors(o.__proto__);for(let r in e)e[r]==null?o.removeAttribute(r):r==="style"?o.style.cssText=e[r]:r==="__value"?o.value=o[r]=e[r]:t[r]&&t[r].set&&iC.indexOf(r)===-1?o[r]=e[r]:h(o,r,e[r])}function sa(o,e){for(let t in e)h(o,t,e[t])}function lC(o,e){Object.keys(e).forEach(t=>{cC(o,t,e[t])})}function cC(o,e,t){let r=e.toLowerCase();r in o?o[r]=typeof o[r]=="boolean"&&t===""?!0:t:e in o?o[e]=typeof o[e]=="boolean"&&t===""?!0:t:h(o,e,t)}function yb(o){return/-/.test(o)?lC:aC}function bb(o){return Array.from(o.childNodes)}function Q(o,e){e=""+e,o.data!==e&&(o.data=e)}function Je(o,e){o.value=e==null?"":e}function me(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Ln(o,e,t){for(let r=0;r<o.options.length;r+=1){let n=o.options[r];if(n.__value===e){n.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Te(o,e,t){o.classList.toggle(e,!!t)}function ia(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Cn=class{constructor(e=!1){yt(this,"is_svg",!1);yt(this,"e");yt(this,"n");yt(this,"t");yt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Kt(t.nodeName):this.e=_(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)w(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(x)}};function vb(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function Jo(o,e){return new o(e)}var $l=new Map,Bl=0;function uC(o){let e=5381,t=o.length;for(;t--;)e=(e<<5)-e^o.charCodeAt(t);return e>>>0}function fC(o,e){let t={stylesheet:hb(e),rules:{}};return $l.set(o,t),t}function Vl(o,e,t,r,n,s,i,a=0){let l=16.666/r,c=`{
`;for(let g=0;g<=1;g+=l){let k=e+(t-e)*s(g);c+=g*100+`%{${i(k,1-k)}}
`}let u=c+`100% {${i(t,1-t)}}
}`,f=`__svelte_${uC(u)}_${a}`,d=Ul(o),{stylesheet:p,rules:m}=$l.get(d)||fC(d,o);m[f]||(m[f]=!0,p.insertRule(`@keyframes ${f} ${u}`,p.cssRules.length));let v=o.style.animation||"";return o.style.animation=`${v?`${v}, `:""}${f} ${r}ms linear ${n}ms 1 both`,Bl+=1,f}function Qf(o,e){let t=(o.style.animation||"").split(", "),r=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),n=t.length-r.length;n&&(o.style.animation=r.join(", "),Bl-=n,Bl||dC())}function dC(){na(()=>{Bl||($l.forEach(o=>{let{ownerNode:e}=o.stylesheet;e&&x(e)}),$l.clear())})}var Mn;function Sr(o){Mn=o}function aa(){if(!Mn)throw new Error("Function called outside component initialization");return Mn}function lt(o){aa().$$.on_mount.push(o)}function os(o){aa().$$.on_destroy.push(o)}function Ye(){let o=aa();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=ia(e,t,{cancelable:r});return n.slice().forEach(i=>{i.call(o,s)}),!s.defaultPrevented}return!0}}function pr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var ns=[];var vt=[],ti=[],Zf=[],_b=Promise.resolve(),Xf=!1;function ed(){Xf||(Xf=!0,_b.then(la))}function td(){return ed(),_b}function So(o){ti.push(o)}function Hl(o){Zf.push(o)}var Yf=new Set,ei=0;function la(){if(ei!==0)return;let o=Mn;do{try{for(;ei<ns.length;){let e=ns[ei];ei++,Sr(e),pC(e.$$)}}catch(e){throw ns.length=0,ei=0,e}for(Sr(null),ns.length=0,ei=0;vt.length;)vt.pop()();for(let e=0;e<ti.length;e+=1){let t=ti[e];Yf.has(t)||(Yf.add(t),t())}ti.length=0}while(ns.length);for(;Zf.length;)Zf.pop()();Xf=!1,Yf.clear(),Sr(o)}function pC(o){if(o.fragment!==null){o.update(),we(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(So)}}function xb(o){let e=[],t=[];ti.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),ti=e}var ca;function mC(){return ca||(ca=Promise.resolve(),ca.then(()=>{ca=null})),ca}function rd(o,e,t){o.dispatchEvent(ia(`${e?"intro":"outro"}${t}`))}var ql=new Set,Qo;function ne(){Qo={r:0,c:[],p:Qo}}function se(){Qo.r||we(Qo.c),Qo=Qo.p}function b(o,e){o&&o.i&&(ql.delete(o),o.i(e))}function S(o,e,t,r){if(o&&o.o){if(ql.has(o))return;ql.add(o),Qo.c.push(()=>{ql.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}var hC={duration:0};function ss(o,e,t,r){let s=e(o,t,{direction:"both"}),i=r?0:1,a=null,l=null,c=null,u;function f(){c&&Qf(o,c)}function d(m,v){let g=m.b-i;return v*=Math.abs(g),{a:i,b:m.b,d:g,duration:v,start:m.start,end:m.start+v,group:m.group}}function p(m){let{delay:v=0,duration:g=300,easing:k=oa,tick:L=q,css:I}=s||hC,C={start:Gf()+v,b:m};m||(C.group=Qo,Qo.r+=1),"inert"in o&&(m?u!==void 0&&(o.inert=u):(u=o.inert,o.inert=!0)),a||l?l=C:(I&&(f(),c=Vl(o,i,m,g,v,k,I)),m&&L(0,1),a=d(C,g),So(()=>rd(o,m,"start")),Jf(M=>{if(l&&M>l.start&&(a=d(l,g),l=null,rd(o,a.b,"start"),I&&(f(),c=Vl(o,i,a.b,a.duration,0,k,s.css))),a){if(M>=a.end)L(i=a.b,1-i),rd(o,a.b,"end"),l||(a.b?f():--a.group.r||we(a.group.c)),a=null;else if(M>=a.start){let A=M-a.start;i=a.a+a.d*k(A/a.duration),L(i,1-i)}}return!!(a||l)}))}return{run(m){Ge(s)?mC().then(()=>{s=s({direction:m?"in":"out"}),p(m)}):p(m)},end(){f(),a=l=null}}}function Yo(o,e){let t=e.token={};function r(n,s,i,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;i!==void 0&&(l=l.slice(),l[i]=a);let c=n&&(e.current=n)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==s&&f&&(ne(),S(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),se())}):e.block.d(1),c.c(),b(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&la()}if(ab(o)){let n=aa();if(o.then(s=>{Sr(n),r(e.then,1,e.value,s),Sr(null)},s=>{if(Sr(n),r(e.catch,2,e.error,s),Sr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function ri(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function xe(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function oi(o,e){o.d(1),e.delete(o.key)}function ni(o,e){S(o,1,1,()=>{e.delete(o.key)})}function eo(o,e,t,r,n,s,i,a,l,c,u,f){let d=o.length,p=s.length,m=d,v={};for(;m--;)v[o[m].key]=m;let g=[],k=new Map,L=new Map,I=[];for(m=p;m--;){let E=f(n,s,m),P=t(E),T=i.get(P);T?r&&I.push(()=>T.p(E,e)):(T=c(P,E),T.c()),k.set(P,g[m]=T),P in v&&L.set(P,Math.abs(m-v[P]))}let C=new Set,M=new Set;function A(E){b(E,1),E.m(a,u),i.set(E.key,E),u=E.first,p--}for(;d&&p;){let E=g[p-1],P=o[d-1],T=E.key,$=P.key;E===P?(u=E.first,d--,p--):k.has($)?!i.has(T)||C.has(T)?A(E):M.has($)?d--:L.get(T)>L.get($)?(M.add(T),A(E)):(C.add($),d--):(l(P,i),d--)}for(;d--;){let E=o[d];k.has(E.key)||l(E,i)}for(;p;)A(g[p-1]);return we(I),g}function Pe(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let i=o[s],a=e[s];if(a){for(let l in i)l in a||(r[l]=1);for(let l in a)n[l]||(t[l]=a[l],n[l]=1);o[s]=a}else for(let l in i)n[l]=1}for(let i in r)i in t||(t[i]=void 0);return t}function Re(o){return typeof o=="object"&&o!==null?o:{}}var gC=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],yC=new Set([...gC]);function zl(o,e,t){let r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function U(o){o&&o.c()}function R(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),So(()=>{let s=o.$$.on_mount.map(Wf).filter(Ge);o.$$.on_destroy?o.$$.on_destroy.push(...s):we(s),o.$$.on_mount=[]}),n.forEach(So)}function D(o,e){let t=o.$$;t.fragment!==null&&(xb(t.after_update),we(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function vC(o,e){o.$$.dirty[0]===-1&&(ns.push(o),ed(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function G(o,e,t,r,n,s,i=null,a=[-1]){let l=Mn;Sr(o);let c=o.$$={fragment:null,ctx:[],props:s,update:q,not_equal:n,bound:Dl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Dl(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let u=!1;if(c.ctx=t?t(o,e.props||{},(f,d,...p)=>{let m=p.length?p[0]:d;return c.ctx&&n(c.ctx[f],c.ctx[f]=m)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](m),u&&vC(o,f)),d}):[],c.update(),u=!0,we(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){pb();let f=bb(e.target);c.fragment&&c.fragment.l(f),f.forEach(x)}else c.fragment&&c.fragment.c();e.intro&&b(o.$$.fragment),R(o,e.target,e.anchor),mb(),la()}Sr(l)}var _C;typeof HTMLElement=="function"&&(_C=class extends HTMLElement{constructor(e,t,r){super();yt(this,"$$ctor");yt(this,"$$s");yt(this,"$$c");yt(this,"$$cn",!1);yt(this,"$$d",{});yt(this,"$$r",!1);yt(this,"$$p_d",{});yt(this,"$$l",{});yt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let i;return{c:function(){i=_("slot"),s!=="default"&&h(i,"name",s)},m:function(c,u){w(c,i,u)},d:function(c){c&&x(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=vb(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=od(i,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let i=od(s,this.$$d[s],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,i)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let i of this.$$l[s]){let a=this.$$c.$on(s,i);this.$$l_u.set(i,a)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=od(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function od(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var K=class{constructor(){yt(this,"$$");yt(this,"$$set")}$destroy(){D(this,1),this.$destroy=q}$on(e,t){if(!Ge(t))return q;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!lb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var wb="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wb);var xC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},nd=xC;function Sb(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function sd(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=ie(r,t[n]);return{c(){e=Kt(o[11]),sa(e,r)},m(n,s){w(n,e,s)},p(n,s){sa(e,r=Pe(t,[s&32&&n[12]]))},d(n){n&&x(e)}}}function kb(o){let e=o[11],t,r=o[11]&&sd(o);return{c(){r&&r.c(),t=pe()},m(n,s){r&&r.m(n,s),w(n,t,s)},p(n,s){n[11]?e?W(e,n[11])?(r.d(1),r=sd(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=sd(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&x(t),r&&r.d(n)}}}function wC(o){let e,t,r,n,s,i=xe(o[5]),a=[];for(let d=0;d<i.length;d+=1)a[d]=kb(Sb(o,i,d));let l=o[10].default,c=ye(l,o,o[9],null),u=[nd,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],f={};for(let d=0;d<u.length;d+=1)f=ie(f,u[d]);return{c(){e=Kt("svg");for(let d=0;d<a.length;d+=1)a[d].c();t=pe(),c&&c.c(),sa(e,f)},m(d,p){w(d,e,p);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(e,null);y(e,t),c&&c.m(e,null),s=!0},p(d,[p]){if(p&32){i=xe(d[5]);let m;for(m=0;m<i.length;m+=1){let v=Sb(d,i,m);a[m]?a[m].p(v,p):(a[m]=kb(v),a[m].c(),a[m].m(e,t))}for(;m<a.length;m+=1)a[m].d(1);a.length=i.length}c&&c.p&&(!s||p&512)&&ve(c,l,d,d[9],s?be(l,d[9],p,null):_e(d[9]),null),sa(e,f=Pe(u,[nd,p&128&&d[7],(!s||p&4)&&{width:d[2]},(!s||p&4)&&{height:d[2]},(!s||p&2)&&{stroke:d[1]},(!s||p&28&&r!==(r=d[4]?Number(d[3])*24/Number(d[2]):d[3]))&&{"stroke-width":r},(!s||p&257&&n!==(n=d[6]("lucide-icon","lucide",d[0]?`lucide-${d[0]}`:"",d[8].class)))&&{class:n}]))},i(d){s||(b(c,d),s=!0)},o(d){S(c,d),s=!1},d(d){d&&x(e),qe(a,d),c&&c.d(d)}}}function SC(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=Kf(e,r),{$$slots:s={},$$scope:i}=e,{name:a=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:f=!1}=e,{iconNode:d}=e,p=(...m)=>m.filter((v,g,k)=>Boolean(v)&&k.indexOf(v)===g).join(" ");return o.$$set=m=>{t(8,e=ie(ie({},e),Se(m))),t(7,n=Kf(e,r)),"name"in m&&t(0,a=m.name),"color"in m&&t(1,l=m.color),"size"in m&&t(2,c=m.size),"strokeWidth"in m&&t(3,u=m.strokeWidth),"absoluteStrokeWidth"in m&&t(4,f=m.absoluteStrokeWidth),"iconNode"in m&&t(5,d=m.iconNode),"$$scope"in m&&t(9,i=m.$$scope)},e=Se(e),[a,l,c,u,f,d,p,n,e,i,s]}var id=class extends K{constructor(e){super(),G(this,e,SC,wC,W,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},De=id;function kC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function IC(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[kC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function CC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var ad=class extends K{constructor(e){super(),G(this,e,CC,IC,W,{})}},ld=ad;function LC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function MC(o){let e,t,r=[{name:"arrow-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[LC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function TC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var cd=class extends K{constructor(e){super(),G(this,e,TC,MC,W,{})}},ud=cd;function AC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function FC(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[AC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function EC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var fd=class extends K{constructor(e){super(),G(this,e,EC,FC,W,{})}},dd=fd;function PC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function RC(o){let e,t,r=[{name:"check"},o[1],{iconNode:o[0]}],n={$$slots:{default:[PC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function DC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 6 9 17l-5-5"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var pd=class extends K{constructor(e){super(),G(this,e,DC,RC,W,{})}},ua=pd;function UC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function OC(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[UC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function NC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var md=class extends K{constructor(e){super(),G(this,e,NC,OC,W,{})}},hd=md;function $C(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function BC(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[$C]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function VC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var gd=class extends K{constructor(e){super(),G(this,e,VC,BC,W,{})}},yd=gd;function HC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function qC(o){let e,t,r=[{name:"circle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[HC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function zC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var bd=class extends K{constructor(e){super(),G(this,e,zC,qC,W,{})}},vd=bd;function jC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function WC(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[jC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function KC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var _d=class extends K{constructor(e){super(),G(this,e,KC,WC,W,{})}},fa=_d;function GC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function JC(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[GC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function QC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var xd=class extends K{constructor(e){super(),G(this,e,QC,JC,W,{})}},da=xd;function YC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function ZC(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[YC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function XC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var wd=class extends K{constructor(e){super(),G(this,e,XC,ZC,W,{})}},pa=wd;function e2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function t2(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[e2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function r2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Sd=class extends K{constructor(e){super(),G(this,e,r2,t2,W,{})}},ma=Sd;function o2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function n2(o){let e,t,r=[{name:"folder-lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[o2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function s2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var kd=class extends K{constructor(e){super(),G(this,e,s2,n2,W,{})}},is=kd;function i2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function a2(o){let e,t,r=[{name:"folder-open"},o[1],{iconNode:o[0]}],n={$$slots:{default:[i2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function l2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Id=class extends K{constructor(e){super(),G(this,e,l2,a2,W,{})}},Cd=Id;function c2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function u2(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[c2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function f2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ld=class extends K{constructor(e){super(),G(this,e,f2,u2,W,{})}},ko=Ld;function d2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function p2(o){let e,t,r=[{name:"home"},o[1],{iconNode:o[0]}],n={$$slots:{default:[d2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function m2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}],["polyline",{points:"9 22 9 12 15 12 15 22"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Md=class extends K{constructor(e){super(),G(this,e,m2,p2,W,{})}},Td=Md;function h2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function g2(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[h2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function y2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ad=class extends K{constructor(e){super(),G(this,e,y2,g2,W,{})}},ha=Ad;function b2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function v2(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[b2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function _2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Fd=class extends K{constructor(e){super(),G(this,e,_2,v2,W,{})}},to=Fd;function x2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function w2(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[x2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function S2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ed=class extends K{constructor(e){super(),G(this,e,S2,w2,W,{})}},Pd=Ed;function k2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function I2(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[k2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function C2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Rd=class extends K{constructor(e){super(),G(this,e,C2,I2,W,{})}},Dd=Rd;function L2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function M2(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[L2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function T2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ud=class extends K{constructor(e){super(),G(this,e,T2,M2,W,{})}},Od=Ud;function A2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function F2(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[A2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function E2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Nd=class extends K{constructor(e){super(),G(this,e,E2,F2,W,{})}},$d=Nd;function P2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function R2(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[P2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function D2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Bd=class extends K{constructor(e){super(),G(this,e,D2,R2,W,{})}},Vd=Bd;function U2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function O2(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[U2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function N2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Hd=class extends K{constructor(e){super(),G(this,e,N2,O2,W,{})}},Zo=Hd;function $2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function B2(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[$2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function V2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var qd=class extends K{constructor(e){super(),G(this,e,V2,B2,W,{})}},zd=qd;function H2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function q2(o){let e,t,r=[{name:"square-pen"},o[1],{iconNode:o[0]}],n={$$slots:{default:[H2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function z2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var jd=class extends K{constructor(e){super(),G(this,e,z2,q2,W,{})}},ga=jd;function j2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function W2(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[j2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function K2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Wd=class extends K{constructor(e){super(),G(this,e,K2,W2,W,{})}},as=Wd;function G2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function J2(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[G2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function Q2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Kd=class extends K{constructor(e){super(),G(this,e,Q2,J2,W,{})}},Gd=Kd;function Y2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function Z2(o){let e,t,r=[{name:"x"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Y2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new De({props:n}),{c(){U(e.$$.fragment)},m(s,i){R(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&Re(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function X2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Jd=class extends K{constructor(e){super(),G(this,e,X2,Z2,W,{})}},Qd=Jd;function eL(o){Ce(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function tL(o){let e,t,r,n,s,i;return t=new to({props:{class:"svg-icon inline-icon"}}),{c(){var a;e=_("button"),U(t.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(a=o[0].view.file)==null?void 0:a.name)},m(a,l){w(a,e,l),R(t,e,null),i=!0},p(a,l){var c;(!i||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(a[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!i||l&1&&n!==(n=a[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!i||l&1&&s!==(s=(c=a[0].view.file)==null?void 0:c.name))&&h(e,"data-filename",s)},i(a){i||(b(t.$$.fragment,a),i=!0)},o(a){S(t.$$.fragment,a),i=!1},d(a){a&&x(e),D(t)}}}function rL(o){let e,t,r,n,s,i,a,l,c,u,f,d,p;return t=new to({props:{class:"svg-icon inline-icon"}}),l=new Zo({props:{class:"svg-icon inline-icon"}}),{c(){var m;e=_("button"),U(t.$$.fragment),i=F(),a=_("button"),U(l.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(m=o[0].view.file)==null?void 0:m.name),h(a,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),h(a,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),h(a,"tabindex","0")},m(m,v){w(m,e,v),R(t,e,null),w(m,i,v),w(m,a,v),R(l,a,null),f=!0,d||(p=[V(a,"click",o[3]),V(a,"keypress",o[4])],d=!0)},p(m,v){var g;(!f||v&1&&r!==(r="clickable-icon view-action system3-view-action "+(m[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!f||v&1&&n!==(n=m[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!f||v&1&&s!==(s=(g=m[0].view.file)==null?void 0:g.name))&&h(e,"data-filename",s),(!f||v&2&&c!==(c="system3-"+m[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&h(a,"class",c),(!f||v&6&&u!==(u=`${m[2].relay.name} (${m[1].status})`))&&h(a,"aria-label",u)},i(m){f||(b(t.$$.fragment,m),b(l.$$.fragment,m),f=!0)},o(m){S(t.$$.fragment,m),S(l.$$.fragment,m),f=!1},d(m){m&&(x(e),x(i),x(a)),D(t),D(l),d=!1,we(p)}}}function oL(o){let e,t,r,n,s=[rL,tL],i=[];function a(l,c){return l[2]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=pe()},m(l,c){i[e].m(l,c),w(l,r,c),n=!0},p(l,[c]){let u=e;e=a(l,c),e===u?i[e].p(l,c):(ne(),S(i[u],1,1,()=>{i[u]=null}),se(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&x(r),i[e].d(l)}}}function nL(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,i={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},a=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&a()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,s=c.remote)},[r,n,s,a,l]}var Yd=class extends K{constructor(e){super(),G(this,e,nL,oL,W,{view:0,state:1,remote:2},eL)}},Zd=Yd;var ls=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),this.onClick=async()=>!0,!0}};var jl=require("@codemirror/state"),Ib=require("@codemirror/view");function Xo(o,e){let t=Object.keys(e).map(r=>sL(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function sL(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},i=t(s);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(a,i),o[e]=a,l;function a(...c){return i===s&&o[e]===a&&l(),i.apply(this,c)}function l(){o[e]===a&&(n?o[e]=s:delete o[e]),i!==s&&(i=s,Object.setPrototypeOf(a,r||Function))}}var Cb=an(Lf());var iL=25,a$=jl.Facet.define({combine(o){return o[o.length-1]}}),Xd=jl.Annotation.define(),ep=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var n,s,i,a;if(this.unsubscribes=[],this.editor=e,this.connectionManager=this.editor.state.field(Io),this.view=(n=this.connectionManager)==null?void 0:n.findView(e),!this.view||(this.log=Fe(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=Fe(`[LiveCMPluginValue][${(i=this.view.view.file)==null?void 0:i.path}]`,"warn"),this.debug=Fe(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=!1,r=this;this.unsubscribes.push(Xo(this.view.view,{setViewData(l){return function(c,u){if(u)ro(r.view)&&r.view.document.text===c&&(r.view.tracking=!0),r.resync();else if(t){let f=r.incrementalBufferChange(c);e.dispatch({changes:f})}return l.call(this,c,u)}},saveFrontmatter(l){return function(c){t=!0;let u=l.call(this,c);return t=!1,u}}})),this.unsubscribes.push(Xo(this.view.view.previewMode,{edit(l){return function(c){if(ro(r.view)&&r.view.view.getMode()==="preview"){let u=r.incrementalBufferChange(c);e.dispatch({changes:u})}return l.call(this,c)}}})),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(l,c)=>{if(!ro(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(c.origin!==this){let u=l.delta,f=[],d=0;for(let p=0;p<u.length;p++){let m=u[p];m.insert!=null?f.push({from:d,to:d,insert:m.insert}):m.delete!=null?(f.push({from:d,to:d+m.delete,insert:""}),d+=m.delete):m.retain!=null&&(d+=m.retain)}!this.view.tracking||Ze().enableEditorTweens&&this.keyFrameCounter>iL?(this.keyFrameCounter=0,f=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),ro(this.view)&&(e.dispatch({changes:f,annotations:[Xd.of(this.editor)]}),this.view.tracking=!0)}this.render()},this.observer=(l,c)=>{var u;try{(u=this._observer)==null||u.call(this,l,c)}catch(f){f instanceof RangeError&&ro(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}render(){var e;((e=this.view)==null?void 0:e.view.getMode())==="preview"&&(this.view.view.previewMode.renderer.set(this.editor.state.doc.toString()),this.view.view.onInternalDataChange())}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new Cb.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],i=0;for(let[a,l]of n)switch(a){case 0:i+=l.length;break;case 1:s.push({from:i,to:i,insert:l}),i+=l.length;break;case-1:s.push({from:i,to:i+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(ro(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();ro(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Xd.of(this.editor)]})}}async getKeyFrame(e=!1){return!ro(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),ro(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var n,s,i,a;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Xd)===this.editor)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(i=(s=this.view)==null?void 0:s.document)==null?void 0:i.ytext;r&&((a=r.doc)==null||a.transact(()=>{let l=0;e.changes.iterChanges((c,u,f,d,p)=>{let m=p.sliceString(0,p.length,`
`);c!==u&&r.delete(c+l,u-c),m.length>0&&r.insert(c+l,m),l+=m.length-(u-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.unsubscribes.forEach(t=>{t()}),this.unsubscribes.length=0,this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Lb=Ib.ViewPlugin.fromClass(ep);var Wl=require("@codemirror/state"),mr=require("@codemirror/view");var Mb=mr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),aL=Wl.Annotation.define(),tp=class extends mr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Pi("span",[Zt("class","cm-ySelectionCaret"),Zt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[As("\u2060"),Pi("div",[Zt("class","cm-ySelectionCaretDot")]),As("\u2060"),Pi("div",[Zt("class","cm-ySelectionInfo")],[As(this.name)]),As("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},rp=class{constructor(e){var r,n;this.editor=e,this.decorations=Wl.RangeSet.of([]),this.connectionManager=this.editor.state.field(Io);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof Tn){this.view=t;let s=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:i,updated:a,removed:l},c,u)=>{i.concat(a).concat(l).findIndex(d=>{var p;return d!==((p=this._awareness)==null?void 0:p.doc.clientID)})>=0&&e.dispatch({annotations:[aL.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,u,f,d;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(f=(u=this.view)==null?void 0:u.document)==null?void 0:f.ytext;if(!(this.view&&r&&r.doc))return;let n=(d=this.view.document)==null?void 0:d._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,i=r.doc,a=[],l=this._awareness.getLocalState();if(l!=null){let p=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),m=p?e.state.selection.main:null,v=l.cursor==null?null:Xu(l.cursor.anchor),g=l.cursor==null?null:Xu(l.cursor.head);if(m!=null){let k=ef(r,m.anchor),L=ef(r,m.head);(l.cursor==null||!rf(v,k)||!rf(g,L))&&s.setLocalStateField("cursor",{anchor:k,head:L})}else l.cursor!=null&&p&&s.setLocalStateField("cursor",null)}s.getStates().forEach((p,m)=>{if(m===s.doc.clientID)return;let v=p.cursor;if(v==null||v.anchor==null||v.head==null)return;let g=tf(v.anchor,i),k=tf(v.head,i);if(g==null||k==null||g.type!==r||k.type!==r)return;if(g.index>e.state.doc.length||k.index>e.state.doc.length){Fe("[RemoteSelections]","warn")(`cursor positions (${g.index}, ${k.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=mr.Decoration.none;return}let{color:L="#30bced",name:I="Anonymous"}=p.user||{},C=p.user&&p.user.colorLight||L+"33",M=bs(g.index,k.index),A=Wr(g.index,k.index),E=e.view.state.doc.lineAt(M),P=e.view.state.doc.lineAt(A);if(E.number===P.number)a.push({from:M,to:A,value:mr.Decoration.mark({attributes:{style:`background-color: ${C}`},class:"cm-ySelection"})});else{a.push({from:M,to:E.from+E.length,value:mr.Decoration.mark({attributes:{style:`background-color: ${C}`},class:"cm-ySelection"})}),a.push({from:P.from,to:A,value:mr.Decoration.mark({attributes:{style:`background-color: ${C}`},class:"cm-ySelection"})});for(let T=E.number+1;T<P.number;T++){let $=e.view.state.doc.line(T).from;a.push({from:$,to:$,value:mr.Decoration.line({attributes:{style:`background-color: ${C}`,class:"cm-yLineSelection"}})})}}a.push({from:k.index,to:k.index,value:mr.Decoration.widget({side:k.index-g.index>0?-1:1,block:!1,widget:new tp(L,I)})})}),this.decorations=mr.Decoration.set(a,!0)}},Tb=mr.ViewPlugin.fromClass(rp,{decorations:o=>o.decorations});var Kl=require("@codemirror/state"),en=require("@codemirror/view"),Ab=require("@codemirror/view");var x$=Kl.Annotation.define(),np=class extends Ab.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},op=Kl.StateEffect.define(),sp=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(Io),this.decorations=en.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:op.of(null)})},!this.connectionManager){Fe("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Fe(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var n,s;let r=(s=(n=this.view)==null?void 0:n.document)==null?void 0:s.getTFile();if(this.connectionManager&&this.app&&r){this.connectionManager.onMeta(r,this.cb);let i=this.app.metadataCache.getFileCache(r);i&&(this.updateFromMetadata(i),this.editor.dispatch({effects:op.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(en.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(i,a,l)=>{var f;(((f=l.spec)==null?void 0:f.class)||"").contains("cm-formatting-link-end")&&t.push({from:i,to:a})})}),t}updateFromMetadata(e){var r,n,s,i;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.tfile))return;let t=new Map;for(let a of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}for(let a of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,i,a,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.sharedFolder)||!((l=(a=this.view)==null?void 0:a.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let u=null;for(let[p,m]of r)if(c.from<=m.to&&c.to>=m.from){u=m,r.delete(p);break}if(!u)continue;let f=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);f&&!this.view.document.sharedFolder.checkPath(f.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>en.Decoration.widget({widget:new np,side:1}).range(t));e.length>0?this.decorations=en.Decoration.set(e,!0):this.decorations=en.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(op))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Fb=en.ViewPlugin.fromClass(sp,{decorations:o=>o.decorations});function tn(){}tn.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var i=this;function a(C){return s?(setTimeout(function(){s(void 0,C)},0),!0):C}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,u=1,f=l+c;n.maxEditLength&&(f=Math.min(f,n.maxEditLength));var d=(r=n.timeout)!==null&&r!==void 0?r:1/0,p=Date.now()+d,m=[{oldPos:-1,lastComponent:void 0}],v=this.extractCommon(m[0],t,e,0);if(m[0].oldPos+1>=c&&v+1>=l)return a([{value:this.join(t),count:t.length}]);var g=-1/0,k=1/0;function L(){for(var C=Math.max(g,-u);C<=Math.min(k,u);C+=2){var M=void 0,A=m[C-1],E=m[C+1];A&&(m[C-1]=void 0);var P=!1;if(E){var T=E.oldPos-C;P=E&&0<=T&&T<l}var $=A&&A.oldPos+1<c;if(!P&&!$){m[C]=void 0;continue}if(!$||P&&A.oldPos+1<E.oldPos?M=i.addToPath(E,!0,void 0,0):M=i.addToPath(A,void 0,!0,1),v=i.extractCommon(M,t,e,C),M.oldPos+1>=c&&v+1>=l)return a(lL(i,M.lastComponent,t,e,i.useLongestToken));m[C]=M,M.oldPos+1>=c&&(k=Math.min(k,C-1)),v+1>=l&&(g=Math.max(g,C+1))}u++}if(s)(function C(){setTimeout(function(){if(u>f||Date.now()>p)return s();L()||C()},0)})();else for(;u<=f&&Date.now()<=p;){var I=L();if(I)return I}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,i=r.length,a=e.oldPos,l=a-n,c=0;l+1<s&&a+1<i&&this.equals(t[l+1],r[a+1]);)l++,a++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=a,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function lL(o,e,t,r,n){for(var s=[],i;e;)s.push(e),i=e.previousComponent,delete e.previousComponent,e=i;s.reverse();for(var a=0,l=s.length,c=0,u=0;a<l;a++){var f=s[a];if(f.removed){if(f.value=o.join(r.slice(u,u+f.count)),u+=f.count,a&&s[a-1].added){var p=s[a-1];s[a-1]=s[a],s[a]=p}}else{if(!f.added&&n){var d=t.slice(c,c+f.count);d=d.map(function(v,g){var k=r[u+g];return k.length>v.length?k:v}),f.value=o.join(d)}else f.value=o.join(t.slice(c,c+f.count));c+=f.count,f.added||(u+=f.count)}}var m=s[l-1];return l>1&&typeof m.value=="string"&&(m.added||m.removed)&&o.equals("",m.value)&&(s[l-2].value+=m.value,s.pop()),s}var S$=new tn;function cL(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Eb=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Pb=/\S/,up=new tn;up.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Pb.test(o)&&!Pb.test(e)};up.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Eb.test(e[t])&&Eb.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Rb(o,e,t){return t=cL(t,{ignoreWhitespace:!0}),up.diff(o,e,t)}var fp=new tn;fp.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function uL(o,e,t){return fp.diff(o,e,t)}var fL=new tn;fL.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var dL=new tn;dL.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Gl(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Gl=function(e){return typeof e}:Gl=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gl(o)}function ip(o){return pL(o)||mL(o)||hL(o)||gL()}function pL(o){if(Array.isArray(o))return ap(o)}function mL(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function hL(o,e){if(o){if(typeof o=="string")return ap(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ap(o,e)}}function ap(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function gL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var yL=Object.prototype.toString,ya=new tn;ya.useLongestToken=!0;ya.tokenize=fp.tokenize;ya.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,i){return typeof i=="undefined"?t:i}:r;return typeof o=="string"?o:JSON.stringify(lp(o,null,null,n),n,"  ")};ya.equals=function(o,e){return tn.prototype.equals.call(ya,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function lp(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var i;if(yL.call(o)==="[object Array]"){for(e.push(o),i=new Array(o.length),t.push(i),s=0;s<o.length;s+=1)i[s]=lp(o[s],e,t,r,n);return e.pop(),t.pop(),i}if(o&&o.toJSON&&(o=o.toJSON()),Gl(o)==="object"&&o!==null){e.push(o),i={},t.push(i);var a=[],l;for(l in o)o.hasOwnProperty(l)&&a.push(l);for(a.sort(),s=0;s<a.length;s+=1)l=a[s],i[l]=lp(o[l],e,t,r,l);e.pop(),t.pop()}else i=o;return i}var cp=new tn;cp.tokenize=function(o){return o.slice()};cp.join=cp.removeEmpty=function(o){return o};function Db(o,e,t,r,n,s,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var a=uL(t,r,i);if(!a)return;a.push({value:"",lines:[]});function l(k){return k.map(function(L){return" "+L})}for(var c=[],u=0,f=0,d=[],p=1,m=1,v=function(L){var I=a[L],C=I.lines||I.value.replace(/\n$/,"").split(`
`);if(I.lines=C,I.added||I.removed){var M;if(!u){var A=a[L-1];u=p,f=m,A&&(d=i.context>0?l(A.lines.slice(-i.context)):[],u-=d.length,f-=d.length)}(M=d).push.apply(M,ip(C.map(function(te){return(I.added?"+":"-")+te}))),I.added?m+=C.length:p+=C.length}else{if(u)if(C.length<=i.context*2&&L<a.length-2){var E;(E=d).push.apply(E,ip(l(C)))}else{var P,T=Math.min(C.length,i.context);(P=d).push.apply(P,ip(l(C.slice(0,T))));var $={oldStart:u,oldLines:p-u+T,newStart:f,newLines:m-f+T,lines:d};if(L>=a.length-2&&C.length<=i.context){var J=/\n$/.test(t),N=/\n$/.test(r),O=C.length==0&&d.length>$.oldLines;!J&&O&&t.length>0&&d.splice($.oldLines,0,"\\ No newline at end of file"),(!J&&!O||!N)&&d.push("\\ No newline at end of file")}c.push($),u=0,f=0,d=[]}p+=C.length,m+=C.length}},g=0;g<a.length;g++)v(g);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var Ub=require("obsidian");var Jl=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Ql=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let i=0;i<r.lines.length;i+=1){let a=r.lines[i];if(a.startsWith("+")||a.startsWith("-")){let l=i,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let u=r.lines.slice(l,c+1).filter(d=>d.startsWith("-")).map(d=>d.slice(1)),f=r.lines.slice(l,c+1).filter(d=>d.startsWith("+")).map(d=>d.slice(1));t.push(new Jl({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:u,file2Lines:f})),n+=u.length,s+=f.length,i+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function dp(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function ba(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function va(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function si(o){return o!==""?o:"\u200E"}var hr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var Co=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Yl=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof Tt){Js(e.ydoc,t,e);return}else if(e instanceof jo){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new hr({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),Co.build(t),new hr({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),Co.build(t),new hr({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),Co.build(t),new hr({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new hr({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),Co.build(t),new hr({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new hr({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),Co.build(t),new hr({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=ba({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=ba({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=ba({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=ba({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=va({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=va({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=dp({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=dp({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=va({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=va({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var ii="system3-differences-view";async function Ob(o,e){o.detachLeavesOfType(ii);let t=o.getLeaf(!0);t.setViewState({type:ii,active:!0,state:e}),o.revealLeaf(t)}var Zl=class extends Ub.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];let r=this.constructor.name;this.log=Fe(`[${r}]`,"log")}async getContent(t){return t instanceof Tt?t.text:t instanceof jo?t.contents:await this.app.vault.read(t)}getViewType(){return ii}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=Db(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));if(this.fileDifferences=Ql.fromParsedDiff(t),this.fileDifferences.differences.length===0){if(this.file1Content!==this.file2Content){if(this.log("byte level difference with differ equivalence",this.file1Content.length,this.file2Content.length),Ze().enableDeltaLogging){let s=this.file1Content||"",i=this.file2Content||"",a=Math.max(s.length,i.length);for(let l=0;l<a;l++){let c=l<s.length?s.charCodeAt(l):void 0,u=l<i.length?i.charCodeAt(l):void 0;if(c!==u){let f=c!==void 0?`0x${c.toString(16).padStart(2,"0")}`:"EOF",d=u!==void 0?`0x${u.toString(16).padStart(2,"0")}`:"EOF";this.log(`Byte difference at position ${l}: file1=${c} (${f}), file2=${u} (${d})`)}}}await this.modify(this.state.file2,this.file1Content||"")}this.leaf.detach()}}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new hr({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),Co.build(r),new hr({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof Tt){Js(t.ydoc,r,t);return}else if(t instanceof jo){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var i,a,l;let r=0,n=0,s=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((a=this.file2Lines)==null?void 0:a.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===n);if(c!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let u=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:si(u),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Yl(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=si(t);else if(t!=null&&r!=null){let i=Rb(r,t);for(let a of i){if(a.removed)continue;let l=document.createElement("span");l.textContent=si(a.value),a.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=si(t),i.classList.add(n),s.appendChild(i)}else s.textContent=si(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var Xl=class extends Mt{constructor(t){super();this.view=t.view,this.canvas=t.view.canvas,this.relayCanvas=t.canvas,this.unsubscribes=[],this.relayCanvasView=t,this.observedTextNodes=new Set,this.install()}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[]),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),n=t.id,s=i=>{let a=this.canvas.nodes.get(n);a&&(a.setText(r.toString()),this.canvas.markDirty(a))};r.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(s),this.observedTextNodes.delete(n)})}}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}install(){var c;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(c=this.view.file)==null?void 0:c.path,this.relayCanvas.path);let t=this,r=wt.exportCanvasData(this.relayCanvas.ydoc),n=r.nodes.length>0||r.edges.length>0;this.relayCanvas.hasLocalDB()&&n&&this.canvas.importData(r,!0),this.unsubscribes.push(Xo(this.canvas,{requestSave(u){return function(){let f=u.call(this);try{t.relayCanvas.importFromView(t.view)}catch(d){t.log(d)}return f}},applyHistory(u){return function(f){let d=u.call(this,f);try{t.relayCanvas.importFromView(t.view)}catch(p){t.log(p)}return d}}}));let i=(u,f)=>{var m,v,g,k;let d="";if(d+=`Transaction origin: ${u.transaction.origin} ${(v=(m=u.transaction.origin)==null?void 0:m.constructor)==null?void 0:v.name}
`,this.relayCanvas||this.log("relay canvas is already destroyed"),!this.canvas){this.log("canvas is already destroyed");return}if(!((g=this.view.file)!=null&&g.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(u.transaction.origin===this.relayCanvas)return;let p=wt.exportCanvasData(this.relayCanvas.ydoc);for(let[L,I]of u.changes.keys)d+=`key: ${L} action: ${I.action}

`;this.debug(d),this.debug("importing data",(k=this.view.file)==null?void 0:k.path,this.relayCanvas.path,p),this.canvas.importData(p,!0),this.canvas.requestSave();for(let L of u.keysChanged){let I=f.get(L);I&&(this.canvas.nodes.has(I.id)&&this.observeNode(I.getData()),this.canvas.markMoved(I),this.canvas.markDirty(I))}},a=u=>i(u,this.canvas.nodes);this.relayCanvas.ynodes.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(a)});for(let[,u]of this.relayCanvas.ynodes)this.observeNode(u);let l=u=>i(u,this.canvas.edges);this.relayCanvas.yedges.observe(l),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(l)}),this.relayCanvasView.tracking=!0}};var ec=require("@codemirror/state"),$b=require("@codemirror/view");var lB=ec.Facet.define({combine(o){return o[o.length-1]}}),Nb=ec.Annotation.define(),pp=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,n,s;this.editor=e,this.connectionManager=this.editor.state.field(Io),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"warn"),this.debug=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"debug"),this.debug("created"),this._observer=async(i,a)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(a.origin!==this){let c=i.delta,u=[],f=0;for(let d=0;d<c.length;d++){let p=c[d];p.insert!=null?u.push({from:f,to:f,insert:p.insert}):p.delete!=null?(u.push({from:f,to:f+p.delete,insert:""}),f+=p.delete):p.retain!=null&&(f+=p.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:u,annotations:[Nb.of(this.editor)]})}},this.observer=(i,a)=>{var l;try{(l=this._observer)==null||l.call(this,i,a)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,n,s,i;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(a=>{if(a&&a.node)return a.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((n=this.node)==null?void 0:n.id)&&this.observer&&((s=this._ytext)==null||s.unobserve(this.observer)),this.node=e.node,(i=this.view)==null?void 0:i.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Nb)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let n=0;e.changes.iterChanges((s,i,a,l,c)=>{let u=c.sliceString(0,c.length,`
`);s!==i&&t.delete(s+n,i-s),u.length>0&&t.insert(s+n,u),n+=u.length-(i-s)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Bb=$b.ViewPlugin.fromClass(pp);var vL=3;function mp(o,e){o.iterateAllLeaves(t=>{t.view instanceof ai.MarkdownView&&e(t.view)})}function hp(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&Ze().enableCanvasSync&&e(t.view)})}function _L(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(((t=o[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((n=o[i].document)==null?void 0:n.path)!==((s=e[i].document)==null?void 0:s.path))return!1;return!0}var tc=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new ls(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){var e;this.release(),(e=this.banner)==null||e.destroy(),this.banner=void 0,this.view=null}};function ro(o){return o instanceof Tn&&o.document!==void 0&&o.document.text!==void 0}function xL(o){return o instanceof rc&&o.document!==void 0}var rc=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this.tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}offlineBanner(){if(this.shouldConnect){let e=new ls(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Zd({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.setConnectionDot(),this.plugin||(this.plugin=new Xl(this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.canvas=null}},Tn=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new ls(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new ls(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Zd({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;if(this.view.getMode()==="preview")return!1;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},oc=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new nc.Compartment,this.log=Fe("[LiveViews]","log"),this.warn=Fe("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,u)=>{let f=this.metadataListeners.get(l);f==null||f(c,u)},i=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(i)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let a=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(u=>{var f;((f=u.document)==null?void 0:f.sharedFolder)===l&&u.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,a(l))})})),$t.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([Io.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Ob(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return mp(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),hp(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(mp(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),hp(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return mp(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getDoc(r),a=new Tn(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new tc(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),hp(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getCanvas(r),a=new rc(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new tc(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),e}findView(e){return this.views.filter(ro).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(xL).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof Tn).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=vL){let r=this.workspace.getActiveViewOfType(ai.MarkdownView),n=0,s=e.sort((a,l)=>l.view.leaf.activeTime-a.view.leaf.activeTime),i=new Set;for(let a of s)a instanceof Tn&&(a.view===r||i.has(a.document)?(a.canConnect=!0,i.add(a.document)):n<t?(a.canConnect=!0,i.add(a.document),n++):a.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(i=>{if(n.document==i.document&&n.view==i.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=Fe(r,"debug"),s=(f,d)=>{n(f,d.map(p=>{var m;return{type:p.constructor.name,file:(m=p.document)==null?void 0:m.path,canConnect:p.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let i=[];try{i=await this.getViews()}catch(f){return this.warn("[System 3][Relay][Live Views] error getting views",f),!1}let a=this.findFolders();if(a.length===0&&i.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?a.forEach(f=>{f.connect()}):this.sharedFolders.forEach(f=>{f.disconnect()});let[l,c]=this.deduplicate(i);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&_L(l,this.views)){let f=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",f)}else{let f=await this.viewsReady(l);s("Ready Views",f);let d=await this.viewsAttachedWithConnectionPool(f);s("Attached Views",d),this.views=l}n("loading plugins"),this.load();let u=ai.moment.utc();return n(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Fe(e,"warn"),r=ai.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(Io.init(()=>this)),Lb,Bb,Mb,Tb,Fb]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},Io=nc.StateField.define({create(o){},update(o,e){return o}});var li=require("obsidian");function wL(o){Ce(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Vb(o){let e,t,r,n;return{c(){e=_("span"),t=B(o[3]),r=B("%"),h(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),me(e,"opacity","1")},m(s,i){w(s,e,i),y(e,t),y(e,r)},p(s,i){i&8&&Q(t,s[3]),i&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&h(e,"class",n)},d(s){s&&x(e)}}}function SL(o){let e,t,r;return t=new to({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=_("span"),U(t.$$.fragment),h(e,"class","notebook system3-icon svelte-1siabfk"),h(e,"aria-label","Tracking Changes")},m(n,s){w(n,e,s),R(t,e,null),r=!0},p:q,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&x(e),D(t)}}}function kL(o){let e,t,r,n,s,i,a,l;return t=new to({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new Zo({props:{class:"inline-icon"}}),{c(){var c;e=_("span"),U(t.$$.fragment),r=F(),n=_("span"),U(s.$$.fragment),h(e,"class","notebook system3-icon hidden svelte-1siabfk"),h(e,"aria-label","Tracking Changes"),h(n,"class",i="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),h(n,"aria-label",a=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,u){w(c,e,u),R(t,e,null),w(c,r,u),w(c,n,u),R(s,n,null),l=!0},p(c,u){var f;(!l||u&1&&i!==(i="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&h(n,"class",i),(!l||u&5&&a!==(a=`${((f=c[2])==null?void 0:f.relay.name)||"Relay Server"} (${c[0]})`))&&h(n,"aria-label",a)},i(c){l||(b(t.$$.fragment,c),b(s.$$.fragment,c),l=!0)},o(c){S(t.$$.fragment,c),S(s.$$.fragment,c),l=!1},d(c){c&&(x(e),x(r),x(n)),D(t),D(s)}}}function IL(o){let e,t,r,n,s,i=o[5]&&Vb(o),a=[kL,SL],l=[];function c(u,f){return u[1]?0:1}return r=c(o,-1),n=l[r]=a[r](o),{c(){e=_("div"),i&&i.c(),t=F(),n.c(),h(e,"class","system3-folder-icons svelte-1siabfk")},m(u,f){w(u,e,f),i&&i.m(e,null),y(e,t),l[r].m(e,null),s=!0},p(u,[f]){u[5]?i?i.p(u,f):(i=Vb(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null);let d=r;r=c(u,f),r===d?l[r].p(u,f):(ne(),S(l[d],1,1,()=>{l[d]=null}),se(),n=l[r],n?n.p(u,f):(n=l[r]=a[r](u),n.c()),b(n,1),n.m(e,null))},i(u){s||(b(n),s=!0)},o(u){S(n),s=!1},d(u){u&&x(e),i&&i.d(),l[r].d()}}}function CL(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:i}=e,{progress:a=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,i=c.remote),"progress"in c&&t(3,a=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||a<100)&&a>0)}},[n,s,i,a,l,r]}var gp=class extends K{constructor(e){super(),G(this,e,CL,IL,W,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},wL)}},Hb=gp;function LL(o){Ce(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function ML(o){let e,t,r;return{c(){e=_("div"),t=_("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),h(e,"aria-label",o[1])},m(n,s){w(n,e,s),y(e,t),y(t,r)},p(n,[s]){s&1&&Q(r,n[0]),s&2&&h(e,"aria-label",n[1])},i:q,o:q,d(n){n&&x(e)}}}function TL(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var yp=class extends K{constructor(e){super(),G(this,e,TL,ML,W,{text:0,label:1},LL)}},qb=yp;function AL(o){Ce(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function FL(o){let e,t,r,n;return{c(){e=_("div"),t=_("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),h(e,"aria-label",o[1]),h(e,"style",n=o[2]?`color:${o[2]}`:"")},m(s,i){w(s,e,i),y(e,t),y(t,r)},p(s,[i]){i&1&&Q(r,s[0]),i&2&&h(e,"aria-label",s[1]),i&4&&n!==(n=s[2]?`color:${s[2]}`:"")&&h(e,"style",n)},i:q,o:q,d(s){s&&x(e)}}}function EL(o,e,t){let{text:r}=e,{label:n}=e,{color:s}=e;return o.$$set=i=>{"text"in i&&t(0,r=i.text),"label"in i&&t(1,n=i.label),"color"in i&&t(2,s=i.color)},[r,n,s]}var bp=class extends K{constructor(e){super(),G(this,e,EL,FL,W,{text:0,label:1,color:2},AL)}},zb=bp;var vp=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},An=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},_p=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new vp(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},xp=class extends An{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new _p(t.selfEl,n):(r&&r.destroy(),null)}},wp=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new Hb({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Sp=class extends An{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new wp(t.selfEl,n):(r&&r.destroy(),null)}},kp=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},Ip=class extends An{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&Tt.checkExtension(t.path)?n||new kp(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},Cp=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(r=>{r.remove()}),this.unsubscribes.push(this.file.subscribe(()=>{this.setText()}))}setText(){var e;if(this.file){if(this.file.inMeta){(e=this.pill)==null||e.$destroy();return}this.pill?this.pill.$set({text:this.file.tag}):this.pill=new zb({target:this.el,props:{text:this.file.tag}})}}destroy(){var e;this.unsubscribes.forEach(t=>t()),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()}),(e=this.pill)==null||e.$destroy(),this.file=null}},Lp=class extends An{visitFile(e,t,r,n){if(n&&!Tt.checkExtension(e.path)&&!wt.checkExtension(e.path)&&n.isSyncableTFile(e)&&n.ready&&n.connected)try{let s=n.proxy.viewSyncFile(e.path);if(s&&xr(s))return r&&r.file===s?r:new Cp(t.selfEl,s)}catch(s){Fe("FilePillVisitor.visitFile","error")(s)}return r&&r.destroy(),null}},Mp=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new qb({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Tp=class extends An{visitFile(e,t,r,n){return n&&n.checkPath(e.path)&&!n.isSyncableTFile(e)?r||new Mp(t.selfEl):(r&&r.destroy(),null)}},Ap=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Fp=class extends An{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),i=n.syncStore.get(s);if(!i)return null;let a=n.files.get(i);return!(a instanceof Tt)||!a?null:r||new Ap(t.el,a,e)}catch(s){return null}return r&&r.destroy(),null}},sc=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,i)=>{let a=s.get(n),l=i.visitFolder(e,n,a,r);a&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof li.TFolder)this.walk(s,r);else if(s instanceof li.TFile){let i=this.getFileExplorerItem(this.fileExplorer,s);if(!i)return;this.storage.forEach((a,l)=>{let c=a.get(i),u=l.visitFile(s,i,c,r);c&&!u?a.delete(i):u&&a.set(i,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},ic=class{constructor(e,t,r,n){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{Oy([qo.enableDocumentStatus],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(s.syncSettingsManager.subscribe(i=>{this.quickRefresh()})),this.unsubscribes.push(s.subscribe(this,()=>{this.quickRefresh()})),this.unsubscribes.push(s.syncStore.subscribe(i=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new xp),e.push(new Sp),bn(qo.enableDocumentStatus,()=>{e.push(new Fp),e.push(new Ip(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new Lp),e.push(new Tp),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new sc(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let i=this.vault.getAbstractFileByPath(s);i instanceof li.TFolder&&n.walk(i)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new sc(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof li.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var Lx=require("obsidian");function Ae(o,e,t,r){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(f){i(f)}}function l(u){try{c(r.throw(u))}catch(f){i(f)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((r=r.apply(o,e||[])).next())})}var oo=require("obsidian");function PL(o){let e,t,r;return{c(){e=Kt("svg"),t=Kt("g"),r=Kt("path"),h(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),h(r,"fill","#5865F2"),h(r,"fill-rule","nonzero"),h(e,"width",o[0]),h(e,"height",o[0]),h(e,"viewBox","0 -28.5 256 256"),h(e,"version","1.1"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),h(e,"preserveAspectRatio","xMidYMid")},m(n,s){w(n,e,s),y(e,t),y(t,r)},p(n,[s]){s&1&&h(e,"width",n[0]),s&1&&h(e,"height",n[0])},i:q,o:q,d(n){n&&x(e)}}}function RL(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var Ep=class extends K{constructor(e){super(),G(this,e,RL,PL,W,{size:0})}},ac=Ep;function DL(o){Ce(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function jb(o){let e,t,r,n,s,i,a,l,c,u,f,d,p;return a=new ac({props:{size:20}}),{c(){e=_("div"),t=_("div"),r=F(),n=_("div"),s=_("span"),i=_("a"),U(a.$$.fragment),l=F(),c=_("span"),c.textContent="Join the community",h(t,"class","arrow svelte-4t8k3t"),h(i,"href","https://discord.system3.md"),h(i,"target","_blank"),h(i,"rel","noopener noreferrer"),h(i,"class","menu-item svelte-4t8k3t"),me(s,"text-align","center"),me(s,"display","flex"),h(n,"class","menu-content svelte-4t8k3t"),h(e,"class","menu-dropdown svelte-4t8k3t")},m(m,v){w(m,e,v),y(e,t),y(e,r),y(e,n),y(n,s),y(s,i),R(a,i,null),y(i,l),y(i,c),f=!0,d||(p=ts(u=o[1].call(null,e)),d=!0)},i(m){f||(b(a.$$.fragment,m),f=!0)},o(m){S(a.$$.fragment,m),f=!1},d(m){m&&x(e),D(a),d=!1,p()}}}function UL(o){let e,t,r,n,s,i,a;r=new Dd({props:{size:"20px"}});let l=o[0]&&jb(o);return{c(){e=_("div"),t=_("button"),U(r.$$.fragment),n=F(),l&&l.c(),h(t,"class","menu-button svelte-4t8k3t"),h(e,"class","menu-container svelte-4t8k3t")},m(c,u){w(c,e,u),y(e,t),R(r,t,null),y(e,n),l&&l.m(e,null),s=!0,i||(a=V(t,"click",Nl(o[2])),i=!0)},p(c,[u]){c[0]?l?u&1&&b(l,1):(l=jb(c),l.c(),b(l,1),l.m(e,null)):l&&(ne(),S(l,1,1,()=>{l=null}),se())},i(c){s||(b(r.$$.fragment,c),b(l),s=!0)},o(c){S(r.$$.fragment,c),S(l),s=!1},d(c){c&&x(e),D(r),l&&l.d(),i=!1,a()}}}function OL(o,e,t){let r=!1;function n(i){let a=l=>{let c=document.querySelector(".menu-button");!i.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",a)},0),{destroy(){document.removeEventListener("click",a)}}}function s(i){i.stopPropagation(),t(0,r=!r)}return[r,n,s]}var Pp=class extends K{constructor(e){super(),G(this,e,OL,UL,W,{},DL)}},Wb=Pp;function NL(o){Ce(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function $L(o){let e,t;return{c(){e=Kt("svg"),t=Kt("path"),h(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),h(e,"class","relay-text svelte-ycfe1d"),h(e,"width",o[0]),h(e,"height",o[1]),h(e,"viewBox","0 0 154.24573 66.293579"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){w(r,e,n),y(e,t)},p:q,i:q,o:q,d(r){r&&x(e)}}}function BL(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=i=>{"size"in i&&t(2,r=i.size)},[n,s,r]}var Rp=class extends K{constructor(e){super(),G(this,e,BL,$L,W,{size:2},NL)}},lc=Rp;function VL(o){Ce(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function HL(o){let e,t,r,n,s,i;return e=new lc({props:{size:140}}),{c(){U(e.$$.fragment),t=F(),r=_("p"),r.textContent="Real-time collaboration in Obsidian",n=F(),s=_("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,h(r,"class","subtitle svelte-120r7kg"),h(s,"class","description svelte-120r7kg")},m(a,l){R(e,a,l),w(a,t,l),w(a,r,l),w(a,n,l),w(a,s,l),i=!0},p:q,i(a){i||(b(e.$$.fragment,a),i=!0)},o(a){S(e.$$.fragment,a),i=!1},d(a){a&&(x(t),x(r),x(n),x(s)),D(e,a)}}}var Dp=class extends K{constructor(e){super(),G(this,e,null,HL,W,{},VL)}},Kb=Dp;var cc=require("obsidian");function qL(o){Ce(o,"svelte-1rfjxfa",`.help-section.svelte-1rfjxfa{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1rfjxfa{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1rfjxfa{position:relative;max-width:640px;margin:0 auto}.why-signin.svelte-1rfjxfa:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-signin.svelte-1rfjxfa{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-signin.svelte-1rfjxfa:hover{color:var(--text-normal)}.help-content.svelte-1rfjxfa{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1rfjxfa{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1rfjxfa{opacity:1;visibility:visible}.popover.svelte-1rfjxfa:not(.visible){transition-delay:0s}.arrow.svelte-1rfjxfa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1rfjxfa{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function zL(o){let e,t,r,n;return{c(){e=_("div"),t=_("div"),r=F(),n=_("p"),n.textContent=`${Jb}`,h(t,"class","arrow svelte-1rfjxfa"),h(e,"class","popover svelte-1rfjxfa"),Te(e,"visible",o[0])},m(s,i){w(s,e,i),y(e,t),y(e,r),y(e,n),o[9](e)},p(s,i){i&1&&Te(e,"visible",s[0])},d(s){s&&x(e),o[9](null)}}}function jL(o){let e,t=o[0]&&Gb(o);return{c(){t&&t.c(),e=pe()},m(r,n){t&&t.m(r,n),w(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=Gb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&x(e),t&&t.d(r)}}}function Gb(o){let e,t;return{c(){e=_("div"),t=_("p"),t.textContent=`${Jb}`,h(e,"class","help-content svelte-1rfjxfa")},m(r,n){w(r,e,n),y(e,t)},p:q,d(r){r&&x(e)}}}function WL(o){let e,t,r,n,s,i,a,l,c,u,f,d;function p(g,k){return g[1]?jL:zL}let m=p(o,-1),v=m(o);return l=new ac({}),{c(){e=_("div"),t=_("div"),r=_("button"),r.textContent="Why do I need to sign in?",n=F(),v.c(),s=F(),i=_("div"),a=_("a"),U(l.$$.fragment),c=B(`
		Join the project on Discord`),h(r,"class","why-signin svelte-1rfjxfa"),Te(r,"mobile",o[1]),h(t,"class","help-container svelte-1rfjxfa"),h(e,"class","help-section svelte-1rfjxfa"),h(a,"href","https://discord.system3.md"),h(a,"class","discord-link svelte-1rfjxfa"),h(i,"class","footer svelte-1rfjxfa")},m(g,k){w(g,e,k),y(e,t),y(t,r),o[8](r),y(t,n),v.m(t,null),w(g,s,k),w(g,i,k),y(i,a),R(l,a,null),y(a,c),u=!0,f||(d=[V(r,"mouseenter",o[4]),V(r,"mouseleave",o[5]),V(r,"click",o[6])],f=!0)},p(g,[k]){(!u||k&2)&&Te(r,"mobile",g[1]),m===(m=p(g,k))&&v?v.p(g,k):(v.d(1),v=m(g),v&&(v.c(),v.m(t,null)))},i(g){u||(b(l.$$.fragment,g),u=!0)},o(g){S(l.$$.fragment,g),u=!1},d(g){g&&(x(e),x(s),x(i)),o[8](null),v.d(),D(l),f=!1,we(d)}}}var Jb="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. Using an identity provider helps to prevent spam accounts and ensures secure authentication.";function KL(o,e,t){var r;let n=!1,s=!1,i,a;function l(){s||t(0,n=!0)}function c(){s||t(0,n=!1)}function u(){s&&t(0,n=!n)}function f(p){vt[p?"unshift":"push"](()=>{i=p,t(2,i)})}function d(p){vt[p?"unshift":"push"](()=>{a=p,t(3,a)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,s=t(7,r=cc.Platform===null||cc.Platform===void 0?void 0:cc.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[n,s,i,a,l,c,u,r,f,d]}var Up=class extends K{constructor(e){super(),G(this,e,KL,WL,W,{},qL)}},Qb=Up;var Yb=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],uc=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=Yb[Ti()%Yb.length]}};function GL(o){Ce(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function JL(o){let e,t;return{c(){e=_("span"),t=B(o[5]),h(e,"class","initial svelte-18fffd7"),me(e,"font-size",o[4])},m(r,n){w(r,e,n),y(e,t)},p(r,n){n&32&&Q(t,r[5]),n&16&&me(e,"font-size",r[4])},d(r){r&&x(e)}}}function QL(o){let e,t,r,n;return{c(){e=_("img"),dr(e.src,t=o[0].picture)||h(e,"src",t),h(e,"alt",o[1]),h(e,"referrerpolicy","no-referrer"),h(e,"class","svelte-18fffd7")},m(s,i){w(s,e,i),r||(n=V(e,"error",o[6]),r=!0)},p(s,i){i&1&&!dr(e.src,t=s[0].picture)&&h(e,"src",t),i&2&&h(e,"alt",s[1])},d(s){s&&x(e),r=!1,n()}}}function YL(o){let e;function t(s,i){return!s[3]&&s[0].picture?QL:JL}let r=t(o,-1),n=r(o);return{c(){e=_("div"),n.c(),h(e,"class","avatar svelte-18fffd7"),me(e,"width",o[2]),me(e,"height",o[2])},m(s,i){w(s,e,i),n.m(e,null)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),i&4&&me(e,"width",s[2]),i&4&&me(e,"height",s[2])},i:q,o:q,d(s){s&&x(e),n.d()}}}function ZL(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function XL(o,e,t){let r,n,s,{user:i}=e,{alt:a="Profile picture"}=e,{size:l="40px"}=e,c=!1;function u(){t(3,c=!0)}return o.$$set=f=>{"user"in f&&t(0,i=f.user),"alt"in f&&t(1,a=f.alt),"size"in f&&t(2,l=f.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=i.name?i.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=ZL(l))}if(o.$$.dirty&132){e:t(4,s=`${parseFloat(l)/2}${n}`)}},[i,a,l,c,s,r,u,n]}var Op=class extends K{constructor(e){super(),G(this,e,XL,YL,W,{user:0,alt:1,size:2},GL)}},Zb=Op;var U7=require("obsidian");function eM(o){Ce(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function tM(o){let e,t,r,n,s,i=(o[0].name||"")+"",a,l,c,u,f=(o[0].email||"")+"",d,p,m,v;t=new Zb({props:{size:"2.5em",user:o[0]}});let g=o[2].default,k=ye(g,o,o[1],null);return{c(){e=_("div"),U(t.$$.fragment),r=F(),n=_("div"),s=_("div"),a=B(i),l=F(),c=_("br"),u=F(),d=B(f),p=F(),m=_("div"),k&&k.c(),h(s,"class","setting-item-description"),h(n,"class","setting-item-info svelte-zlums1"),me(n,"display","grid"),h(m,"class","setting-item-control svelte-zlums1"),h(e,"class","setting-item svelte-zlums1")},m(L,I){w(L,e,I),R(t,e,null),y(e,r),y(e,n),y(n,s),y(s,a),y(s,l),y(s,c),y(s,u),y(s,d),y(e,p),y(e,m),k&&k.m(m,null),v=!0},p(L,[I]){let C={};I&1&&(C.user=L[0]),t.$set(C),(!v||I&1)&&i!==(i=(L[0].name||"")+"")&&Q(a,i),(!v||I&1)&&f!==(f=(L[0].email||"")+"")&&Q(d,f),k&&k.p&&(!v||I&2)&&ve(k,g,L,L[1],v?be(g,L[1],I,null):_e(L[1]),null)},i(L){v||(b(t.$$.fragment,L),b(k,L),v=!0)},o(L){S(t.$$.fragment,L),S(k,L),v=!1},d(L){L&&x(e),D(t),k&&k.d(L)}}}function rM(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=i=>{"user"in i&&t(0,s=i.user),"$$scope"in i&&t(1,n=i.$$scope)},[s,n,r]}var Np=class extends K{constructor(e){super(),G(this,e,rM,tM,W,{user:0},eM)}},ci=Np;var fc=require("obsidian");function oM(o){Ce(o,"svelte-1da9go9",".help-container.svelte-1da9go9.svelte-1da9go9{position:relative;display:inline-block}button.svelte-1da9go9.svelte-1da9go9{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-1da9go9.svelte-1da9go9:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-1da9go9.svelte-1da9go9:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.help-container.svelte-1da9go9>.popover.svelte-1da9go9{position:absolute;z-index:70;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.help-container.svelte-1da9go9>.popover.left.svelte-1da9go9{right:100%;margin-right:8px}.help-container.svelte-1da9go9>.popover.right.svelte-1da9go9{left:0}.arrow.svelte-1da9go9.svelte-1da9go9{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-1da9go9.svelte-1da9go9{right:8px}.arrow.right.svelte-1da9go9.svelte-1da9go9{left:8px}p.svelte-1da9go9.svelte-1da9go9{margin:0;color:var(--text-normal)}")}function Xb(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),r=F(),n=_("p"),s=B(o[0]),h(t,"class","arrow svelte-1da9go9"),Te(t,"left",o[4]==="left"),Te(t,"right",o[4]==="right"),h(n,"class","svelte-1da9go9"),h(e,"class","popover svelte-1da9go9"),Te(e,"left",o[4]==="left"),Te(e,"right",o[4]==="right")},m(i,a){w(i,e,a),y(e,t),y(e,r),y(e,n),y(n,s),o[9](e)},p(i,a){a&16&&Te(t,"left",i[4]==="left"),a&16&&Te(t,"right",i[4]==="right"),a&1&&Q(s,i[0]),a&16&&Te(e,"left",i[4]==="left"),a&16&&Te(e,"right",i[4]==="right")},d(i){i&&x(e),o[9](null)}}}function nM(o){let e,t,r,n,s,i,a;r=new da({props:{size:16}});let l=o[1]&&Xb(o);return{c(){e=_("div"),t=_("button"),U(r.$$.fragment),n=F(),l&&l.c(),h(t,"type","button"),h(t,"class","svelte-1da9go9"),h(e,"class","help-container svelte-1da9go9")},m(c,u){w(c,e,u),y(e,t),R(r,t,null),o[8](t),y(e,n),l&&l.m(e,null),s=!0,i||(a=[V(t,"mouseenter",o[5]),V(t,"mouseleave",o[6]),V(t,"click",o[7])],i=!0)},p(c,[u]){c[1]?l?l.p(c,u):(l=Xb(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(b(r.$$.fragment,c),s=!0)},o(c){S(r.$$.fragment,c),s=!1},d(c){c&&x(e),D(r),o[8](null),l&&l.d(),i=!1,we(a)}}}function sM(o,e,t){let{helpText:r}=e,n=!1,s="right",i,a;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function u(){t(1,n=!n)}function f(p){vt[p?"unshift":"push"](()=>{i=p,t(2,i)})}function d(p){vt[p?"unshift":"push"](()=>{a=p,t(3,a)})}return o.$$set=p=>{"helpText"in p&&t(0,r=p.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&i&&a){let p=i.getBoundingClientRect(),m=a.getBoundingClientRect(),v=window.innerWidth;t(4,s=p.right+m.width>v-20?"left":"right")}}},[r,n,i,a,s,l,c,u,f,d]}var $p=class extends K{constructor(e){super(),G(this,e,sM,nM,W,{helpText:0},oM)}},ev=$p;function iM(o){Ce(o,"svelte-5o4y9d",".setting-item-name.svelte-5o4y9d{display:flex;align-items:center;gap:8px;overflow:unset}.help-button.svelte-5o4y9d{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-5o4y9d:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-5o4y9d:active{color:var(--text-normal)}.help-content.svelte-5o4y9d{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-5o4y9d{margin:0}")}var aM=o=>({}),tv=o=>({}),lM=o=>({}),rv=o=>({}),cM=o=>({}),ov=o=>({});function uM(o){let e;return{c(){e=B(o[0])},m(t,r){w(t,e,r)},p(t,r){r&1&&Q(e,t[0])},d(t){t&&x(e)}}}function nv(o){let e,t,r,n,s=[dM,fM],i=[];function a(l,c){return l[3]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=pe()},m(l,c){i[e].m(l,c),w(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(ne(),S(i[u],1,1,()=>{i[u]=null}),se(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&x(r),i[e].d(l)}}}function fM(o){let e,t;return e=new ev({props:{helpText:o[1]}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function dM(o){let e,t,r,n,s;return t=new da({props:{size:16}}),{c(){e=_("button"),U(t.$$.fragment),h(e,"class","help-button svelte-5o4y9d"),h(e,"aria-expanded",o[2])},m(i,a){w(i,e,a),R(t,e,null),r=!0,n||(s=V(e,"click",o[4]),n=!0)},p(i,a){(!r||a&4)&&h(e,"aria-expanded",i[2])},i(i){r||(b(t.$$.fragment,i),r=!0)},o(i){S(t.$$.fragment,i),r=!1},d(i){i&&x(e),D(t),n=!1,s()}}}function pM(o){let e,t,r=o[7].description,n=ye(r,o,o[6],tv);return{c(){e=_("div"),n&&n.c(),h(e,"class","setting-item-description")},m(s,i){w(s,e,i),n&&n.m(e,null),t=!0},p(s,i){n&&n.p&&(!t||i&64)&&ve(n,r,s,s[6],t?be(r,s[6],i,aM):_e(s[6]),tv)},i(s){t||(b(n,s),t=!0)},o(s){S(n,s),t=!1},d(s){s&&x(e),n&&n.d(s)}}}function sv(o){let e,t,r;return{c(){e=_("div"),t=_("p"),r=B(o[1]),h(t,"class","svelte-5o4y9d"),h(e,"class","help-content svelte-5o4y9d"),Te(e,"expanded",o[2])},m(n,s){w(n,e,s),y(e,t),y(t,r)},p(n,s){s&2&&Q(r,n[1]),s&4&&Te(e,"expanded",n[2])},d(n){n&&x(e)}}}function mM(o){let e,t,r,n,s,i,a,l,c,u=o[7].name,f=ye(u,o,o[6],ov),d=f||uM(o),p=o[1]&&nv(o),m=o[7].description,v=ye(m,o,o[6],rv),g=v||pM(o),k=o[1]&&o[2]&&o[3]&&sv(o),L=o[7].default,I=ye(L,o,o[6],null);return{c(){e=_("div"),t=_("div"),r=_("div"),d&&d.c(),n=F(),p&&p.c(),s=F(),g&&g.c(),i=F(),k&&k.c(),a=F(),l=_("div"),I&&I.c(),h(r,"class","setting-item-name svelte-5o4y9d"),h(t,"class","setting-item-info"),h(l,"class","setting-item-control"),h(e,"class","setting-item setting-item-heading mod-list-item")},m(C,M){w(C,e,M),y(e,t),y(t,r),d&&d.m(r,null),y(r,n),p&&p.m(r,null),y(t,s),g&&g.m(t,null),y(t,i),k&&k.m(t,null),y(e,a),y(e,l),I&&I.m(l,null),c=!0},p(C,[M]){f?f.p&&(!c||M&64)&&ve(f,u,C,C[6],c?be(u,C[6],M,cM):_e(C[6]),ov):d&&d.p&&(!c||M&1)&&d.p(C,c?M:-1),C[1]?p?(p.p(C,M),M&2&&b(p,1)):(p=nv(C),p.c(),b(p,1),p.m(r,null)):p&&(ne(),S(p,1,1,()=>{p=null}),se()),v?v.p&&(!c||M&64)&&ve(v,m,C,C[6],c?be(m,C[6],M,lM):_e(C[6]),rv):g&&g.p&&(!c||M&64)&&g.p(C,c?M:-1),C[1]&&C[2]&&C[3]?k?k.p(C,M):(k=sv(C),k.c(),k.m(t,null)):k&&(k.d(1),k=null),I&&I.p&&(!c||M&64)&&ve(I,L,C,C[6],c?be(L,C[6],M,null):_e(C[6]),null)},i(C){c||(b(d,C),b(p),b(g,C),b(I,C),c=!0)},o(C){S(d,C),S(p),S(g,C),S(I,C),c=!1},d(C){C&&x(e),d&&d.d(C),p&&p.d(),g&&g.d(C),k&&k.d(),I&&I.d(C)}}}function hM(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:i=""}=e,{helpText:a=void 0}=e,l=!1,c=!1;function u(){c&&t(2,l=!l)}return o.$$set=f=>{"name"in f&&t(0,i=f.name),"helpText"in f&&t(1,a=f.helpText),"$$scope"in f&&t(6,n=f.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,s=fc.Platform===null||fc.Platform===void 0?void 0:fc.Platform.isMobile)!==null&&s!==void 0?s:!1)}},[i,a,l,c,u,s,n,r]}var Bp=class extends K{constructor(e){super(),G(this,e,hM,mM,W,{name:0,helpText:1},iM)}},ze=Bp;var ui=[];function gM(o,e){return{subscribe:Ie(o,e).subscribe}}function Ie(o,e=q){let t,r=new Set;function n(a){if(W(o,a)&&(o=a,t)){let l=!ui.length;for(let c of r)c[1](),ui.push(c,o);if(l){for(let c=0;c<ui.length;c+=2)ui[c][0](ui[c+1]);ui.length=0}}}function s(a){n(a(o))}function i(a,l=q){let c=[a,l];return r.add(c),r.size===1&&(t=e(n,s)||q),a(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:i}}function Xe(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return gM(t,(i,a)=>{let l=!1,c=[],u=0,f=q,d=()=>{if(u)return;f();let m=e(r?c[0]:c,i,a);s?i(m):f=Ge(m)?m:q},p=n.map((m,v)=>At(m,g=>{c[v]=g,u&=~(1<<v),l&&d()},()=>{u|=1<<v}));return l=!0,d(),function(){we(p),f(),l=!1}})}function iv(o){let e=o-1;return e*e*e+1}function cs(o){return--o*o*o*o*o+1}function us(o,{delay:e=0,duration:t=400,easing:r=iv,axis:n="y"}={}){let s=getComputedStyle(o),i=+s.opacity,a=n==="y"?"height":"width",l=parseFloat(s[a]),c=n==="y"?["top","bottom"]:["left","right"],u=c.map(k=>`${k[0].toUpperCase()}${k.slice(1)}`),f=parseFloat(s[`padding${u[0]}`]),d=parseFloat(s[`padding${u[1]}`]),p=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),v=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:t,easing:r,css:k=>`overflow: hidden;opacity: ${Math.min(k*20,1)*i};${a}: ${k*l}px;padding-${c[0]}: ${k*f}px;padding-${c[1]}: ${k*d}px;margin-${c[0]}: ${k*p}px;margin-${c[1]}: ${k*m}px;border-${c[0]}-width: ${k*v}px;border-${c[1]}-width: ${k*g}px;`}}function yM(o){Ce(o,"svelte-18ny0l5",`.continue.svelte-18ny0l5{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-18ny0l5{color:var(--text-muted)}.link.svelte-18ny0l5:hover{color:var(--text-normal)}.not-working.svelte-18ny0l5{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-18ny0l5{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-18ny0l5:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-18ny0l5{height:auto;padding:0}.welcome.svelte-18ny0l5{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHdpZHRoPSIxOCIgICBoZWlnaHQ9IjE4IiAgIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgICB2ZXJzaW9uPSIxLjEiICAgaWQ9InN2ZzYiICAgc29kaXBvZGk6ZG9jbmFtZT0iZGlzY29yZC5zdmciICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICA8ZGVmcyAgICAgaWQ9ImRlZnMxMCIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJuYW1lZHZpZXc4IiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIgICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiICAgICBzaG93Z3JpZD0iZmFsc2UiICAgICBpbmtzY2FwZTp6b29tPSIyNC4yNSIgICAgIGlua3NjYXBlOmN4PSI0LjM3MTEzNCIgICAgIGlua3NjYXBlOmN5PSIxNC40NTM2MDgiICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDY0IiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTA5NiIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc2IiAvPiAgPGcgICAgIGlkPSJnNCIgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMDg4NzYxMiwwLDAsMS4wNDc4NTU0LC0xMC40NTgyNzYsMzMuNDI2NTI1KSI+ICAgIDxwYXRoICAgICAgIGQ9Ik0gMjE2Ljg1NjM0LDE2LjU5NjYwMyBDIDIwMC4yODUsOC44NDMyODY3IDE4Mi41NjYxNCwzLjIwODQ5ODggMTY0LjA0MTU2LDAgYyAtMi4yNzUwNCw0LjExMzE4MTEgLTQuOTMyOTQsOS42NDU0OTkxIC02Ljc2NTQ2LDE0LjA0NjQzOCAtMTkuNjkyMTEsLTIuOTYxNDQ4IC0zOS4yMDMxMywtMi45NjE0NDggLTU4LjUzMzA4NCwwIEMgOTYuOTEwODQyLDkuNjQ1NDk5MSA5NC4xOTI1ODQsNC4xMTMxODExIDkxLjg5NzE4OSwwIDczLjM1MjYwNywzLjIwODQ5ODggNTUuNjEzMzk1LDguODYzOTkxMiAzOS4wNDIwNTgsMTYuNjM3NjYxIDUuNjE3NTIyOSw2Ny4xNDY1MTQgLTMuNDQzMzE5MSwxMTYuNDAwODEgMS4wODcxMTA3LDE2NC45NTU3MiAyMy4yNTYwMiwxODEuNTEwOTEgNDQuNzQwMzYzLDE5MS41Njc3IDY1Ljg2MjEzMywxOTguMTQ4NTggYyA1LjIxNTA4MiwtNy4xNzc0NSA5Ljg2NjIzLC0xNC44MDcyNSAxMy44NzMwODEsLTIyLjg0ODMyIC03LjYzMTE5NSwtMi44OTk2OSAtMTQuOTQwMjQyLC02LjQ3ODA2IC0yMS44NDY0MjcsLTEwLjYzMjMgMS44MzIxNzQsLTEuMzU3MzcgMy42MjQzNDMsLTIuNzc2NTEgNS4zNTU4MDMsLTQuMjM2NyA0Mi4xMjI4MiwxOS43MDE5MyA4Ny44OTAzNCwxOS43MDE5MyAxMjkuNTA5OTMsMCAxLjc1MTgyLDEuNDYwMTkgMy41NDM2MywyLjg3OTMzIDUuMzU1ODEsNC4yMzY3IC02LjkyNjU0LDQuMTc0NiAtMTQuMjU1NTksNy43NTI5NyAtMjEuODg2NzksMTAuNjUzIDQuMDA2ODUsOC4wMjAzNyA4LjYzOCwxNS42NzA4NyAxMy44NzMwOCwyMi44NDc5NyAyMS4xNDIxMywtNi41ODA4OCA0Mi42NDY0LC0xNi42MzczMSA2NC44MTUzMywtMzMuMjEzMjEgNS4zMTU4LC01Ni4yODc1MiAtOS4wODA4NiwtMTA1LjA4OTQ3NyAtMzguMDU1NjEsLTE0OC4zNTkxMTcgeiBNIDg1LjQ3Mzg3NSwxMzUuMDk0ODkgYyAtMTIuNjQ0ODQ3LDAgLTIzLjAxNDY1MywtMTEuODA0NzMgLTIzLjAxNDY1MywtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODM3MywtMjYuMjAwMzQxIDIzLjAxNDY1MywtMjYuMjAwMzQxIDEyLjg2NjYzMSwwIDIzLjIzNjA4NSwxMS44MDQzODQgMjMuMDE0NjU1LDI2LjIwMDM0MSAwLjAyLDE0LjM3NTI2IC0xMC4xNDgwMjQsMjYuMTc5OTkgLTIzLjAxNDY1NSwyNi4xNzk5OSB6IG0gODUuMDUxMzY1LDAgYyAtMTIuNjQ0ODUsMCAtMjMuMDE0NjYsLTExLjgwNDczIC0yMy4wMTQ2NiwtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODAzLC0yNi4yMDAzNDEgMjMuMDE0NjYsLTI2LjIwMDM0MSAxMi44NjYyOCwwIDIzLjIzNjA4LDExLjgwNDM4NCAyMy4wMTQ2NSwyNi4yMDAzNDEgMCwxNC4zNzUyNiAtMTAuMTQ4MzcsMjYuMTc5OTkgLTIzLjAxNDY1LDI2LjE3OTk5IHoiICAgICAgIGZpbGw9IiM1ODY1ZjIiICAgICAgIGZpbGwtcnVsZT0ibm9uemVybyIgICAgICAgaWQ9InBhdGgyIiAvPiAgPC9nPjwvc3ZnPg==);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.discord-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4gICAgPHRpdGxlPk1pY3Jvc29mdDwvdGl0bGU+ICAgIDxnPiAgICAgICAgPHBvbHlnb24gZmlsbD0iI0YxNTExQiIgcG9pbnRzPSIxMjEuNjY2MDk1IDEyMS42NjYwOTUgMCAxMjEuNjY2MDk1IDAgMCAxMjEuNjY2MDk1IDAiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiM4MENDMjgiIHBvaW50cz0iMjU2IDEyMS42NjYwOTUgMTM0LjMzNTM1NiAxMjEuNjY2MDk1IDEzNC4zMzUzNTYgMCAyNTYgMCIvPiAgICAgICAgPHBvbHlnb24gZmlsbD0iIzAwQURFRiIgcG9pbnRzPSIxMjEuNjYzMTk0IDI1Ni4wMDIxODggMCAyNTYuMDAyMTg4IDAgMTM0LjMzNjA5NSAxMjEuNjYzMTk0IDEzNC4zMzYwOTUiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiNGQkJDMDkiIHBvaW50cz0iMjU2IDI1Ni4wMDIxODggMTM0LjMzNTM1NiAyNTYuMDAyMTg4IDEzNC4zMzUzNTYgMTM0LjMzNjA5NSAyNTYgMTM0LjMzNjA5NSIvPiAgICA8L2c+PC9zdmc+);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.microsoft-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjE2LjE5NjU4NSIKICAgaGVpZ2h0PSIxNS42NTQ3NjgiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzQiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImdoLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0ibmFtZWR2aWV3NiIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSIwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBmaXQtbWFyZ2luLXRvcD0iMCIKICAgICBmaXQtbWFyZ2luLWxlZnQ9IjAiCiAgICAgZml0LW1hcmdpbi1yaWdodD0iMCIKICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIKICAgICBpbmtzY2FwZTp6b29tPSI0OC41IgogICAgIGlua3NjYXBlOmN4PSI4IgogICAgIGlua3NjYXBlOmN5PSI4LjAxMDMwOTMiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIzNzY0IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjIxMTIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjgiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjQwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnNCIgLz4KICA8cGF0aAogICAgIGZpbGwtcnVsZT0iZXZlbm9kZCIKICAgICBjbGlwLXJ1bGU9ImV2ZW5vZGQiCiAgICAgZD0ibSA4LjAwMTc3OTksMC4wMDIzNzIxNiBhIDgsOCAwIDAgMCAtMi41MywxNS41ODk5OTk4NCBjIDAuNCwwLjA3IDAuNTUsLTAuMTcgMC41NSwtMC4zOCB2IC0xLjMzIGMgLTIuMjIsMC40OCAtMi42OSwtMS4wNyAtMi42OSwtMS4wNyAtMC4zNiwtMC45MiAtMC44OCwtMS4xNyAtMC44OCwtMS4xNyAtMC43MywtMC40OSAwLjA1LC0wLjQ4IDAuMDUsLTAuNDggMC44LDAuMDYgMS4yMywwLjgzIDEuMjMsMC44MyAwLjcyLDEuMjMgMS44OCwwLjg3IDIuMzMsMC42NiAwLjA3LC0wLjUyIDAuMjgsLTAuODcgMC41MSwtMS4wNyAtMS43OCwtMC4yIC0zLjY1LC0wLjg5IC0zLjY1LC0zLjk0OTk5OTggMCwtMC44NyAwLjMxLC0xLjU4IDAuODIsLTIuMTQgLTAuMDgsLTAuMiAtMC4zNiwtMS4wMSAwLjA4LC0yLjEgMCwwIDAuNjcsLTAuMjIgMi4yLDAuODIgYSA3LjY1LDcuNjUgMCAwIDEgNC4wMDAwMDAxLDAgYyAxLjUzLC0xLjA0IDIuMiwtMC44MiAyLjIsLTAuODIgMC40NCwxLjA5IDAuMTYsMS45IDAuMDgsMi4xIDAuNTEsMC41NiAwLjgyLDEuMjcgMC44MiwyLjE0IDAsMy4wNjk5OTk4IC0xLjg3LDMuNzQ5OTk5OCAtMy42NTAwMDAxLDMuOTQ5OTk5OCAwLjI5LDAuMjUgMC41NDAwMDAxLDAuNzQgMC41NDAwMDAxLDEuNDggdiAyLjIgYyAwLDAuMjEgMC4xNSwwLjQ1IDAuNTUsMC4zOCBBIDgsOCAwIDAgMCA4LjAwMTc3OTksMC4wMDIzNzIxNiBaIgogICAgIGZpbGw9IiMyNDI5MmYiCiAgICAgaWQ9InBhdGgyIiAvPgo8L3N2Zz4K)}.theme-dark .github-sign-in-button.svelte-18ny0l5{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYuMTk2NTg1IiBoZWlnaHQ9IjE1LjY1NDc2OCIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJtIDguMDAxNzc5OSwwLjAwMjM3MjE2IGEgOCw4IDAgMCAwIC0yLjUzLDE1LjU4OTk5OTg0IGMgMC40LDAuMDcgMC41NSwtMC4xNyAwLjU1LC0wLjM4IHYgLTEuMzMgYyAtMi4yMiwwLjQ4IC0yLjY5LC0xLjA3IC0yLjY5LC0xLjA3IC0wLjM2LC0wLjkyIC0wLjg4LC0xLjE3IC0wLjg4LC0xLjE3IC0wLjczLC0wLjQ5IDAuMDUsLTAuNDggMC4wNSwtMC40OCAwLjgsMC4wNiAxLjIzLDAuODMgMS4yMywwLjgzIDAuNzIsMS4yMyAxLjg4LDAuODcgMi4zMywwLjY2IDAuMDcsLTAuNTIgMC4yOCwtMC44NyAwLjUxLC0xLjA3IC0xLjc4LC0wLjIgLTMuNjUsLTAuODkgLTMuNjUsLTMuOTQ5OTk5OCAwLC0wLjg3IDAuMzEsLTEuNTggMC44MiwtMi4xNCAtMC4wOCwtMC4yIC0wLjM2LC0xLjAxIDAuMDgsLTIuMSAwLDAgMC42NywtMC4yMiAyLjIsMC44MiBhIDcuNjUsNy42NSAwIDAgMSA0LjAwMDAwMDEsMCBjIDEuNTMsLTEuMDQgMi4yLC0wLjgyIDIuMiwtMC44MiAwLjQ0LDEuMDkgMC4xNiwxLjkgMC4wOCwyLjEgMC41MSwwLjU2IDAuODIsMS4yNyAwLjgyLDIuMTQgMCwzLjA2OTk5OTggLTEuODcsMy43NDk5OTk4IC0zLjY1MDAwMDEsMy45NDk5OTk4IDAuMjksMC4yNSAwLjU0MDAwMDEsMC43NCAwLjU0MDAwMDEsMS40OCB2IDIuMiBjIDAsMC4yMSAwLjE1LDAuNDUgMC41NSwwLjM4IEEgOCw4IDAgMCAwIDguMDAxNzc5OSwwLjAwMjM3MjE2IFoiIGZpbGw9IiNmZmZmZmYiIC8+Cjwvc3ZnPgo=)}.github-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnoiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTggMTJoOE0xMiA4bDQgNC00IDQiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.oidc-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.login-buttons.svelte-18ny0l5{display:flex;flex-direction:column;gap:0.85rem;padding:1rem;background:var(--background-modifier-border-hover);border-radius:0.5rem}.choose-another.svelte-18ny0l5{text-align:center;margin-top:0.25rem;margin-bottom:1rem;font-size:0.85em;color:var(--text-normal)}`)}function av(o,e,t){let r=o.slice();return r[58]=e[t],r}function lv(o,e,t){let r=o.slice();return r[58]=e[t],r}function bM(o){let e,t,r,n,s,i,a,l,c,u;t=new Kb({});let f=[xM,_M],d=[];function p(L,I){return L[5]?0:1}n=p(o,[-1,-1,-1]),s=d[n]=f[n](o);function m(L,I){if(L[11])return IM;if(L[7])return kM}let v=m(o,[-1,-1,-1]),g=v&&v(o),k=o[3].provider&&!o[7]&&dv(o);return c=new Qb({}),{c(){e=_("div"),U(t.$$.fragment),r=F(),s.c(),i=F(),g&&g.c(),a=F(),k&&k.c(),l=F(),U(c.$$.fragment),h(e,"class","welcome svelte-18ny0l5")},m(L,I){w(L,e,I),R(t,e,null),y(e,r),d[n].m(e,null),y(e,i),g&&g.m(e,null),w(L,a,I),k&&k.m(L,I),w(L,l,I),R(c,L,I),u=!0},p(L,I){let C=n;n=p(L,I),n===C?d[n].p(L,I):(ne(),S(d[C],1,1,()=>{d[C]=null}),se(),s=d[n],s?s.p(L,I):(s=d[n]=f[n](L),s.c()),b(s,1),s.m(e,i)),v===(v=m(L,I))&&g?g.p(L,I):(g&&g.d(1),g=v&&v(L),g&&(g.c(),g.m(e,null))),L[3].provider&&!L[7]?k?k.p(L,I):(k=dv(L),k.c(),k.m(l.parentNode,l)):k&&(k.d(1),k=null)},i(L){u||(b(t.$$.fragment,L),b(s),b(c.$$.fragment,L),u=!0)},o(L){S(t.$$.fragment,L),S(s),S(c.$$.fragment,L),u=!1},d(L){L&&(x(e),x(a),x(l)),D(t),d[n].d(),g&&g.d(),k&&k.d(L),D(c,L)}}}function vM(o){let e,t,r,n,s,i,a;e=new ze({props:{$$slots:{name:[LM],default:[CM]},$$scope:{ctx:o}}}),r=new ze({props:{name:"Account"}}),s=new ci({props:{user:o[4].user,$$slots:{default:[MM]},$$scope:{ctx:o}}});let l=o[34].default,c=ye(l,o,o[42],null);return{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment),i=F(),c&&c.c()},m(u,f){R(e,u,f),w(u,t,f),R(r,u,f),w(u,n,f),R(s,u,f),w(u,i,f),c&&c.m(u,f),a=!0},p(u,f){let d={};f[1]&2048&&(d.$$scope={dirty:f,ctx:u}),e.$set(d);let p={};f[0]&16&&(p.user=u[4].user),f[1]&2048&&(p.$$scope={dirty:f,ctx:u}),s.$set(p),c&&c.p&&(!a||f[1]&2048)&&ve(c,l,u,u[42],a?be(l,u[42],f,null):_e(u[42]),null)},i(u){a||(b(e.$$.fragment,u),b(r.$$.fragment,u),b(s.$$.fragment,u),b(c,u),a=!0)},o(u){S(e.$$.fragment,u),S(r.$$.fragment,u),S(s.$$.fragment,u),S(c,u),a=!1},d(u){u&&(x(t),x(n),x(i)),D(e,u),D(r,u),D(s,u),c&&c.d(u)}}}function _M(o){let e,t=[],r=new Map,n=xe(o[6]),s=i=>i[58];for(let i=0;i<n.length;i+=1){let a=av(o,n,i),l=s(a);r.set(l,t[i]=cv(l,a))}return{c(){e=_("div");for(let i=0;i<t.length;i+=1)t[i].c();h(e,"class","login-buttons svelte-18ny0l5")},m(i,a){w(i,e,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(i,a){a[0]&18114|a[1]&2&&(n=xe(i[6]),t=eo(t,a,s,1,i,n,r,e,oi,cv,null,av))},i:q,o:q,d(i){i&&x(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function xM(o){let e,t=[],r=new Map,n,s=xe(o[6]),i=a=>a[58];for(let a=0;a<s.length;a+=1){let l=lv(o,s,a),c=i(l);r.set(c,t[a]=uv(c,l))}return{c(){e=_("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","login-buttons svelte-18ny0l5")},m(a,l){w(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,l){l[0]&1073760192&&(s=xe(a[6]),ne(),t=eo(t,l,i,1,a,s,r,e,ni,uv,null,lv),se())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)S(t[l]);n=!1},d(a){a&&x(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function wM(o){let e,t,r=(o[10][o[58]]||fs(o[58]))+"",n,s,i,a,l;return{c(){e=_("button"),t=B("Sign in with "),n=B(r),h(e,"class",s=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"),e.disabled=i=!0},m(c,u){w(c,e,u),y(e,t),y(e,n),l=!0},p(c,u){o=c,(!l||u[0]&1088)&&r!==(r=(o[10][o[58]]||fs(o[58]))+"")&&Q(n,r),(!l||u[0]&64&&s!==(s=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"))&&h(e,"class",s)},i(c){l||(c&&So(()=>{l&&(a||(a=ss(e,us,{duration:o[9]?300:0,easing:cs},!0)),a.run(1))}),l=!0)},o(c){c&&(a||(a=ss(e,us,{duration:o[9]?300:0,easing:cs},!1)),a.run(0)),l=!1},d(c){c&&x(e),c&&a&&a.end()}}}function SM(o){let e,t,r,n=(o[10][o[58]]||fs(o[58]))+"",s,i,a,l,c,u,f,d,p;function m(){return o[37](o[58])}return{c(){e=_("a"),t=_("button"),r=B("Sign in with "),s=B(n),c=F(),h(t,"class",i=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"),t.disabled=a=o[7]||!o[1][o[58]],h(e,"href",u=o[1][o[58]].fullAuthUrl),h(e,"target","_blank")},m(v,g){w(v,e,g),y(e,t),y(t,r),y(t,s),y(e,c),f=!0,d||(p=V(t,"click",m),d=!0)},p(v,g){o=v,(!f||g[0]&1088)&&n!==(n=(o[10][o[58]]||fs(o[58]))+"")&&Q(s,n),(!f||g[0]&64&&i!==(i=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"))&&h(t,"class",i),(!f||g[0]&194&&a!==(a=o[7]||!o[1][o[58]]))&&(t.disabled=a),(!f||g[0]&66&&u!==(u=o[1][o[58]].fullAuthUrl))&&h(e,"href",u)},i(v){f||(v&&So(()=>{f&&(l||(l=ss(t,us,{duration:o[9]?300:0,easing:cs},!0)),l.run(1))}),f=!0)},o(v){v&&(l||(l=ss(t,us,{duration:o[9]?300:0,easing:cs},!1)),l.run(0)),f=!1},d(v){v&&x(e),v&&l&&l.end(),d=!1,p()}}}function cv(o,e){let t,r,n,s,i=[SM,wM],a=[];function l(c,u){return c[1][c[58]]?0:1}return r=l(e,[-1,-1,-1]),n=a[r]=i[r](e),{key:o,first:null,c(){t=pe(),n.c(),s=pe(),this.first=t},m(c,u){w(c,t,u),a[r].m(c,u),w(c,s,u)},p(c,u){e=c;let f=r;r=l(e,u),r===f?a[r].p(e,u):(ne(),S(a[f],1,1,()=>{a[f]=null}),se(),n=a[r],n?n.p(e,u):(n=a[r]=i[r](e),n.c()),b(n,1),n.m(s.parentNode,s))},d(c){c&&(x(t),x(s)),a[r].d(c)}}}function uv(o,e){let t,r,n=(e[10][e[58]]||fs(e[58]))+"",s,i,a,l,c,u,f;function d(){return e[36](e[58])}return{key:o,first:null,c(){t=_("button"),r=B("Sign in with "),s=B(n),h(t,"class",i=kt(`${e[58].startsWith("oidc")?"oidc":e[58]}-sign-in-button`)+" svelte-18ny0l5"),t.disabled=a=e[7]||!e[8].contains(e[58]),this.first=t},m(p,m){w(p,t,m),y(t,r),y(t,s),c=!0,u||(f=V(t,"click",function(){Ge((0,oo.debounce)(d))&&(0,oo.debounce)(d).apply(this,arguments)}),u=!0)},p(p,m){e=p,(!c||m[0]&1088)&&n!==(n=(e[10][e[58]]||fs(e[58]))+"")&&Q(s,n),(!c||m[0]&64&&i!==(i=kt(`${e[58].startsWith("oidc")?"oidc":e[58]}-sign-in-button`)+" svelte-18ny0l5"))&&h(t,"class",i),(!c||m[0]&448&&a!==(a=e[7]||!e[8].contains(e[58])))&&(t.disabled=a)},i(p){c||(p&&So(()=>{c&&(l||(l=ss(t,us,{duration:e[9]?300:0,easing:cs},!0)),l.run(1))}),c=!0)},o(p){p&&(l||(l=ss(t,us,{duration:e[9]?300:0,easing:cs},!1)),l.run(0)),c=!1},d(p){p&&x(t),p&&l&&l.end(),u=!1,f()}}}function kM(o){let e,t,r,n,s,i,a,l;return{c(){e=_("div"),t=_("p"),t.textContent="Continue in your browser...",r=F(),n=_("p"),s=B(`Not working?
					`),i=_("button"),i.textContent="(try again)",h(t,"class","continue svelte-18ny0l5"),h(i,"class","link link-button svelte-18ny0l5"),h(n,"class","not-working svelte-18ny0l5")},m(c,u){w(c,e,u),y(e,t),y(e,r),y(e,n),y(n,s),y(n,i),a||(l=V(i,"click",o[40]),a=!0)},p:q,d(c){c&&x(e),a=!1,l()}}}function IM(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[12]&&o[2]&&fv(o);return{c(){e=_("p"),t=B(o[11]),r=B("."),n=_("br"),s=F(),d&&d.c(),i=F(),a=_("p"),l=B(`Not working?
				`),c=_("button"),c.textContent="(try again)",h(c,"class","link link-button svelte-18ny0l5"),h(a,"class","not-working svelte-18ny0l5")},m(p,m){w(p,e,m),y(e,t),y(e,r),y(e,n),y(e,s),d&&d.m(e,null),w(p,i,m),w(p,a,m),y(a,l),y(a,c),u||(f=V(c,"click",o[39]),u=!0)},p(p,m){m[0]&2048&&Q(t,p[11]),p[12]&&p[2]?d?d.p(p,m):(d=fv(p),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},d(p){p&&(x(e),x(i),x(a)),d&&d.d(),u=!1,f()}}}function fv(o){let e,t,r,n;return{c(){e=B("Already logged in? "),t=_("button"),t.textContent="(click here)",h(t,"class","link link-button svelte-18ny0l5")},m(s,i){w(s,e,i),w(s,t,i),r||(n=V(t,"click",function(){Ge((0,oo.debounce)(o[38]))&&(0,oo.debounce)(o[38]).apply(this,arguments)}),r=!0)},p(s,i){o=s},d(s){s&&(x(e),x(t)),r=!1,n()}}}function dv(o){let e,t,r,n;return{c(){e=_("p"),t=_("button"),t.textContent="(choose another provider)",h(t,"class","link link-button svelte-18ny0l5"),h(e,"class","choose-another svelte-18ny0l5")},m(s,i){w(s,e,i),y(e,t),r||(n=V(t,"click",(0,oo.debounce)(o[41])),r=!0)},p:q,d(s){s&&x(e),r=!1,n()}}}function CM(o){let e,t;return e=new Wb({}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function LM(o){let e,t;return e=new lc({props:{slot:"name"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p:q,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function MM(o){let e,t,r;return{c(){e=_("button"),e.textContent="Logout"},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,oo.debounce)(o[35])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function TM(o){let e,t,r,n,s=[vM,bM],i=[];function a(l,c){return l[4].hasUser&&l[4].user?0:1}return e=a(o,[-1,-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=pe()},m(l,c){i[e].m(l,c),w(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(ne(),S(i[u],1,1,()=>{i[u]=null}),se(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&x(r),i[e].d(l)}}}var AM="system3-relay-auth-providers-";function fs(o){return o?o=="oidc"?"OIDC":o=="github"?"GitHub":o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():""}function FM(o,e,t){let r,n,s,i,a,l,c,u,f=q,d=()=>(f(),f=At(T,ke=>t(4,u=ke)),T),p,m,v,g,k,L,I,C;o.$$.on_destroy.push(()=>f());let{$$slots:M={},$$scope:A}=e,{plugin:E}=e,P=Fe("LoggedIn.svelte","error"),T,$=Ie(!oo.Platform.isIosApp);le(o,$,ke=>t(5,p=ke));let J=Ie(!1);le(o,J,ke=>t(7,v=ke)),d(T=E.loginManager);let N=Ie(!1);le(o,N,ke=>t(12,C=ke));let O=Ie(!1),te=Ie(!0);le(o,te,ke=>t(44,s=ke));let Z=Ie("");le(o,Z,ke=>t(2,r=ke));let Y=_t.getInstance();le(o,Y,ke=>t(45,i=ke));let ge={},j=Ie(!1);le(o,j,ke=>t(47,l=ke));let H=T.loginSettings;le(o,H,ke=>t(3,c=ke));let X=Ie([]);le(o,X,ke=>t(46,a=ke));let ue=Ie(!1);le(o,ue,ke=>t(9,k=ke));function z(){var ke;let Ke=((ke=T.pb)===null||ke===void 0?void 0:ke.baseUrl)||"default";return`${AM}${Ke}`}function ee(){let ke=["github","google","microsoft"];return i.getFlag("enableDiscordLogin")&&ke.push("discord"),ke}function re(){try{let ke=z(),Ke=localStorage.getItem(ke);if(Ke)return JSON.parse(Ke)}catch(ke){P("Failed to load cached providers:",ke)}return ee()}function fe(ke){try{let Ke=z();localStorage.setItem(Ke,JSON.stringify(ke))}catch(Ke){P("Failed to save cached providers:",Ke)}}let Le=Xe([Z,Y],()=>{let ke=["github","google","microsoft","oidc"];return i.getFlag("enableDiscordLogin")&&ke.push("discord"),ke});le(o,Le,ke=>t(43,n=ke));let de=Xe([Z,T.loginSettings,Y,j,X],()=>{if(c&&c.provider)return[c.provider];if(r!=="")return[r];if(l&&Object.keys(ge).length>0){let Ke=Object.keys(ge),et=[];Ke.includes("google")&&et.push("google"),Ke.includes("microsoft")&&et.push("microsoft"),Ke.includes("discord")&&i.getFlag("enableDiscordLogin")&&et.push("discord"),Ke.includes("github")&&et.push("github"),Ke.forEach(nn=>{nn.startsWith("oidc")&&et.push(nn)});let Mr=JSON.stringify(et.sort())!==JSON.stringify(a.sort());return ue.set(Mr),fe(et),et}if(a.length>0&&!l)return a;let ke=["github","google","microsoft"];return i.getFlag("enableDiscordLogin")&&ke.push("discord"),ke});le(o,de,ke=>t(6,m=ke));function Ee(){T.clearPreferredProvider(),Z.set(""),io()}let Oe=Xe([Z,E.loginSettings,Y,j],()=>r?[r]:Object.keys(ge));le(o,Oe,ke=>t(8,g=ke));let Me=Xe([j],()=>{var ke;let Ke={};for(let et of Object.keys(ge)){let Mr=ge[et];!((ke=Mr==null?void 0:Mr.info)===null||ke===void 0)&&ke.displayName?Ke[et]=Mr.info.displayName:Ke[et]=fs(et)}return Ke});le(o,Me,ke=>t(10,L=ke));let ot,at=Ie("");le(o,at,ke=>t(11,I=ke));function Dt(){return Ae(this,void 0,void 0,function*(){E.loginManager.logout(),O.set(!1),J.set(!1),Z.set(""),N.set(!1)})}function Eo(ke){return Ae(this,void 0,void 0,function*(){try{Z.set(ke),(yield E.loginManager.login(ke))&&O.set(!0)}catch(Ke){$.set(!1),O.set(!1);let et=ge[ke];et&&(window.open(et.fullAuthUrl,"_blank"),qt(ke))}})}let Ir=Ie(E.loginManager.pb);function Cr(){Ir.set(E.loginManager.pb)}function io(){try{let ke=s?it:fetch;T.initiateManualOAuth2CodeFlow(ke,n).then(Ke=>{t(1,ge=Ke),j.set(!0),T.updateWebviewIntercepts(Ke)}).catch(Ke=>{let et=Ke.message;throw et=et,at.set(et),O.set(!1),Z.set(""),Ke})}catch(ke){at.set(ke.message)}}lt(()=>{O.set(!1);let ke=re();X.set(ke),io()});function qt(ke){return Ae(this,void 0,void 0,function*(){let Ke=ge[ke];if(Ke)return Z.set(ke),yield E.loginManager.poll(Ke).then(et=>{O.set(!0),J.set(!1),at.set("")}).catch(et=>{N.set(!0),J.set(!1),O.set(!1),at.set(et.message)})})}function on(ke){let Ke=ke.target;Ke.focus(),Ke.select(),navigator.clipboard.writeText(Ke.value).then(()=>new oo.Notice("Invite link copied")).catch(et=>{}),qt(r)}let ms=()=>{Dt()},yr=async ke=>{J.set(!0),await Eo(ke)},Lr=ke=>{J.set(!0),qt(ke)},ao=()=>{qt(r)},Un=()=>{J.set(!1),$.set(!1),at.set(""),Z.set(""),j.set(!1),io()},lo=()=>{J.set(!1),$.set(!1),at.set(""),Z.set("")},On=()=>{Ee()};return o.$$set=ke=>{"plugin"in ke&&t(33,E=ke.plugin),"$$scope"in ke&&t(42,A=ke.$$scope)},[T,ge,r,c,u,p,m,v,g,k,L,I,C,$,J,N,te,Z,Y,j,H,X,ue,Le,de,Ee,Oe,Me,at,Dt,Eo,io,qt,E,M,ms,yr,Lr,ao,Un,lo,On,A]}var Vp=class extends K{constructor(e){super(),G(this,e,FM,TM,W,{plugin:33},yM,[-1,-1,-1])}},pv=Vp;function mv(o,e,t){let r=o.slice();return r[5]=e[t],r}var EM=o=>({}),hv=o=>({}),PM=o=>({}),gv=o=>({});function RM(o){let e;return{c(){e=B(o[0])},m(t,r){w(t,e,r)},p(t,r){r&1&&Q(e,t[0])},d(t){t&&x(e)}}}function DM(o){let e,t=xe(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=yv(mv(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=pe()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);w(n,e,s)},p(n,s){if(s&2){t=xe(n[1]);let i;for(i=0;i<t.length;i+=1){let a=mv(n,t,i);r[i]?r[i].p(a,s):(r[i]=yv(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&x(e),qe(r,n)}}}function yv(o){let e;return{c(){e=_("div"),e.textContent=`${o[5]} `},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function UM(o){let e,t=o[1].length>0&&DM(o);return{c(){t&&t.c(),e=pe()},m(r,n){t&&t.m(r,n),w(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&x(e),t&&t.d(r)}}}function OM(o){let e,t,r,n,s,i,a,l,c=o[4].name,u=ye(c,o,o[3],gv),f=u||RM(o),d=o[4].description,p=ye(d,o,o[3],hv),m=p||UM(o),v=o[4].default,g=ye(v,o,o[3],null);return{c(){e=_("div"),t=_("div"),r=_("div"),f&&f.c(),n=F(),s=_("div"),m&&m.c(),i=F(),a=_("div"),g&&g.c(),h(r,"class","setting-item-name"),me(r,"display","grid"),me(r,"align-items","center"),h(s,"class","setting-item-description"),h(t,"class","setting-item-info"),me(t,"display","grid"),h(a,"class","setting-item-control"),h(e,"class","setting-item")},m(k,L){w(k,e,L),y(e,t),y(t,r),f&&f.m(r,null),y(t,n),y(t,s),m&&m.m(s,null),y(e,i),y(e,a),g&&g.m(a,null),l=!0},p(k,[L]){u?u.p&&(!l||L&8)&&ve(u,c,k,k[3],l?be(c,k[3],L,PM):_e(k[3]),gv):f&&f.p&&(!l||L&1)&&f.p(k,l?L:-1),p&&p.p&&(!l||L&8)&&ve(p,d,k,k[3],l?be(d,k[3],L,EM):_e(k[3]),hv),g&&g.p&&(!l||L&8)&&ve(g,v,k,k[3],l?be(v,k[3],L,null):_e(k[3]),null)},i(k){l||(b(f,k),b(m,k),b(g,k),l=!0)},o(k){S(f,k),S(m,k),S(g,k),l=!1},d(k){k&&x(e),f&&f.d(k),m&&m.d(k),g&&g.d(k)}}}function NM(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i}=e,a=i!==void 0?i.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,i=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,a,i,n,r]}var Hp=class extends K{constructor(e){super(),G(this,e,NM,OM,W,{name:0,description:2})}},Ue=Hp;function $M(o){Ce(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var BM=o=>({}),bv=o=>({}),VM=o=>({}),vv=o=>({});function HM(o){let e;return{c(){e=B(o[0])},m(t,r){w(t,e,r)},p(t,r){r&1&&Q(e,t[0])},d(t){t&&x(e)}}}function _v(o){let e,t;return{c(){e=_("div"),t=B(o[1]),h(e,"class","setting-item-description")},m(r,n){w(r,e,n),y(e,t)},p(r,n){n&2&&Q(t,r[1])},d(r){r&&x(e)}}}function qM(o){let e,t=o[1]&&_v(o);return{c(){t&&t.c(),e=pe()},m(r,n){t&&t.m(r,n),w(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=_v(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&x(e),t&&t.d(r)}}}function zM(o){let e,t,r,n,s,i,a,l=o[3].name,c=ye(l,o,o[2],vv),u=c||HM(o),f=o[3].description,d=ye(f,o,o[2],bv),p=d||qM(o),m=o[3].default,v=ye(m,o,o[2],null);return{c(){e=_("div"),t=_("div"),r=_("div"),u&&u.c(),n=F(),p&&p.c(),s=F(),i=_("div"),v&&v.c(),h(r,"class","setting-item-name truncate svelte-11hpkul"),h(t,"class","setting-item-info svelte-11hpkul"),h(i,"class","setting-item-control svelte-11hpkul"),h(e,"class","setting-item mod-list-item svelte-11hpkul")},m(g,k){w(g,e,k),y(e,t),y(t,r),u&&u.m(r,null),y(t,n),p&&p.m(t,null),y(e,s),y(e,i),v&&v.m(i,null),a=!0},p(g,[k]){c?c.p&&(!a||k&4)&&ve(c,l,g,g[2],a?be(l,g[2],k,VM):_e(g[2]),vv):u&&u.p&&(!a||k&1)&&u.p(g,a?k:-1),d?d.p&&(!a||k&4)&&ve(d,f,g,g[2],a?be(f,g[2],k,BM):_e(g[2]),bv):p&&p.p&&(!a||k&2)&&p.p(g,a?k:-1),v&&v.p&&(!a||k&4)&&ve(v,m,g,g[2],a?be(m,g[2],k,null):_e(g[2]),null)},i(g){a||(b(u,g),b(p,g),b(v,g),a=!0)},o(g){S(u,g),S(p,g),S(v,g),a=!1},d(g){g&&x(e),u&&u.d(g),p&&p.d(g),v&&v.d(g)}}}function jM(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"description"in a&&t(1,i=a.description),"$$scope"in a&&t(2,n=a.$$scope)},[s,i,n,r]}var qp=class extends K{constructor(e){super(),G(this,e,jM,zM,W,{name:0,description:1},$M)}},Ft=qp;function WM(o){Ce(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function KM(o){let e,t;return e=new zd({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p:q,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function GM(o){let e,t,r,n,s=o[3].default,i=ye(s,o,o[2],null),a=i||KM(o);return{c(){e=_("div"),a&&a.c(),h(e,"class","clickable-icon extra-setting-button svelte-y529x8"),h(e,"aria-label",o[0]),h(e,"role","button"),h(e,"tabindex","0")},m(l,c){w(l,e,c),a&&a.m(e,null),t=!0,r||(n=[V(e,"click",o[1]),V(e,"keydown",o[1])],r=!0)},p(l,[c]){i&&i.p&&(!t||c&4)&&ve(i,s,l,l[2],t?be(s,l[2],c,null):_e(l[2]),null),(!t||c&1)&&h(e,"aria-label",l[0])},i(l){t||(b(a,l),t=!0)},o(l){S(a,l),t=!1},d(l){l&&x(e),a&&a.d(l),r=!1,we(n)}}}function JM(o,e,t){let{$$slots:r={},$$scope:n}=e,s=Ye(),{label:i="Options"}=e;function a(l){(l instanceof MouseEvent||l instanceof KeyboardEvent&&(l.key==="Enter"||l.key===" "))&&s("settings")}return o.$$set=l=>{"label"in l&&t(0,i=l.label),"$$scope"in l&&t(2,n=l.$$scope)},[i,a,n,r]}var zp=class extends K{constructor(e){super(),G(this,e,JM,GM,W,{label:0},WM)}},ds=zp;function jp(o){return Array.isArray(o.permissionParents)}function QM(o){let e,t,r,n,s,i;t=new Zo({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let a=o[3].default,l=ye(a,o,o[2],null);return{c(){e=_("span"),U(t.$$.fragment),r=F(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),me(e,"display","flex"),me(e,"align-items","center"),me(e,"width","100%")},m(c,u){w(c,e,u),R(t,e,null),y(e,r),l&&l.m(e,null),n=!0,s||(i=[V(e,"keypress",o[0]),V(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&4)&&ve(l,a,c,c[2],n?be(a,c[2],u,null):_e(c[2]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){S(t.$$.fragment,c),S(l,c),n=!1},d(c){c&&x(e),D(t),l&&l.d(c),s=!1,we(i)}}}function YM(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,i=Ye();function a(){s&&i("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var Wp=class extends K{constructor(e){super(),G(this,e,YM,QM,W,{relay:1})}},_a=Wp;function ZM(o){let e,t,r,n,s,i;t=new ko({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let a=o[4].default,l=ye(a,o,o[3],null);return{c(){e=_("span"),U(t.$$.fragment),r=F(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),me(e,"display","inline-flex"),me(e,"align-items","center"),me(e,"width","100%")},m(c,u){w(c,e,u),R(t,e,null),y(e,r),l&&l.m(e,null),n=!0,s||(i=[V(e,"keypress",o[0]),V(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&8)&&ve(l,a,c,c[3],n?be(a,c[3],u,null):_e(c[3]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){S(t.$$.fragment,c),S(l,c),n=!1},d(c){c&&x(e),D(t),l&&l.d(c),s=!1,we(i)}}}function XM(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,{remoteFolder:i=void 0}=e,a=Ye();function l(){var c;s&&a("manageSharedFolder",{folder:s,relay:((c=s==null?void 0:s.remote)===null||c===void 0?void 0:c.relay)||(i==null?void 0:i.relay),remoteFolder:i})}return o.$$set=c=>{"folder"in c&&t(1,s=c.folder),"remoteFolder"in c&&t(2,i=c.remoteFolder),"$$scope"in c&&t(3,n=c.$$scope)},[l,s,i,n,r]}var Kp=class extends K{constructor(e){super(),G(this,e,XM,ZM,W,{folder:1,remoteFolder:2})}},xa=Kp;function eT(o){let e,t;return e=new ko({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function tT(o){let e,t;return e=new is({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function rT(o){let e,t,r,n,s,i,a,l=[tT,eT],c=[];function u(p,m){var v;return(v=p[0])!=null&&v.private?0:1}t=u(o,-1),r=c[t]=l[t](o);let f=o[3].default,d=ye(f,o,o[2],null);return{c(){e=_("span"),r.c(),n=F(),d&&d.c(),h(e,"role","button"),h(e,"tabindex","0"),me(e,"display","inline-flex"),me(e,"align-items","center"),me(e,"width","100%")},m(p,m){w(p,e,m),c[t].m(e,null),y(e,n),d&&d.m(e,null),s=!0,i||(a=[V(e,"keypress",o[1]),V(e,"click",o[1])],i=!0)},p(p,[m]){let v=t;t=u(p,m),t!==v&&(ne(),S(c[v],1,1,()=>{c[v]=null}),se(),r=c[t],r||(r=c[t]=l[t](p),r.c()),b(r,1),r.m(e,n)),d&&d.p&&(!s||m&4)&&ve(d,f,p,p[2],s?be(f,p[2],m,null):_e(p[2]),null)},i(p){s||(b(r),b(d,p),s=!0)},o(p){S(r),S(d,p),s=!1},d(p){p&&x(e),c[t].d(),d&&d.d(p),i=!1,we(a)}}}function oT(o,e,t){let{$$slots:r={},$$scope:n}=e,{remoteFolder:s}=e,i=Ye();function a(){i("manageRemoteFolder",{remoteFolder:s,relay:s==null?void 0:s.relay})}return o.$$set=l=>{"remoteFolder"in l&&t(0,s=l.remoteFolder),"$$scope"in l&&t(2,n=l.$$scope)},[s,a,n,r]}var Gp=class extends K{constructor(e){super(),G(this,e,oT,rT,W,{remoteFolder:0})}},dc=Gp;function nT(o){let e,t;return e=new xa({props:{folder:o[0],$$slots:{default:[iT]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[2]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.folder=r[0]),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function sT(o){let e,t;return e=new dc({props:{remoteFolder:o[0].remote,$$slots:{default:[aT]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",o[1]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.remoteFolder=r[0].remote),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function iT(o){let e,t=o[0].name+"",r;return{c(){e=_("span"),r=B(t),me(e,"overflow","hidden"),me(e,"text-overflow","ellipsis"),me(e,"white-space","nowrap")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&Q(r,t)},d(n){n&&x(e)}}}function aT(o){let e,t=o[0].name+"",r;return{c(){e=_("span"),r=B(t),me(e,"flex","1"),me(e,"min-width","0"),me(e,"text-overflow","ellipsis"),me(e,"white-space","nowrap")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&Q(r,t)},d(n){n&&x(e)}}}function xv(o){let e,t,r,n,s;return t=new ld({props:{size:16,class:"svg-icon"}}),n=new _a({props:{relay:o[0].remote.relay,$$slots:{default:[lT]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=_("span"),U(t.$$.fragment),r=F(),U(n.$$.fragment),me(e,"width","16px"),me(e,"flex-shrink","0"),me(e,"display","flex"),me(e,"justify-content","center")},m(i,a){w(i,e,a),R(t,e,null),w(i,r,a),R(n,i,a),s=!0},p(i,a){let l={};a&1&&(l.relay=i[0].remote.relay),a&17&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){s||(b(t.$$.fragment,i),b(n.$$.fragment,i),s=!0)},o(i){S(t.$$.fragment,i),S(n.$$.fragment,i),s=!1},d(i){i&&(x(e),x(r)),D(t),D(n,i)}}}function lT(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=_("span"),r=B(t),me(e,"flex","1"),me(e,"min-width","0"),me(e,"text-overflow","ellipsis"),me(e,"white-space","nowrap")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&Q(r,t)},d(n){n&&x(e)}}}function cT(o){let e,t,r,n,s,i,a=[sT,nT],l=[];function c(f,d){return f[0].remote?0:1}r=c(o,-1),n=l[r]=a[r](o);let u=o[0].remote&&xv(o);return{c(){e=_("span"),t=_("span"),n.c(),s=F(),u&&u.c(),me(t,"display","inline-flex"),me(t,"align-items","center"),me(t,"width","200px"),me(t,"min-width","200px"),me(t,"flex-shrink","0"),me(e,"display","inline-flex"),me(e,"align-items","center"),me(e,"width","100%"),me(e,"gap","8px")},m(f,d){w(f,e,d),y(e,t),l[r].m(t,null),y(e,s),u&&u.m(e,null),i=!0},p(f,[d]){let p=r;r=c(f,d),r===p?l[r].p(f,d):(ne(),S(l[p],1,1,()=>{l[p]=null}),se(),n=l[r],n?n.p(f,d):(n=l[r]=a[r](f),n.c()),b(n,1),n.m(t,null)),f[0].remote?u?(u.p(f,d),d&1&&b(u,1)):(u=xv(f),u.c(),b(u,1),u.m(e,null)):u&&(ne(),S(u,1,1,()=>{u=null}),se())},i(f){i||(b(n),b(u),i=!0)},o(f){S(n),S(u),i=!1},d(f){f&&x(e),l[r].d(),u&&u.d()}}}function uT(o,e,t){let{folder:r}=e;function n(a){pr.call(this,o,a)}function s(a){pr.call(this,o,a)}function i(a){pr.call(this,o,a)}return o.$$set=a=>{"folder"in a&&t(0,r=a.folder)},[r,n,s,i]}var Jp=class extends K{constructor(e){super(),G(this,e,uT,cT,W,{folder:0})}},wv=Jp;var nr=require("obsidian");var Lo=require("obsidian");function fT(o){Ce(o,"svelte-1fe7ajn",".input-with-icon.svelte-1fe7ajn{position:relative;width:100%}.secret-text-toggle-icon.svelte-1fe7ajn{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.secret-text-toggle-icon.svelte-1fe7ajn:hover{background-color:var(--background-modifier-hover)}.system3-secret-text.svelte-1fe7ajn{padding-inline-end:28px !important;font-family:monospace !important}.system3-input-invalid.svelte-1fe7ajn{border:1px solid var(--color-red) !important}")}function dT(o){let e,t,r,n;return{c(){e=_("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","password"),e.readOnly=o[3],h(e,"class",t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){w(s,e,i),r||(n=[V(e,"click",function(){Ge(o[4]?(0,Lo.debounce)(o[12]):null)&&(o[4]?(0,Lo.debounce)(o[12]):null).apply(this,arguments)}),V(e,"input",o[15]),V(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&x(e),r=!1,we(n)}}}function pT(o){let e,t,r,n;return{c(){e=_("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","text"),e.readOnly=o[3],h(e,"class",t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){w(s,e,i),r||(n=[V(e,"click",function(){Ge(o[4]?(0,Lo.debounce)(o[12]):null)&&(o[4]?(0,Lo.debounce)(o[12]):null).apply(this,arguments)}),V(e,"input",o[14]),V(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&x(e),r=!1,we(n)}}}function mT(o){let e,t,r,n,s,i,a;function l(f,d){return f[6]?pT:dT}let c=l(o,-1),u=c(o);return{c(){e=_("div"),u.c(),t=F(),r=_("div"),h(r,"class","secret-text-toggle-icon svelte-1fe7ajn"),h(r,"role","button"),h(r,"tabindex","0"),h(r,"aria-label",n=o[6]?"Hide text":"Show text"),h(e,"class","input-with-icon svelte-1fe7ajn")},m(f,d){w(f,e,d),u.m(e,null),y(e,t),y(e,r),i||(a=[ts(s=o[11].call(null,r)),V(r,"click",o[16]),V(r,"keypress",o[17])],i=!0)},p(f,[d]){c===(c=l(f,d))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(e,t))),d&64&&n!==(n=f[6]?"Hide text":"Show text")&&h(r,"aria-label",n)},i:q,o:q,d(f){f&&x(e),u.d(),i=!1,we(a)}}}function hT(o,e,t){let r,n,s=Ye(),{value:i}=e,{disabled:a=!1}=e,{placeholder:l="please wait..."}=e,{readonly:c=!0}=e,{copyOnClick:u=!0}=e,{successMessage:f="Copied to clipboard"}=e,{invalid:d=!1}=e,p=Ie(!1);le(o,p,E=>t(6,r=E));let m=Ie(!1);le(o,m,E=>t(19,n=E));let v;function g(E){E.key==="Enter"&&!a&&s("enter")}function k(E){v=E;let P=()=>{n?((0,Lo.setIcon)(E,"clipboard-check"),E.addClass("mod-success")):((0,Lo.setIcon)(E,r?"eye-off":"eye"),E.removeClass("mod-success"))},T=p.subscribe(()=>{P()}),$=m.subscribe(()=>{P()});return P(),{destroy(){T(),$()}}}function L(E){!u||!i||a||navigator.clipboard.writeText(i).then(()=>{new Lo.Notice(f),m.set(!0),setTimeout(()=>{m.set(!1)},800)}).catch(P=>{console.error("Failed to copy: ",P)})}let I=E=>{t(0,i=E.currentTarget.value),s("input",E)},C=E=>{t(0,i=E.currentTarget.value),s("input",E)},M=()=>p.update(E=>!E),A=()=>p.update(E=>!E);return o.$$set=E=>{"value"in E&&t(0,i=E.value),"disabled"in E&&t(1,a=E.disabled),"placeholder"in E&&t(2,l=E.placeholder),"readonly"in E&&t(3,c=E.readonly),"copyOnClick"in E&&t(4,u=E.copyOnClick),"successMessage"in E&&t(13,f=E.successMessage),"invalid"in E&&t(5,d=E.invalid)},[i,a,l,c,u,d,r,s,p,m,g,k,L,f,I,C,M,A]}var Qp=class extends K{constructor(e){super(),G(this,e,hT,mT,W,{value:0,disabled:1,placeholder:2,readonly:3,copyOnClick:4,successMessage:13,invalid:5},fT)}},pc=Qp;var im=require("obsidian");var jv=require("obsidian");var nm=require("obsidian");var Cv=require("obsidian");function gT(o){Ce(o,"svelte-1dpxzin",".folder-suggest-wrapper.svelte-1dpxzin{position:relative;width:100%}.folder-suggest-input.svelte-1dpxzin{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.suggestion-container.svelte-1dpxzin{position:fixed;z-index:9999;box-sizing:border-box;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:6px;box-shadow:var(--shadow-s);overflow-y:auto;overflow-x:hidden}.suggestion.svelte-1dpxzin{overflow-y:auto;overflow-x:hidden;max-height:100%}.suggestion-note.svelte-1dpxzin{color:var(--text-muted);font-style:italic}")}function Sv(o,e,t){let r=o.slice();return r[31]=e[t],r[33]=t,r}function kv(o){let e,t,r,n,s,i,a=xe(o[2]),l=[];for(let c=0;c<a.length;c+=1)l[c]=Iv(Sv(o,a,c));return{c(){e=_("div"),t=_("div");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","suggestion svelte-1dpxzin"),h(e,"class","suggestion-container svelte-1dpxzin")},m(c,u){w(c,e,u),y(e,t);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(t,null);s||(i=[ts(r=_T.call(null,e)),ts(n=o[6].call(null,e))],s=!0)},p(c,u){if(u[0]&2060){a=xe(c[2]);let f;for(f=0;f<a.length;f+=1){let d=Sv(c,a,f);l[f]?l[f].p(d,u):(l[f]=Iv(d),l[f].c(),l[f].m(t,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=a.length}},d(c){c&&x(e),qe(l,c),s=!1,we(i)}}}function yT(o){let e=o[31]+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&4&&e!==(e=r[31]+"")&&Q(t,e)},d(r){r&&x(t)}}}function bT(o){let e,t=o[31].substring(9)+"",r;return{c(){e=_("span"),e.textContent=`Create:
								`,r=B(t),h(e,"class","suggestion-note svelte-1dpxzin")},m(n,s){w(n,e,s),w(n,r,s)},p(n,s){s[0]&4&&t!==(t=n[31].substring(9)+"")&&Q(r,t)},d(n){n&&(x(e),x(r))}}}function Iv(o){let e,t,r,n,s,i,a,l,c,u;function f(k,L){return L[0]&4&&(n=null),n==null&&(n=!!k[31].startsWith("[Create] ")),n?bT:yT}let d=f(o,[-1,-1]),p=d(o);function m(){return o[18](o[31])}function v(...k){return o[19](o[31],...k)}function g(){return o[20](o[33])}return{c(){e=_("div"),t=_("div"),r=_("div"),p.c(),s=F(),i=_("div"),i.innerHTML='<div class="suggestion-icon"></div>',a=F(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(i,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",l=o[33]===o[3]),h(e,"tabindex","-1"),Te(e,"is-selected",o[33]===o[3])},m(k,L){w(k,e,L),y(e,t),y(t,r),p.m(r,null),y(e,s),y(e,i),y(e,a),c||(u=[V(e,"mousedown",Ol(o[15])),V(e,"click",m),V(e,"keydown",v),V(e,"mouseenter",g)],c=!0)},p(k,L){o=k,d===(d=f(o,L))&&p?p.p(o,L):(p.d(1),p=d(o),p&&(p.c(),p.m(r,null))),L[0]&8&&l!==(l=o[33]===o[3])&&h(e,"aria-selected",l),L[0]&8&&Te(e,"is-selected",o[33]===o[3])},d(k){k&&x(e),p.d(),c=!1,we(u)}}}function vT(o){let e,t,r,n,s,i,a=o[4]&&o[2].length>0&&kv(o);return{c(){e=_("div"),t=_("input"),r=F(),a&&a.c(),n=pe(),h(t,"type","text"),h(t,"placeholder",o[0]),h(t,"class","folder-suggest-input svelte-1dpxzin"),h(e,"class","folder-suggest-wrapper svelte-1dpxzin")},m(l,c){w(l,e,c),y(e,t),o[16](t),Je(t,o[5]),w(l,r,c),a&&a.m(l,c),w(l,n,c),s||(i=[V(t,"input",o[17]),V(t,"input",o[8]),V(t,"keydown",o[7]),V(t,"focus",o[9]),V(t,"blur",o[10])],s=!0)},p(l,c){c[0]&1&&h(t,"placeholder",l[0]),c[0]&32&&t.value!==l[5]&&Je(t,l[5]),l[4]&&l[2].length>0?a?a.p(l,c):(a=kv(l),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i:q,o:q,d(l){l&&(x(e),x(r),x(n)),o[16](null),a&&a.d(l),s=!1,we(i)}}}function _T(o){return document.body.appendChild(o),{destroy(){o.remove()}}}function xT(o,e,t){function r(j){return setTimeout(()=>{u=j,I()},0),{destroy(){}}}let{app:n}=e,{value:s=""}=e,{placeholder:i="Choose or create folder..."}=e,{blockedPaths:a=new Set}=e,l=Ye(),c,u,f=[],d=-1,p=!1,m=s||"/",v=!1;function g(j){let H=j.toLowerCase(),X=[],ue=re=>{if(a.has(re.path)&&re.path!=="/")return;let fe=re.path.toLowerCase(),Le=(re.path.startsWith("/")?re.path:"/"+re.path).toLowerCase();if((!H||fe.includes(H)||Le.includes(H))&&!a.has(re.path)){let Ee=re.path.startsWith("/")?re.path:"/"+re.path;X.push(Ee)}for(let Ee of re.children)Ee instanceof Cv.TFolder&&ue(Ee)},z=n.vault.getRoot();ue(z);let ee=j.trim();if(ee&&!X.includes(ee)){let re=ee.startsWith("/")?ee:"/"+ee;X.unshift(`[Create] ${re}`)}return X.slice(0,100)}function k(){return Ae(this,void 0,void 0,function*(){t(2,f=g(m)),f.length>0?(t(4,p=!0),t(3,d=0),yield td()):L()})}function L(){t(4,p=!1),t(2,f=[]),t(3,d=-1)}function I(){if(!c||!u)return;let j=c.getBoundingClientRect(),H=window.innerWidth,X=window.innerHeight;u.style.position="fixed",u.style.zIndex="9999";let ue=H<768,z=40,ee=8,re=Math.min(f.length*z+ee,ue?240:300);if(u.style.top="",u.style.bottom="",u.style.left="",u.style.right="",u.style.transform="",ue){let fe=X-j.bottom,Le=j.top;u.style.left="10px",u.style.right="10px",u.style.width="auto",fe<re+10&&Le>re+10?(u.style.bottom=`${X-j.top+2}px`,u.style.maxHeight=`${re}px`,u.style.height=""):(u.style.bottom=`${X-j.bottom-2}px`,u.style.maxHeight=`${Math.min(re,fe-10)}px`,u.style.height="",u.style.transform="translateY(-100%)")}else{let fe=Math.max(j.width,350),Le=Math.min(fe,H-j.left-20);u.style.left=`${j.left}px`,u.style.top=`${j.bottom+2}px`,u.style.width=`${Le}px`,u.style.maxHeight=`${re}px`,u.style.height=""}}function C(j){let H=j;j.startsWith("[Create] ")&&(H=j.substring(9)),t(5,m=H),t(12,s=H),l("select",{value:H}),L(),c==null||c.blur()}function M(j){if(!p){(j.key==="Enter"&&m.trim()||j.key==="Tab"&&!j.shiftKey&&m.trim())&&(j.preventDefault(),C(m.trim()));return}switch(j.key){case"ArrowDown":j.preventDefault(),t(3,d=Math.min(d+1,f.length-1));break;case"ArrowUp":j.preventDefault(),t(3,d=Math.max(d-1,-1));break;case"Enter":j.preventDefault(),d>=0?C(f[d]):m.trim()&&C(m.trim());break;case"Escape":j.preventDefault(),L();break;case"Tab":j.shiftKey||(j.preventDefault(),d>=0?C(f[d]):f.length>0?C(f[0]):m.trim()&&C(m.trim()));break}}function A(){v=!0,t(12,s=m),l("input",{value:m}),k()}function E(){!v&&m==="/"&&(t(5,m=""),t(12,s="")),t(2,f=g(m||"")),f.length>0&&(t(4,p=!0),t(3,d=0))}function P(j){setTimeout(()=>{u!=null&&u.contains(document.activeElement)||L()},200)}function T(j){C(j)}function $(j){!(c!=null&&c.contains(j.target))&&!(u!=null&&u.contains(j.target))&&L()}function J(){p&&I()}lt(()=>{document.addEventListener("click",$),window.addEventListener("resize",J)}),os(()=>{document.removeEventListener("click",$),window.removeEventListener("resize",J)});function N(j){pr.call(this,o,j)}function O(j){vt[j?"unshift":"push"](()=>{c=j,t(1,c)})}function te(){m=this.value,t(5,m)}let Z=j=>T(j),Y=(j,H)=>H.key==="Enter"&&T(j),ge=j=>t(3,d=j);return o.$$set=j=>{"app"in j&&t(13,n=j.app),"value"in j&&t(12,s=j.value),"placeholder"in j&&t(0,i=j.placeholder),"blockedPaths"in j&&t(14,a=j.blockedPaths)},[i,c,f,d,p,m,r,M,A,E,P,T,s,n,a,N,O,te,Z,Y,ge]}var Yp=class extends K{constructor(e){super(),G(this,e,xT,vT,W,{app:13,value:12,placeholder:0,blockedPaths:14},gT,[-1,-1])}},Lv=Yp;function wT(o){let e,t,r,n;function s(a){o[8](a)}let i={app:o[0],placeholder:o[2],blockedPaths:o[4]()};return o[3]!==void 0&&(i.value=o[3]),t=new Lv({props:i}),vt.push(()=>zl(t,"value",s)),t.$on("select",o[5]),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","folder-select-input")},m(a,l){w(a,e,l),R(t,e,null),n=!0},p(a,[l]){let c={};l&1&&(c.app=a[0]),l&4&&(c.placeholder=a[2]),!r&&l&8&&(r=!0,c.value=a[3],Hl(()=>r=!1)),t.$set(c)},i(a){n||(b(t.$$.fragment,a),n=!0)},o(a){S(t.$$.fragment,a),n=!1},d(a){a&&x(e),D(t)}}}function ST(o,e,t){let r,n=q,s=()=>(n(),n=At(l,m=>t(7,r=m)),l);o.$$.on_destroy.push(()=>n());let{app:i}=e,{sharedFolders:a}=e,{selectedFolder:l}=e;s();let{placeholder:c="Choose or create folder..."}=e,u="";function f(){return new Set(a.filter(m=>!!m.relayId).map(m=>m.path))}function d(m){let v=m.detail.value;t(3,u=v),l.set(v)}function p(m){u=m,t(3,u),t(7,r)}return o.$$set=m=>{"app"in m&&t(0,i=m.app),"sharedFolders"in m&&t(6,a=m.sharedFolders),"selectedFolder"in m&&s(t(1,l=m.selectedFolder)),"placeholder"in m&&t(2,c=m.placeholder)},o.$$.update=()=>{if(o.$$.dirty&136){e:r&&r!==u&&t(3,u=r)}},[i,l,c,u,f,d,a,r,p]}var Zp=class extends K{constructor(e){super(),G(this,e,ST,wT,W,{app:0,sharedFolders:6,selectedFolder:1,placeholder:2})}},Mv=Zp;function kT(o){Ce(o,"svelte-1cvg97u",".faint.svelte-1cvg97u.svelte-1cvg97u{color:var(--text-faint)}.breadcrumb-container.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:8px;overflow:hidden}.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;min-width:0}.breadcrumb-item.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;cursor:pointer;min-width:0}.breadcrumb-text.svelte-1cvg97u.svelte-1cvg97u{display:inline-block}@media(max-width: 768px){.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u:last-child{flex:1;min-width:0;overflow:hidden}.middle-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{display:none}.last-item.svelte-1cvg97u.svelte-1cvg97u{overflow:hidden}.last-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}")}function Tv(o,e,t){let r=o.slice();return r[6]=e[t],r[8]=t,r}function IT(o){let e,t;return e=new yd({props:{size:16,class:"breadcrumb-separator"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Av(o){let e,t,r;var n=o[2](o[6]);function s(i,a){return{props:{class:"svg-icon breadcrumb-icon"}}}return n&&(e=Jo(n,s(o))),{c(){e&&U(e.$$.fragment),t=pe()},m(i,a){e&&R(e,i,a),w(i,t,a),r=!0},p(i,a){if(a&1&&n!==(n=i[2](i[6]))){if(e){ne();let l=e;S(l.$$.fragment,1,0,()=>{D(l,1)}),se()}n?(e=Jo(n,s(i,a)),U(e.$$.fragment),b(e.$$.fragment,1),R(e,t.parentNode,t)):e=null}},i(i){r||(e&&b(e.$$.fragment,i),r=!0)},o(i){e&&S(e.$$.fragment,i),r=!1},d(i){i&&x(t),e&&D(e,i)}}}function CT(o){let e;function t(s,i){return s[6].remoteFolder.name?FT:AT}let r=t(o,-1),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function LT(o){let e=o[6].folder.name+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&1&&e!==(e=r[6].folder.name+"")&&Q(t,e)},d(r){r&&x(t)}}}function MT(o){let e;function t(s,i){return s[6].relay.name?PT:ET}let r=t(o,-1),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function TT(o){let e=o[6].text+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&1&&e!==(e=r[6].text+"")&&Q(t,e)},d(r){r&&x(t)}}}function AT(o){let e;return{c(){e=_("span"),e.textContent="(Untitled folder)",h(e,"class","faint svelte-1cvg97u")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function FT(o){let e=o[6].remoteFolder.name+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&1&&e!==(e=r[6].remoteFolder.name+"")&&Q(t,e)},d(r){r&&x(t)}}}function ET(o){let e;return{c(){e=_("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-1cvg97u")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function PT(o){let e=o[6].relay.name+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&1&&e!==(e=r[6].relay.name+"")&&Q(t,e)},d(r){r&&x(t)}}}function Fv(o){let e,t,r,n=o[2](o[6]),s,i,a,l,c,u,f,d=o[8]>0&&IT(o),p=n&&Av(o);function m(I,C){if(I[6].type==="text")return TT;if(I[6].type==="relay")return MT;if(I[6].type==="folder")return LT;if(I[6].type==="remoteFolder")return CT}let v=m(o,-1),g=v&&v(o);function k(){return o[3](o[6])}function L(...I){return o[4](o[6],...I)}return{c(){d&&d.c(),e=F(),t=_("span"),r=_("span"),p&&p.c(),s=F(),i=_("span"),g&&g.c(),l=F(),h(i,"class","breadcrumb-text svelte-1cvg97u"),h(r,"tabindex","0"),h(r,"role","button"),h(r,"class",a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"),h(t,"class","breadcrumb-item-wrapper svelte-1cvg97u")},m(I,C){d&&d.m(I,C),w(I,e,C),w(I,t,C),y(t,r),p&&p.m(r,null),y(r,s),y(r,i),g&&g.m(i,null),y(t,l),c=!0,u||(f=[V(r,"click",k),V(r,"keypress",L)],u=!0)},p(I,C){o=I,C&1&&(n=o[2](o[6])),n?p?(p.p(o,C),C&1&&b(p,1)):(p=Av(o),p.c(),b(p,1),p.m(r,s)):p&&(ne(),S(p,1,1,()=>{p=null}),se()),v===(v=m(o,C))&&g?g.p(o,C):(g&&g.d(1),g=v&&v(o),g&&(g.c(),g.m(i,null))),(!c||C&1&&a!==(a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"))&&h(r,"class",a)},i(I){c||(b(d),b(p),c=!0)},o(I){S(d),S(p),c=!1},d(I){I&&(x(e),x(t)),d&&d.d(I),p&&p.d(),g&&g.d(),u=!1,we(f)}}}function Xp(o){let e,t,r=xe(o[0]),n=[];for(let i=0;i<r.length;i+=1)n[i]=Fv(Tv(o,r,i));let s=i=>S(n[i],1,1,()=>{n[i]=null});return{c(){e=_(o[1]);for(let i=0;i<n.length;i+=1)n[i].c();yb(o[1])(e,{class:"breadcrumb-container svelte-1cvg97u"})},m(i,a){w(i,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);t=!0},p(i,a){if(a&5){r=xe(i[0]);let l;for(l=0;l<r.length;l+=1){let c=Tv(i,r,l);n[l]?(n[l].p(c,a),b(n[l],1)):(n[l]=Fv(c),n[l].c(),b(n[l],1),n[l].m(e,null))}for(ne(),l=r.length;l<n.length;l+=1)s(l);se()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)b(n[a]);t=!0}},o(i){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)S(n[a]);t=!1},d(i){i&&x(e),qe(n,i)}}}function RT(o){let e=o[1],t,r,n=o[1]&&Xp(o);return{c(){n&&n.c(),t=pe()},m(s,i){n&&n.m(s,i),w(s,t,i)},p(s,[i]){s[1]?e?W(e,s[1])?(n.d(1),n=Xp(s),e=s[1],n.c(),n.m(t.parentNode,t)):n.p(s,i):(n=Xp(s),e=s[1],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=s[1])},i:q,o(s){S(n,s),r=!1},d(s){s&&x(t),n&&n.d(s)}}}function Ev(o){o.onClick&&o.onClick()}function DT(o,e,t){let{items:r}=e,{element:n="h4"}=e,s=Ye();function i(c){var u;switch(c.type){case"home":return Td;case"relay":return Zo;case"folder":return to;case"remoteFolder":return!((u=c.remoteFolder)===null||u===void 0)&&u.private?is:ko;default:return null}}let a=c=>Ev(c),l=(c,u)=>{(u.key==="Enter"||u.key===" ")&&Ev(c)};return o.$$set=c=>{"items"in c&&t(0,r=c.items),"element"in c&&t(1,n=c.element)},[r,n,i,a,l]}var em=class extends K{constructor(e){super(),G(this,e,DT,RT,W,{items:0,element:1},kT)}},Mo=em;function UT(o){Ce(o,"svelte-1r8auw9",".folder-transformation.svelte-1r8auw9{display:flex;align-items:center;padding:8px 12px;background:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;gap:8px}.folder-transformation.readonly.svelte-1r8auw9{background:var(--background-secondary);border:1px solid var(--background-modifier-border)}.folder-state.svelte-1r8auw9{display:flex;align-items:center;gap:6px}.folder-name.svelte-1r8auw9{font-weight:500;color:var(--text-normal);white-space:nowrap}.clear-button.svelte-1r8auw9{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:2px;margin-left:auto}.clear-button.svelte-1r8auw9:hover{background:var(--background-modifier-hover);color:var(--text-normal)}.folder-select-button.svelte-1r8auw9{width:100%;min-height:3em;text-align:left}")}function OT(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("button"),r=B(o[3]),h(t,"class","mod-cta folder-select-button svelte-1r8auw9"),h(e,"class","folder-suggest-container")},m(i,a){w(i,e,a),y(e,t),y(t,r),n||(s=V(t,"click",o[8]),n=!0)},p(i,a){a&8&&Q(r,i[3])},i:q,o:q,d(i){i&&x(e),n=!1,s()}}}function NT(o){let e,t,r,n,s,i=[VT,BT,$T],a=[];function l(u,f){return u[6]?0:u[2]?1:2}t=l(o,-1),r=a[t]=i[t](o);let c=!o[4]&&Pv(o);return{c(){e=_("div"),r.c(),n=F(),c&&c.c(),h(e,"class","folder-transformation svelte-1r8auw9"),Te(e,"readonly",o[4])},m(u,f){w(u,e,f),a[t].m(e,null),y(e,n),c&&c.m(e,null),s=!0},p(u,f){let d=t;t=l(u,f),t===d?a[t].p(u,f):(ne(),S(a[d],1,1,()=>{a[d]=null}),se(),r=a[t],r?r.p(u,f):(r=a[t]=i[t](u),r.c()),b(r,1),r.m(e,n)),u[4]?c&&(c.d(1),c=null):c?c.p(u,f):(c=Pv(u),c.c(),c.m(e,null)),(!s||f&16)&&Te(e,"readonly",u[4])},i(u){s||(b(r),s=!0)},o(u){S(r),s=!1},d(u){u&&x(e),a[t].d(),c&&c.d()}}}function $T(o){let e,t,r,n,s,i;return t=new ko({props:{class:"svg-icon folder-icon"}}),{c(){e=_("div"),U(t.$$.fragment),r=F(),n=_("span"),s=B(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9")},m(a,l){w(a,e,l),R(t,e,null),y(e,r),y(e,n),y(n,s),i=!0},p(a,l){(!i||l&32)&&Q(s,a[5])},i(a){i||(b(t.$$.fragment,a),i=!0)},o(a){S(t.$$.fragment,a),i=!1},d(a){a&&x(e),D(t)}}}function BT(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v;t=new Cd({props:{class:"svg-icon folder-icon"}}),a=new ud({props:{class:"svg-icon arrow-icon"}});let g=[qT,HT],k=[];function L(I,C){return I[1]?0:1}return u=L(o,-1),f=k[u]=g[u](o),{c(){e=_("div"),U(t.$$.fragment),r=F(),n=_("span"),s=B(o[5]),i=F(),U(a.$$.fragment),l=F(),c=_("div"),f.c(),d=F(),p=_("span"),m=B(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9"),h(p,"class","folder-name svelte-1r8auw9"),h(c,"class","folder-state svelte-1r8auw9")},m(I,C){w(I,e,C),R(t,e,null),y(e,r),y(e,n),y(n,s),w(I,i,C),R(a,I,C),w(I,l,C),w(I,c,C),k[u].m(c,null),y(c,d),y(c,p),y(p,m),v=!0},p(I,C){(!v||C&32)&&Q(s,I[5]);let M=u;u=L(I,C),u!==M&&(ne(),S(k[M],1,1,()=>{k[M]=null}),se(),f=k[u],f||(f=k[u]=g[u](I),f.c()),b(f,1),f.m(c,d)),(!v||C&32)&&Q(m,I[5])},i(I){v||(b(t.$$.fragment,I),b(a.$$.fragment,I),b(f),v=!0)},o(I){S(t.$$.fragment,I),S(a.$$.fragment,I),S(f),v=!1},d(I){I&&(x(e),x(i),x(l),x(c)),D(t),D(a,I),k[u].d()}}}function VT(o){let e,t;return e=new Mo({props:{element:"div",items:[{type:"relay",relay:o[0].relay},{type:"remoteFolder",remoteFolder:o[0]}]}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.items=[{type:"relay",relay:r[0].relay},{type:"remoteFolder",remoteFolder:r[0]}]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function HT(o){let e,t;return e=new ko({props:{class:"svg-icon folder-icon"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function qT(o){let e,t;return e=new is({props:{class:"svg-icon folder-icon"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Pv(o){let e,t,r;return{c(){e=_("button"),e.textContent="\xD7",h(e,"class","clear-button svelte-1r8auw9")},m(n,s){w(n,e,s),t||(r=V(e,"click",o[7]),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function zT(o){let e,t,r,n,s=[NT,OT],i=[];function a(l,c){return l[0]?0:1}return t=a(o,-1),r=i[t]=s[t](o),{c(){e=_("div"),r.c(),h(e,"class","folder-selector")},m(l,c){w(l,e,c),i[t].m(e,null),n=!0},p(l,[c]){let u=t;t=a(l,c),t===u?i[t].p(l,c):(ne(),S(i[u],1,1,()=>{i[u]=null}),se(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),b(r,1),r.m(e,null))},i(l){n||(b(r),n=!0)},o(l){S(r),n=!1},d(l){l&&x(e),i[t].d()}}}function jT(o,e,t){let r,n,s,{selectedItem:i=void 0}=e,{isPrivate:a=!1}=e,{showTransformation:l=!1}=e,{selectButtonText:c="Choose a folder..."}=e,{readonly:u=!1}=e,f=Ye();function d(){f("clear")}function p(){f("select")}return o.$$set=m=>{"selectedItem"in m&&t(0,i=m.selectedItem),"isPrivate"in m&&t(1,a=m.isPrivate),"showTransformation"in m&&t(2,l=m.showTransformation),"selectButtonText"in m&&t(3,c=m.selectButtonText),"readonly"in m&&t(4,u=m.readonly)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(6,r=i&&typeof i=="object")}if(o.$$.dirty&1){e:t(9,n=typeof i=="string"?i:"")}if(o.$$.dirty&512){e:t(5,s=n?n.split("/").pop()||n:"")}},[i,a,l,c,u,s,r,d,p,n]}var tm=class extends K{constructor(e){super(),G(this,e,jT,zT,W,{selectedItem:0,isPrivate:1,showTransformation:2,selectButtonText:3,readonly:4},UT)}},wa=tm;function Rv(o,e,t){let r=o.slice();return r[23]=e[t],r}function Dv(o,e,t){let r=o.slice();return r[26]=e[t],r[28]=t,r}var WT=o=>({item:o&8}),Uv=o=>({item:o[26],index:o[28]}),KT=o=>({item:o&8}),Ov=o=>({item:o[26],index:o[28]});function GT(o){let e=o[26]+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&8&&e!==(e=r[26]+"")&&Q(t,e)},d(r){r&&x(t)}}}function JT(o){let e;return{c(){e=_("div"),h(e,"class","suggestion-icon")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function Nv(o){let e,t,r,n,s,i,a,l,c,u,f=o[13].suggestion,d=ye(f,o,o[12],Ov),p=d||GT(o),m=o[13]["suggestion-aux"],v=ye(m,o,o[12],Uv),g=v||JT(o);function k(){return o[17](o[26])}function L(...C){return o[18](o[26],...C)}function I(){return o[19](o[28])}return{c(){e=_("div"),t=_("div"),r=_("div"),p&&p.c(),n=F(),s=_("div"),g&&g.c(),i=F(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(s,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",a=o[28]===o[4]),h(e,"tabindex","-1"),Te(e,"is-selected",o[28]===o[4])},m(C,M){w(C,e,M),y(e,t),y(t,r),p&&p.m(r,null),y(e,n),y(e,s),g&&g.m(s,null),y(e,i),l=!0,c||(u=[V(e,"mousedown",Ol(o[14])),V(e,"click",k),V(e,"keydown",L),V(e,"mouseenter",I)],c=!0)},p(C,M){o=C,d?d.p&&(!l||M&4104)&&ve(d,f,o,o[12],l?be(f,o[12],M,KT):_e(o[12]),Ov):p&&p.p&&(!l||M&8)&&p.p(o,l?M:-1),v&&v.p&&(!l||M&4104)&&ve(v,m,o,o[12],l?be(m,o[12],M,WT):_e(o[12]),Uv),(!l||M&16&&a!==(a=o[28]===o[4]))&&h(e,"aria-selected",a),(!l||M&16)&&Te(e,"is-selected",o[28]===o[4])},i(C){l||(b(p,C),b(g,C),l=!0)},o(C){S(p,C),S(g,C),l=!1},d(C){C&&x(e),p&&p.d(C),g&&g.d(C),c=!1,we(u)}}}function $v(o){let e,t,r=o[23].command+"",n,s,i,a=o[23].purpose+"",l,c;return{c(){e=_("div"),t=_("span"),n=B(r),s=F(),i=_("span"),l=B(a),c=F(),h(t,"class","prompt-instruction-command"),h(e,"class","prompt-instruction")},m(u,f){w(u,e,f),y(e,t),y(t,n),y(e,s),y(e,i),y(i,l),y(e,c)},p(u,f){f&2&&r!==(r=u[23].command+"")&&Q(n,r),f&2&&a!==(a=u[23].purpose+"")&&Q(l,a)},d(u){u&&x(e)}}}function QT(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v=xe(o[3]),g=[];for(let C=0;C<v.length;C+=1)g[C]=Nv(Dv(o,v,C));let k=C=>S(g[C],1,1,()=>{g[C]=null}),L=xe(o[1]),I=[];for(let C=0;C<L.length;C+=1)I[C]=$v(Rv(o,L,C));return{c(){e=_("div"),t=_("div"),r=_("input"),n=F(),s=_("div"),i=F(),a=_("div"),l=F(),c=_("div");for(let C=0;C<g.length;C+=1)g[C].c();u=F(),f=_("div");for(let C=0;C<I.length;C+=1)I[C].c();h(r,"type","text"),h(r,"placeholder",o[0]),h(r,"class","prompt-input"),h(r,"autocapitalize","off"),h(r,"spellcheck","false"),h(r,"enterkeyhint","done"),h(s,"class","prompt-input-cta"),h(a,"class","search-input-clear-button"),h(t,"class","prompt-input-container"),h(c,"class","prompt-results"),h(f,"class","prompt-instructions"),h(e,"class","prompt")},m(C,M){w(C,e,M),y(e,t),y(t,r),o[15](r),Je(r,o[5]),y(t,n),y(t,s),y(t,i),y(t,a),y(e,l),y(e,c);for(let A=0;A<g.length;A+=1)g[A]&&g[A].m(c,null);y(e,u),y(e,f);for(let A=0;A<I.length;A+=1)I[A]&&I[A].m(f,null);d=!0,p||(m=[V(r,"input",o[16]),V(r,"input",o[7]),V(r,"keydown",o[6])],p=!0)},p(C,[M]){if((!d||M&1)&&h(r,"placeholder",C[0]),M&32&&r.value!==C[5]&&Je(r,C[5]),M&4376){v=xe(C[3]);let A;for(A=0;A<v.length;A+=1){let E=Dv(C,v,A);g[A]?(g[A].p(E,M),b(g[A],1)):(g[A]=Nv(E),g[A].c(),b(g[A],1),g[A].m(c,null))}for(ne(),A=v.length;A<g.length;A+=1)k(A);se()}if(M&2){L=xe(C[1]);let A;for(A=0;A<L.length;A+=1){let E=Rv(C,L,A);I[A]?I[A].p(E,M):(I[A]=$v(E),I[A].c(),I[A].m(f,null))}for(;A<I.length;A+=1)I[A].d(1);I.length=L.length}},i(C){if(!d){for(let M=0;M<v.length;M+=1)b(g[M]);d=!0}},o(C){g=g.filter(Boolean);for(let M=0;M<g.length;M+=1)S(g[M]);d=!1},d(C){C&&x(e),o[15](null),qe(g,C),qe(I,C),p=!1,we(m)}}}function YT(o,e,t){let{$$slots:r={},$$scope:n}=e,{placeholder:s="Search..."}=e,{autofocus:i=!1}=e,{onSelect:a=()=>{}}=e,{getSuggestions:l=()=>[]}=e,{instructions:c=[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Select"},{command:"Esc",purpose:"Cancel"}]}=e,u=Ye(),f,d=[],p=0,m="";function v(){t(3,d=l(m)),t(4,p=0)}function g($){a($),u("select",{item:$})}function k($){switch($.key){case"ArrowDown":$.preventDefault(),t(4,p=Math.min(p+1,d.length-1));break;case"ArrowUp":$.preventDefault(),t(4,p=Math.max(p-1,-1));break;case"Enter":$.preventDefault(),p>=0?g(d[p]):m.trim()&&d.length===0&&u("customInput",{value:m.trim()});break;case"Tab":$.shiftKey||($.preventDefault(),p>=0?g(d[p]):d.length>0&&g(d[0]));break}}function L(){v(),u("input",{value:m})}function I($){g($)}lt(()=>{i&&f&&setTimeout(()=>{f.focus()},10),v()});function C($){pr.call(this,o,$)}function M($){vt[$?"unshift":"push"](()=>{f=$,t(2,f)})}function A(){m=this.value,t(5,m)}let E=$=>I($),P=($,J)=>J.key==="Enter"&&I($),T=$=>t(4,p=$);return o.$$set=$=>{"placeholder"in $&&t(0,s=$.placeholder),"autofocus"in $&&t(9,i=$.autofocus),"onSelect"in $&&t(10,a=$.onSelect),"getSuggestions"in $&&t(11,l=$.getSuggestions),"instructions"in $&&t(1,c=$.instructions),"$$scope"in $&&t(12,n=$.$$scope)},[s,c,f,d,p,m,k,L,I,i,a,l,n,r,C,M,A,E,P,T]}var rm=class extends K{constructor(e){super(),G(this,e,YT,QT,W,{placeholder:0,autofocus:9,onSelect:10,getSuggestions:11,instructions:1})}},mc=rm;function ZT(o){let e,t;return e=new Mo({props:{element:"div",items:[{type:"relay",relay:o[5].relay},{type:"remoteFolder",remoteFolder:o[5]}]}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.items=[{type:"relay",relay:r[5].relay},{type:"remoteFolder",remoteFolder:r[5]}]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function XT(o){let e,t;return e=new mc({props:{placeholder:o[0],autofocus:o[1],onSelect:o[2],getSuggestions:o[3],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Add folder to vault"},{command:"Esc",purpose:"Cancel"}],$$slots:{suggestion:[ZT,({item:r})=>({5:r}),({item:r})=>r?32:0]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&4&&(s.onSelect=r[2]),n&96&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function eA(o,e,t){let{availableFolders:r}=e,{placeholder:n="Search folders..."}=e,{autofocus:s=!1}=e,{onSelect:i=()=>{}}=e;function a(l){let c=l.toLowerCase();return r.filter(f=>{var d;let p=(f.name||"").toLowerCase(),m=(((d=f.relay)===null||d===void 0?void 0:d.name)||"").toLowerCase();return!!f.relay.name&&f.name&&(p.includes(c)||m.includes(c))}).sort((f,d)=>{let p=`${f.relay.name} / ${f.name}`,m=`${d.relay.name} / ${d.name}`;return p.localeCompare(m)}).slice(0,100)}return o.$$set=l=>{"availableFolders"in l&&t(4,r=l.availableFolders),"placeholder"in l&&t(0,n=l.placeholder),"autofocus"in l&&t(1,s=l.autofocus),"onSelect"in l&&t(2,i=l.onSelect)},[n,s,i,a,r]}var om=class extends K{constructor(e){super(),G(this,e,eA,XT,W,{availableFolders:4,placeholder:0,autofocus:1,onSelect:2})}},Bv=om;var Vv=require("obsidian"),fi=class extends Vv.Modal{constructor(t,r,n,s){super(t);this.ComponentClass=r;this.componentProps=n;this.onSelect=s}onOpen(){let{modalEl:t}=this,r=t.closest(".modal-container");t.style.display="none";let n=r||t;this.component=new this.ComponentClass({target:n,props:{...this.componentProps,autofocus:!0,onSelect:s=>{this.onSelect(s),this.close()}}})}onClose(){var t;(t=this.component)==null||t.$destroy()}destroy(){this.onSelect=null,this.componentProps=null,this.ComponentClass=null}};var hc=class extends fi{constructor(e,t,r){super(e,Bv,{availableFolders:t,placeholder:"Search folders..."},r)}};function tA(o){Ce(o,"svelte-djtxkf","span.error.svelte-djtxkf{flex:auto;align-content:center}.section.svelte-djtxkf{margin-bottom:24px}")}function Hv(o){let e,t,r,n,s;return t=new ze({props:{name:"Remote folder"}}),n=new wa({props:{selectedItem:o[5],selectButtonText:"Choose a folder..."}}),n.$on("clear",o[12]),n.$on("select",o[13]),{c(){e=_("div"),U(t.$$.fragment),r=F(),U(n.$$.fragment),h(e,"class","section svelte-djtxkf")},m(i,a){w(i,e,a),R(t,e,null),y(e,r),R(n,e,null),s=!0},p(i,a){let l={};a&32&&(l.selectedItem=i[5]),n.$set(l)},i(i){s||(b(t.$$.fragment,i),b(n.$$.fragment,i),s=!0)},o(i){S(t.$$.fragment,i),S(n.$$.fragment,i),s=!1},d(i){i&&x(e),D(t),D(n)}}}function rA(o){let e,t,r,n;return{c(){e=_("input"),h(e,"type","text"),e.disabled=t=!o[5]},m(s,i){w(s,e,i),Je(e,o[6]),r||(n=V(e,"input",o[14]),r=!0)},p(s,i){i&32&&t!==(t=!s[5])&&(e.disabled=t),i&64&&e.value!==s[6]&&Je(e,s[6])},d(s){s&&x(e),r=!1,n()}}}function oA(o){let e,t;return e=new Mv({props:{app:o[0],sharedFolders:o[3],selectedFolder:o[9]}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&8&&(s.sharedFolders=r[3]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function qv(o){let e,t;return{c(){e=_("span"),t=B(o[7]),h(e,"class","mod-warning error svelte-djtxkf")},m(r,n){w(r,e,n),y(e,t)},p(r,n){n&128&&Q(t,r[7])},d(r){r&&x(e)}}}function nA(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v,g,k=!o[1]&&o[2].length>0&&Hv(o);s=new Ue({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[rA]},$$scope:{ctx:o}}}),a=new Ue({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[oA]},$$scope:{ctx:o}}});let L=o[7]&&qv(o);return{c(){e=_("div"),e.textContent="Add to vault",t=F(),r=_("div"),k&&k.c(),n=F(),U(s.$$.fragment),i=F(),U(a.$$.fragment),l=F(),c=_("div"),L&&L.c(),u=F(),f=_("button"),d=B("Confirm"),h(e,"class","modal-title"),h(f,"class","mod-cta"),f.disabled=p=!o[5]||!o[6].trim(),h(c,"class","modal-button-container"),h(r,"class","modal-content")},m(I,C){w(I,e,C),w(I,t,C),w(I,r,C),k&&k.m(r,null),y(r,n),R(s,r,null),y(r,i),R(a,r,null),y(r,l),y(r,c),L&&L.m(c,null),y(c,u),y(c,f),y(f,d),m=!0,v||(g=V(f,"click",function(){Ge((0,nm.debounce)(o[15]))&&(0,nm.debounce)(o[15]).apply(this,arguments)}),v=!0)},p(I,[C]){o=I,!o[1]&&o[2].length>0?k?(k.p(o,C),C&6&&b(k,1)):(k=Hv(o),k.c(),b(k,1),k.m(r,n)):k&&(ne(),S(k,1,1,()=>{k=null}),se());let M={};C&65632&&(M.$$scope={dirty:C,ctx:o}),s.$set(M);let A={};C&65545&&(A.$$scope={dirty:C,ctx:o}),a.$set(A),o[7]?L?L.p(o,C):(L=qv(o),L.c(),L.m(c,u)):L&&(L.d(1),L=null),(!m||C&96&&p!==(p=!o[5]||!o[6].trim()))&&(f.disabled=p)},i(I){m||(b(k),b(s.$$.fragment,I),b(a.$$.fragment,I),m=!0)},o(I){S(k),S(s.$$.fragment,I),S(a.$$.fragment,I),m=!1},d(I){I&&(x(e),x(t),x(r)),k&&k.d(),D(s),D(a),L&&L.d(),v=!1,g()}}}function sA(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{availableFolders:i=[]}=e,{sharedFolders:a}=e,{onConfirm:l}=e,c=s,u=(s==null?void 0:s.name)||"",f=Ie("/");le(o,f,I=>t(8,r=I));let d="",p=s,m=new hc(n,i,I=>{t(5,c=I)});lt(()=>{!s&&i.length>0&&setTimeout(()=>{m.open()},100)}),os(()=>{m.close(),m.destroy()});let v=()=>{t(5,c=void 0),t(6,u="")},g=()=>{m.open()};function k(){u=this.value,t(6,u),t(5,c),t(11,p)}let L=async()=>{if(!c){t(7,d="Please select a remote folder");return}if(!u.trim()){t(7,d="Please enter a folder name");return}l(c,u,r||"/").catch(I=>{t(7,d=I.message)})};return o.$$set=I=>{"app"in I&&t(0,n=I.app),"remoteFolder"in I&&t(1,s=I.remoteFolder),"availableFolders"in I&&t(2,i=I.availableFolders),"sharedFolders"in I&&t(3,a=I.sharedFolders),"onConfirm"in I&&t(4,l=I.onConfirm)},o.$$.update=()=>{if(o.$$.dirty&2080){e:c!==p&&(c&&t(6,u=c.name||""),t(11,p=c))}},[n,s,i,a,l,c,u,d,r,f,m,p,v,g,k,L]}var sm=class extends K{constructor(e){super(),G(this,e,sA,nA,W,{app:0,remoteFolder:1,availableFolders:2,sharedFolders:3,onConfirm:4},tA)}},zv=sm;var Fn=class extends jv.Modal{constructor(t,r,n,s,i){super(t);this.sharedFolders=r;this.remoteFolder=n;this.availableFolders=s;this.onConfirm=i;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new zv({target:t,props:{remoteFolder:this.remoteFolder,availableFolders:this.availableFolders,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy(),this.onConfirm=null,this.sharedFolders=null,this.remoteFolder=void 0,this.availableFolders.length=0}};var r_=require("obsidian"),o_=an(Nn());function iA(o){Ce(o,"svelte-zmx7zz","span.faint.svelte-zmx7zz{color:var(--text-faint)}div.spacer.svelte-zmx7zz{height:3em}")}function Wv(o,e,t){let r=o.slice();return r[33]=e[t],r[34]=e,r[35]=t,r}function Kv(o,e,t){let r=o.slice();return r[36]=e[t],r}function Gv(o,e,t){let r=o.slice();return r[39]=e[t],r}function aA(o){let e,t,r,n,s,i,a,l;function c(f){o[18](f)}let u={disabled:o[5],placeholder:"Enter share key",readonly:!1,copyOnClick:!1,invalid:o[4]};return o[3]!==void 0&&(u.value=o[3]),e=new pc({props:u}),vt.push(()=>zl(e,"value",c)),e.$on("input",o[14]),e.$on("enter",function(){Ge((0,nr.debounce)(o[19]))&&(0,nr.debounce)(o[19]).apply(this,arguments)}),{c(){U(e.$$.fragment),r=F(),n=_("button"),s=B("Join"),h(n,"class","mod-cta"),n.disabled=o[5]},m(f,d){R(e,f,d),w(f,r,d),w(f,n,d),y(n,s),i=!0,a||(l=V(n,"click",function(){Ge((0,nr.debounce)(o[20]))&&(0,nr.debounce)(o[20]).apply(this,arguments)}),a=!0)},p(f,d){o=f;let p={};d[0]&32&&(p.disabled=o[5]),d[0]&16&&(p.invalid=o[4]),!t&&d[0]&8&&(t=!0,p.value=o[3],Hl(()=>t=!1)),e.$set(p),(!i||d[0]&32)&&(n.disabled=o[5])},i(f){i||(b(e.$$.fragment,f),i=!0)},o(f){S(e.$$.fragment,f),i=!1},d(f){f&&(x(r),x(n)),D(e,f),a=!1,l()}}}function lA(o){let e;return{c(){e=_("span"),e.textContent="Relay Servers",h(e,"slot","name"),me(e,"display","inline-flex"),me(e,"align-items","center")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function cA(o){let e,t;function r(){return o[22](o[39])}return e=new ds({}),e.$on("settings",r),{c(){U(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function uA(o){let e;return{c(){e=_("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function fA(o){let e=o[39].name+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[39].name+"")&&Q(t,e)},d(r){r&&x(t)}}}function dA(o){let e;function t(s,i){return s[39].name?fA:uA}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function pA(o){let e,t;return e=new _a({props:{slot:"name",relay:o[39],$$slots:{default:[dA]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[39]),n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Jv(o){let e,t;return e=new Ft({props:{$$slots:{name:[pA],default:[cA]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function mA(o){let e,t,r;return{c(){e=_("button"),e.textContent="Create",h(e,"class","mod-cta")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,nr.debounce)(o[23])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function Qv(o){let e,t;return e=new Ue({props:{description:"No shared folders on this device. Share folders from a Relay Server's settings page to begin collaboration."}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function hA(o){let e,t;function r(){return o[28](o[36])}return e=new ds({}),e.$on("settings",function(){Ge((0,nr.debounce)(r))&&(0,nr.debounce)(r).apply(this,arguments)}),{c(){U(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function gA(o){let e,t;function r(){return o[27](o[36])}return e=new ds({}),e.$on("settings",function(){Ge((0,nr.debounce)(r))&&(0,nr.debounce)(r).apply(this,arguments)}),{c(){U(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function yA(o){let e,t,r,n,s=[gA,hA],i=[];function a(l,c){return l[36].remote?0:1}return e=a(o,[-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=pe()},m(l,c){i[e].m(l,c),w(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(ne(),S(i[u],1,1,()=>{i[u]=null}),se(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&x(r),i[e].d(l)}}}function bA(o){let e,t;return e=new wv({props:{folder:o[36],slot:"name"}}),e.$on("manageSharedFolder",o[24]),e.$on("manageRemoteFolder",o[25]),e.$on("manageRelay",o[26]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.folder=r[36]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Yv(o){let e,t;return e=new Ft({props:{$$slots:{name:[bA],default:[yA]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&192|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function vA(o){let e,t,r;return{c(){e=_("button"),e.textContent="Add folder",h(e,"class","mod-cta"),h(e,"aria-label","Add shared folder to vault"),me(e,"max-width","8em")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,nr.debounce)(o[17])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function Zv(o){let e,t,r,n,s,i;r=new ze({props:{name:"Subscriptions",helpText:"Subscriptions are tied to each Relay Server, not to your user account. Modify and cancel your subscription via our payment processor Stripe."}});let a=xe(o[8].values()),l=[];for(let u=0;u<a.length;u+=1)l[u]=Xv(Wv(o,a,u));let c=u=>S(l[u],1,1,()=>{l[u]=null});return{c(){e=_("div"),t=F(),U(r.$$.fragment),n=F();for(let u=0;u<l.length;u+=1)l[u].c();s=pe(),h(e,"class","spacer svelte-zmx7zz")},m(u,f){w(u,e,f),w(u,t,f),R(r,u,f),w(u,n,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(u,f);w(u,s,f),i=!0},p(u,f){if(f[0]&2305){a=xe(u[8].values());let d;for(d=0;d<a.length;d+=1){let p=Wv(u,a,d);l[d]?(l[d].p(p,f),b(l[d],1)):(l[d]=Xv(p),l[d].c(),b(l[d],1),l[d].m(s.parentNode,s))}for(ne(),d=a.length;d<l.length;d+=1)c(d);se()}},i(u){if(!i){b(r.$$.fragment,u);for(let f=0;f<a.length;f+=1)b(l[f]);i=!0}},o(u){S(r.$$.fragment,u),l=l.filter(Boolean);for(let f=0;f<l.length;f+=1)S(l[f]);i=!1},d(u){u&&(x(e),x(t),x(n),x(s)),D(r,u),qe(l,u)}}}function _A(o){let e,t,r,n;function s(){return o[30](o[33],o[34],o[35])}return{c(){e=_("button"),e.textContent="Manage",t=F()},m(i,a){w(i,e,a),w(i,t,a),r||(n=V(e,"click",function(){Ge((0,nr.debounce)(s))&&(0,nr.debounce)(s).apply(this,arguments)}),r=!0)},p(i,a){o=i},d(i){i&&(x(e),x(t)),r=!1,n()}}}function xA(o){let e;return{c(){e=_("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function wA(o){let e=o[33].relay.name+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&256&&e!==(e=r[33].relay.name+"")&&Q(t,e)},d(r){r&&x(t)}}}function SA(o){let e;function t(s,i){return s[33].relay.name?wA:xA}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=F()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function kA(o){let e,t;return e=new _a({props:{slot:"name",relay:o[33].relay,$$slots:{default:[SA]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[29]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.relay=r[33].relay),n[0]&256|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Xv(o){let e,t;return e=new Ft({props:{name:"",description:o[33].cancelAt?o[11](o[33].cancelAt):"",$$slots:{name:[kA],default:[_A]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.description=r[33].cancelAt?r[11](r[33].cancelAt):""),n[0]&257|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function IA(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[6].items().length===0,p,m,v,g,k=o[2].values().length>0,L,I;e=new ze({props:{name:"Join a Relay Server"}}),r=new Ue({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[aA]},$$scope:{ctx:o}}}),s=new ze({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[lA]},$$scope:{ctx:o}}});let C=xe(o[7].values().filter(jp).sort(e_)),M=[];for(let N=0;N<C.length;N+=1)M[N]=Jv(Gv(o,C,N));let A=N=>S(M[N],1,1,()=>{M[N]=null});l=new Ue({props:{name:"",description:"",$$slots:{default:[mA]},$$scope:{ctx:o}}}),u=new ze({props:{name:"My vault",helpText:"The following Shared Folders have been added to your vault. You can see what Relay Server a Shared Folder is connected to below."}});let E=d&&Qv(o),P=xe(o[6].items().sort(t_)),T=[];for(let N=0;N<P.length;N+=1)T[N]=Yv(Kv(o,P,N));let $=N=>S(T[N],1,1,()=>{T[N]=null});v=new Ft({props:{name:"",$$slots:{default:[vA]},$$scope:{ctx:o}}});let J=k&&Zv(o);return{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment),i=F();for(let N=0;N<M.length;N+=1)M[N].c();a=F(),U(l.$$.fragment),c=F(),U(u.$$.fragment),f=F(),E&&E.c(),p=F();for(let N=0;N<T.length;N+=1)T[N].c();m=F(),U(v.$$.fragment),g=F(),J&&J.c(),L=pe()},m(N,O){R(e,N,O),w(N,t,O),R(r,N,O),w(N,n,O),R(s,N,O),w(N,i,O);for(let te=0;te<M.length;te+=1)M[te]&&M[te].m(N,O);w(N,a,O),R(l,N,O),w(N,c,O),R(u,N,O),w(N,f,O),E&&E.m(N,O),w(N,p,O);for(let te=0;te<T.length;te+=1)T[te]&&T[te].m(N,O);w(N,m,O),R(v,N,O),w(N,g,O),J&&J.m(N,O),w(N,L,O),I=!0},p(N,O){let te={};O[0]&56|O[1]&2048&&(te.$$scope={dirty:O,ctx:N}),r.$set(te);let Z={};if(O[1]&2048&&(Z.$$scope={dirty:O,ctx:N}),s.$set(Z),O[0]&1152){C=xe(N[7].values().filter(jp).sort(e_));let j;for(j=0;j<C.length;j+=1){let H=Gv(N,C,j);M[j]?(M[j].p(H,O),b(M[j],1)):(M[j]=Jv(H),M[j].c(),b(M[j],1),M[j].m(a.parentNode,a))}for(ne(),j=C.length;j<M.length;j+=1)A(j);se()}let Y={};if(O[1]&2048&&(Y.$$scope={dirty:O,ctx:N}),l.$set(Y),O[0]&64&&(d=N[6].items().length===0),d?E?O[0]&64&&b(E,1):(E=Qv(N),E.c(),b(E,1),E.m(p.parentNode,p)):E&&(ne(),S(E,1,1,()=>{E=null}),se()),O[0]&12480){P=xe(N[6].items().sort(t_));let j;for(j=0;j<P.length;j+=1){let H=Kv(N,P,j);T[j]?(T[j].p(H,O),b(T[j],1)):(T[j]=Yv(H),T[j].c(),b(T[j],1),T[j].m(m.parentNode,m))}for(ne(),j=P.length;j<T.length;j+=1)$(j);se()}let ge={};O[1]&2048&&(ge.$$scope={dirty:O,ctx:N}),v.$set(ge),O[0]&4&&(k=N[2].values().length>0),k?J?(J.p(N,O),O[0]&4&&b(J,1)):(J=Zv(N),J.c(),b(J,1),J.m(L.parentNode,L)):J&&(ne(),S(J,1,1,()=>{J=null}),se())},i(N){if(!I){b(e.$$.fragment,N),b(r.$$.fragment,N),b(s.$$.fragment,N);for(let O=0;O<C.length;O+=1)b(M[O]);b(l.$$.fragment,N),b(u.$$.fragment,N),b(E);for(let O=0;O<P.length;O+=1)b(T[O]);b(v.$$.fragment,N),b(J),I=!0}},o(N){S(e.$$.fragment,N),S(r.$$.fragment,N),S(s.$$.fragment,N),M=M.filter(Boolean);for(let O=0;O<M.length;O+=1)S(M[O]);S(l.$$.fragment,N),S(u.$$.fragment,N),S(E),T=T.filter(Boolean);for(let O=0;O<T.length;O+=1)S(T[O]);S(v.$$.fragment,N),S(J),I=!1},d(N){N&&(x(t),x(n),x(i),x(a),x(c),x(f),x(p),x(m),x(g),x(L)),D(e,N),D(r,N),D(s,N),qe(M,N),D(l,N),D(u,N),E&&E.d(N),qe(T,N),D(v,N),J&&J.d(N)}}}function e_(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function t_(o,e){return o.remote&&!e.remote?-1:e.remote&&!o.remote||o.name>e.name?1:-1}function CA(o,e,t){let r,n,s=q,i=()=>(s(),s=At(f,re=>t(7,n=re)),f),a,l=q,c=()=>(l(),l=At(d,re=>t(8,a=re)),d);o.$$.on_destroy.push(()=>s()),o.$$.on_destroy.push(()=>l());let{plugin:u}=e,{relays:f}=e;i();let{subscriptions:d}=e;c();let p=u.sharedFolders;le(o,p,re=>t(6,r=re));let m="",v=!1,g=!1,k=Ye();function L(re){re&&k("manageRelay",{relay:re})}function I(re){if(!re)return"Active";let fe=im.moment.utc(),Le=im.moment.utc(re),de=Le.diff(fe,"days");return de<=0?"Subscription has ended":de===1?"Active for 1 more day":de>31?`Ends on ${Le.format("YYYY-MM-DD")}`:`Active for ${de} more days`}function C(re,fe){re&&k("manageSharedFolder",{folder:re,relay:fe})}function M(re){re&&k("manageRemoteFolder",{remoteFolder:re})}function A(){t(4,v=!1)}function E(re){return Ae(this,void 0,void 0,function*(){try{t(5,g=!0);let fe=yield u.relayManager.acceptInvitation(re).catch(Le=>{throw Le.status===429&&new nr.Notice("Slow down"),Le});t(5,g=!1),k("joinRelay",{relay:fe})}catch(fe){t(4,v=!0),t(5,g=!1)}})}function P(){k("createRelay")}function T(re,fe,Le){return Ae(this,void 0,void 0,function*(){let de=(0,r_.normalizePath)((0,o_.join)(Le,fe));u.app.vault.getFolderByPath(de)===null&&(yield u.app.vault.createFolder(de));let Ee=u.sharedFolders.new(de,re.guid,re.relay.guid);return Ee.remote=re,Ee})}function $(){let re=[];n.values().forEach(Le=>{Le.folders&&Le.folders.values().forEach(de=>{r.items().some(Oe=>{var Me;return((Me=Oe.remote)===null||Me===void 0?void 0:Me.id)===de.id})||re.push(de)})}),new Fn(u.app,u.sharedFolders,void 0,re,T).open()}function J(re){m=re,t(3,m)}let N=()=>E(m),O=()=>E(m);function te(re){pr.call(this,o,re)}let Z=re=>{L(re)},Y=()=>P();function ge(re){pr.call(this,o,re)}function j(re){pr.call(this,o,re)}function H(re){pr.call(this,o,re)}let X=re=>{M(re.remote)},ue=re=>{let fe=n.values().find(Le=>{var de;return((de=re.remote)==null?void 0:de.relay.guid)===Le.guid});C(re,fe)};function z(re){pr.call(this,o,re)}let ee=async(re,fe,Le)=>{if(!re.token){let Oe=await u.relayManager.getSubscriptionToken(re);Ys(d,fe[Le].token=Oe,a)}let de=re.id,Ee=re.token;window.open(u.buildApiUrl(`/subscriptions/${de}/manage?token=${Ee}`),"_blank")};return o.$$set=re=>{"plugin"in re&&t(0,u=re.plugin),"relays"in re&&i(t(1,f=re.relays)),"subscriptions"in re&&c(t(2,d=re.subscriptions))},[u,f,d,m,v,g,r,n,a,p,L,I,C,M,A,E,P,$,J,N,O,te,Z,Y,ge,j,H,X,ue,z,ee]}var am=class extends K{constructor(e){super(),G(this,e,CA,IA,W,{plugin:0,relays:1,subscriptions:2},iA,[-1,-1])}},To=am;var It=require("obsidian");var B_=an(Nn());function LA(o){Ce(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function MA(o){let e,t,r;return t=new Pd({props:{class:"svg-icon"}}),{c(){e=_("span"),U(t.$$.fragment),h(e,"class","lock-icon svelte-15ov1wm")},m(n,s){w(n,e,s),R(t,e,null),r=!0},p:q,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&x(e),D(t)}}}var lm=class extends K{constructor(e){super(),G(this,e,null,MA,W,{},LA)}},gc=lm;function TA(o){Ce(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function AA(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("div"),n=F(),s=_("div"),i=B(o[1]),h(t,"class","system3-disk-usage-bar svelte-1ezpbya"),me(t,"width",o[0]+"%"),h(t,"data-state",r=o[0]>90?"warning":""),h(e,"class","system3-disk-usage-container svelte-1ezpbya"),h(s,"class","system3-disk-usage-report svelte-1ezpbya")},m(a,l){w(a,e,l),y(e,t),w(a,n,l),w(a,s,l),y(s,i)},p(a,[l]){l&1&&me(t,"width",a[0]+"%"),l&1&&r!==(r=a[0]>90?"warning":"")&&h(t,"data-state",r),l&2&&Q(i,a[1])},i:q,o:q,d(a){a&&(x(e),x(n),x(s))}}}function FA(o,e,t){let{diskUsagePercentage:r=0}=e,{text:n=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=s=>{"diskUsagePercentage"in s&&t(0,r=s.diskUsagePercentage),"text"in s&&t(1,n=s.text)},[r,n]}var cm=class extends K{constructor(e){super(),G(this,e,FA,AA,W,{diskUsagePercentage:0,text:1},TA)}},n_=cm;var m_=require("obsidian");var s_=require("obsidian");function EA(o){Ce(o,"svelte-pb1sr8",".suggestion-create-prefix.svelte-pb1sr8{color:var(--text-muted);font-style:italic}.suggestion-action.svelte-pb1sr8{color:var(--text-muted);font-size:var(--font-smaller)}.suggestion-icon.svelte-pb1sr8{display:flex;align-items:center}.system3-svg-icon{color:var(--text-muted);opacity:0.6}")}function PA(o){let e=o[10].path+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&1024&&e!==(e=r[10].path+"")&&Q(t,e)},d(r){r&&x(t)}}}function RA(o){let e,t=o[10].path+"",r;return{c(){e=_("span"),e.textContent="Create: ",r=B(t),h(e,"class","suggestion-create-prefix svelte-pb1sr8")},m(n,s){w(n,e,s),w(n,r,s)},p(n,s){s&1024&&t!==(t=n[10].path+"")&&Q(r,t)},d(n){n&&(x(e),x(r))}}}function DA(o){let e;function t(s,i){return s[10].isCreate?RA:PA}let r=t(o,-1),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function UA(o){let e;return{c(){e=_("div"),h(e,"class","suggestion-icon svelte-pb1sr8")},m(t,r){w(t,e,r)},i:q,o:q,d(t){t&&x(e)}}}function OA(o){let e,t,r;return t=new to({props:{class:"system3-svg-icon",size:16}}),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","suggestion-icon svelte-pb1sr8")},m(n,s){w(n,e,s),R(t,e,null),r=!0},i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&x(e),D(t)}}}function NA(o){let e;return{c(){e=_("span"),e.textContent="Enter to create",h(e,"class","suggestion-action svelte-pb1sr8")},m(t,r){w(t,e,r)},i:q,o:q,d(t){t&&x(e)}}}function $A(o){let e,t,r,n,s=[NA,OA,UA],i=[];function a(l,c){return l[10].isCreate?0:l[10].isShared&&!l[10].hasRelay?1:2}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=pe()},m(l,c){i[e].m(l,c),w(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e!==u&&(ne(),S(i[u],1,1,()=>{i[u]=null}),se(),t=i[e],t||(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&x(r),i[e].d(l)}}}function BA(o){let e,t;return e=new mc({props:{placeholder:o[0],autofocus:o[1],onSelect:o[3],getSuggestions:o[2],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}],$$slots:{"suggestion-aux":[$A,({item:r})=>({10:r}),({item:r})=>r?1024:0],suggestion:[DA,({item:r})=>({10:r}),({item:r})=>r?1024:0]},$$scope:{ctx:o}}}),e.$on("customInput",o[9]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&3072&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function VA(o,e,t){let{app:r}=e,{placeholder:n="Choose or create folder..."}=e,{blockedPaths:s=new Set}=e,{sharedFolders:i}=e,{autofocus:a=!1}=e,{onSelect:l=()=>{}}=e;function c(p){let m=new Map;i&&i.forEach(M=>{m.set(M.path,!!M.relayId)});let v=p.toLowerCase(),g=[],k=new Set,L=M=>{if(!(s.has(M.path)&&M.path!=="/")){if((!v||M.path.toLowerCase().includes(v))&&!s.has(M.path)){let A=m.has(M.path),E=m.get(M.path)||!1;g.push({path:M.path,isCreate:!1,isShared:A,hasRelay:E}),k.add(M.path.toLowerCase())}for(let A of M.children)A instanceof s_.TFolder&&L(A)}},I=r.vault.getRoot();L(I);let C=p.trim();return C&&!k.has(C.toLowerCase())&&g.unshift({path:C,isCreate:!0,isShared:!1,hasRelay:!1}),g.sort((M,A)=>M.isCreate&&!A.isCreate?-1:!M.isCreate&&A.isCreate?1:M.isShared&&!M.hasRelay&&(!A.isShared||A.hasRelay)?-1:A.isShared&&!A.hasRelay&&(!M.isShared||M.hasRelay)?1:M.path.localeCompare(A.path)),g.slice(0,100)}function u(p){l(p.path)}function f(p){l(p)}let d=p=>f(p.detail.value);return o.$$set=p=>{"app"in p&&t(5,r=p.app),"placeholder"in p&&t(0,n=p.placeholder),"blockedPaths"in p&&t(6,s=p.blockedPaths),"sharedFolders"in p&&t(7,i=p.sharedFolders),"autofocus"in p&&t(1,a=p.autofocus),"onSelect"in p&&t(8,l=p.onSelect)},[n,a,c,u,f,r,s,i,l,d]}var um=class extends K{constructor(e){super(),G(this,e,VA,BA,W,{app:5,placeholder:0,blockedPaths:6,sharedFolders:7,autofocus:1,onSelect:8},EA)}},i_=um;var di=class extends fi{constructor(e,t="Choose or create folder...",r=new Set,n,s){super(e,i_,{app:e,placeholder:t,blockedPaths:r,sharedFolders:n},s)}};var bc=Ie({});function HA(o,e,t,r="error",n,s="client"){bc.update(i=>({...i,[o]:{message:e,details:t,type:r,visible:!0,autoDismiss:n!=null?n:5e3,source:s}}))}function a_(o){bc.update(e=>({...e,[o]:{...e[o],visible:!1}}))}function yc(o,e,t,r="error",n){HA(o,e,t,r,n,"server")}function Jt(o,e="An error occurred"){var r,n,s;let t=`server-error-${Date.now()}`;if(o.status===403){let i=((r=o.body)==null?void 0:r.message)||o.message||"Permission denied",a=(n=o.body)==null?void 0:n.details;yc(t,i,a,"error",7e3)}else if(o.status>=400&&o.status<500){let i=((s=o.body)==null?void 0:s.message)||o.message||e;yc(t,i,void 0,"error",5e3)}else o.status>=500?yc(t,"Server error occurred",o.message,"error",8e3):yc(t,e,o.message,"error",5e3)}function qA(o){Ce(o,"svelte-y144a4",".share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:500px;max-width:600px}@media(max-width: 768px){.share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:100vw;max-width:100vw;margin:0;border-radius:0;height:100vh;max-height:100vh}}.section.svelte-y144a4.svelte-y144a4{margin-bottom:24px}.search-container.svelte-y144a4.svelte-y144a4{margin-bottom:12px}.search-input.svelte-y144a4.svelte-y144a4{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-y144a4.svelte-y144a4{max-height:300px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary)}.user-item.svelte-y144a4.svelte-y144a4{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);gap:12px}.user-item.svelte-y144a4.svelte-y144a4:last-child{border-bottom:none}.user-item.svelte-y144a4.svelte-y144a4:hover:not(.is-current-user){background:var(--background-modifier-hover)}.user-item.is-current-user.svelte-y144a4.svelte-y144a4{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-y144a4.svelte-y144a4{margin:0;cursor:pointer}.user-avatar.svelte-y144a4.svelte-y144a4{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-y144a4 img.svelte-y144a4{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-y144a4.svelte-y144a4{flex:1;min-width:0}.user-name.svelte-y144a4.svelte-y144a4{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-y144a4.svelte-y144a4{font-size:0.8em;color:var(--text-muted);font-style:italic;margin-left:auto}.no-users.svelte-y144a4.svelte-y144a4{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-y144a4.svelte-y144a4{display:flex;justify-content:flex-end;align-items:center;margin-top:24px;gap:12px}.modal-button-container.users-step.svelte-y144a4.svelte-y144a4{justify-content:space-between}button.svelte-y144a4.svelte-y144a4:disabled{opacity:0.5;cursor:not-allowed}.checkbox-container.svelte-y144a4.svelte-y144a4{cursor:pointer}")}function l_(o,e,t){let r=o.slice();return r[38]=e[t],r}function zA(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v,g,k,L,I,C,M,A,E,P;s=new ze({props:{name:"Selected Folder"}}),a=new wa({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],readonly:!0}}),u=new ze({props:{name:"Users"}});function T(N,O){return N[7].length===0?KA:WA}let $=T(o,[-1,-1]),J=$(o);return{c(){e=_("div"),e.textContent="Add Users to Folder",t=F(),r=_("div"),n=_("div"),U(s.$$.fragment),i=F(),U(a.$$.fragment),l=F(),c=_("div"),U(u.$$.fragment),f=F(),d=_("div"),p=_("input"),m=F(),v=_("div"),J.c(),g=F(),k=_("div"),L=_("button"),L.textContent="Back",I=F(),C=_("button"),C.textContent="Share",h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(p,"type","text"),h(p,"placeholder","Search users by name..."),h(p,"class","search-input svelte-y144a4"),h(d,"class","search-container svelte-y144a4"),h(v,"class","user-list svelte-y144a4"),h(c,"class","section svelte-y144a4"),h(L,"class","mod-muted svelte-y144a4"),h(C,"class","mod-cta svelte-y144a4"),C.disabled=M=!1,h(k,"class","modal-button-container users-step svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(N,O){w(N,e,O),w(N,t,O),w(N,r,O),y(r,n),R(s,n,null),y(n,i),R(a,n,null),y(r,l),y(r,c),R(u,c,null),y(c,f),y(c,d),y(d,p),Je(p,o[6]),y(c,m),y(c,v),J.m(v,null),y(r,g),y(r,k),y(k,L),y(k,I),y(k,C),o[28](r),A=!0,E||(P=[V(p,"input",o[25]),V(L,"click",o[15]),V(C,"click",o[14])],E=!0)},p(N,O){let te={};O[0]&16&&(te.selectedItem=N[4]),O[0]&4&&(te.isPrivate=N[2]),a.$set(te),O[0]&64&&p.value!==N[6]&&Je(p,N[6]),$===($=T(N,O))&&J?J.p(N,O):(J.d(1),J=$(N),J&&(J.c(),J.m(v,null)))},i(N){A||(b(s.$$.fragment,N),b(a.$$.fragment,N),b(u.$$.fragment,N),A=!0)},o(N){S(s.$$.fragment,N),S(a.$$.fragment,N),S(u.$$.fragment,N),A=!1},d(N){N&&(x(e),x(t),x(r)),D(s),D(a),D(u),J.d(),o[28](null),E=!1,we(P)}}}function jA(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[2]?"Add Users":"Share",p,m,v,g,k;s=new ze({props:{name:"Folder"}}),a=new wa({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],selectButtonText:"Choose or create folder..."}}),a.$on("clear",o[11]),a.$on("select",o[16]);let L=o[0].version>0&&f_(o);return{c(){e=_("div"),e.textContent="Share a folder",t=F(),r=_("div"),n=_("div"),U(s.$$.fragment),i=F(),U(a.$$.fragment),l=F(),L&&L.c(),c=F(),u=_("div"),f=_("button"),p=B(d),h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(f,"class","mod-cta svelte-y144a4"),f.disabled=m=!o[4]&&!o[3].trim(),h(u,"class","modal-button-container svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(I,C){w(I,e,C),w(I,t,C),w(I,r,C),y(r,n),R(s,n,null),y(n,i),R(a,n,null),y(r,l),L&&L.m(r,null),y(r,c),y(r,u),y(u,f),y(f,p),o[24](r),v=!0,g||(k=V(f,"click",o[12]),g=!0)},p(I,C){let M={};C[0]&16&&(M.selectedItem=I[4]),C[0]&4&&(M.isPrivate=I[2]),a.$set(M),I[0].version>0?L?(L.p(I,C),C[0]&1&&b(L,1)):(L=f_(I),L.c(),b(L,1),L.m(r,c)):L&&(ne(),S(L,1,1,()=>{L=null}),se()),(!v||C[0]&4)&&d!==(d=I[2]?"Add Users":"Share")&&Q(p,d),(!v||C[0]&24&&m!==(m=!I[4]&&!I[3].trim()))&&(f.disabled=m)},i(I){v||(b(s.$$.fragment,I),b(a.$$.fragment,I),b(L),v=!0)},o(I){S(s.$$.fragment,I),S(a.$$.fragment,I),S(L),v=!1},d(I){I&&(x(e),x(t),x(r)),D(s),D(a),L&&L.d(),o[24](null),g=!1,k()}}}function WA(o){let e,t=xe(o[7]),r=[];for(let n=0;n<t.length;n+=1)r[n]=u_(l_(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=pe()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);w(n,e,s)},p(n,s){if(s[0]&8320){t=xe(n[7]);let i;for(i=0;i<t.length;i+=1){let a=l_(n,t,i);r[i]?r[i].p(a,s):(r[i]=u_(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&x(e),qe(r,n)}}}function KA(o){let e,t=o[6]?"No users found":"No users available",r;return{c(){e=_("div"),r=B(t),h(e,"class","no-users svelte-y144a4")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s[0]&64&&t!==(t=n[6]?"No users found":"No users available")&&Q(r,t)},d(n){n&&x(e)}}}function GA(o){let e=d_(o[38].user.name)+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&128&&e!==(e=d_(r[38].user.name)+"")&&Q(t,e)},d(r){r&&x(t)}}}function JA(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[38].user.picture)||h(e,"src",t),h(e,"alt",r=o[38].user.name),h(e,"class","svelte-y144a4")},m(n,s){w(n,e,s)},p(n,s){s[0]&128&&!dr(e.src,t=n[38].user.picture)&&h(e,"src",t),s[0]&128&&r!==(r=n[38].user.name)&&h(e,"alt",r)},d(n){n&&x(e)}}}function c_(o){let e;return{c(){e=_("div"),e.textContent="Required (You)",h(e,"class","user-status svelte-y144a4")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function u_(o){let e,t,r,n,s,i,a,l,c,u=o[38].user.name+"",f,d,p,m,v;function g(A,E){return A[38].user.picture?JA:GA}let k=g(o,[-1,-1]),L=k(o),I=o[38].isCurrentUser&&c_(o);function C(){return o[26](o[38])}function M(...A){return o[27](o[38],...A)}return{c(){e=_("div"),t=_("input"),s=F(),i=_("div"),L.c(),a=F(),l=_("div"),c=_("div"),f=B(u),d=F(),I&&I.c(),p=F(),h(t,"type","checkbox"),t.checked=r=o[38].selected,t.disabled=n=o[38].isCurrentUser,h(t,"class","user-checkbox svelte-y144a4"),h(t,"tabindex","-1"),h(i,"class","user-avatar svelte-y144a4"),h(c,"class","user-name svelte-y144a4"),h(l,"class","user-info svelte-y144a4"),h(e,"class","user-item svelte-y144a4"),h(e,"role","button"),h(e,"tabindex","0"),Te(e,"is-current-user",o[38].isCurrentUser)},m(A,E){w(A,e,E),y(e,t),y(e,s),y(e,i),L.m(i,null),y(e,a),y(e,l),y(l,c),y(c,f),y(e,d),I&&I.m(e,null),y(e,p),m||(v=[V(e,"click",C),V(e,"keydown",M)],m=!0)},p(A,E){o=A,E[0]&128&&r!==(r=o[38].selected)&&(t.checked=r),E[0]&128&&n!==(n=o[38].isCurrentUser)&&(t.disabled=n),k===(k=g(o,E))&&L?L.p(o,E):(L.d(1),L=k(o),L&&(L.c(),L.m(i,null))),E[0]&128&&u!==(u=o[38].user.name+"")&&Q(f,u),o[38].isCurrentUser?I||(I=c_(o),I.c(),I.m(e,p)):I&&(I.d(1),I=null),E[0]&128&&Te(e,"is-current-user",o[38].isCurrentUser)},d(A){A&&x(e),L.d(),I&&I.d(),m=!1,we(v)}}}function f_(o){let e,t;return e=new Ue({props:{name:"Private",description:"Only selected users can access this folder",$$slots:{default:[QA]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&4|n[1]&1024&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function QA(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("input"),r=F(),n=_("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[2]),h(e,"tabindex","0"),h(e,"class","checkbox-container svelte-y144a4"),Te(e,"is-enabled",o[2])},m(a,l){w(a,e,l),y(e,t),t.checked=o[2],y(e,r),y(e,n),s||(i=[V(t,"change",o[21]),V(e,"keypress",o[22]),V(e,"click",o[23])],s=!0)},p(a,l){l[0]&4&&(t.checked=a[2]),l[0]&4&&h(e,"aria-checked",a[2]),l[0]&4&&Te(e,"is-enabled",a[2])},d(a){a&&x(e),s=!1,we(i)}}}function YA(o){let e,t,r,n,s=[jA,zA],i=[];function a(l,c){return l[1]==="main"?0:l[1]==="users"?1:-1}return~(e=a(o,[-1,-1]))&&(t=i[e]=s[e](o)),{c(){t&&t.c(),r=pe()},m(l,c){~e&&i[e].m(l,c),w(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?~e&&i[e].p(l,c):(t&&(ne(),S(i[u],1,1,()=>{i[u]=null}),se()),~e?(t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r)):t=null)},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&x(r),~e&&i[e].d(l)}}}function d_(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function ZA(o,e,t){let r,n,s;var i;let{app:a}=e,{relay:l}=e,{relayManager:c}=e,{sharedFolders:u}=e,{onConfirm:f}=e,d="main",p=!1,m="",v="",g=Ie(new Set(!((i=c.user)===null||i===void 0)&&i.id?[c.user.id]:[]));le(o,g,fe=>t(30,r=fe));let k=Ie("");le(o,k,fe=>t(6,n=fe));let L,I=()=>new Set(u.filter(fe=>!!fe.relayId).map(fe=>fe.path)).add("/"),C=Xe([c.relayRoles],([fe])=>Array.from(fe.values()).filter(Le=>Le.relayId===l.id).map(Le=>Le.user)),M=Xe([C,g],([fe,Le])=>{var de;let Ee=(de=c.user)===null||de===void 0?void 0:de.id;return fe.map(Oe=>{let Me=Ee===Oe.id,ot=Le.has(Oe.id)||Me;return{user:Oe,selected:ot,isCurrentUser:Me}})}),A=Xe([M,k],([fe,Le])=>{if(!Le||Le.trim()==="")return fe;let de=Le.toLowerCase().trim();return fe.filter(Ee=>Ee.user.name.toLowerCase().includes(de))}),E=Xe([A],([fe])=>fe.sort((Le,de)=>Le.user.name.localeCompare(de.user.name)));le(o,E,fe=>t(7,s=fe));function P(){t(4,v=""),t(3,m="")}function T(){!v&&m.trim()&&t(4,v=m.trim()),p?t(1,d="users"):J()}function $(fe){fe.isCurrentUser||g.update(Le=>{let de=new Set(Le);return de.has(fe.user.id)?de.delete(fe.user.id):de.add(fe.user.id),de})}function J(){return Ae(this,void 0,void 0,function*(){var fe;!v&&m.trim()&&t(4,v=m.trim());try{let Le=(fe=c.user)===null||fe===void 0?void 0:fe.id,de=r,Ee=Array.from(de).filter(Oe=>Oe!==Le);yield f(v,v.split("/").pop()||"",p,Ee)}catch(Le){Jt(Le,"Failed to share folder.")}})}function N(){t(1,d="main")}function O(fe){t(4,v=fe),t(3,m=fe)}function te(){new di(a,"Choose or create folder...",I(),u,O).open()}let Z=fe=>{fe.key==="Tab"&&Y(fe)};lt(()=>(document.addEventListener("keydown",Z),v||setTimeout(()=>{te()},100),()=>{document.removeEventListener("keydown",Z)}));function Y(fe){if(!L)return;let Le=L.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),de=Le[0],Ee=Le[Le.length-1];fe.shiftKey?document.activeElement===de&&(fe.preventDefault(),Ee.focus()):document.activeElement===Ee&&(fe.preventDefault(),de.focus())}function ge(){p=this.checked,t(2,p)}let j=()=>t(2,p=!p),H=()=>t(2,p=!p);function X(fe){vt[fe?"unshift":"push"](()=>{L=fe,t(5,L)})}function ue(){n=this.value,k.set(n)}let z=fe=>$(fe),ee=(fe,Le)=>{(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),$(fe))};function re(fe){vt[fe?"unshift":"push"](()=>{L=fe,t(5,L)})}return o.$$set=fe=>{"app"in fe&&t(17,a=fe.app),"relay"in fe&&t(0,l=fe.relay),"relayManager"in fe&&t(18,c=fe.relayManager),"sharedFolders"in fe&&t(19,u=fe.sharedFolders),"onConfirm"in fe&&t(20,f=fe.onConfirm)},[l,d,p,m,v,L,n,s,g,k,E,P,T,$,J,N,te,a,c,u,f,ge,j,H,X,ue,z,ee,re]}var fm=class extends K{constructor(e){super(),G(this,e,ZA,YA,W,{app:17,relay:0,relayManager:18,sharedFolders:19,onConfirm:20},qA,[-1,-1])}},p_=fm;var vc=class extends m_.Modal{constructor(t,r,n,s,i){super(t);this.relay=r;this.sharedFolders=n;this.relayManager=s;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new p_({target:t,props:{app:this.app,relay:this.relay,relayManager:this.relayManager,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s,i)=>{let a=await this.onConfirm(r,n,s,i);return this.close(),a}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}destroy(){this.relay=null,this.sharedFolders=null,this.relayManager=null,this.onConfirm=null}};function XA(o){Ce(o,"svelte-1r0liue",`.el-pre.svelte-1r0liue.svelte-1r0liue{position:relative;margin:1em 0}pre.language-toml.svelte-1r0liue.svelte-1r0liue{position:relative;background:var(--code-background);border-radius:var(--radius-s);padding:1em;overflow-x:auto;font-family:var(--font-monospace);font-size:var(--code-size);line-height:var(--line-height-normal);tab-size:4;border:1px solid var(--background-modifier-border)}code.language-toml.svelte-1r0liue.svelte-1r0liue{display:block;color:var(--code-normal);white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:inherit;user-select:text;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text}.copy-code-button.svelte-1r0liue.svelte-1r0liue{position:absolute;top:0.5em;right:0.5em;padding:0.25em;background:transparent;border:none;color:var(--text-muted);cursor:pointer;opacity:0;transition:opacity 0.2s ease,
			color 0.2s ease;display:flex;align-items:center;justify-content:center;box-shadow:none !important}.el-pre.svelte-1r0liue:hover .copy-code-button.svelte-1r0liue{opacity:0.7;box-shadow:none}.copy-code-button.svelte-1r0liue.svelte-1r0liue:hover{opacity:1 !important;color:var(--text-normal);background:transparent;border:none;box-shadow:none !important}.copy-code-button.svelte-1r0liue.svelte-1r0liue:focus{outline:none;border:none;opacity:1;color:var(--interactive-accent);background:transparent;box-shadow:none !important}.svg-icon.svelte-1r0liue.svelte-1r0liue{width:16px;height:16px}.error-message.svelte-1r0liue.svelte-1r0liue{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}`)}function eF(o){let e;return{c(){e=_("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-1r0liue")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function tF(o){let e,t,r,n,s,i,a,l,c;function u(p,m){return p[1]?oF:rF}let f=u(o,-1),d=f(o);return{c(){e=_("div"),t=_("pre"),r=_("code"),n=_("button"),s=B(`
				`),d.c(),i=B(`
			`),h(r,"class","language-toml is-loaded svelte-1r0liue"),h(n,"class","copy-code-button svelte-1r0liue"),h(n,"aria-label",a=o[1]?"Copied to clipboard":"Copy"),h(t,"class","language-toml svelte-1r0liue"),h(e,"class","el-pre svelte-1r0liue")},m(p,m){w(p,e,m),y(e,t),y(t,r),r.innerHTML=o[2],y(t,n),y(n,s),d.m(n,null),y(n,i),l||(c=[V(n,"click",o[3]),V(n,"keydown",o[4])],l=!0)},p(p,m){m&4&&(r.innerHTML=p[2]),f!==(f=u(p,m))&&(d.d(1),d=f(p),d&&(d.c(),d.m(n,i))),m&2&&a!==(a=p[1]?"Copied to clipboard":"Copy")&&h(n,"aria-label",a)},d(p){p&&x(e),d.d(),l=!1,we(c)}}}function rF(o){let e,t,r;return{c(){e=Kt("svg"),t=Kt("rect"),r=Kt("path"),h(t,"x","8"),h(t,"y","8"),h(t,"width","14"),h(t,"height","14"),h(t,"rx","2"),h(t,"ry","2"),h(r,"d","M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24"),h(e,"height","24"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","2"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","svg-icon lucide-copy svelte-1r0liue")},m(n,s){w(n,e,s),y(e,t),y(e,r)},d(n){n&&x(e)}}}function oF(o){let e,t;return{c(){e=Kt("svg"),t=Kt("polyline"),h(t,"points","20,6 9,17 4,12"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24"),h(e,"height","24"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","2"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","svg-icon lucide-check svelte-1r0liue")},m(r,n){w(r,e,n),y(e,t)},d(r){r&&x(e)}}}function nF(o){let e;function t(s,i){return s[0]?tF:eF}let r=t(o,-1),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},i:q,o:q,d(s){s&&x(e),n.d(s)}}}function sF(o){let e=[],t=o.split(`
`);for(let r of t){let n=r.trim();if(n==="")e.push({type:"newline",value:r});else if(n.startsWith("#"))e.push({type:"comment",value:r});else if(n.startsWith("[[")&&n.endsWith("]]")){let s=r.match(/^(\s*)\[\[([^\]]+)\]\](\s*)$/);if(s){let[,i,a,l]=s;e.push({type:"array-table",value:r,parts:{leading:i,tableName:a,trailing:l}})}else e.push({type:"text",value:r})}else if(n.startsWith("[")&&n.endsWith("]")){let s=r.match(/^(\s*)\[([^\]]+)\](\s*)$/);if(s){let[,i,a,l]=s;e.push({type:"table",value:r,parts:{leading:i,tableName:a,trailing:l}})}else e.push({type:"text",value:r})}else if(n.includes("=")){let s=r.match(/^(\s*)([^=]+?)\s*=\s*(.+)(\s*)$/);if(s){let[,i,a,l,c]=s;e.push({type:"key-value",value:r,parts:{leading:i,key:a.trim(),value:l.trim(),trailing:c}})}else e.push({type:"text",value:r})}else e.push({type:"text",value:r})}return e}function iF(o){return o.map(e=>{switch(e.type){case"comment":return`<span class="token comment">${e.value}</span>`;case"newline":return e.value;case"table":let{leading:t,tableName:r,trailing:n}=e.parts;return`${t}<span class="token punctuation">[</span><span class="token table class-name">${r}</span><span class="token punctuation">]</span>${n}`;case"array-table":let{leading:s,tableName:i,trailing:a}=e.parts;return`${s}<span class="token punctuation">[[</span><span class="token table class-name">${i}</span><span class="token punctuation">]]</span>${a}`;case"key-value":let{leading:l,key:c,value:u,trailing:f}=e.parts,d=u;return u.startsWith('"')&&u.endsWith('"')?d=`<span class="token string">${u}</span>`:/^\d+$/.test(u)?d=`<span class="token number">${u}</span>`:d=`<span class="token string">${u}</span>`,`${l}<span class="token key property">${c}</span> <span class="token punctuation">=</span> ${d}${f}`;default:return e.value}}).join(`
`)}function aF(o,e,t){let r,{toml:n=""}=e,s=!1;function i(){return Ae(this,void 0,void 0,function*(){try{yield navigator.clipboard.writeText(n),t(1,s=!0),setTimeout(()=>{t(1,s=!1)},2e3)}catch(l){console.error("Failed to copy text: ",l)}})}function a(l){l.key==="Enter"&&(l.preventDefault(),i())}return o.$$set=l=>{"toml"in l&&t(0,n=l.toml)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(2,r=n?iF(sF(n)):"")}},[n,s,r,i,a]}var dm=class extends K{constructor(e){super(),G(this,e,aF,nF,W,{toml:0},XA)}},_c=dm;var pm=require("obsidian");function lF(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function cF(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function En(o){let e=lF(o);return cF(e)}function uF(o){Ce(o,"svelte-sj7m72",`div.spacer.svelte-sj7m72{height:3em}.faint.svelte-sj7m72{color:var(--text-faint) !important}.edit-members-button.svelte-sj7m72{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-sj7m72:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-sj7m72:focus{outline:none;color:var(--icon-color-focus)}.share-key-container.svelte-sj7m72{width:100%}.share-key-disabled-notice.svelte-sj7m72{color:var(--text-error) !important;font-size:0.85em !important}.relay-host-check.svelte-sj7m72{text-align:right}input.system3-updating.svelte-sj7m72{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-sj7m72{border:1px solid var(--color-red) !important}.admin-toggle-btn.svelte-sj7m72{background:none;border:none;box-shadow:none;color:var(--text-muted);font-size:0.9em;cursor:pointer;padding:0;margin-left:8px}.admin-toggle-btn.svelte-sj7m72:hover{color:var(--text-normal);text-decoration:underline}.relay-auth-section.svelte-sj7m72{margin:16px 0}.loading-message.svelte-sj7m72{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.error-message.svelte-sj7m72{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}`)}function h_(o,e,t){let r=o.slice();return r[87]=e[t],r}function g_(o,e,t){let r=o.slice();return r[90]=e[t],r}function y_(o,e,t){let r=o.slice();return r[93]=e[t],r}function b_(o){let e,t;return e=new Ue({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[fF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&132225|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function fF(o){let e,t,r,n;return{c(){e=_("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=kt((o[17]?"system3-updating":"")+(o[10]?"":" system3-input-invalid"))+" svelte-sj7m72")},m(s,i){w(s,e,i),Je(e,o[0].name),o[68](e),r||(n=[V(e,"input",o[67]),V(e,"input",o[51])],r=!0)},p(s,i){i[0]&132096&&t!==(t=kt((s[17]?"system3-updating":"")+(s[10]?"":" system3-input-invalid"))+" svelte-sj7m72")&&h(e,"class",t),i[0]&1&&e.value!==s[0].name&&Je(e,s[0].name)},d(s){s&&x(e),o[68](null),r=!1,we(n)}}}function v_(o){let e,t=o[20]?"View as member":"View as admin",r,n,s;return{c(){e=_("button"),r=B(t),h(e,"class","admin-toggle-btn svelte-sj7m72")},m(i,a){w(i,e,a),y(e,r),n||(s=V(e,"click",o[69]),n=!0)},p(i,a){a[0]&1048576&&t!==(t=i[20]?"View as member":"View as admin")&&Q(r,t)},d(i){i&&x(e),n=!1,s()}}}function dF(o){let e,t=o[18]&&o[19]&&v_(o);return{c(){t&&t.c(),e=pe()},m(r,n){t&&t.m(r,n),w(r,e,n)},p(r,n){r[18]&&r[19]?t?t.p(r,n):(t=v_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&x(e),t&&t.d(r)}}}function __(o){let e,t;return e=new Ft({props:{$$slots:{name:[gF],default:[mF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&6291458|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function x_(o){let e,t;function r(){return o[71](o[93])}return e=new ds({props:{label:"Add to vault",$$slots:{default:[pF]},$$scope:{ctx:o}}}),e.$on("settings",function(){Ge((0,It.debounce)(r))&&(0,It.debounce)(r).apply(this,arguments)}),{c(){U(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){o=n;let i={};s[3]&8&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function pF(o){let e,t;return e=new ma({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p:q,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function mF(o){let e=!o[22].some(s)&&wo(o[1].relayManager.userCan(["folder","read_content"],o[93])),t,r,n;function s(...l){return o[65](o[93],...l)}let i=e&&x_(o);function a(){return o[72](o[93])}return r=new ds({}),r.$on("settings",function(){Ge((0,It.debounce)(a))&&(0,It.debounce)(a).apply(this,arguments)}),{c(){i&&i.c(),t=F(),U(r.$$.fragment)},m(l,c){i&&i.m(l,c),w(l,t,c),R(r,l,c),n=!0},p(l,c){o=l,c[0]&6291458&&(e=!o[22].some(s)&&wo(o[1].relayManager.userCan(["folder","read_content"],o[93]))),e?i?(i.p(o,c),c[0]&6291458&&b(i,1)):(i=x_(o),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(ne(),S(i,1,1,()=>{i=null}),se())},i(l){n||(b(i),b(r.$$.fragment,l),n=!0)},o(l){S(i),S(r.$$.fragment,l),n=!1},d(l){l&&x(t),i&&i.d(l),D(r,l)}}}function hF(o){let e=o[93].name+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&2097152&&e!==(e=r[93].name+"")&&Q(t,e)},d(r){r&&x(t)}}}function gF(o){let e,t;function r(){return o[70](o[93])}return e=new dc({props:{remoteFolder:o[93],slot:"name",$$slots:{default:[hF]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",r),{c(){U(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){o=n;let i={};s[0]&2097152&&(i.remoteFolder=o[93]),s[0]&2097152|s[3]&8&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function w_(o){let e=o[20]?wo(o[1].relayManager.userCan(["folder","manage_users"],o[93])):wo(o[1].relayManager.userCan(["folder","read_content"],o[93])),t,r,n=e&&__(o);return{c(){n&&n.c(),t=pe()},m(s,i){n&&n.m(s,i),w(s,t,i),r=!0},p(s,i){i[0]&3145730&&(e=s[20]?wo(s[1].relayManager.userCan(["folder","manage_users"],s[93])):wo(s[1].relayManager.userCan(["folder","read_content"],s[93]))),e?n?(n.p(s,i),i[0]&3145730&&b(n,1)):(n=__(s),n.c(),b(n,1),n.m(t.parentNode,t)):n&&(ne(),S(n,1,1,()=>{n=null}),se())},i(s){r||(b(n),r=!0)},o(s){S(n),r=!1},d(s){s&&x(t),n&&n.d(s)}}}function yF(o){let e,t,r;return{c(){e=_("button"),e.textContent="Share a folder",h(e,"class","mod-cta"),h(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){w(n,e,s),t||(r=V(e,"click",function(){Ge((0,It.debounce)(o[73]))&&(0,It.debounce)(o[73]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&x(e),t=!1,r()}}}function S_(o){let e,t,r,n,s,i,a,l=[vF,bF],c=[];function u(f,d){return f[23]?0:1}return t=u(o,[-1,-1,-1,-1]),r=c[t]=l[t](o),{c(){e=_("div"),r.c(),h(e,"class","edit-members-button svelte-sj7m72"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[23]?"Done editing":"Edit members")},m(f,d){w(f,e,d),c[t].m(e,null),s=!0,i||(a=[V(e,"click",o[55]),V(e,"keypress",o[55])],i=!0)},p(f,d){let p=t;t=u(f,d),t!==p&&(ne(),S(c[p],1,1,()=>{c[p]=null}),se(),r=c[t],r||(r=c[t]=l[t](f),r.c()),b(r,1),r.m(e,null)),(!s||d[0]&8388608&&n!==(n=f[23]?"Done editing":"Edit members"))&&h(e,"aria-label",n)},i(f){s||(b(r),s=!0)},o(f){S(r),s=!1},d(f){f&&x(e),c[t].d(),i=!1,we(a)}}}function bF(o){let e,t;return e=new ga({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function vF(o){let e,t;return e=new ua({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function _F(o){let e,t,r=o[18]&&S_(o);return{c(){r&&r.c(),e=pe()},m(n,s){r&&r.m(n,s),w(n,e,s),t=!0},p(n,s){n[18]?r?(r.p(n,s),s[0]&262144&&b(r,1)):(r=S_(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(ne(),S(r,1,1,()=>{r=null}),se())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&x(e),r&&r.d(n)}}}function xF(o){let e,t=o[87].role+"",r;return{c(){e=_("span"),r=B(t),h(e,"class","role-label")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s[0]&512&&t!==(t=n[87].role+"")&&Q(r,t)},d(n){n&&x(e)}}}function wF(o){let e;function t(s,i){return s[23]?kF:SF}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function SF(o){let e,t,r,n,s,i,a,l,c=xe(o[24]),u=[];for(let f=0;f<c.length;f+=1)u[f]=k_(g_(o,c,f));return{c(){var f,d;e=_("div"),t=_("select");for(let p=0;p<u.length;p+=1)u[p].c();h(t,"class","dropdown"),t.disabled=r=o[87].userId===((f=o[1].loginManager.user)==null?void 0:f.id),h(t,"aria-label",n=o[87].userId===((d=o[1].loginManager.user)==null?void 0:d.id)?"Cannot modify your own role":void 0),h(t,"data-role-id",i=o[87].id),me(e,"display","flex"),me(e,"gap","8px"),me(e,"align-items","center")},m(f,d){w(f,e,d),y(e,t);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(t,null);Ln(t,o[87].role),a||(l=V(t,"change",o[54]),a=!0)},p(f,d){var p,m;if(d[0]&16777216){c=xe(f[24]);let v;for(v=0;v<c.length;v+=1){let g=g_(f,c,v);u[v]?u[v].p(g,d):(u[v]=k_(g),u[v].c(),u[v].m(t,null))}for(;v<u.length;v+=1)u[v].d(1);u.length=c.length}d[0]&16777730&&r!==(r=f[87].userId===((p=f[1].loginManager.user)==null?void 0:p.id))&&(t.disabled=r),d[0]&16777730&&n!==(n=f[87].userId===((m=f[1].loginManager.user)==null?void 0:m.id)?"Cannot modify your own role":void 0)&&h(t,"aria-label",n),d[0]&16777728&&s!==(s=f[87].role)&&Ln(t,f[87].role),d[0]&16777728&&i!==(i=f[87].id)&&h(t,"data-role-id",i)},d(f){f&&x(e),qe(u,f),a=!1,l()}}}function kF(o){var r;let e,t=o[87].userId!==((r=o[1].loginManager.user)==null?void 0:r.id)&&I_(o);return{c(){t&&t.c(),e=pe()},m(n,s){t&&t.m(n,s),w(n,e,s)},p(n,s){var i;n[87].userId!==((i=n[1].loginManager.user)==null?void 0:i.id)?t?t.p(n,s):(t=I_(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){n&&x(e),t&&t.d(n)}}}function k_(o){let e,t=o[90].name+"",r,n;return{c(){e=_("option"),r=B(t),e.__value=n=o[90].name,Je(e,e.__value)},m(s,i){w(s,e,i),y(e,r)},p(s,i){i[0]&16777216&&t!==(t=s[90].name+"")&&Q(r,t),i[0]&16777216&&n!==(n=s[90].name)&&(e.__value=n,Je(e,e.__value))},d(s){s&&x(e)}}}function I_(o){let e,t,r;function n(){return o[74](o[87])}return{c(){e=_("button"),e.textContent="Kick",h(e,"class","mod-destructive")},m(s,i){w(s,e,i),t||(r=V(e,"click",function(){Ge((0,It.debounce)(n))&&(0,It.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&x(e),t=!1,r()}}}function IF(o){let e;function t(s,i){return s[18]?wF:xF}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function C_(o){let e,t;return e=new ci({props:{user:o[87].user,$$slots:{default:[IF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.user=r[87].user),n[0]&25428482|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function CF(o){let e,t=o[9].values().length+"",r,n,s=o[14].userLimit+"",i,a;return{c(){e=_("span"),r=B(t),n=B(" of "),i=B(s),a=B(" seats used"),h(e,"class","faint svelte-sj7m72")},m(l,c){w(l,e,c),y(e,r),y(e,n),y(e,i),y(e,a)},p(l,c){c[0]&512&&t!==(t=l[9].values().length+"")&&Q(r,t),c[0]&16384&&s!==(s=l[14].userLimit+"")&&Q(i,s)},d(l){l&&x(e)}}}function L_(o){let e,t;return e=new gc({}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function LF(o){let e,t,r,n,s,i,a,l,c,u,f,d=!o[12]&&L_(o);return{c(){e=_("div"),d&&d.c(),t=F(),r=_("div"),n=_("input"),i=F(),a=_("div"),h(n,"type","checkbox"),n.checked=o[11],n.disabled=s=!o[12],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",o[11]),h(r,"tabindex","0"),h(r,"class",l=o[12]?"checkbox-container":"checkbox-container checkbox-locked"),Te(r,"is-enabled",o[11]),h(e,"class","setting-item-control")},m(p,m){w(p,e,m),d&&d.m(e,null),y(e,t),y(e,r),y(r,n),y(r,i),y(r,a),c=!0,u||(f=[V(n,"change",o[75]),V(r,"keypress",o[76]),V(r,"click",o[77])],u=!0)},p(p,m){p[12]?d&&(ne(),S(d,1,1,()=>{d=null}),se()):d?m[0]&4096&&b(d,1):(d=L_(p),d.c(),b(d,1),d.m(e,t)),(!c||m[0]&2048)&&(n.checked=p[11]),(!c||m[0]&4096&&s!==(s=!p[12]))&&(n.disabled=s),(!c||m[0]&2048)&&h(r,"aria-checked",p[11]),(!c||m[0]&4096&&l!==(l=p[12]?"checkbox-container":"checkbox-container checkbox-locked"))&&h(r,"class",l),(!c||m[0]&6144)&&Te(r,"is-enabled",p[11])},i(p){c||(b(d),c=!0)},o(p){S(d),c=!1},d(p){p&&x(e),d&&d.d(),u=!1,we(f)}}}function MF(o){let e;return{c(){e=_("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",h(e,"class","setting-item-description mod-warning")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function TF(o){let e;return{c(){e=_("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",h(e,"class","setting-item-description")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function AF(o){let e;return{c(){e=_("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",h(e,"class","setting-item-description")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function FF(o){let e;function t(s,i){return s[12]?AF:s[11]?TF:MF}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){e=_("fragment"),n.c(),h(e,"slot","description")},m(s,i){w(s,e,i),n.m(e,null)},p(s,i){r!==(r=t(s,i))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e,null)))},d(s){s&&x(e),n.d()}}}function M_(o){let e,t,r,n;e=new Ue({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[RF]},$$scope:{ctx:o}}});let s=o[12]&&T_(o);return{c(){U(e.$$.fragment),t=F(),s&&s.c(),r=pe()},m(i,a){R(e,i,a),w(i,t,a),s&&s.m(i,a),w(i,r,a),n=!0},p(i,a){let l={};a[0]&2304|a[3]&8&&(l.$$scope={dirty:a,ctx:i}),e.$set(l),i[12]?s?(s.p(i,a),a[0]&4096&&b(s,1)):(s=T_(i),s.c(),b(s,1),s.m(r.parentNode,r)):s&&(ne(),S(s,1,1,()=>{s=null}),se())},i(i){n||(b(e.$$.fragment,i),b(s),n=!0)},o(i){S(e.$$.fragment,i),S(s),n=!1},d(i){i&&(x(t),x(r)),D(e,i),s&&s.d(i)}}}function EF(o){let e,t;return e=new pc({props:{value:o[8]?o[8].key:"please wait...",disabled:!o[11],placeholder:"please wait...",readonly:!0,copyOnClick:!0,successMessage:"Invite link copied"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.value=r[8]?r[8].key:"please wait..."),n[0]&2048&&(s.disabled=!r[11]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function PF(o){let e;return{c(){e=_("span"),e.textContent="Share key is currently disabled",h(e,"role","button"),h(e,"tabindex","0"),h(e,"class","input-like share-key-disabled-notice svelte-sj7m72")},m(t,r){w(t,e,r)},p:q,i:q,o:q,d(t){t&&x(e)}}}function RF(o){let e,t,r,n,s=[PF,EF],i=[];function a(l,c){return l[11]?1:0}return t=a(o,[-1,-1,-1,-1]),r=i[t]=s[t](o),{c(){e=_("div"),r.c(),h(e,"class","share-key-container svelte-sj7m72")},m(l,c){w(l,e,c),i[t].m(e,null),n=!0},p(l,c){let u=t;t=a(l,c),t===u?i[t].p(l,c):(ne(),S(i[u],1,1,()=>{i[u]=null}),se(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),b(r,1),r.m(e,null))},i(l){n||(b(r),n=!0)},o(l){S(r),n=!1},d(l){l&&x(e),i[t].d()}}}function T_(o){let e,t;return e=new Ue({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[DF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function DF(o){let e,t,r;return{c(){e=_("button"),e.textContent="Rotate key",h(e,"class","mod-destructive")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,It.debounce)(o[49])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function A_(o){let e,t,r,n,s,i,a,l;e=new ze({props:{name:"Plan"}});let c=[OF,UF],u=[];function f(m,v){return m[26]?0:1}r=f(o,[-1,-1,-1,-1]),n=u[r]=c[r](o);let d=o[27]&&o[27].quota>0&&P_(o),p=o[0].provider&&o[0].provider.selfHosted&&R_(o);return{c(){U(e.$$.fragment),t=F(),n.c(),s=F(),d&&d.c(),i=F(),p&&p.c(),a=pe()},m(m,v){R(e,m,v),w(m,t,v),u[r].m(m,v),w(m,s,v),d&&d.m(m,v),w(m,i,v),p&&p.m(m,v),w(m,a,v),l=!0},p(m,v){let g=r;r=f(m,v),r===g?u[r].p(m,v):(ne(),S(u[g],1,1,()=>{u[g]=null}),se(),n=u[r],n?n.p(m,v):(n=u[r]=c[r](m),n.c()),b(n,1),n.m(s.parentNode,s)),m[27]&&m[27].quota>0?d?(d.p(m,v),v[0]&134217728&&b(d,1)):(d=P_(m),d.c(),b(d,1),d.m(i.parentNode,i)):d&&(ne(),S(d,1,1,()=>{d=null}),se()),m[0].provider&&m[0].provider.selfHosted?p?(p.p(m,v),v[0]&1&&b(p,1)):(p=R_(m),p.c(),b(p,1),p.m(a.parentNode,a)):p&&(ne(),S(p,1,1,()=>{p=null}),se())},i(m){l||(b(e.$$.fragment,m),b(n),b(d),b(p),l=!0)},o(m){S(e.$$.fragment,m),S(n),S(d),S(p),l=!1},d(m){m&&(x(t),x(s),x(i),x(a)),D(e,m),u[r].d(m),d&&d.d(m),p&&p.d(m)}}}function UF(o){let e,t;return e=new Ue({props:{name:`Plan: ${o[14].plan}`,description:o[14].cta||"Thanks for supporting Relay development",$$slots:{default:[NF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&16384&&(s.name=`Plan: ${r[14].plan}`),n[0]&16384&&(s.description=r[14].cta||"Thanks for supporting Relay development"),n[0]&16384|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function OF(o){let e,t,r=!o[15].values()[0].active||o[15].values()[0].cancelAt,n,s;e=new Ue({props:{name:`Plan: ${o[14].plan}`,description:"",$$slots:{description:[BF],default:[$F]},$$scope:{ctx:o}}});let i=r&&E_(o);return{c(){U(e.$$.fragment),t=F(),i&&i.c(),n=pe()},m(a,l){R(e,a,l),w(a,t,l),i&&i.m(a,l),w(a,n,l),s=!0},p(a,l){let c={};l[0]&16384&&(c.name=`Plan: ${a[14].plan}`),l[0]&67158016|l[3]&8&&(c.$$scope={dirty:l,ctx:a}),e.$set(c),l[0]&32768&&(r=!a[15].values()[0].active||a[15].values()[0].cancelAt),r?i?(i.p(a,l),l[0]&32768&&b(i,1)):(i=E_(a),i.c(),b(i,1),i.m(n.parentNode,n)):i&&(ne(),S(i,1,1,()=>{i=null}),se())},i(a){s||(b(e.$$.fragment,a),b(i),s=!0)},o(a){S(e.$$.fragment,a),S(i),s=!1},d(a){a&&(x(t),x(n)),D(e,a),i&&i.d(a)}}}function NF(o){let e,t,r;return{c(){e=_("button"),e.textContent="Upgrade",h(e,"class","mod-cta")},m(n,s){w(n,e,s),t||(r=V(e,"click",function(){Ge((0,It.debounce)(o[80]))&&(0,It.debounce)(o[80]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&x(e),t=!1,r()}}}function F_(o){let e,t,r;return{c(){e=_("button"),e.textContent="Cancel",h(e,"class","mod-destructive")},m(n,s){w(n,e,s),t||(r=V(e,"click",function(){Ge((0,It.debounce)(o[79]))&&(0,It.debounce)(o[79]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&x(e),t=!1,r()}}}function $F(o){let e,t,r=o[15].values()[0].active&&!o[15].values()[0].cancelAt,n,s,i,a=r&&F_(o);return{c(){e=_("button"),e.textContent="Manage",t=F(),a&&a.c(),n=pe()},m(l,c){w(l,e,c),w(l,t,c),a&&a.m(l,c),w(l,n,c),s||(i=V(e,"click",function(){Ge((0,It.debounce)(o[78]))&&(0,It.debounce)(o[78]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&32768&&(r=o[15].values()[0].active&&!o[15].values()[0].cancelAt),r?a?a.p(o,c):(a=F_(o),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(l){l&&(x(e),x(t),x(n)),a&&a.d(l),s=!1,i()}}}function BF(o){let e,t=o[14].cta+"",r;return{c(){e=_("fragment"),r=B(t),h(e,"slot","description")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s[0]&16384&&t!==(t=n[14].cta+"")&&Q(r,t)},d(n){n&&x(e)}}}function E_(o){let e,t;return e=new Ue({props:{description:"",$$slots:{name:[HF],default:[VF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&32768|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function VF(o){let e=o[33](o[15].values()[0].cancelAt)+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&32768&&e!==(e=r[33](r[15].values()[0].cancelAt)+"")&&Q(t,e)},d(r){r&&x(t)}}}function HF(o){let e;return{c(){e=_("span"),e.textContent="Status: Cancelled",h(e,"slot","name"),h(e,"class","mod-warning")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function P_(o){let e,t,r,n,s,i,a;e=new ze({props:{name:"Storage"}});let l=[zF,qF],c=[];function u(f,d){return f[27].metered?0:1}return r=u(o,[-1,-1,-1,-1]),n=c[r]=l[r](o),i=new Ft({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[GF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),n.c(),s=F(),U(i.$$.fragment)},m(f,d){R(e,f,d),w(f,t,d),c[r].m(f,d),w(f,s,d),R(i,f,d),a=!0},p(f,d){let p=r;r=u(f,d),r===p?c[r].p(f,d):(ne(),S(c[p],1,1,()=>{c[p]=null}),se(),n=c[r],n?n.p(f,d):(n=c[r]=l[r](f),n.c()),b(n,1),n.m(s.parentNode,s));let m={};d[0]&134217728|d[3]&8&&(m.$$scope={dirty:d,ctx:f}),i.$set(m)},i(f){a||(b(e.$$.fragment,f),b(n),b(i.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(n),S(i.$$.fragment,f),a=!1},d(f){f&&(x(t),x(s)),D(e,f),c[r].d(f),D(i,f)}}}function qF(o){let e,t;return e=new Ft({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[jF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function zF(o){let e,t,r,n,s,i;return e=new n_({props:{diskUsagePercentage:Math.round(o[27].usage*100/o[27].quota)}}),r=new Ft({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[WF]},$$scope:{ctx:o}}}),s=new Ft({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[KF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment)},m(a,l){R(e,a,l),w(a,t,l),R(r,a,l),w(a,n,l),R(s,a,l),i=!0},p(a,l){let c={};l[0]&134217728&&(c.diskUsagePercentage=Math.round(a[27].usage*100/a[27].quota)),e.$set(c);let u={};l[0]&134217728|l[3]&8&&(u.$$scope={dirty:l,ctx:a}),r.$set(u);let f={};l[0]&134217728|l[3]&8&&(f.$$scope={dirty:l,ctx:a}),s.$set(f)},i(a){i||(b(e.$$.fragment,a),b(r.$$.fragment,a),b(s.$$.fragment,a),i=!0)},o(a){S(e.$$.fragment,a),S(r.$$.fragment,a),S(s.$$.fragment,a),i=!1},d(a){a&&(x(t),x(n)),D(e,a),D(r,a),D(s,a)}}}function jF(o){let e;return{c(){e=B("Unmetered by Relay")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function WF(o){let e=pi(o[27].usage)+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=pi(r[27].usage)+"")&&Q(t,e)},d(r){r&&x(t)}}}function KF(o){let e=pi(o[27].quota)+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=pi(r[27].quota)+"")&&Q(t,e)},d(r){r&&x(t)}}}function GF(o){let e=pi(o[27].maxFileSize)+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=pi(r[27].maxFileSize)+"")&&Q(t,e)},d(r){r&&x(t)}}}function R_(o){let e,t,r,n,s,i,a,l;e=new ze({props:{name:"Host"}}),r=new Ue({props:{name:"URL",description:"",$$slots:{default:[JF]},$$scope:{ctx:o}}});let c={ctx:o,current:null,token:null,hasCatch:!1,pending:XF,then:YF,catch:QF,value:86,blocks:[,,,]};Yo(s=o[32](o[0]),c);let u=o[0].provider.publicKey&&O_(o);return{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),c.block.c(),i=F(),u&&u.c(),a=pe()},m(f,d){R(e,f,d),w(f,t,d),R(r,f,d),w(f,n,d),c.block.m(f,c.anchor=d),c.mount=()=>i.parentNode,c.anchor=i,w(f,i,d),u&&u.m(f,d),w(f,a,d),l=!0},p(f,d){o=f;let p={};d[0]&1|d[3]&8&&(p.$$scope={dirty:d,ctx:o}),r.$set(p),c.ctx=o,d[0]&1&&s!==(s=o[32](o[0]))&&Yo(s,c)||ri(c,o,d),o[0].provider.publicKey?u?(u.p(o,d),d[0]&1&&b(u,1)):(u=O_(o),u.c(),b(u,1),u.m(a.parentNode,a)):u&&(ne(),S(u,1,1,()=>{u=null}),se())},i(f){l||(b(e.$$.fragment,f),b(r.$$.fragment,f),b(c.block),b(u),l=!0)},o(f){S(e.$$.fragment,f),S(r.$$.fragment,f);for(let d=0;d<3;d+=1){let p=c.blocks[d];S(p)}S(u),l=!1},d(f){f&&(x(t),x(n),x(i),x(a)),D(e,f),D(r,f),c.block.d(f),c.token=null,c=null,u&&u.d(f)}}}function JF(o){let e=o[0].provider.url+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.url+"")&&Q(t,e)},d(r){r&&x(t)}}}function QF(o){return{c:q,m:q,p:q,i:q,o:q,d:q}}function YF(o){let e,t,r=o[86].level==="warning"&&D_(o);return{c(){r&&r.c(),e=pe()},m(n,s){r&&r.m(n,s),w(n,e,s),t=!0},p(n,s){n[86].level==="warning"?r?(r.p(n,s),s[0]&1&&b(r,1)):(r=D_(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(ne(),S(r,1,1,()=>{r=null}),se())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&x(e),r&&r.d(n)}}}function D_(o){let e,t;return e=new Ue({props:{name:"Status",description:"",$$slots:{default:[ZF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&1|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function U_(o){let e,t,r,n=En(o[86].link.text)+"",s;return{c(){e=_("br"),t=F(),r=_("a"),h(r,"href",s=o[86].link.url)},m(i,a){w(i,e,a),w(i,t,a),w(i,r,a),r.innerHTML=n},p(i,a){a[0]&1&&n!==(n=En(i[86].link.text)+"")&&(r.innerHTML=n),a[0]&1&&s!==(s=i[86].link.url)&&h(r,"href",s)},d(i){i&&(x(e),x(t),x(r))}}}function ZF(o){let e,t,r=En(o[86].status)+"",n,s=o[86].link&&U_(o);return{c(){e=_("p"),t=new Cn(!1),n=F(),s&&s.c(),t.a=n,h(e,"class","mod-warning relay-host-check svelte-sj7m72")},m(i,a){w(i,e,a),t.m(r,e),y(e,n),s&&s.m(e,null)},p(i,a){a[0]&1&&r!==(r=En(i[86].status)+"")&&t.p(r),i[86].link?s?s.p(i,a):(s=U_(i),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(i){i&&x(e),s&&s.d()}}}function XF(o){return{c:q,m:q,p:q,i:q,o:q,d:q}}function O_(o){let e,t,r,n,s,i,a,l,c=[oE,rE,tE,eE],u=[];function f(d,p){return d[4]?0:d[5]?1:d[6]?2:3}return i=f(o,[-1,-1,-1,-1]),a=u[i]=c[i](o),{c(){e=_("div"),t=_("div"),t.textContent="Relay Server Configuration",r=F(),n=_("div"),n.textContent="Copy this configuration to your Relay Server's TOML file.",s=F(),a.c(),h(t,"class","setting-item-name"),h(n,"class","setting-item-description"),h(e,"class","relay-auth-section svelte-sj7m72")},m(d,p){w(d,e,p),y(e,t),y(e,r),y(e,n),y(e,s),u[i].m(e,null),l=!0},p(d,p){let m=i;i=f(d,p),i===m?u[i].p(d,p):(ne(),S(u[m],1,1,()=>{u[m]=null}),se(),a=u[i],a?a.p(d,p):(a=u[i]=c[i](d),a.c()),b(a,1),a.m(e,null))},i(d){l||(b(a),l=!0)},o(d){S(a),l=!1},d(d){d&&x(e),u[i].d()}}}function eE(o){let e;return{c(){e=_("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-sj7m72")},m(t,r){w(t,e,r)},p:q,i:q,o:q,d(t){t&&x(e)}}}function tE(o){let e,t;return e=new _c({props:{toml:o[6]}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.toml=r[6]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function rE(o){let e,t;return{c(){e=_("div"),t=B(o[5]),h(e,"class","error-message svelte-sj7m72")},m(r,n){w(r,e,n),y(e,t)},p(r,n){n[0]&32&&Q(t,r[5])},i:q,o:q,d(r){r&&x(e)}}}function oE(o){let e;return{c(){e=_("div"),e.textContent="Loading configuration...",h(e,"class","loading-message svelte-sj7m72")},m(t,r){w(t,e,r)},p:q,i:q,o:q,d(t){t&&x(e)}}}function N_(o){let e,t,r,n;return e=new ze({props:{name:"Membership"}}),r=new Ue({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[nE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){R(e,s,i),w(s,t,i),R(r,s,i),n=!0},p(s,i){let a={};i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&x(t),D(e,s),D(r,s)}}}function nE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Leave",h(e,"class","mod-warning")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,It.debounce)(o[81])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function $_(o){let e,t,r,n;return e=new ze({props:{name:"Danger zone"}}),r=new Ue({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[aE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){R(e,s,i),w(s,t,i),R(r,s,i),n=!0},p(s,i){let a={};i[0]&32768|i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&x(t),D(e,s),D(r,s)}}}function sE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Destroy",h(e,"class","mod-warning")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,It.debounce)(o[52])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function iE(o){let e,t;return{c(){e=_("button"),e.textContent="Destroy",e.disabled=t=!0,h(e,"class","mod-warning"),h(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){w(r,e,n)},p:q,d(r){r&&x(e)}}}function aE(o){let e,t;function r(i,a){return a[0]&32768&&(e=null),e==null&&(e=i[15].values().length>0&&!i[15].values()[0].cancelAt),e?iE:sE}let n=r(o,[-1,-1,-1,-1]),s=n(o);return{c(){s.c(),t=pe()},m(i,a){s.m(i,a),w(i,t,a)},p(i,a){n===(n=r(i,a))&&s?s.p(i,a):(s.d(1),s=n(i),s&&(s.c(),s.m(t.parentNode,t)))},d(i){i&&x(t),s.d(i)}}}function lE(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v,g,k,L,I,C,M,A,E=!o[14].owner||o[13].filter(o[64]).values().length>1,P,T,$;e=new Mo({props:{items:[{type:"home",onClick:o[66]},{type:"relay",relay:o[0]}]}});let J=o[16]&&b_(o);n=new ze({props:{name:"Shared Folders on this Relay Server",$$slots:{default:[dF]},$$scope:{ctx:o}}});let N=xe(o[21].values()),O=[];for(let z=0;z<N.length;z+=1)O[z]=w_(y_(o,N,z));let te=z=>S(O[z],1,1,()=>{O[z]=null});a=new Ue({props:{description:"",name:"",$$slots:{default:[yF]},$$scope:{ctx:o}}}),d=new ze({props:{name:"Users",$$slots:{default:[_F]},$$scope:{ctx:o}}});let Z=xe(o[9].values().sort(o[34])),Y=[];for(let z=0;z<Z.length;z+=1)Y[z]=C_(h_(o,Z,z));let ge=z=>S(Y[z],1,1,()=>{Y[z]=null});v=new Ue({props:{description:"",name:"",$$slots:{default:[CF]},$$scope:{ctx:o}}}),k=new ze({props:{name:"Sharing",helpText:"Share keys can be shared with collaborators so that they can join the Relay Server. Once you have added all of your collaborators, you can disable the share key to prevent anyone from joining, even if they have the key."}}),I=new Ft({props:{name:o[12]?"Enable key sharing":"Key sharing",$$slots:{description:[FF],default:[LF]},$$scope:{ctx:o}}});let j=o[11]&&M_(o),H=o[25]&&A_(o),X=E&&N_(o),ue=o[28]&&$_(o);return{c(){U(e.$$.fragment),t=F(),J&&J.c(),r=F(),U(n.$$.fragment),s=F();for(let z=0;z<O.length;z+=1)O[z].c();i=F(),U(a.$$.fragment),l=F(),c=_("div"),u=F(),f=_("div"),U(d.$$.fragment),p=F();for(let z=0;z<Y.length;z+=1)Y[z].c();m=F(),U(v.$$.fragment),g=F(),U(k.$$.fragment),L=F(),U(I.$$.fragment),C=F(),j&&j.c(),M=F(),H&&H.c(),A=F(),X&&X.c(),P=F(),ue&&ue.c(),T=pe(),h(c,"class","spacer svelte-sj7m72"),h(f,"class","users-header")},m(z,ee){R(e,z,ee),w(z,t,ee),J&&J.m(z,ee),w(z,r,ee),R(n,z,ee),w(z,s,ee);for(let re=0;re<O.length;re+=1)O[re]&&O[re].m(z,ee);w(z,i,ee),R(a,z,ee),w(z,l,ee),w(z,c,ee),w(z,u,ee),w(z,f,ee),R(d,f,null),w(z,p,ee);for(let re=0;re<Y.length;re+=1)Y[re]&&Y[re].m(z,ee);w(z,m,ee),R(v,z,ee),w(z,g,ee),R(k,z,ee),w(z,L,ee),R(I,z,ee),w(z,C,ee),j&&j.m(z,ee),w(z,M,ee),H&&H.m(z,ee),w(z,A,ee),X&&X.m(z,ee),w(z,P,ee),ue&&ue.m(z,ee),w(z,T,ee),$=!0},p(z,ee){let re={};ee[0]&1&&(re.items=[{type:"home",onClick:z[66]},{type:"relay",relay:z[0]}]),e.$set(re),z[16]?J?(J.p(z,ee),ee[0]&65536&&b(J,1)):(J=b_(z),J.c(),b(J,1),J.m(r.parentNode,r)):J&&(ne(),S(J,1,1,()=>{J=null}),se());let fe={};if(ee[0]&1835008|ee[3]&8&&(fe.$$scope={dirty:ee,ctx:z}),n.$set(fe),ee[0]&7340034|ee[1]&1024|ee[2]&2){N=xe(z[21].values());let Me;for(Me=0;Me<N.length;Me+=1){let ot=y_(z,N,Me);O[Me]?(O[Me].p(ot,ee),b(O[Me],1)):(O[Me]=w_(ot),O[Me].c(),b(O[Me],1),O[Me].m(i.parentNode,i))}for(ne(),Me=N.length;Me<O.length;Me+=1)te(Me);se()}let Le={};ee[0]&7|ee[3]&8&&(Le.$$scope={dirty:ee,ctx:z}),a.$set(Le);let de={};if(ee[0]&8650752|ee[3]&8&&(de.$$scope={dirty:ee,ctx:z}),d.$set(de),ee[0]&25428482|ee[1]&12582920){Z=xe(z[9].values().sort(z[34]));let Me;for(Me=0;Me<Z.length;Me+=1){let ot=h_(z,Z,Me);Y[Me]?(Y[Me].p(ot,ee),b(Y[Me],1)):(Y[Me]=C_(ot),Y[Me].c(),b(Y[Me],1),Y[Me].m(m.parentNode,m))}for(ne(),Me=Z.length;Me<Y.length;Me+=1)ge(Me);se()}let Ee={};ee[0]&16896|ee[3]&8&&(Ee.$$scope={dirty:ee,ctx:z}),v.$set(Ee);let Oe={};ee[0]&4096&&(Oe.name=z[12]?"Enable key sharing":"Key sharing"),ee[0]&6144|ee[3]&8&&(Oe.$$scope={dirty:ee,ctx:z}),I.$set(Oe),z[11]?j?(j.p(z,ee),ee[0]&2048&&b(j,1)):(j=M_(z),j.c(),b(j,1),j.m(M.parentNode,M)):j&&(ne(),S(j,1,1,()=>{j=null}),se()),z[25]?H?(H.p(z,ee),ee[0]&33554432&&b(H,1)):(H=A_(z),H.c(),b(H,1),H.m(A.parentNode,A)):H&&(ne(),S(H,1,1,()=>{H=null}),se()),ee[0]&24577&&(E=!z[14].owner||z[13].filter(z[64]).values().length>1),E?X?(X.p(z,ee),ee[0]&24577&&b(X,1)):(X=N_(z),X.c(),b(X,1),X.m(P.parentNode,P)):X&&(ne(),S(X,1,1,()=>{X=null}),se()),z[28]?ue?(ue.p(z,ee),ee[0]&268435456&&b(ue,1)):(ue=$_(z),ue.c(),b(ue,1),ue.m(T.parentNode,T)):ue&&(ne(),S(ue,1,1,()=>{ue=null}),se())},i(z){if(!$){b(e.$$.fragment,z),b(J),b(n.$$.fragment,z);for(let ee=0;ee<N.length;ee+=1)b(O[ee]);b(a.$$.fragment,z),b(d.$$.fragment,z);for(let ee=0;ee<Z.length;ee+=1)b(Y[ee]);b(v.$$.fragment,z),b(k.$$.fragment,z),b(I.$$.fragment,z),b(j),b(H),b(X),b(ue),$=!0}},o(z){S(e.$$.fragment,z),S(J),S(n.$$.fragment,z),O=O.filter(Boolean);for(let ee=0;ee<O.length;ee+=1)S(O[ee]);S(a.$$.fragment,z),S(d.$$.fragment,z),Y=Y.filter(Boolean);for(let ee=0;ee<Y.length;ee+=1)S(Y[ee]);S(v.$$.fragment,z),S(k.$$.fragment,z),S(I.$$.fragment,z),S(j),S(H),S(X),S(ue),$=!1},d(z){z&&(x(t),x(r),x(s),x(i),x(l),x(c),x(u),x(f),x(p),x(m),x(g),x(L),x(C),x(M),x(A),x(P),x(T)),D(e,z),J&&J.d(z),D(n,z),qe(O,z),D(a,z),D(d),qe(Y,z),D(v,z),D(k,z),D(I,z),j&&j.d(z),H&&H.d(z),X&&X.d(z),ue&&ue.d(z)}}}function pi(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,n)).toFixed(e)+" "+r[n]}function cE(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function uE(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function fE(o,e,t){let r,n,s,i,a,l=q,c=()=>(l(),l=At(z,oe=>t(13,a=oe)),z),u,f=q,d=()=>(f(),f=At(O,oe=>t(14,u=oe)),O),p,m,v,g,k,L,I,C,M=q,A=()=>(M(),M=At(ue,oe=>t(22,C=oe)),ue),E,P,T,$,J,N;o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>M());let{relay:O}=e;d();let te=O.folders;le(o,te,oe=>t(21,I=oe));let Z=Ie(!1);le(o,Z,oe=>t(20,L=oe));let{plugin:Y}=e,ge=!1,j=null,H="",X=Xe([te,Y.relayManager.relayRoles,Y.relayManager.folderRoles],([oe,$e,Qe])=>{let Ct=Array.from(oe.values()),Hr=Ct.filter(qr=>wo(Y.relayManager.userCan(["folder","read_content"],qr))),br=Ct.filter(qr=>wo(Y.relayManager.userCan(["folder","manage_users"],qr)));return Hr.length!==br.length});le(o,X,oe=>t(19,k=oe));let{sharedFolders:ue}=e;A();let{relayRoles:z}=e;c(),Y.relayManager.refreshRelay(O);function ee(oe){return Ae(this,void 0,void 0,function*(){let $e=yield Y.loginManager.checkRelayHost(oe.guid);if($e.status===200)return $e.json})}function re(oe){if(!oe)return"Active";let $e=pm.moment.utc(),Qe=pm.moment.utc(oe),Ct=Qe.diff($e,"days");return Ct<=0?"Subscription has ended":Ct===1?"Active for 1 more day":Ct>31?`Ends on ${Qe.format("YYYY-MM-DD")}`:`Active for ${Ct} more days`}function fe(oe,$e){var Qe;return oe.role==="Owner"&&$e.role==="Owner"?oe.userId===((Qe=Y.loginManager.user)===null||Qe===void 0?void 0:Qe.id)?-1:1:oe.role==="Owner"&&$e.role!=="Owner"?-1:oe.role!=="Owner"&&$e.role==="Owner"||oe.user.name>$e.user.name?1:-1}let Le=Xe([Y.relayManager.roles],([oe])=>oe.values().sort(cE));le(o,Le,oe=>t(24,P=oe));let de=u.subscriptions;le(o,de,oe=>t(15,p=oe));let Ee=Xe(p,oe=>{if(oe.values().length===0)return;let $e=oe.values()[0];return $e.token||Y.relayManager.getSubscriptionToken($e).then(Qe=>{$e.token=Qe}),$e});le(o,Ee,oe=>t(26,$=oe));let Oe=u.storageQuota;le(o,Oe,oe=>t(27,J=oe));let Me=a.filter(oe=>oe.relayId===O.id);le(o,Me,oe=>t(9,r=oe));let ot=Ie(!0);le(o,ot,oe=>t(10,n=oe));let at;lt(()=>{at&&at.value===""&&at.focus()});let Dt=Ye();function Eo(){return Ae(this,void 0,void 0,function*(){var oe,$e;if(!(!((oe=Y.relayManager)===null||oe===void 0)&&oe.pb)){t(5,j="Not connected to relay service");return}t(4,ge=!0),t(5,j=null);try{let Qe=Y.relayManager.pb.baseUrl+`/api/collections/relays/records/${O.id}/relay.toml`,Hr=yield(yield it(Qe,{method:"GET",headers:{Authorization:Y.relayManager.pb.authStore.token?`Bearer ${Y.relayManager.pb.authStore.token}`:""}})).text();t(6,H=Hr.replace(/\{url\}/g,(($e=O.provider)===null||$e===void 0?void 0:$e.url)||""))}catch(Qe){t(5,j=Qe instanceof Error?Qe.message:"Failed to fetch relay configuration")}finally{t(4,ge=!1)}})}lt(()=>{var oe;at&&at.value===""&&at.focus(),!((oe=O.provider)===null||oe===void 0)&&oe.selfHosted&&Eo()});function Ir(oe){return Ae(this,void 0,void 0,function*(){var $e;if(!(!(($e=Y.loginManager)===null||$e===void 0)&&$e.user))return;let Qe={relay:oe.id,quantity:10,user_email:Y.loginManager.user.email},Ct=btoa(JSON.stringify(Qe)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(Y.buildApiUrl(`/subscribe/${Ct}`),"_blank")})}function Cr(oe){return Ae(this,void 0,void 0,function*(){let $e=oe.token,Qe=oe.id;window.open(Y.buildApiUrl(`/subscriptions/${Qe}/manage?token=${$e}`),"_blank")})}function io(oe){return Ae(this,void 0,void 0,function*(){let $e=oe.token,Qe=oe.id;window.open(Y.buildApiUrl(`/subscriptions/${Qe}/cancel?token=${$e}`),"_blank")})}function qt(oe){i&&(Lr.set(oe),Y.relayManager.toggleRelayInvitation(yr,s).then($e=>{Lr.set($e.enabled)}).catch($e=>{Lr.set(!oe),Jt($e,"Failed to toggle share key")}))}function on(){return Ae(this,void 0,void 0,function*(){Y.relayManager.leaveRelay(O),Dt("goBack",{clear:!0})})}function ms(){return Ae(this,void 0,void 0,function*(){Dt("goBack",{clear:!0})})}let yr,Lr=Ie(!0);le(o,Lr,oe=>t(11,s=oe));let ao=Ie(!1);le(o,ao,oe=>t(23,E=oe)),Y.relayManager.getRelayInvitation(O).then(oe=>{oe&&(t(8,yr=oe),Lr.set(oe.enabled))});function Un(){return Ae(this,void 0,void 0,function*(){if(yr)try{t(8,yr=yield Y.relayManager.rotateKey(yr))}catch(oe){Jt(oe,"Failed to rotate key.")}})}let lo=Ie(!1);le(o,lo,oe=>t(17,v=oe));let On=Y.timeProvider.debounce(()=>{Y.relayManager.updateRelay(O).then(()=>{lo.set(!1)})},500);function ke(){ot.set(uE(at.value)),n&&at.value!==""&&(lo.set(!0),On())}function Ke(){Y.relayManager.destroyRelay(O),Dt("goBack",{})}function et(oe){Y.relayManager.kick(oe).catch($e=>{Jt($e,"Failed to remove user")})}function Mr(oe,$e){return Ae(this,void 0,void 0,function*(){try{yield Y.relayManager.updateRelayRole(oe,$e)}catch(Qe){throw Jt(Qe,"Failed to change user role."),Qe}})}function nn(oe){return Ae(this,void 0,void 0,function*(){let $e=oe.target,Qe=r.get($e.dataset.roleId);if(Qe){let Ct=Qe.role;try{yield Mr(Qe,$e.value)}catch(Hr){$e.value=Ct}}})}function ae(oe){(oe instanceof MouseEvent||oe instanceof KeyboardEvent&&(oe.key==="Enter"||oe.key===" "))&&ao.update($e=>!$e)}let Ne=Y.relayManager.userCan(["relay","manage_users"],O);le(o,Ne,oe=>t(18,g=oe));let dt=Y.relayManager.userCan(["relay","manage_sharing"],O);le(o,dt,oe=>t(12,i=oe));let Vr=Y.relayManager.userCan(["relay","rename"],O);le(o,Vr,oe=>t(16,m=oe));let ir=Y.relayManager.userCan(["relay","delete"],O);le(o,ir,oe=>t(28,N=oe));let Fa=Y.relayManager.userCan(["subscription","manage"],O);le(o,Fa,oe=>t(25,T=oe));function xi(oe,$e,Qe,Ct){return Ae(this,void 0,void 0,function*(){let Hr=(0,It.normalizePath)(oe),br=ue.find(Si=>Si.path==Hr);if(Y.vault.getFolderByPath(Hr)===null&&(yield Y.vault.createFolder(Hr)),br)br.relayId=O.guid;else{let Si=Ms();br=ue.new(Hr,Si,O.guid,!0)}let qr=yield Y.relayManager.createRemoteFolder(br,O,Qe!=null?Qe:!1,$e);if(Qe&&Ct&&Ct.length>0)for(let Si of Ct)yield Y.relayManager.addFolderRole(qr,Si,"Member");return br.remote=qr,br.connect(),Y.sharedFolders.notifyListeners(),Ct&&Ct.length>0&&setTimeout(()=>{Dt("manageRemoteFolder",{remoteFolder:qr})},100),br})}let ce=new vc(Y.app,O,ue,Y.relayManager,xi);function Ve(oe){return Ae(this,void 0,void 0,function*(){function $e(Qe,Ct,Hr){return Ae(this,void 0,void 0,function*(){let br=(0,It.normalizePath)((0,B_.join)(Hr,Ct));Y.vault.getFolderByPath(br)===null&&(yield Y.vault.createFolder(br));let qr=Y.sharedFolders.new(br,Qe.guid,Qe.relay.guid,!0);return qr.remote=Qe,Y.sharedFolders.notifyListeners(),Dt("manageRemoteFolder",{remoteFolder:qr.remote}),qr})}new Fn(Y.app,Y.sharedFolders,oe,[],$e).open()})}os(()=>{ce==null||ce.destroy()});let mt=oe=>oe.role==="Owner"&&oe.relayId===O.id,gt=(oe,$e)=>$e.guid===oe.guid,ar=()=>Dt("goBack",{clear:!0});function sn(){O.name=this.value,d(t(0,O))}function wi(oe){vt[oe?"unshift":"push"](()=>{at=oe,t(7,at)})}let q1=()=>Z.update(oe=>!oe),z1=oe=>{Dt("manageRemoteFolder",{remoteFolder:oe})},j1=oe=>{Ve(oe)},W1=oe=>{Dt("manageRemoteFolder",{remoteFolder:oe})},K1=()=>{O.version===0?new di(Y.app,"Choose or create folder...",new Set(ue.filter($e=>!!$e.relayId).map($e=>$e.path)).add("/"),ue,xi).open():ce.open()},G1=oe=>{et(oe)},J1=oe=>qt(oe.currentTarget.checked),Q1=()=>qt(!s),Y1=()=>qt(!s),Z1=()=>{Cr($)},X1=()=>{io($)},e0=()=>{Ir(u)},t0=()=>{on()};return o.$$set=oe=>{"relay"in oe&&d(t(0,O=oe.relay)),"plugin"in oe&&t(1,Y=oe.plugin),"sharedFolders"in oe&&A(t(2,ue=oe.sharedFolders)),"relayRoles"in oe&&c(t(3,z=oe.relayRoles))},[O,Y,ue,z,ge,j,H,at,yr,r,n,s,i,a,u,p,m,v,g,k,L,I,C,E,P,T,$,J,N,te,Z,X,ee,re,fe,Le,de,Ee,Oe,Me,ot,Dt,Ir,Cr,io,qt,on,Lr,ao,Un,lo,ke,Ke,et,nn,ae,Ne,dt,Vr,ir,Fa,xi,ce,Ve,mt,gt,ar,sn,wi,q1,z1,j1,W1,K1,G1,J1,Q1,Y1,Z1,X1,e0,t0]}var mm=class extends K{constructor(e){super(),G(this,e,fE,lE,W,{relay:0,plugin:1,sharedFolders:2,relayRoles:3},uF,[-1,-1,-1,-1])}},mi=mm;function dE(o){let e,t,r,n,s,i;return r=new hd({}),{c(){e=_("div"),t=_("div"),U(r.$$.fragment),h(t,"class","clickable-icon"),h(t,"aria-label","Back"),h(t,"tabindex","0"),h(t,"role","button"),h(e,"class","modal-setting-nav-bar")},m(a,l){w(a,e,l),y(e,t),R(r,t,null),n=!0,s||(i=[V(t,"click",o[0]),V(t,"keypress",o[1])],s=!0)},p:q,i(a){n||(b(r.$$.fragment,a),n=!0)},o(a){S(r.$$.fragment,a),n=!1},d(a){a&&x(e),D(r),s=!1,we(i)}}}function pE(o){let e=Ye();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var hm=class extends K{constructor(e){super(),G(this,e,pE,dE,W,{})}},V_=hm;var ym=require("obsidian");function H_(o){let e,t,r,n,s,i;return e=new ze({props:{name:"Danger zone"}}),r=new Ue({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[mE]},$$scope:{ctx:o}}}),s=new Ue({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[hE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment)},m(a,l){R(e,a,l),w(a,t,l),R(r,a,l),w(a,n,l),R(s,a,l),i=!0},p(a,l){let c={};l&256&&(c.$$scope={dirty:l,ctx:a}),r.$set(c);let u={};l&256&&(u.$$scope={dirty:l,ctx:a}),s.$set(u)},i(a){i||(b(e.$$.fragment,a),b(r.$$.fragment,a),b(s.$$.fragment,a),i=!0)},o(a){S(e.$$.fragment,a),S(r.$$.fragment,a),S(s.$$.fragment,a),i=!1},d(a){a&&(x(t),x(n)),D(e,a),D(r,a),D(s,a)}}}function mE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Delete metadata",h(e,"class","mod-destructive")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,ym.debounce)(o[6])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function hE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,ym.debounce)(o[7])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function gE(o){let e,t,r,n,s,i;e=new Mo({props:{items:[{type:"home",onClick:o[5]},{type:"folder",folder:o[0]}]}});let a=o[0]&&H_(o);return{c(){U(e.$$.fragment),t=F(),r=_("div"),r.innerHTML=`<p style="margin: 1em; text-align: center">This Shared Folder is not on a Relay Server, or else you do not have
		permission to access it.</p>`,n=F(),a&&a.c(),s=pe(),me(r,"padding","1em"),me(r,"margin","1em"),me(r,"background","var(--background-secondary)")},m(l,c){R(e,l,c),w(l,t,c),w(l,r,c),w(l,n,c),a&&a.m(l,c),w(l,s,c),i=!0},p(l,[c]){let u={};c&1&&(u.items=[{type:"home",onClick:l[5]},{type:"folder",folder:l[0]}]),e.$set(u),l[0]?a?(a.p(l,c),c&1&&b(a,1)):(a=H_(l),a.c(),b(a,1),a.m(s.parentNode,s)):a&&(ne(),S(a,1,1,()=>{a=null}),se())},i(l){i||(b(e.$$.fragment,l),b(a),i=!0)},o(l){S(e.$$.fragment,l),S(a),i=!1},d(l){l&&(x(t),x(r),x(n),x(s)),D(e,l),a&&a.d(l)}}}function yE(o,e,t){let{plugin:r}=e,{sharedFolder:n}=e,s=Ye();function i(){return Ae(this,void 0,void 0,function*(){n&&r.sharedFolders.delete(n),s("goBack",{clear:!0})})}function a(){if(n){let f=r.vault.getFolderByPath(n.path);f&&r.app.vault.trash(f,!1)}s("goBack",{})}let l=()=>s("goBack",{clear:!0}),c=()=>{i()},u=()=>{a()};return o.$$set=f=>{"plugin"in f&&t(4,r=f.plugin),"sharedFolder"in f&&t(0,n=f.sharedFolder)},[n,s,i,a,r,l,c,u]}var gm=class extends K{constructor(e){super(),G(this,e,yE,gE,W,{plugin:4,sharedFolder:0})}},xc=gm;var Ao=require("obsidian");var yx=require("obsidian"),bx=an(Nn());var K_=require("obsidian");function bE(o){Ce(o,"svelte-1iq1qoa",".search-container.svelte-1iq1qoa.svelte-1iq1qoa{margin-bottom:16px}.search-input.svelte-1iq1qoa.svelte-1iq1qoa{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;max-height:400px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);margin-bottom:16px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);cursor:pointer;gap:12px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:last-child{border-bottom:none}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:hover:not(.has-access){background:var(--background-modifier-hover)}.user-item.has-access.svelte-1iq1qoa.svelte-1iq1qoa{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-1iq1qoa.svelte-1iq1qoa{margin:0;cursor:pointer}.user-avatar.svelte-1iq1qoa.svelte-1iq1qoa{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-1iq1qoa img.svelte-1iq1qoa{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;min-width:0}.user-name.svelte-1iq1qoa.svelte-1iq1qoa{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-1iq1qoa.svelte-1iq1qoa{font-size:0.8em;color:var(--text-muted);font-style:italic}.no-users.svelte-1iq1qoa.svelte-1iq1qoa{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;justify-content:space-between;align-items:center;margin-top:16px}.selection-count.svelte-1iq1qoa.svelte-1iq1qoa{color:var(--text-muted);font-size:0.9em}button.svelte-1iq1qoa.svelte-1iq1qoa:disabled{opacity:0.5;cursor:not-allowed}")}function q_(o,e,t){let r=o.slice();return r[22]=e[t],r}function vE(o){let e,t=xe(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=z_(q_(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=pe()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);w(n,e,s)},p(n,s){if(s&130){t=xe(n[1]);let i;for(i=0;i<t.length;i+=1){let a=q_(n,t,i);r[i]?r[i].p(a,s):(r[i]=z_(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&x(e),qe(r,n)}}}function _E(o){let e,t=o[0]?"No users found":"No users available",r;return{c(){e=_("div"),r=B(t),h(e,"class","no-users svelte-1iq1qoa")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0]?"No users found":"No users available")&&Q(r,t)},d(n){n&&x(e)}}}function xE(o){let e=j_(o[22].user.name)+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&2&&e!==(e=j_(r[22].user.name)+"")&&Q(t,e)},d(r){r&&x(t)}}}function wE(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[22].user.picture)||h(e,"src",t),h(e,"alt",r=o[22].user.name),h(e,"class","svelte-1iq1qoa")},m(n,s){w(n,e,s)},p(n,s){s&2&&!dr(e.src,t=n[22].user.picture)&&h(e,"src",t),s&2&&r!==(r=n[22].user.name)&&h(e,"alt",r)},d(n){n&&x(e)}}}function SE(o){let e;return{c(){e=_("div"),e.textContent="(You)",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function kE(o){let e;return{c(){e=_("div"),e.textContent="Already has access",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function z_(o){let e,t,r,n,s,i,a,l,c,u=o[22].user.name+"",f,d,p,m,v;function g(...T){return o[14](o[22],...T)}function k(T,$){return T[22].user.picture?wE:xE}let L=k(o,-1),I=L(o);function C(T,$){if(T[22].hasAccess)return kE;if(T[22].isCurrentUser)return SE}let M=C(o,-1),A=M&&M(o);function E(){return o[15](o[22])}function P(...T){return o[16](o[22],...T)}return{c(){e=_("div"),t=_("input"),s=F(),i=_("div"),I.c(),a=F(),l=_("div"),c=_("div"),f=B(u),d=F(),A&&A.c(),p=F(),h(t,"type","checkbox"),t.checked=r=o[22].selected,t.disabled=n=o[22].hasAccess,h(t,"class","user-checkbox svelte-1iq1qoa"),h(i,"class","user-avatar svelte-1iq1qoa"),h(c,"class","user-name svelte-1iq1qoa"),h(l,"class","user-info svelte-1iq1qoa"),h(e,"class","user-item svelte-1iq1qoa"),h(e,"role","button"),h(e,"tabindex","0"),Te(e,"has-access",o[22].hasAccess),Te(e,"is-owner",o[22].isOwner),Te(e,"is-current-user",o[22].isCurrentUser)},m(T,$){w(T,e,$),y(e,t),y(e,s),y(e,i),I.m(i,null),y(e,a),y(e,l),y(l,c),y(c,f),y(e,d),A&&A.m(e,null),y(e,p),m||(v=[V(t,"click",g),V(e,"click",E),V(e,"keydown",P)],m=!0)},p(T,$){o=T,$&2&&r!==(r=o[22].selected)&&(t.checked=r),$&2&&n!==(n=o[22].hasAccess)&&(t.disabled=n),L===(L=k(o,$))&&I?I.p(o,$):(I.d(1),I=L(o),I&&(I.c(),I.m(i,null))),$&2&&u!==(u=o[22].user.name+"")&&Q(f,u),M!==(M=C(o,$))&&(A&&A.d(1),A=M&&M(o),A&&(A.c(),A.m(e,p))),$&2&&Te(e,"has-access",o[22].hasAccess),$&2&&Te(e,"is-owner",o[22].isOwner),$&2&&Te(e,"is-current-user",o[22].isCurrentUser)},d(T){T&&x(e),I.d(),A&&A.d(),m=!1,we(v)}}}function IE(o){let e,t,r,n,s,i,a,l,c,u,f=o[2]===0?"No users selected":`${o[2]} user${o[2]===1?"":"s"} selected`,d,p,m,v,g,k,L;function I(A,E){return A[1].length===0?_E:vE}let C=I(o,-1),M=C(o);return{c(){e=_("div"),e.textContent="Invite users to this folder",t=F(),r=_("div"),n=_("div"),s=_("input"),i=F(),a=_("div"),M.c(),l=F(),c=_("div"),u=_("span"),d=B(f),p=F(),m=_("button"),v=B("Add Users"),h(e,"class","modal-title"),h(s,"type","text"),h(s,"placeholder","Search users by name..."),h(s,"class","search-input svelte-1iq1qoa"),h(n,"class","search-container svelte-1iq1qoa"),h(a,"class","user-list svelte-1iq1qoa"),h(u,"class","selection-count svelte-1iq1qoa"),h(m,"class","mod-cta svelte-1iq1qoa"),m.disabled=g=o[2]===0,h(c,"class","modal-button-container svelte-1iq1qoa"),h(r,"class","modal-content user-select-modal")},m(A,E){w(A,e,E),w(A,t,E),w(A,r,E),y(r,n),y(n,s),Je(s,o[0]),y(r,i),y(r,a),M.m(a,null),y(r,l),y(r,c),y(c,u),y(u,d),y(c,p),y(c,m),y(m,v),k||(L=[V(s,"input",o[13]),V(m,"click",o[8])],k=!0)},p(A,[E]){E&1&&s.value!==A[0]&&Je(s,A[0]),C===(C=I(A,E))&&M?M.p(A,E):(M.d(1),M=C(A),M&&(M.c(),M.m(a,null))),E&4&&f!==(f=A[2]===0?"No users selected":`${A[2]} user${A[2]===1?"":"s"} selected`)&&Q(d,f),E&4&&g!==(g=A[2]===0)&&(m.disabled=g)},i:q,o:q,d(A){A&&(x(e),x(t),x(r)),M.d(),k=!1,we(L)}}}function j_(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function CE(o,e,t){let r,n,s,i,{relayManager:a}=e,{folder:l}=e,{onAdd:c}=e,{preSelectedUserIds:u=[]}=e,f=Ie(new Set([...u]));le(o,f,T=>t(17,r=T));let d=Ie("");le(o,d,T=>t(0,n=T));let p=Xe([a.relayRoles],([T])=>T.values().filter($=>$.relayId===l.relayId).map($=>$.user)),m=Xe([a.folderRoles],([T])=>T.values().filter($=>$.sharedFolderId===l.id)),v=Xe([p,m,f],([T,$,J])=>{var N;let O=new Set($.map(Y=>Y.userId)),te=new Set($.filter(Y=>Y.role==="Owner").map(Y=>Y.userId)),Z=(N=a.user)===null||N===void 0?void 0:N.id;return T.map(Y=>{let ge=te.has(Y.id),j=Z===Y.id,H=J.has(Y.id);return{user:Y,hasAccess:O.has(Y.id),selected:H,isOwner:ge,isCurrentUser:j}})}),g=Xe([v,d],([T,$])=>{if(!$)return T;let J=$.toLowerCase();return T.filter(N=>N.user.name.toLowerCase().includes(J))}),k=Xe([g],([T])=>T.sort(($,J)=>$.hasAccess&&!J.hasAccess?1:!$.hasAccess&&J.hasAccess?-1:$.user.name.localeCompare(J.user.name)));le(o,k,T=>t(1,s=T));let L=Xe([f],([T])=>T.size);le(o,L,T=>t(2,i=T));function I(T){T.hasAccess||f.update($=>{let J=new Set($);return J.has(T.user.id)?J.delete(T.user.id):J.add(T.user.id),J})}function C(){return Ae(this,void 0,void 0,function*(){let T=r;if(T.size!==0)try{yield c(Array.from(T),"Member")}catch($){Jt($)}})}function M(){n=this.value,d.set(n)}let A=(T,$)=>{$.stopPropagation(),I(T)},E=T=>I(T),P=(T,$)=>{($.key==="Enter"||$.key===" ")&&($.preventDefault(),I(T))};return o.$$set=T=>{"relayManager"in T&&t(9,a=T.relayManager),"folder"in T&&t(10,l=T.folder),"onAdd"in T&&t(11,c=T.onAdd),"preSelectedUserIds"in T&&t(12,u=T.preSelectedUserIds)},[n,s,i,f,d,k,L,I,C,a,l,c,u,M,A,E,P]}var bm=class extends K{constructor(e){super(),G(this,e,CE,IE,W,{relayManager:9,folder:10,onAdd:11,preSelectedUserIds:12},bE)}},W_=bm;var wc=class extends K_.Modal{constructor(t,r,n,s,i){super(t);this.relayManager=r;this.folder=n;this.onAdd=s;this.preSelectedUserIds=i}onOpen(){let{contentEl:t}=this;this.component=new W_({target:t,props:{relayManager:this.relayManager,folder:this.folder,preSelectedUserIds:this.preSelectedUserIds,onAdd:async(r,n)=>{await this.onAdd(r,n),this.close()}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function LE(o){Ce(o,"svelte-fmnezc",`div.spacer.svelte-fmnezc{height:3em}.local-settings.svelte-fmnezc{margin-left:-1em;padding-left:1em;border-left:1px solid var(--color-accent)}.system3-input-invalid.svelte-fmnezc{border:1px solid var(--color-red) !important}input.system3-updating.svelte-fmnezc{border:1px solid var(--color-accent) !important}.edit-members-button.svelte-fmnezc{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-fmnezc:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-fmnezc:focus{outline:none;color:var(--icon-color-focus)}select.dropdown.svelte-fmnezc:disabled{opacity:1 !important;color:var(--text-muted) !important;-webkit-text-fill-color:var(--text-muted) !important}`)}function G_(o,e,t){let r=o.slice();return r[68]=e[t][0],r[69]=e[t][1],r}function J_(o,e,t){let r=o.slice();return r[72]=e[t],r}function Q_(o,e,t){let r=o.slice();return r[72]=e[t],r}function Y_(o){let e;return{c(){e=_("div"),e.innerHTML=`<p style="margin: 1em; text-align: center">As Relay Server owner, you can manage this Shared Folder but cannot access
			its contents. You must be added to the Shared Folder in order to
			collaborate.</p>`,me(e,"padding","1em"),me(e,"margin","1em"),me(e,"background","var(--background-secondary)")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function Z_(o){let e,t;return e=new Ue({props:{name:"Name",description:"Set the Shared Folder's default name. A Shared Folder can always be renamed locally.",$$slots:{default:[ME]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&33048|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function ME(o){let e,t,r,n;return{c(){e=_("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=kt((o[15]?"system3-updating":"")+(o[8]?"":" system3-input-invalid"))+" svelte-fmnezc")},m(s,i){w(s,e,i),Je(e,o[3]),o[56](e),r||(n=[V(e,"input",o[55]),V(e,"input",o[48])],r=!0)},p(s,i){i[0]&33024&&t!==(t=kt((s[15]?"system3-updating":"")+(s[8]?"":" system3-input-invalid"))+" svelte-fmnezc")&&h(e,"class",t),i[0]&8&&e.value!==s[3]&&Je(e,s[3])},d(s){s&&x(e),o[56](null),r=!1,we(n)}}}function X_(o){let e,t,r,n;return e=new ze({props:{name:"Add to vault"}}),r=new Ue({props:{name:"Add this folder to your vault",description:"Download and sync this folder to your local device",$$slots:{default:[TE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){R(e,s,i),w(s,t,i),R(r,s,i),n=!0},p(s,i){let a={};i[2]&32768&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&x(t),D(e,s),D(r,s)}}}function TE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Add to vault",h(e,"class","mod-cta")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,Ao.debounce)(o[47])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function ex(o){let e,t,r,n,s;e=new ze({props:{name:"Users with access",helpText:o[7]?"":"This folder is accessible to everyone on this Relay Server.",$$slots:{default:[EE]},$$scope:{ctx:o}}});let i=xe(o[9]),a=[];for(let u=0;u<i.length;u+=1)a[u]=nx(J_(o,i,u));let l=u=>S(a[u],1,1,()=>{a[u]=null}),c=o[7]&&o[12]&&sx(o);return{c(){U(e.$$.fragment),t=F();for(let u=0;u<a.length;u+=1)a[u].c();r=F(),c&&c.c(),n=pe()},m(u,f){R(e,u,f),w(u,t,f);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(u,f);w(u,r,f),c&&c.m(u,f),w(u,n,f),s=!0},p(u,f){let d={};if(f[0]&128&&(d.helpText=u[7]?"":"This folder is accessible to everyone on this Relay Server."),f[0]&135172|f[2]&32768&&(d.$$scope={dirty:f,ctx:u}),e.$set(d),f[0]&397952|f[1]&36864){i=xe(u[9]);let p;for(p=0;p<i.length;p+=1){let m=J_(u,i,p);a[p]?(a[p].p(m,f),b(a[p],1)):(a[p]=nx(m),a[p].c(),b(a[p],1),a[p].m(r.parentNode,r))}for(ne(),p=i.length;p<a.length;p+=1)l(p);se()}u[7]&&u[12]?c?(c.p(u,f),f[0]&4224&&b(c,1)):(c=sx(u),c.c(),b(c,1),c.m(n.parentNode,n)):c&&(ne(),S(c,1,1,()=>{c=null}),se())},i(u){if(!s){b(e.$$.fragment,u);for(let f=0;f<i.length;f+=1)b(a[f]);b(c),s=!0}},o(u){S(e.$$.fragment,u),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)S(a[f]);S(c),s=!1},d(u){u&&(x(t),x(r),x(n)),D(e,u),qe(a,u),c&&c.d(u)}}}function tx(o){let e,t,r,n,s,i,a,l=[FE,AE],c=[];function u(f,d){return f[17]?0:1}return t=u(o,[-1,-1,-1]),r=c[t]=l[t](o),{c(){e=_("div"),r.c(),h(e,"class","edit-members-button svelte-fmnezc"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[17]?"Cancel editing users":"Edit users")},m(f,d){w(f,e,d),c[t].m(e,null),s=!0,i||(a=[V(e,"click",o[42]),V(e,"keypress",o[42])],i=!0)},p(f,d){let p=t;t=u(f,d),t!==p&&(ne(),S(c[p],1,1,()=>{c[p]=null}),se(),r=c[t],r||(r=c[t]=l[t](f),r.c()),b(r,1),r.m(e,null)),(!s||d[0]&131072&&n!==(n=f[17]?"Cancel editing users":"Edit users"))&&h(e,"aria-label",n)},i(f){s||(b(r),s=!0)},o(f){S(r),s=!1},d(f){f&&x(e),c[t].d(),i=!1,we(a)}}}function AE(o){let e,t;return e=new ga({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function FE(o){let e,t;return e=new ua({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function EE(o){let e,t,r=o[2].private&&o[12]&&tx(o);return{c(){r&&r.c(),e=pe()},m(n,s){r&&r.m(n,s),w(n,e,s),t=!0},p(n,s){n[2].private&&n[12]?r?(r.p(n,s),s[0]&4100&&b(r,1)):(r=tx(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(ne(),S(r,1,1,()=>{r=null}),se())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&x(e),r&&r.d(n)}}}function rx(o){let e;function t(s,i){return s[17]?DE:s[12]?RE:PE}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=pe()},m(s,i){n.m(s,i),w(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n.d(s)}}}function PE(o){let e,t=o[72].role+"",r;return{c(){e=_("span"),r=B(t),h(e,"class","role-label")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s[0]&512&&t!==(t=n[72].role+"")&&Q(r,t)},d(n){n&&x(e)}}}function RE(o){let e,t,r,n,s,i,a=xe(o[18]),l=[];for(let c=0;c<a.length;c+=1)l[c]=ox(Q_(o,a,c));return{c(){e=_("div"),t=_("select");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","dropdown svelte-fmnezc"),h(t,"data-role-id",n=o[72].id),me(e,"display","flex"),me(e,"gap","8px"),me(e,"align-items","center")},m(c,u){w(c,e,u),y(e,t);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(t,null);Ln(t,o[72].role),s||(i=V(t,"change",o[46]),s=!0)},p(c,u){if(u[0]&262144){a=xe(c[18]);let f;for(f=0;f<a.length;f+=1){let d=Q_(c,a,f);l[f]?l[f].p(d,u):(l[f]=ox(d),l[f].c(),l[f].m(t,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=a.length}u[0]&262656&&r!==(r=c[72].role)&&Ln(t,c[72].role),u[0]&262656&&n!==(n=c[72].id)&&h(t,"data-role-id",n)},d(c){c&&x(e),qe(l,c),s=!1,i()}}}function DE(o){let e,t,r;function n(){return o[57](o[72])}return{c(){e=_("button"),e.textContent="Remove",h(e,"class","mod-destructive")},m(s,i){w(s,e,i),t||(r=V(e,"click",function(){Ge((0,Ao.debounce)(n))&&(0,Ao.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&x(e),t=!1,r()}}}function ox(o){let e,t=o[72].name+"",r,n;return{c(){e=_("option"),r=B(t),e.__value=n=o[72].name,Je(e,e.__value)},m(s,i){w(s,e,i),y(e,r)},p(s,i){i[0]&262144&&t!==(t=s[72].name+"")&&Q(r,t),i[0]&262144&&n!==(n=s[72].name)&&(e.__value=n,Je(e,e.__value))},d(s){s&&x(e)}}}function UE(o){let e,t=o[7]&&rx(o);return{c(){t&&t.c(),e=pe()},m(r,n){t&&t.m(r,n),w(r,e,n)},p(r,n){r[7]?t?t.p(r,n):(t=rx(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&x(e),t&&t.d(r)}}}function nx(o){let e,t;return e=new ci({props:{user:o[72].user,$$slots:{default:[UE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.user=r[72].user),n[0]&397952|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function sx(o){let e,t;return e=new Ue({props:{description:"",name:"",$$slots:{default:[OE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&131072|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function OE(o){let e,t,r,n;return{c(){e=_("button"),t=B("Add User"),h(e,"class","mod-cta"),h(e,"aria-label","Add user to private folder"),e.disabled=o[17]},m(s,i){w(s,e,i),y(e,t),r||(n=V(e,"click",(0,Ao.debounce)(o[45])),r=!0)},p(s,i){i[0]&131072&&(e.disabled=s[17])},d(s){s&&x(e),r=!1,n()}}}function ix(o){let e,t,r,n,s,i;t=new ze({props:{name:"Sync settings for this device",helpText:"You must have attachment storage available in order to sync attachments."}});let a=o[3]!==o[10].name&&ax(o),l=xe(o[6]),c=[];for(let d=0;d<l.length;d+=1)c[d]=cx(G_(o,l,d));let u=d=>S(c[d],1,1,()=>{c[d]=null}),f=o[11]&&o[16]&&ux(o);return{c(){e=_("div"),U(t.$$.fragment),r=F(),a&&a.c(),n=F();for(let d=0;d<c.length;d+=1)c[d].c();s=F(),f&&f.c(),h(e,"class","local-settings svelte-fmnezc")},m(d,p){w(d,e,p),R(t,e,null),y(e,r),a&&a.m(e,null),y(e,n);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(e,null);y(e,s),f&&f.m(e,null),i=!0},p(d,p){if(d[3]!==d[10].name?a?(a.p(d,p),p[0]&1032&&b(a,1)):(a=ax(d),a.c(),b(a,1),a.m(e,n)):a&&(ne(),S(a,1,1,()=>{a=null}),se()),p[0]&526432|p[1]&2){l=xe(d[6]);let m;for(m=0;m<l.length;m+=1){let v=G_(d,l,m);c[m]?(c[m].p(v,p),b(c[m],1)):(c[m]=cx(v),c[m].c(),b(c[m],1),c[m].m(e,s))}for(ne(),m=l.length;m<c.length;m+=1)u(m);se()}d[11]&&d[16]?f?(f.p(d,p),p[0]&67584&&b(f,1)):(f=ux(d),f.c(),b(f,1),f.m(e,null)):f&&(ne(),S(f,1,1,()=>{f=null}),se())},i(d){if(!i){b(t.$$.fragment,d),b(a);for(let p=0;p<l.length;p+=1)b(c[p]);b(f),i=!0}},o(d){S(t.$$.fragment,d),S(a),c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)S(c[p]);S(f),i=!1},d(d){d&&x(e),D(t),a&&a.d(),qe(c,d),f&&f.d()}}}function ax(o){let e,t;return e=new Ue({props:{name:"Local path",description:"This folder has a different name in your Vault",$$slots:{default:[NE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&1024|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function NE(o){let e,t=o[10].path+"",r;return{c(){e=B("/"),r=B(t)},m(n,s){w(n,e,s),w(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[10].path+"")&&Q(r,t)},d(n){n&&(x(e),x(r))}}}function lx(o){let e,t;return e=new gc({}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function $E(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[11]&&lx(o);function p(...g){return o[58](o[68],...g)}function m(){return o[59](o[68])}function v(){return o[60](o[68])}return{c(){e=_("div"),d&&d.c(),t=F(),r=_("div"),n=_("input"),i=F(),a=_("div"),h(n,"type","checkbox"),n.checked=s=o[19][o[68]]&&!o[11],n.disabled=o[5],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",l=o[19][o[68]]&&!o[11]),h(r,"tabindex","0"),h(r,"class","checkbox-container"),Te(r,"is-enabled",o[19][o[68]]&&!o[11]),h(e,"class","setting-item-control")},m(g,k){w(g,e,k),d&&d.m(e,null),y(e,t),y(e,r),y(r,n),y(r,i),y(r,a),c=!0,u||(f=[V(n,"change",p),V(r,"keypress",m),V(r,"click",v)],u=!0)},p(g,k){o=g,o[11]?d?k[0]&2048&&b(d,1):(d=lx(o),d.c(),b(d,1),d.m(e,t)):d&&(ne(),S(d,1,1,()=>{d=null}),se()),(!c||k[0]&526400&&s!==(s=o[19][o[68]]&&!o[11]))&&(n.checked=s),(!c||k[0]&32)&&(n.disabled=o[5]),(!c||k[0]&526400&&l!==(l=o[19][o[68]]&&!o[11]))&&h(r,"aria-checked",l),(!c||k[0]&526400)&&Te(r,"is-enabled",o[19][o[68]]&&!o[11])},i(g){c||(b(d),c=!0)},o(g){S(d),c=!1},d(g){g&&x(e),d&&d.d(),u=!1,we(f)}}}function cx(o){let e,t;return e=new Ft({props:{name:o[69].name,description:o[69].description,$$slots:{default:[$E]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.name=r[69].name),n[0]&64&&(s.description=r[69].description),n[0]&526432|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function ux(o){let e,t;return e=new Ft({props:{name:"",$$slots:{default:[BE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&65536|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function BE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Buy storage",h(e,"class","mod-cta")},m(n,s){w(n,e,s),t||(r=V(e,"click",function(){Ge((0,Ao.debounce)(o[61]))&&(0,Ao.debounce)(o[61]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&x(e),t=!1,r()}}}function fx(o){let e,t;return e=new ze({props:{name:"Danger zone"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function dx(o){let e,t,r,n=o[21]&&px(o),s=o[20]&&hx(o);return{c(){n&&n.c(),e=F(),s&&s.c(),t=pe()},m(i,a){n&&n.m(i,a),w(i,e,a),s&&s.m(i,a),w(i,t,a),r=!0},p(i,a){i[21]?n?(n.p(i,a),a[0]&2097152&&b(n,1)):(n=px(i),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ne(),S(n,1,1,()=>{n=null}),se()),i[20]?s?(s.p(i,a),a[0]&1048576&&b(s,1)):(s=hx(i),s.c(),b(s,1),s.m(t.parentNode,t)):s&&(ne(),S(s,1,1,()=>{s=null}),se())},i(i){r||(b(n),b(s),r=!0)},o(i){S(n),S(s),r=!1},d(i){i&&(x(e),x(t)),n&&n.d(i),s&&s.d(i)}}}function px(o){var n,s;let e,t,r=!((n=o[0])!=null&&n.private)&&((s=o[0])==null?void 0:s.relay.version)>0&&mx(o);return{c(){r&&r.c(),e=pe()},m(i,a){r&&r.m(i,a),w(i,e,a),t=!0},p(i,a){var l,c;!((l=i[0])!=null&&l.private)&&((c=i[0])==null?void 0:c.relay.version)>0?r?(r.p(i,a),a[0]&1&&b(r,1)):(r=mx(i),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(ne(),S(r,1,1,()=>{r=null}),se())},i(i){t||(b(r),t=!0)},o(i){S(r),t=!1},d(i){i&&x(e),r&&r.d(i)}}}function mx(o){let e,t;return e=new Ue({props:{name:"Make private",description:"Convert this folder to a private folder and manage access",$$slots:{default:[VE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function VE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Make private",h(e,"class","mod-destructive")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,Ao.debounce)(o[44])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function hx(o){let e,t;return e=new Ue({props:{name:"Remove from Relay Server",description:"Deletes the remote folder from the Relay Server. Local files will be preserved.",$$slots:{default:[HE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function HE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Delete from Relay Server",h(e,"class","mod-destructive")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,Ao.debounce)(o[41])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function gx(o){let e,t;return e=new Ue({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[qE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function qE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,Ao.debounce)(o[62])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function zE(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v;e=new Mo({props:{items:[{type:"home",onClick:o[53]},{type:"relay",relay:o[2].relay,onClick:o[54]},{type:"remoteFolder",remoteFolder:{...o[2],name:o[3],private:o[7]}}]}});let g=o[12]&&!o[13]&&Y_(o),k=o[14]&&Z_(o),L=!o[10]&&o[13]&&X_(o),I=o[16]&&ex(o),C=o[10]&&o[19]&&o[16]&&ix(o),M=(o[20]||o[21]||o[10])&&fx(o),A=o[16]&&dx(o),E=o[10]&&gx(o);return{c(){U(e.$$.fragment),t=F(),g&&g.c(),r=F(),k&&k.c(),n=F(),L&&L.c(),s=F(),I&&I.c(),i=F(),a=_("div"),l=F(),C&&C.c(),c=F(),u=_("div"),f=F(),M&&M.c(),d=F(),A&&A.c(),p=F(),E&&E.c(),m=pe(),h(a,"class","spacer svelte-fmnezc"),h(u,"class","spacer svelte-fmnezc")},m(P,T){R(e,P,T),w(P,t,T),g&&g.m(P,T),w(P,r,T),k&&k.m(P,T),w(P,n,T),L&&L.m(P,T),w(P,s,T),I&&I.m(P,T),w(P,i,T),w(P,a,T),w(P,l,T),C&&C.m(P,T),w(P,c,T),w(P,u,T),w(P,f,T),M&&M.m(P,T),w(P,d,T),A&&A.m(P,T),w(P,p,T),E&&E.m(P,T),w(P,m,T),v=!0},p(P,T){let $={};T[0]&140&&($.items=[{type:"home",onClick:P[53]},{type:"relay",relay:P[2].relay,onClick:P[54]},{type:"remoteFolder",remoteFolder:{...P[2],name:P[3],private:P[7]}}]),e.$set($),P[12]&&!P[13]?g||(g=Y_(P),g.c(),g.m(r.parentNode,r)):g&&(g.d(1),g=null),P[14]?k?(k.p(P,T),T[0]&16384&&b(k,1)):(k=Z_(P),k.c(),b(k,1),k.m(n.parentNode,n)):k&&(ne(),S(k,1,1,()=>{k=null}),se()),!P[10]&&P[13]?L?(L.p(P,T),T[0]&9216&&b(L,1)):(L=X_(P),L.c(),b(L,1),L.m(s.parentNode,s)):L&&(ne(),S(L,1,1,()=>{L=null}),se()),P[16]?I?(I.p(P,T),T[0]&65536&&b(I,1)):(I=ex(P),I.c(),b(I,1),I.m(i.parentNode,i)):I&&(ne(),S(I,1,1,()=>{I=null}),se()),P[10]&&P[19]&&P[16]?C?(C.p(P,T),T[0]&590848&&b(C,1)):(C=ix(P),C.c(),b(C,1),C.m(c.parentNode,c)):C&&(ne(),S(C,1,1,()=>{C=null}),se()),P[20]||P[21]||P[10]?M?T[0]&3146752&&b(M,1):(M=fx(P),M.c(),b(M,1),M.m(d.parentNode,d)):M&&(ne(),S(M,1,1,()=>{M=null}),se()),P[16]?A?(A.p(P,T),T[0]&65536&&b(A,1)):(A=dx(P),A.c(),b(A,1),A.m(p.parentNode,p)):A&&(ne(),S(A,1,1,()=>{A=null}),se()),P[10]?E?(E.p(P,T),T[0]&1024&&b(E,1)):(E=gx(P),E.c(),b(E,1),E.m(m.parentNode,m)):E&&(ne(),S(E,1,1,()=>{E=null}),se())},i(P){v||(b(e.$$.fragment,P),b(k),b(L),b(I),b(C),b(M),b(A),b(E),v=!0)},o(P){S(e.$$.fragment,P),S(k),S(L),S(I),S(C),S(M),S(A),S(E),v=!1},d(P){P&&(x(t),x(r),x(n),x(s),x(i),x(a),x(l),x(c),x(u),x(f),x(d),x(p),x(m)),D(e,P),g&&g.d(P),k&&k.d(P),L&&L.d(P),I&&I.d(P),C&&C.d(P),M&&M.d(P),A&&A.d(P),E&&E.d(P)}}}function jE(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function WE(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function KE(o,e,t){let r,n,s,i,a,l,c,u=q,f=()=>(u(),u=At($,ce=>t(2,c=ce)),$),d,p=q,m=()=>(p(),p=At(J,ce=>t(64,d=ce)),J),v,g,k,L,I,C,M,A,E,P;o.$$.on_destroy.push(()=>u()),o.$$.on_destroy.push(()=>p());let{plugin:T}=e,{remoteFolder:$}=e;f();let{sharedFolders:J}=e;m();let{relayRoles:N}=e,{folderRoles:O}=e,te=$.name,{errorLog:Z=Fe("ManageRemoveFolder.svelte","error")}=e;T.relayManager.refreshRemoteFolder($);let Y=Xe([N],([ce])=>{var Ve;return(Ve=ce.find(mt=>mt.relayId===c.relayId))===null||Ve===void 0?void 0:Ve.relay});le(o,Y,ce=>t(16,I=ce));let ge=Xe(d,ce=>ce.items().find(Ve=>Ve.guid===$.guid));le(o,ge,ce=>t(10,a=ce));let j=Xe([T.relayManager.roles],([ce])=>ce.values().sort(jE));le(o,j,ce=>t(18,M=ce));let H=Xe([O,N],([ce,Ve])=>{if(c.private){let gt=[];for(let ar of ce.values())ar.sharedFolderId===c.id&&Ve.some(sn=>sn.userId===ar.userId)&&gt.push(ar);return gt}let mt=[];for(let gt of Ve.values())gt.relayId===c.relayId&&mt.push(gt);return mt});le(o,H,ce=>t(9,i=ce));let X=Ie(!1);le(o,X,ce=>t(17,C=ce));let ue=Ie(!0);le(o,ue,ce=>t(8,s=ce));let z,ee=Ie(!1);le(o,ee,ce=>t(15,L=ce));let re=$.name;lt(()=>{z&&z.value===""&&z.focus()});function fe(ce){return Ae(this,void 0,void 0,function*(){var Ve;if(!(!((Ve=T.loginManager)===null||Ve===void 0)&&Ve.user))return;let mt={relay:ce.id,quantity:10,user_email:T.loginManager.user.email},gt=btoa(JSON.stringify(mt)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(T.buildApiUrl(`/subscribe/${gt}?action="buy_storage"`),"_blank")})}let Le=a==null?void 0:a.syncSettingsManager;le(o,Le,ce=>t(19,A=ce));let de=Xe([ge,N],([ce,Ve])=>{var mt,gt,ar;return((ar=(gt=(mt=Ve.find(sn=>{var wi;return sn.relay===((wi=ce==null?void 0:ce.remote)===null||wi===void 0?void 0:wi.relay)}))===null||mt===void 0?void 0:mt.relay)===null||gt===void 0?void 0:gt.storageQuota)===null||ar===void 0?void 0:ar.quota)===0});le(o,de,ce=>t(11,l=ce));let Ee=!1;function Oe(ce,Ve){return Ae(this,void 0,void 0,function*(){if(!Ee&&!l&&Le){t(5,Ee=!0);try{yield Le.toggleCategory(ce,Ve),t(6,n=Object.entries(Le.getCategories()))}catch(mt){}finally{t(5,Ee=!1)}}})}let Me=Ye(),ot=T.relayManager.userCan(["folder","read_content"],$);le(o,ot,ce=>t(13,g=ce));let at=T.relayManager.userCan(["folder","rename"],$);le(o,at,ce=>t(14,k=ce));let Dt=T.relayManager.userCan(["folder","delete"],$);le(o,Dt,ce=>t(20,E=ce));let Eo=T.relayManager.userCan(["folder","manage_users"],$);le(o,Eo,ce=>t(12,v=ce));let Ir=T.relayManager.userCan(["folder","make_private"],$);le(o,Ir,ce=>t(21,P=ce));function Cr(ce){ce&&Me("manageRelay",{relay:ce})}function io(){return Ae(this,void 0,void 0,function*(){a&&T.sharedFolders.delete(a),Me("goBack",{clear:!0})})}function qt(){if(a){let ce=T.vault.getFolderByPath(a.path);ce&&T.app.vault.trash(ce,!1)}}function on(){return Ae(this,void 0,void 0,function*(){try{if(yield T.relayManager.deleteRemote($),a){Ys(ge,a.remote=void 0,a),T.sharedFolders.notifyListeners(),Me("manageSharedFolder",{folder:a});return}}catch(ce){Z("Failed to delete remote folder:",ce)}Me("goBack",{})})}function ms(ce){(ce instanceof MouseEvent||ce instanceof KeyboardEvent&&(ce.key==="Enter"||ce.key===" "))&&X.update(Ve=>!Ve)}function yr(ce){return Ae(this,void 0,void 0,function*(){try{yield T.relayManager.removeFolderRole(ce)}catch(Ve){Jt(Ve,"Failed to remove user from folder.")}})}function Lr(){return Ae(this,void 0,void 0,function*(){try{let ce=yield T.relayManager.updateFolderPrivacy($,!0);ao()}catch(ce){Jt(ce,"Failed to make folder private. Permission denied.")}})}function ao(){new wc(T.app,T.relayManager,$,(Ve,mt)=>Ae(this,void 0,void 0,function*(){try{for(let gt of Ve)yield T.relayManager.addFolderRole($,gt,mt)}catch(gt){Jt(gt,"Failed to add users to folder.")}})).open()}function Un(ce,Ve){return Ae(this,void 0,void 0,function*(){try{yield T.relayManager.updateFolderRole(ce,Ve)}catch(mt){throw Jt(mt,"Failed to change user role."),mt}})}function lo(ce){return Ae(this,void 0,void 0,function*(){let Ve=ce.target,mt=i.find(gt=>gt.id===Ve.dataset.roleId);if(mt){let gt=mt.role;try{yield Un(mt,Ve.value)}catch(ar){Ve.value=gt}}})}function On(){return Ae(this,void 0,void 0,function*(){function ce(Ve,mt,gt){return Ae(this,void 0,void 0,function*(){let ar=(0,yx.normalizePath)((0,bx.join)(gt,mt));T.vault.getFolderByPath(ar)===null&&(yield T.vault.createFolder(ar));let sn=T.sharedFolders.new(ar,Ve.guid,Ve.relay.guid,!0);return sn.remote=Ve,T.sharedFolders.notifyListeners(),Me("manageRemoteFolder",{remoteFolder:Ve}),sn})}new Fn(T.app,T.sharedFolders,$,[],ce).open()})}let ke=T.timeProvider.debounce(ce=>Ae(void 0,void 0,void 0,function*(){try{let Ve=yield T.relayManager.updateRemoteFolder($,{name:ce});re=Ve.name,t(3,te=Ve.name),ee.set(!1)}catch(Ve){Z("Failed to update folder name:",Ve),(Ve==null?void 0:Ve.status)===400&&ue.set(!1),ee.set(!1)}}),500);function Ke(){ue.set(WE(z.value));let ce=z.value.trim();s&&ce!==""&&ce!==re&&(ee.set(!0),ke(ce))}let et=()=>Me("goBack",{clear:!0}),Mr=()=>Cr(c.relay);function nn(){te=this.value,t(3,te)}function ae(ce){vt[ce?"unshift":"push"](()=>{z=ce,t(4,z)})}let Ne=ce=>{"sharedFolder"in ce&&yr(ce)},dt=(ce,Ve)=>Oe(ce,Ve.currentTarget.checked),Vr=ce=>Oe(ce,!A[ce]),ir=ce=>Oe(ce,!A[ce]),Fa=()=>{fe(I)},xi=()=>{qt()};o.$$set=ce=>{"plugin"in ce&&t(49,T=ce.plugin),"remoteFolder"in ce&&f(t(0,$=ce.remoteFolder)),"sharedFolders"in ce&&m(t(1,J=ce.sharedFolders)),"relayRoles"in ce&&t(50,N=ce.relayRoles),"folderRoles"in ce&&t(51,O=ce.folderRoles),"errorLog"in ce&&t(52,Z=ce.errorLog)},o.$$.update=()=>{if(o.$$.dirty[0]&4){e:t(7,r=(c==null?void 0:c.private)||!1)}};e:t(6,n=Le?Object.entries(Le.getCategories()):[]);return[$,J,c,te,z,Ee,n,r,s,i,a,l,v,g,k,L,I,C,M,A,E,P,Y,ge,j,H,X,ue,ee,fe,Le,de,Oe,Me,ot,at,Dt,Eo,Ir,Cr,qt,on,ms,yr,Lr,ao,lo,On,Ke,T,N,O,Z,et,Mr,nn,ae,Ne,dt,Vr,ir,Fa,xi]}var vm=class extends K{constructor(e){super(),G(this,e,KE,zE,W,{plugin:49,remoteFolder:0,sharedFolders:1,relayRoles:50,folderRoles:51,errorLog:52},LE,[-1,-1,-1])}},Sc=vm;function GE(o){Ce(o,"svelte-gjlxvj",".toast.svelte-gjlxvj.svelte-gjlxvj{position:absolute;top:20px;left:50%;transform:translateX(-50%);display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border-radius:8px;border:1px solid;background:var(--background-primary);color:var(--text-normal);box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);min-height:48px;max-width:500px;min-width:300px;width:max-content;animation:svelte-gjlxvj-slideDown 0.3s ease-out;pointer-events:auto}.toast-error.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-error)}.toast-warning.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-warning)}.toast-success.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--interactive-accent)}@keyframes svelte-gjlxvj-slideDown{from{opacity:0;transform:translateX(-50%) translateY(-10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}.toast-icon.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;flex-shrink:0;margin-top:1px}.toast-error.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-error)}.toast-warning.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-warning)}.toast-success.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--interactive-accent)}.toast-content.svelte-gjlxvj.svelte-gjlxvj{flex:1;min-width:0}.toast-message.svelte-gjlxvj.svelte-gjlxvj{font-weight:500;margin-bottom:2px;line-height:1.4;color:var(--text-normal)}.toast-details.svelte-gjlxvj.svelte-gjlxvj{font-size:0.9em;color:var(--text-muted);line-height:1.3}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;justify-content:center;width:24px;height:24px;border:none;background:transparent;border-radius:4px;cursor:pointer;color:var(--text-muted);transition:all 0.15s ease-in-out;padding:0;flex-shrink:0}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:hover{background:var(--background-modifier-hover);color:var(--text-error)}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:focus{outline:2px solid var(--interactive-accent);outline-offset:1px}")}function vx(o){let e,t;return{c(){e=_("div"),t=B(o[1]),h(e,"class","toast-details svelte-gjlxvj")},m(r,n){w(r,e,n),y(e,t)},p(r,n){n&2&&Q(t,r[1])},d(r){r&&x(e)}}}function JE(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v;var g=o[3];function k(I,C){return{props:{class:"svg-icon"}}}g&&(r=Jo(g,k(o)));let L=o[1]&&vx(o);return f=new Qd({props:{class:"svg-icon"}}),{c(){e=_("div"),t=_("div"),r&&U(r.$$.fragment),n=F(),s=_("div"),i=_("div"),a=B(o[0]),l=F(),L&&L.c(),c=F(),u=_("button"),U(f.$$.fragment),h(t,"class","toast-icon svelte-gjlxvj"),h(i,"class","toast-message svelte-gjlxvj"),h(s,"class","toast-content svelte-gjlxvj"),h(u,"class","toast-dismiss svelte-gjlxvj"),h(u,"aria-label","Dismiss error"),h(e,"class",d=kt(o[2])+" svelte-gjlxvj"),h(e,"role","alert"),h(e,"aria-live","polite")},m(I,C){w(I,e,C),y(e,t),r&&R(r,t,null),y(e,n),y(e,s),y(s,i),y(i,a),y(s,l),L&&L.m(s,null),y(e,c),y(e,u),R(f,u,null),p=!0,m||(v=V(u,"click",o[4]),m=!0)},p(I,[C]){if(C&8&&g!==(g=I[3])){if(r){ne();let M=r;S(M.$$.fragment,1,0,()=>{D(M,1)}),se()}g?(r=Jo(g,k(I,C)),U(r.$$.fragment),b(r.$$.fragment,1),R(r,t,null)):r=null}(!p||C&1)&&Q(a,I[0]),I[1]?L?L.p(I,C):(L=vx(I),L.c(),L.m(s,null)):L&&(L.d(1),L=null),(!p||C&4&&d!==(d=kt(I[2])+" svelte-gjlxvj"))&&h(e,"class",d)},i(I){p||(r&&b(r.$$.fragment,I),b(f.$$.fragment,I),p=!0)},o(I){r&&S(r.$$.fragment,I),S(f.$$.fragment,I),p=!1},d(I){I&&x(e),r&&D(r),L&&L.d(),D(f),m=!1,v()}}}function QE(o,e,t){let r,n,{message:s}=e,{details:i=""}=e,{type:a="error"}=e,{autoDismiss:l=5e3}=e,c=Ye(),u;lt(()=>(l>0&&(u=window.setTimeout(()=>{c("dismiss")},l)),()=>{u&&clearTimeout(u)}));function f(){u&&clearTimeout(u),c("dismiss")}return o.$$set=d=>{"message"in d&&t(0,s=d.message),"details"in d&&t(1,i=d.details),"type"in d&&t(5,a=d.type),"autoDismiss"in d&&t(6,l=d.autoDismiss)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,r=a==="error"?as:a==="warning"?vd:a==="success"?fa:ha)}if(o.$$.dirty&32){e:t(2,n=`toast toast-${a}`)}},[s,i,n,r,f,a,l]}var _m=class extends K{constructor(e){super(),G(this,e,QE,JE,W,{message:0,details:1,type:5,autoDismiss:6},GE)}},_x=_m;function YE(o){Ce(o,"svelte-ml1z9c",".toast-container.svelte-ml1z9c{position:fixed;top:0;left:0;width:100vw;height:0;pointer-events:none;z-index:1000}")}function xx(o,e,t){let r=o.slice();return r[3]=e[t][0],r[4]=e[t][1],r}function wx(o,e){let t,r,n;function s(){return e[2](e[3])}return r=new _x({props:{message:e[4].message,details:e[4].details,type:e[4].type,autoDismiss:e[4].autoDismiss,source:e[4].source}}),r.$on("dismiss",s),{key:o,first:null,c(){t=pe(),U(r.$$.fragment),this.first=t},m(i,a){w(i,t,a),R(r,i,a),n=!0},p(i,a){e=i;let l={};a&1&&(l.message=e[4].message),a&1&&(l.details=e[4].details),a&1&&(l.type=e[4].type),a&1&&(l.autoDismiss=e[4].autoDismiss),a&1&&(l.source=e[4].source),r.$set(l)},i(i){n||(b(r.$$.fragment,i),n=!0)},o(i){S(r.$$.fragment,i),n=!1},d(i){i&&x(t),D(r,i)}}}function ZE(o){let e,t=[],r=new Map,n,s=xe(o[0]),i=a=>a[3];for(let a=0;a<s.length;a+=1){let l=xx(o,s,a),c=i(l);r.set(c,t[a]=wx(c,l))}return{c(){e=_("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","toast-container svelte-ml1z9c")},m(a,l){w(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,[l]){l&1&&(s=xe(a[0]),ne(),t=eo(t,l,i,1,a,s,r,e,ni,wx,null,xx),se())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)S(t[l]);n=!1},d(a){a&&x(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function XE(o,e,t){let r,n;le(o,bc,i=>t(1,n=i));let s=i=>a_(i);return o.$$.update=()=>{if(o.$$.dirty&2){e:t(0,r=Object.entries(n).filter(([i,a])=>a.visible))}},[r,n,s]}var xm=class extends K{constructor(e){super(),G(this,e,XE,ZE,W,{},YE)}},Sx=xm;function eP(o){Ce(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function tP(o){let e,t,r,n,s=o[0].networkStatus.status&&kx(o);return{c(){e=_("div"),t=_("span"),s&&s.c(),h(t,"class","system3-announcement svelte-d22j3"),me(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),h(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),h(e,"role","button"),h(e,"tabindex","0"),me(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(i,a){w(i,e,a),y(e,t),s&&s.m(t,null),r||(n=[V(e,"click",o[22]),V(e,"keypress",o[23])],r=!0)},p(i,a){i[0].networkStatus.status?s?s.p(i,a):(s=kx(i),s.c(),s.m(t,null)):s&&(s.d(1),s=null),a&1&&me(t,"color",i[0].networkStatus.status.color?i[0].networkStatus.status.color:"var(--text-on-accent)",1),a&1&&me(e,"background-color",i[0].networkStatus.status.backgroundColor?i[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:q,o:q,d(i){i&&x(e),s&&s.d(),r=!1,we(n)}}}function rP(o){let e,t;return e=new V_({}),e.$on("goBack",o[14]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p:q,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function kx(o){let e,t=En(o[0].networkStatus.status.status)+"",r;return{c(){e=new Cn(!1),r=pe(),e.a=r},m(n,s){e.m(t,n,s),w(n,r,s)},p(n,s){s&1&&t!==(t=En(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(x(r),e.d())}}}function oP(o){let e,t;return e=new pv({props:{plugin:o[0],$$slots:{default:[aP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&134217729&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function nP(o){let e,t;return e=new mi({props:{plugin:o[0],relayRoles:o[5],relay:o[2],sharedFolders:o[9]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function sP(o){let e,t;return e=new xc({props:{plugin:o[0],sharedFolder:o[1]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function iP(o){let e,t;return e=new Sc({props:{plugin:o[0],remoteFolder:o[3],sharedFolders:o[9],relayRoles:o[5],folderRoles:o[4].folderRoles}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&8&&(s.remoteFolder=r[3]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function aP(o){let e,t;return e=new To({props:{relays:o[6],subscriptions:o[7],providers:o[8],plugin:o[0]}}),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),e.$on("createRelay",o[13]),e.$on("joinRelay",o[16]),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function lP(o){let e,t;return e=new Sx({}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Ix(o){let e,t=o[0].version+"",r;return{c(){e=_("span"),r=B(t),h(e,"class","relay-version svelte-d22j3")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&Q(r,t)},d(n){n&&x(e)}}}function cP(o){let e,t,r,n,s,i,a,l=Ze().enableToasts,c,u,f,d=[rP,tP],p=[];function m(C,M){return C[2]||C[1]||C[3]?0:C[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=p[e]=d[e](o));let v=[iP,sP,nP,oP],g=[];function k(C,M){return C[3]?0:C[1]?1:C[2]?2:3}s=k(o,-1),i=g[s]=v[s](o);let L=l&&lP(o),I=o[0].manifest.version!==o[0].version&&Ix(o);return{c(){t&&t.c(),r=F(),n=_("div"),i.c(),a=F(),L&&L.c(),c=F(),I&&I.c(),u=pe(),h(n,"class","vertical-tab-content svelte-d22j3")},m(C,M){~e&&p[e].m(C,M),w(C,r,M),w(C,n,M),g[s].m(n,null),w(C,a,M),L&&L.m(C,M),w(C,c,M),I&&I.m(C,M),w(C,u,M),f=!0},p(C,[M]){let A=e;e=m(C,M),e===A?~e&&p[e].p(C,M):(t&&(ne(),S(p[A],1,1,()=>{p[A]=null}),se()),~e?(t=p[e],t?t.p(C,M):(t=p[e]=d[e](C),t.c()),b(t,1),t.m(r.parentNode,r)):t=null);let E=s;s=k(C,M),s===E?g[s].p(C,M):(ne(),S(g[E],1,1,()=>{g[E]=null}),se(),i=g[s],i?i.p(C,M):(i=g[s]=v[s](C),i.c()),b(i,1),i.m(n,null)),C[0].manifest.version!==C[0].version?I?I.p(C,M):(I=Ix(C),I.c(),I.m(u.parentNode,u)):I&&(I.d(1),I=null)},i(C){f||(b(t),b(i),b(L),f=!0)},o(C){S(t),S(i),S(L),f=!1},d(C){C&&(x(r),x(n),x(a),x(c),x(u)),~e&&p[e].d(C),g[s].d(),L&&L.d(C),I&&I.d(C)}}}function uP(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,i=n.app,a=n.relayManager,l=a.relayRoles,c=a.relays;le(o,c,te=>t(21,r=te));let u=a.subscriptions,f=a.providers,d=n.sharedFolders,p,m=To,v,g,k=[{component:To}],{close:L}=e;function I(te){if(t(2,v=void 0),t(1,p=void 0),t(3,g=void 0),te==="/"){t(20,m=To);return}let Z=new URLSearchParams(te.split("?")[1]||""),Y=Z.get("id");if(te.startsWith("/relays")){Y?(t(2,v=a.relays.find(ge=>ge.guid===Y||ge.id===Y)),t(20,m=mi)):t(20,m=To);return}if(te.startsWith("/shared-folders")){if(Y){t(1,p=d.find(j=>j.guid===Y));let ge=Z.get("relay");ge&&t(2,v=a.relays.find(j=>j.guid===ge||j.id===ge)),p!=null&&p.remote?(t(3,g=p.remote),t(2,v=p.remote.relay),t(20,m=Sc)):t(20,m=xc)}return}}function C(te){k.push({currentRelay:v,sharedFolder:p,remoteFolder:g,component:m}),t(2,v=te.detail.relay),t(1,p=void 0),t(3,g=void 0),t(20,m=mi)}function M(te){k.push({currentRelay:v,sharedFolder:p,remoteFolder:g,component:m}),t(1,p=te.detail.folder),t(3,g=te.detail.remoteFolder),t(2,v=te.detail.relay),t(20,m=xc)}function A(te){k.push({currentRelay:v,sharedFolder:p,remoteFolder:g,component:m}),t(1,p=void 0),t(3,g=te.detail.remoteFolder),t(2,v=te.detail.relay),t(20,m=Sc)}function E(te){return Ae(this,void 0,void 0,function*(){try{k.push({currentRelay:v,sharedFolder:p,remoteFolder:g,component:m}),t(2,v=yield n.relayManager.createRelay("")),t(20,m=mi)}catch(Z){Jt(Z,"Failed to create relay")}})}function P(te){if(te.detail.clear){k.length=0,t(2,v=void 0),t(1,p=void 0),t(3,g=void 0),t(20,m=To);return}let Z=k.pop();if(Z)for(;Z;){if(!Z.currentRelay&&!Z.sharedFolder&&!Z.remoteFolder)t(2,v=Z.currentRelay),t(1,p=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,m=Z.component);else if(Z.sharedFolder&&d.has(Z.sharedFolder)){t(2,v=Z.currentRelay),t(1,p=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,m=Z.component);break}else if(Z.remoteFolder){t(2,v=Z.currentRelay),t(1,p=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,m=Z.component);break}else if(Z.currentRelay&&a.relays.get(Z.currentRelay.id)){t(2,v=Z.currentRelay),t(1,p=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,m=Z.component);break}Z=k.pop()}else t(2,v=void 0),t(1,p=void 0),t(3,g=void 0),t(20,m=To)}function T(te){k.length=0,L()}function $(te){t(2,v=te.detail.relay),t(20,m=mi)}function J(){var te;!((te=n.networkStatus.status)===null||te===void 0)&&te.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let N=()=>{var te,Z;(te=n.networkStatus.status)!=null&&te.versions?J():(Z=n.networkStatus.status)!=null&&Z.link&&window.open(n.networkStatus.status.link)},O=()=>{var te,Z;(te=n.networkStatus.status)!=null&&te.versions?J():(Z=n.networkStatus.status)!=null&&Z.link&&window.open(n.networkStatus.status.link)};return o.$$set=te=>{"plugin"in te&&t(0,n=te.plugin),"path"in te&&t(18,s=te.path),"close"in te&&t(19,L=te.close)},o.$$.update=()=>{if(o.$$.dirty&262144){e:s&&I(s)}if(o.$$.dirty&2097156){e:v&&!r.has(v.id)&&(t(2,v=void 0),t(20,m=To))}if(o.$$.dirty&2){e:p&&!d.has(p)&&(t(1,p=void 0),t(3,g=void 0),t(20,m=To))}if(o.$$.dirty&1048590){e:(m||v||p||g)&&setTimeout(()=>{let te=document.querySelector(".vertical-tab-content");te&&(te.scrollTop=0)},0)}},[n,p,v,g,a,l,c,u,f,d,C,M,A,E,P,T,$,J,s,L,m,r,N,O]}var wm=class extends K{constructor(e){super(),G(this,e,uP,cP,W,{plugin:0,path:18,close:19},eP)}},Cx=wm;var kc=class extends Lx.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new Cx({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var Cc=require("obsidian");var Ic=class extends ea{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};function fP(o){if("email"in o&&"name"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}if("email"in o&&"login"in o&&"avatar_url"in o){let e=o,t=(e.name||e.login).split(" ");return{name:e.name||e.login,given_name:t[0]||e.login,family_name:t.slice(1).join(" ")||"",email:e.email,picture:e.avatar_url}}if("mail"in o&&"displayName"in o){let e=o;return{name:e.displayName,given_name:e.givenName,family_name:e.surname,email:e.mail}}if("email"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name||`${e.given_name} ${e.family_name}`,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}return null}function dP(o,e,t,r){let n=r?fP(r):null;return new uc(o,(t==null?void 0:t.name)||(n==null?void 0:n.name)||"",(t==null?void 0:t.email)||(n==null?void 0:n.email)||"",(t==null?void 0:t.picture)||(n==null?void 0:n.picture)||"",e)}var Sm=class{constructor(e,t,r){this.fullAuthUrl=e,this.info=t,this.login=r}},Lc=class extends st{constructor(t,r,n,s,i,a){var c;super();this.beforeLogin=s;this.loginSettings=i;let l=Fe("[Pocketbase]","debug");this.authStore=new Ic(`pocketbase_auth_${t}`),this.endpointManager=a,this.pb=new es(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(u,f)=>(l(u,f),f.fetch=it,f.headers=Object.assign({},f.headers,{"Relay-Version":"0.6.1"}),{url:u,options:f}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(c=this.pb.authStore.model)!=null&&c.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(u=>{u.status===404&&this.logout()}),$t.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),i=new Date(s.exp*1e3),a=new Date,l=Math.ceil((i.getTime()-a.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:i.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t,r){var n,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(n=t==null?void 0:t.meta)==null?void 0:n.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(i=>{this.log(i)}),r&&this.loginSettings.set({provider:r}),!0):(this.notifyListeners(),!1)}clearPreferredProvider(){this.loginSettings.set({provider:void 0})}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.6.1"};return(0,Cc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.6.1"};(0,Cc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/flags`,method:"GET",headers:t}).then(r=>{if(r.status===200){let n=r.json;_t.getInstance().applyServerFlags(n)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Cc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/whoami`,method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}getEndpointManager(){return this.endpointManager}async validateAndApplyEndpoints(t){let r=await this.endpointManager.validateAndSetEndpoints(t);if(r.success&&this.endpointManager.hasValidatedEndpoints()){let n=Fe("[Pocketbase]","debug");this.pb=new es(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(s,i)=>(n(s,i),i.fetch=it,i.headers=Object.assign({},i.headers,{"Relay-Version":"0.6.1"}),{url:s,options:i}),this.log("Updated PocketBase instance with validated endpoints")}return r}get hasUser(){return this.user!==void 0}makeUser(t,r){var n;return dP((n=t.model)==null?void 0:n.id,t.token,t.model,r)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}getWebviewIntercepts(t){var a;let r=this.pb.buildUrl("/api/oauth2-redirect"),n=l=>{let c=l.replace(/\//g,"\\/");return new RegExp(`^${c}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},s=l=>{let c=new URL(l),f=`${c.protocol}//${c.host}${c.pathname}`.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${f}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},i=[n("https://accounts.google.com/o/oauth2/auth"),n("https://github.com/login/oauth/authorize"),n("https://discord.com/api/oauth2/authorize"),n("https://login.microsoftonline.com/common/oauth2/v2.0/authorize")];if(t){let l=t.oidc;(a=l==null?void 0:l.info)!=null&&a.authUrl&&(console.log("[OIDC Provider] Creating dynamic intercept for authUrl:",l.info.authUrl),i.push(s(l.info.authUrl)))}else i.push(new RegExp(`.*?/auth.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i"));return i}updateWebviewIntercepts(t){let r=this.getWebviewIntercepts(t);return console.log("[OIDC Provider] Updated webview intercepts:",r.map(n=>n.source)),r}async initiateManualOAuth2CodeFlow(t,r){this.beforeLogin();let n=await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError}),s=this.pb.buildUrl("/api/oauth2-redirect"),i={};for(let a of r){let l=n.authProviders.find(u=>u.name===a);if(!l){this.log(`Warning: unable to find provider: ${a}`);continue}let c=async u=>this.pb.collection("users").authWithOAuth2Code(l.name,u,l.codeVerifier,s,{fetch:t}).then(f=>(this.setup(f,l.name),f));i[a]=new Sm(l.authUrl+s,l,c)}if(Object.keys(i).length===0)throw new Error(`No valid providers found from requested list: ${r.join(", ")}`);return i}async poll(t){let r=0,n=1e3;return new Promise((s,i)=>{let a=setInterval(()=>{if(r+=1,r>=30)return clearInterval(a),i(new Error(`Auth timeout: Timed out after ${r*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.info.state.slice(0,15)).then(l=>{if(l)return clearInterval(a),s(t.login(l.code))}).catch(l=>{})},n)})}async login(t){this.beforeLogin();let r=await this.pb.collection("users").authWithOAuth2({provider:t});return this.setup(r,t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Dx=require("obsidian");function pP(o){Ce(o,"svelte-74c8lg",".endpoint-config-modal.svelte-74c8lg.svelte-74c8lg{padding:0}.tenant-list-section.svelte-74c8lg.svelte-74c8lg{margin:16px 0}.tenant-card.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;justify-content:space-between;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.tenant-card.svelte-74c8lg.svelte-74c8lg:hover{background:var(--background-modifier-hover)}.tenant-card.active.svelte-74c8lg.svelte-74c8lg{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.tenant-info.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:12px;flex:1}.tenant-logo.svelte-74c8lg.svelte-74c8lg{width:4em;height:4em;object-fit:contain;border-radius:4px;background:var(--background-secondary);padding:4px}.tenant-details.svelte-74c8lg.svelte-74c8lg{flex:1}.tenant-name.svelte-74c8lg.svelte-74c8lg{font-weight:500;color:var(--text-normal);margin-bottom:2px}.tenant-url.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.tenant-env.svelte-74c8lg.svelte-74c8lg{font-size:0.8em;color:var(--text-faint);text-transform:capitalize}.tenant-actions.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:8px}.add-tenant-container.svelte-74c8lg.svelte-74c8lg{display:flex;gap:8px;align-items:center}.endpoint-url-input.svelte-74c8lg.svelte-74c8lg{flex:1;padding:6px 12px;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);color:var(--text-normal)}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg{border-color:var(--text-error) !important;box-shadow:0 0 0 1px var(--text-error) !important;transition:border-color 0.3s ease, box-shadow 0.3s ease}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg:focus{border-color:var(--text-error) !important;box-shadow:0 0 0 2px var(--text-error) !important}.add-tenant-container.svelte-74c8lg button.mod-cta.svelte-74c8lg{background:var(--interactive-accent);color:var(--text-on-accent);padding:6px 12px;white-space:nowrap}.error-banner.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;justify-content:space-between;margin:12px 0;padding:10px 12px;background-color:rgba(255, 0, 0, 0.1);color:var(--text-normal);border:1px solid rgba(255, 0, 0, 0.3);border-radius:var(--radius-s);animation:svelte-74c8lg-error-slide-in 0.3s ease-out}.error-content.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;gap:8px;flex:1}.error-icon.svelte-74c8lg.svelte-74c8lg{font-size:1em;line-height:1.2;margin-top:2px}.error-text.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;line-height:1.4;color:var(--text-normal)}.error-dismiss.svelte-74c8lg.svelte-74c8lg{background:none;border:none;color:var(--text-muted);font-size:1.2em;font-weight:normal;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s ease;opacity:0.6}.error-dismiss.svelte-74c8lg.svelte-74c8lg:hover{opacity:1}@keyframes svelte-74c8lg-error-slide-in{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}.apply-section.svelte-74c8lg.svelte-74c8lg{display:flex;justify-content:flex-end;margin-top:20px;padding-top:16px;border-top:1px solid var(--background-modifier-border)}.apply-btn.svelte-74c8lg.svelte-74c8lg{padding:8px 20px;font-size:0.9em}")}function Mx(o,e,t){let r=o.slice();return r[32]=e[t],r}function mP(o){let e,t,r,n,s,i=o[5]?"Adding...":"Add Tenant",a,l,c,u;return{c(){e=_("div"),t=_("input"),n=F(),s=_("button"),a=B(i),h(t,"type","text"),h(t,"placeholder","https://auth.example.com"),h(t,"class","endpoint-url-input svelte-74c8lg"),h(t,"title",r=o[6].error),Te(t,"endpoint-input-invalid",!o[6].isValid||o[2]),h(s,"class","mod-cta svelte-74c8lg"),s.disabled=l=o[5]||!o[0].trim()||!o[6].isValid,h(e,"class","add-tenant-container svelte-74c8lg")},m(f,d){w(f,e,d),y(e,t),Je(t,o[0]),y(e,n),y(e,s),y(s,a),c||(u=[V(t,"input",o[20]),V(s,"click",o[12])],c=!0)},p(f,d){d[0]&64&&r!==(r=f[6].error)&&h(t,"title",r),d[0]&1&&t.value!==f[0]&&Je(t,f[0]),d[0]&68&&Te(t,"endpoint-input-invalid",!f[6].isValid||f[2]),d[0]&32&&i!==(i=f[5]?"Adding...":"Add Tenant")&&Q(a,i),d[0]&97&&l!==(l=f[5]||!f[0].trim()||!f[6].isValid)&&(s.disabled=l)},d(f){f&&x(e),c=!1,we(u)}}}function Tx(o){let e,t,r,n,s,i,a,l,c,u;return{c(){e=_("div"),t=_("div"),r=_("span"),r.textContent="\u26A0\uFE0F",n=F(),s=_("span"),i=B(o[1]),a=F(),l=_("button"),l.textContent="\xD7",h(r,"class","error-icon svelte-74c8lg"),h(s,"class","error-text svelte-74c8lg"),h(t,"class","error-content svelte-74c8lg"),h(l,"class","error-dismiss svelte-74c8lg"),h(l,"title","Dismiss error"),h(e,"class","error-banner svelte-74c8lg")},m(f,d){w(f,e,d),y(e,t),y(t,r),y(t,n),y(t,s),y(s,i),y(e,a),y(e,l),c||(u=V(l,"click",o[11]),c=!0)},p(f,d){d[0]&2&&Q(i,f[1])},d(f){f&&x(e),c=!1,u()}}}function Ax(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[8].logo)||h(e,"src",t),h(e,"alt",r=o[8].customer||"Default Tenant"),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){w(n,e,s)},p(n,s){s[0]&256&&!dr(e.src,t=n[8].logo)&&h(e,"src",t),s[0]&256&&r!==(r=n[8].customer||"Default Tenant")&&h(e,"alt",r)},d(n){n&&x(e)}}}function Fx(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[32].logo)||h(e,"src",t),h(e,"alt",r=o[32].name),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){w(n,e,s)},p(n,s){s[0]&16&&!dr(e.src,t=n[32].logo)&&h(e,"src",t),s[0]&16&&r!==(r=n[32].name)&&h(e,"alt",r)},d(n){n&&x(e)}}}function Ex(o){let e,t=o[32].environment+"",r;return{c(){e=_("div"),r=B(t),h(e,"class","tenant-env svelte-74c8lg")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s[0]&16&&t!==(t=n[32].environment+"")&&Q(r,t)},d(n){n&&x(e)}}}function Px(o,e){let t,r,n,s,i,a=e[32].name+"",l,c,u,f=e[32].tenantUrl+"",d,p,m,v,g,k,L,I,C=e[32].logo&&Fx(e),M=e[32].environment&&Ex(e);function A(){return e[22](e[32])}function E(){return e[23](e[32])}function P(...T){return e[24](e[32],...T)}return{key:o,first:null,c(){t=_("div"),r=_("div"),C&&C.c(),n=F(),s=_("div"),i=_("div"),l=B(a),c=F(),u=_("div"),d=B(f),p=F(),M&&M.c(),m=F(),v=_("div"),g=_("button"),g.textContent="Remove",k=F(),h(i,"class","tenant-name svelte-74c8lg"),h(u,"class","tenant-url svelte-74c8lg"),h(s,"class","tenant-details svelte-74c8lg"),h(r,"class","tenant-info svelte-74c8lg"),h(g,"class","mod-destructive"),h(g,"title","Remove this tenant"),h(v,"class","tenant-actions svelte-74c8lg"),h(t,"class","tenant-card svelte-74c8lg"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to switch to this tenant"),Te(t,"active",e[32].id===e[3]),this.first=t},m(T,$){w(T,t,$),y(t,r),C&&C.m(r,null),y(r,n),y(r,s),y(s,i),y(i,l),y(s,c),y(s,u),y(u,d),y(s,p),M&&M.m(s,null),y(t,m),y(t,v),y(v,g),y(t,k),L||(I=[V(g,"click",Nl(A)),V(t,"click",E),V(t,"keydown",P)],L=!0)},p(T,$){e=T,e[32].logo?C?C.p(e,$):(C=Fx(e),C.c(),C.m(r,n)):C&&(C.d(1),C=null),$[0]&16&&a!==(a=e[32].name+"")&&Q(l,a),$[0]&16&&f!==(f=e[32].tenantUrl+"")&&Q(d,f),e[32].environment?M?M.p(e,$):(M=Ex(e),M.c(),M.m(s,null)):M&&(M.d(1),M=null),$[0]&24&&Te(t,"active",e[32].id===e[3])},d(T){T&&x(t),C&&C.d(),M&&M.d(),L=!1,we(I)}}}function hP(o){var re,fe,Le;let e,t,r,n,s,i=o[1]&&o[1].trim(),a,l,c,u,f,d,p,m,v,g,k=(((re=o[8])==null?void 0:re.customer)||"Default Tenant")+"",L,I,C,M,A,E=(((fe=o[8])==null?void 0:fe.environment)||o[10].environment)+"",P,T,$,J,N=[],O=new Map,te,Z,Y,ge,j,H;n=new Ue({props:{name:"Add Enterprise Tenant",description:"Enter your organization's tenant URL",$$slots:{default:[mP]},$$scope:{ctx:o}}});let X=i&&Tx(o),ue=((Le=o[8])==null?void 0:Le.logo)&&Ax(o),z=xe(o[4]),ee=de=>de[32].id;for(let de=0;de<z.length;de+=1){let Ee=Mx(o,z,de),Oe=ee(Ee);O.set(Oe,N[de]=Px(Oe,Ee))}return{c(){e=_("div"),t=_("div"),t.innerHTML="<p>Manage your organization&#39;s enterprise Relay tenants. Add tenants to switch between different enterprise deployments.</p>",r=F(),U(n.$$.fragment),s=F(),X&&X.c(),a=F(),l=_("div"),c=_("div"),c.textContent="Available Tenants",u=F(),f=_("div"),d=_("div"),p=_("div"),ue&&ue.c(),m=F(),v=_("div"),g=_("div"),L=B(k),I=F(),C=_("div"),C.textContent=`${o[10].authUrl}`,M=F(),A=_("div"),P=B(E),T=F(),$=_("div"),$.innerHTML="",J=F();for(let de=0;de<N.length;de+=1)N[de].c();te=F(),Z=_("div"),Y=_("button"),Y.textContent="Apply",h(t,"class","setting-item-description"),me(t,"margin-bottom","16px"),h(c,"class","setting-item-name"),h(g,"class","tenant-name svelte-74c8lg"),h(C,"class","tenant-url svelte-74c8lg"),h(A,"class","tenant-env svelte-74c8lg"),h(v,"class","tenant-details svelte-74c8lg"),h(p,"class","tenant-info svelte-74c8lg"),h($,"class","tenant-actions svelte-74c8lg"),h(d,"class","tenant-card svelte-74c8lg"),h(d,"role","button"),h(d,"tabindex","0"),h(d,"title","Click to use default tenant"),Te(d,"active",!o[3]),h(f,"class","tenant-list"),h(l,"class","tenant-list-section svelte-74c8lg"),h(Y,"class","mod-cta apply-btn svelte-74c8lg"),h(Z,"class","apply-section svelte-74c8lg"),h(e,"class","endpoint-config-modal svelte-74c8lg")},m(de,Ee){w(de,e,Ee),y(e,t),y(e,r),R(n,e,null),y(e,s),X&&X.m(e,null),y(e,a),y(e,l),y(l,c),y(l,u),y(l,f),y(f,d),y(d,p),ue&&ue.m(p,null),y(p,m),y(p,v),y(v,g),y(g,L),y(v,I),y(v,C),y(v,M),y(v,A),y(A,P),y(d,T),y(d,$),y(f,J);for(let Oe=0;Oe<N.length;Oe+=1)N[Oe]&&N[Oe].m(f,null);y(e,te),y(e,Z),y(Z,Y),ge=!0,j||(H=[V(d,"click",o[15]),V(d,"keydown",o[21]),V(Y,"click",o[25])],j=!0)},p(de,Ee){var Me,ot,at;let Oe={};Ee[0]&101|Ee[1]&16&&(Oe.$$scope={dirty:Ee,ctx:de}),n.$set(Oe),Ee[0]&2&&(i=de[1]&&de[1].trim()),i?X?X.p(de,Ee):(X=Tx(de),X.c(),X.m(e,a)):X&&(X.d(1),X=null),(Me=de[8])!=null&&Me.logo?ue?ue.p(de,Ee):(ue=Ax(de),ue.c(),ue.m(p,m)):ue&&(ue.d(1),ue=null),(!ge||Ee[0]&256)&&k!==(k=(((ot=de[8])==null?void 0:ot.customer)||"Default Tenant")+"")&&Q(L,k),(!ge||Ee[0]&256)&&E!==(E=(((at=de[8])==null?void 0:at.environment)||de[10].environment)+"")&&Q(P,E),(!ge||Ee[0]&8)&&Te(d,"active",!de[3]),Ee[0]&24600&&(z=xe(de[4]),N=eo(N,Ee,ee,1,de,z,O,f,oi,Px,null,Mx))},i(de){ge||(b(n.$$.fragment,de),ge=!0)},o(de){S(n.$$.fragment,de),ge=!1},d(de){de&&x(e),D(n),X&&X.d(),ue&&ue.d();for(let Ee=0;Ee<N.length;Ee+=1)N[Ee].d();j=!1,we(H)}}}function gP(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=Ye(),u="",f=!1,d={isValid:!0,error:""},p="",m=!1,v="",g=!1,k=0,L=l.loginManager.getEndpointManager().getDefaultUrls(),I=null;function C(){t(18,k++,k)}function M(){t(1,p=""),t(2,m=!1)}function A(H){if(!H.trim())return{isValid:!0,error:""};try{let X=new URL(H);if(l.loginManager.getEndpointManager().isStaging()){if(X.protocol!=="https:"&&X.protocol!=="http:")return{isValid:!1,error:"Only HTTP and HTTPS URLs are allowed in development"}}else if(X.protocol!=="https:")return{isValid:!1,error:"Only HTTPS URLs are allowed in production"};return X.hostname.length<3?{isValid:!1,error:"Invalid hostname"}:{isValid:!0,error:""}}catch(X){return{isValid:!1,error:"Invalid URL format"}}}function E(){return Ae(this,void 0,void 0,function*(){if(u.trim()&&d.isValid){t(5,f=!0);try{let H=yield l.loginManager.getEndpointManager().addTenant(u);H.success?(t(0,u=""),t(1,p=""),t(2,m=!1),C(),t(7,g=!0),H.tenantId&&(yield P(H.tenantId))):(console.log("Add tenant failed with error:",H.error),t(1,p=H.error||"Failed to add tenant"),t(2,m=!0),C())}catch(H){let X=H instanceof Error?H.message:"Unknown error occurred";t(1,p=`Error adding tenant: ${X}`),t(2,m=!0)}finally{t(5,f=!1)}}})}function P(H){return Ae(this,void 0,void 0,function*(){try{let X=yield l.loginManager.getEndpointManager().switchToTenant(H);X.success?(t(7,g=!0),C()):t(1,p=X.error||"Failed to switch tenant")}catch(X){let ue=X instanceof Error?X.message:"Unknown error occurred";t(1,p=`Error switching tenant: ${ue}`)}})}function T(H){return Ae(this,void 0,void 0,function*(){try{(yield l.loginManager.getEndpointManager().removeTenant(H))?(t(7,g=!0),C()):t(1,p="Failed to remove tenant")}catch(X){let ue=X instanceof Error?X.message:"Unknown error occurred";t(1,p=`Error removing tenant: ${ue}`)}})}function $(){return Ae(this,void 0,void 0,function*(){yield l.endpointSettings.update(H=>Object.assign(Object.assign({},H),{activeTenantId:void 0})),l.loginManager.getEndpointManager().clearValidatedEndpoints(),t(7,g=!0),C()})}function J(){return Ae(this,void 0,void 0,function*(){try{return yield l.loginManager.getEndpointManager().getCustomerInfo()}catch(H){return null}})}function N(){return Ae(this,void 0,void 0,function*(){try{let H=l.loginManager.getEndpointManager();t(8,I=yield H.getDefaultTenantInfo())}catch(H){console.log("Failed to load default tenant info:",H),t(8,I=null)}})}lt(()=>{N()});function O(){u=this.value,t(0,u)}let te=H=>H.key==="Enter"||H.key===" "?$():null,Z=H=>T(H.id),Y=H=>P(H.id),ge=(H,X)=>X.key==="Enter"||X.key===" "?P(H.id):null,j=()=>{c(g?"apply":"close")};return o.$$set=H=>{"plugin"in H&&t(16,l=H.plugin)},o.$$.update=()=>{if(o.$$.dirty[0]&327680){e:t(19,r=l.endpointSettings.get())}if(o.$$.dirty[0]&524288){e:t(4,n=r.tenants||[])}if(o.$$.dirty[0]&524288){e:t(3,s=r.activeTenantId)}if(o.$$.dirty[0]&24){e:i=n.find(H=>H.id===s)}if(o.$$.dirty[0]&65536){e:a=l.loginManager.getEndpointManager().hasValidatedEndpoints()}if(o.$$.dirty[0]&131079){e:t(6,d=A(u)),u!==v&&v!==""&&(m&&t(2,m=!1),p&&t(1,p="")),t(17,v=u)}},[u,p,m,s,n,f,d,g,I,c,L,M,E,P,T,$,l,v,k,r,O,te,Z,Y,ge,j]}var km=class extends K{constructor(e){super(),G(this,e,gP,hP,W,{plugin:16},pP,[-1,-1])}},Rx=km;var Mc=class extends Dx.Modal{constructor(t,r,n){super(t);this.plugin=r;this.reload=n;this.setTitle("Enterprise Tenant Configuration")}onOpen(){let{contentEl:t}=this;this.component=new Rx({target:t,props:{plugin:this.plugin,reload:this.reload}}),this.component.$on("close",()=>{this.close()}),this.component.$on("apply",()=>{this.close(),setTimeout(()=>{this.reload()},100)})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Et=crypto,Br=o=>o instanceof CryptoKey;var gr=new TextEncoder,Qt=new TextDecoder,Bj=2**32;function Pn(...o){let e=o.reduce((n,{length:s})=>n+s,0),t=new Uint8Array(e),r=0;for(let n of o)t.set(n,r),r+=n.length;return t}var Ux=o=>{let e=o;typeof e=="string"&&(e=gr.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},no=o=>Ux(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Ox=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Fo=o=>{let e=o;e instanceof Uint8Array&&(e=Qt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Ox(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Im={};au(Im,{JOSEAlgNotAllowed:()=>gi,JOSEError:()=>Bt,JOSENotSupported:()=>pt,JWEDecryptionFailed:()=>Sa,JWEInvalid:()=>kr,JWKInvalid:()=>Tc,JWKSInvalid:()=>Ac,JWKSMultipleMatchingKeys:()=>Fc,JWKSNoMatchingKey:()=>ka,JWKSTimeout:()=>Ec,JWSInvalid:()=>ft,JWSSignatureVerificationFailed:()=>yi,JWTClaimValidationFailed:()=>sr,JWTExpired:()=>hi,JWTInvalid:()=>Gt});var Bt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},sr=class extends Bt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},hi=class extends Bt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},gi=class extends Bt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},pt=class extends Bt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Sa=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},kr=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},ft=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Gt=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Tc=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Ac=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},ka=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Fc=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Ec=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},yi=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var Pc=Et.getRandomValues.bind(Et);function rn(o,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${o}`)}function Rc(o,e){return o.name===e}function Cm(o){return parseInt(o.name.slice(4),10)}function bP(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function vP(o,e){if(e.length&&!e.some(t=>o.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let r=e.pop();t+=`one of ${e.join(", ")}, or ${r}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function $x(o,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!Rc(o.algorithm,"HMAC"))throw rn("HMAC");let r=parseInt(e.slice(2),10);if(Cm(o.algorithm.hash)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Rc(o.algorithm,"RSASSA-PKCS1-v1_5"))throw rn("RSASSA-PKCS1-v1_5");let r=parseInt(e.slice(2),10);if(Cm(o.algorithm.hash)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Rc(o.algorithm,"RSA-PSS"))throw rn("RSA-PSS");let r=parseInt(e.slice(2),10);if(Cm(o.algorithm.hash)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":{if(o.algorithm.name!=="Ed25519"&&o.algorithm.name!=="Ed448")throw rn("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!Rc(o.algorithm,"ECDSA"))throw rn("ECDSA");let r=bP(e);if(o.algorithm.namedCurve!==r)throw rn(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}vP(o,t)}function Bx(o,e,...t){var r;if(t.length>2){let n=t.pop();o+=`one of type ${t.join(", ")}, or ${n}.`}else t.length===2?o+=`one of type ${t[0]} or ${t[1]}.`:o+=`of type ${t[0]}.`;return e==null?o+=` Received ${e}`:typeof e=="function"&&e.name?o+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(r=e.constructor)!=null&&r.name&&(o+=` Received an instance of ${e.constructor.name}`),o}var so=(o,...e)=>Bx("Key must be ",o,...e);function Lm(o,e,...t){return Bx(`Key for the ${o} algorithm must be `,e,...t)}var Mm=o=>Br(o),Pt=["CryptoKey"];var SP=(...o)=>{let e=o.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(let r of e){let n=Object.keys(r);if(!t||t.size===0){t=new Set(n);continue}for(let s of n){if(t.has(s))return!1;t.add(s)}}return!0},bi=SP;function kP(o){return typeof o=="object"&&o!==null}function Vt(o){if(!kP(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var Dc=(o,e)=>{if(o.startsWith("RS")||o.startsWith("PS")){let{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${o} requires key modulusLength to be 2048 bits or larger`)}};var Rn=(o,e,t=0)=>{t===0&&(e.unshift(e.length),e.unshift(6));let r=o.indexOf(e[0],t);if(r===-1)return!1;let n=o.subarray(r,r+e.length);return n.length!==e.length?!1:n.every((s,i)=>s===e[i])||Rn(o,e,r+1)},Hx=o=>{switch(!0){case Rn(o,[42,134,72,206,61,3,1,7]):return"P-256";case Rn(o,[43,129,4,0,34]):return"P-384";case Rn(o,[43,129,4,0,35]):return"P-521";case Rn(o,[43,101,110]):return"X25519";case Rn(o,[43,101,111]):return"X448";case Rn(o,[43,101,112]):return"Ed25519";case Rn(o,[43,101,113]):return"Ed448";default:throw new pt("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},MP=async(o,e,t,r,n)=>{var c;let s,i,a=new Uint8Array(atob(t.replace(o,"")).split("").map(u=>u.charCodeAt(0))),l=e==="spki";switch(r){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},i=l?["verify"]:["sign"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},i=l?["verify"]:["sign"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},i=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let u=Hx(a);s=u.startsWith("P-")?{name:"ECDH",namedCurve:u}:{name:u},i=l?[]:["deriveBits"];break}case"EdDSA":s={name:Hx(a)},i=l?["verify"]:["sign"];break;default:throw new pt('Invalid or unsupported "alg" (Algorithm) value')}return Et.subtle.importKey(e,a,s,(c=n==null?void 0:n.extractable)!=null?c:!1,i)};var qx=(o,e,t)=>MP(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",o,e,t);async function Tm(o,e,t){if(typeof o!="string"||o.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return qx(o,e,t)}var TP=(o,e)=>{if(!(e instanceof Uint8Array)){if(!Mm(e))throw new TypeError(Lm(o,e,...Pt,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Pt.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},AP=(o,e,t)=>{if(!Mm(e))throw new TypeError(Lm(o,e,...Pt));if(e.type==="secret")throw new TypeError(`${Pt.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${Pt.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${Pt.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${Pt.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${Pt.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},FP=(o,e,t)=>{o.startsWith("HS")||o==="dir"||o.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(o)?TP(o,e):AP(o,e,t)},Ca=FP;function OP(o,e,t,r,n){if(n.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new o('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(i=>typeof i!="string"||i.length===0))throw new o('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(let i of r.crit){if(!s.has(i))throw new pt(`Extension Header Parameter "${i}" is not recognized`);if(n[i]===void 0)throw new o(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&r[i]===void 0)throw new o(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(r.crit)}var vi=OP;var NP=(o,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(t=>typeof t!="string")))throw new TypeError(`"${o}" option must be an array of strings`);if(e)return new Set(e)},Fm=NP;var VP=Symbol();function Uc(o,e){let t=`SHA-${o.slice(-3)}`;switch(o){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:o.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new pt(`alg ${o} is not supported either by JOSE or your javascript runtime`)}}function Oc(o,e,t){if(Br(e))return $x(e,o,t),e;if(e instanceof Uint8Array){if(!o.startsWith("HS"))throw new TypeError(so(e,...Pt));return Et.subtle.importKey("raw",e,{hash:`SHA-${o.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(so(e,...Pt,"Uint8Array"))}var HP=async(o,e,t,r)=>{let n=await Oc(o,e,"verify");Dc(o,n);let s=Uc(o,n.algorithm);try{return await Et.subtle.verify(s,n,t,r)}catch(i){return!1}},Kx=HP;async function Nc(o,e,t){var v;if(!Vt(o))throw new ft("Flattened JWS must be an object");if(o.protected===void 0&&o.header===void 0)throw new ft('Flattened JWS must have either of the "protected" or "header" members');if(o.protected!==void 0&&typeof o.protected!="string")throw new ft("JWS Protected Header incorrect type");if(o.payload===void 0)throw new ft("JWS Payload missing");if(typeof o.signature!="string")throw new ft("JWS Signature missing or incorrect type");if(o.header!==void 0&&!Vt(o.header))throw new ft("JWS Unprotected Header incorrect type");let r={};if(o.protected)try{let g=Fo(o.protected);r=JSON.parse(Qt.decode(g))}catch(g){throw new ft("JWS Protected Header is invalid")}if(!bi(r,o.header))throw new ft("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...r,...o.header},s=vi(ft,new Map([["b64",!0]]),t==null?void 0:t.crit,r,n),i=!0;if(s.has("b64")&&(i=r.b64,typeof i!="boolean"))throw new ft('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new ft('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=t&&Fm("algorithms",t.algorithms);if(l&&!l.has(a))throw new gi('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof o.payload!="string")throw new ft("JWS Payload must be a string")}else if(typeof o.payload!="string"&&!(o.payload instanceof Uint8Array))throw new ft("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=await e(r,o),c=!0),Ca(a,e,"verify");let u=Pn(gr.encode((v=o.protected)!=null?v:""),gr.encode("."),typeof o.payload=="string"?gr.encode(o.payload):o.payload),f;try{f=Fo(o.signature)}catch(g){throw new ft("Failed to base64url decode the signature")}if(!await Kx(a,e,f,u))throw new yi;let p;if(i)try{p=Fo(o.payload)}catch(g){throw new ft("Failed to base64url decode the payload")}else typeof o.payload=="string"?p=gr.encode(o.payload):p=o.payload;let m={payload:p};return o.protected!==void 0&&(m.protectedHeader=r),o.header!==void 0&&(m.unprotectedHeader=o.header),c?{...m,key:e}:m}async function Em(o,e,t){if(o instanceof Uint8Array&&(o=Qt.decode(o)),typeof o!="string")throw new ft("Compact JWS must be a string or Uint8Array");let{0:r,1:n,2:s,length:i}=o.split(".");if(i!==3)throw new ft("Invalid Compact JWS");let a=await Nc({payload:n,protected:r,signature:s},e,t),l={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?{...l,key:a.key}:l}var Pm=o=>Math.floor(o.getTime()/1e3);var qP=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,$c=o=>{let e=qP.exec(o);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let t=parseFloat(e[2]),r=e[3].toLowerCase(),n;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(t*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(t*3600);break;case"day":case"days":case"d":n=Math.round(t*86400);break;case"week":case"weeks":case"w":n=Math.round(t*604800);break;default:n=Math.round(t*31557600);break}return e[1]==="-"||e[4]==="ago"?-n:n};var Gx=o=>o.toLowerCase().replace(/^application\//,""),zP=(o,e)=>typeof o=="string"?e.includes(o):Array.isArray(o)?e.some(Set.prototype.has.bind(new Set(o))):!1,Bc=(o,e,t={})=>{let{typ:r}=t;if(r&&(typeof o.typ!="string"||Gx(o.typ)!==Gx(r)))throw new sr('unexpected "typ" JWT header value',"typ","check_failed");let n;try{n=JSON.parse(Qt.decode(e))}catch(m){}if(!Vt(n))throw new Gt("JWT Claims Set must be a top-level JSON object");let{requiredClaims:s=[],issuer:i,subject:a,audience:l,maxTokenAge:c}=t,u=[...s];c!==void 0&&u.push("iat"),l!==void 0&&u.push("aud"),a!==void 0&&u.push("sub"),i!==void 0&&u.push("iss");for(let m of new Set(u.reverse()))if(!(m in n))throw new sr(`missing required "${m}" claim`,m,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(n.iss))throw new sr('unexpected "iss" claim value',"iss","check_failed");if(a&&n.sub!==a)throw new sr('unexpected "sub" claim value',"sub","check_failed");if(l&&!zP(n.aud,typeof l=="string"?[l]:l))throw new sr('unexpected "aud" claim value',"aud","check_failed");let f;switch(typeof t.clockTolerance){case"string":f=$c(t.clockTolerance);break;case"number":f=t.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:d}=t,p=Pm(d||new Date);if((n.iat!==void 0||c)&&typeof n.iat!="number")throw new sr('"iat" claim must be a number',"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new sr('"nbf" claim must be a number',"nbf","invalid");if(n.nbf>p+f)throw new sr('"nbf" claim timestamp check failed',"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new sr('"exp" claim must be a number',"exp","invalid");if(n.exp<=p-f)throw new hi('"exp" claim timestamp check failed',"exp","check_failed")}if(c){let m=p-n.iat,v=typeof c=="number"?c:$c(c);if(m-f>v)throw new hi('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(m<0-f)throw new sr('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return n};async function Rm(o,e,t){var i;let r=await Em(o,e,t);if((i=r.protectedHeader.crit)!=null&&i.includes("b64")&&r.protectedHeader.b64===!1)throw new Gt("JWTs MUST NOT use unencoded payload");let s={payload:Bc(r.protectedHeader,r.payload,t),protectedHeader:r.protectedHeader};return typeof e=="function"?{...s,key:r.key}:s}var JP,Vc,Yx;(typeof navigator=="undefined"||!((Yx=(Vc=navigator.userAgent)==null?void 0:Vc.startsWith)!=null&&Yx.call(Vc,"Mozilla/5.0 ")))&&(JP="jose/v5.3.0");var Dm={};au(Dm,{decode:()=>Hc,encode:()=>QP});var QP=no,Hc=Fo;function La(o){if(typeof o!="string")throw new Gt("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new Gt("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Gt("Invalid JWT");if(!e)throw new Gt("JWTs must contain a payload");let r;try{r=Hc(e)}catch(s){throw new Gt("Failed to base64url decode the payload")}let n;try{n=JSON.parse(Qt.decode(r))}catch(s){throw new Gt("Failed to parse the decoded payload as JSON")}if(!Vt(n))throw new Gt("Invalid JWT Claims Set");return n}function Zx(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function YP(o){let e=La(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var qc=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=YP,this.maxConnections=t,this.refreshInterval=null,$t.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=a=>{r(a)},i=a=>{this.removeFromRefreshQueue(e),n(a)};this.refresh(e,s,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){var n;let t=this.tokenMap.get(e),r=((n=t==null?void 0:t.attempts)!=null?n:0)+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){var a;let n=this._activePromises.get(e);if(n)return n;let s=this.tokenMap.get(e);this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:(a=s==null?void 0:s.attempts)!=null?a:0}),this.callbacks.set(e,r);let i=this.onRefresh(e).then(l=>(this.onTokenRefreshed(e,l),this._activePromises.delete(e),l)).catch(l=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),l});return this._activePromises.set(e,i),i}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Error("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,i)=>s[1].expiryTime-i[1].expiryTime);for(let[s,{friendlyName:i,expiryTime:a,attempts:l}]of n){if(!e(s))continue;let c=a-r,u="";c>0?u=`expires in ${Zx(c-this.expiryMargin)}`:u="expired",t.push(`${s} (${i}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${Zx(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function ZP(o){return o.expiryTime||0}function XP(o,e){return(...t)=>e(o,...t)}async function eR(o,e,t,r){var c;let n=Fe("[TokenStore][Refresh]","debug"),s=Fe("[TokenStore][Refresh]","error");n(`${e}`);let i=bt.decode(e),a;if(i instanceof vo)a=JSON.stringify({docId:i.documentId,relay:i.relayId,folder:i.folderId});else if(i instanceof Yr)a=JSON.stringify({docId:i.canvasId,relay:i.relayId,folder:i.folderId});else if(i instanceof Vo)a=JSON.stringify({docId:i.folderId,relay:i.relayId,folder:i.folderId});else if(i instanceof _o)a=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.6.1","Content-Type":"application/json"};try{let u=o.getEndpointManager().getApiUrl(),f=await it(`${u}/token`,{method:"POST",headers:l,body:a});if(!f.ok){n(f.status,await f.text()),r(Error(`Received status code ${f.status} from an API.`));return}let d=await f.json();t(d)}catch(u){s(u,a),r(u)}}var zc=class extends qc{constructor(t,r,n,s=5){super({log:Fe("[LiveTokenStore]","debug"),refresh:XP(t,eR),getJwtExpiry:ZP,getStorage:function(){return new Wo("TokenStore/"+n)},getTimeProvider:()=>r},s);this.loginManager=t}async getFileTokenFromNetwork(t,r,n,s){let i=`${t}${r}`,a=this._activePromises.get(i);if(a)return a;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,n,s).then(c=>{let u=this.getJwtExpiry(c),f=this.tokenMap.get(i);return this.tokenMap.set(r,{...f,token:c,expiryTime:u}),this._activePromises.delete(i),c}).catch(c=>{throw this._activePromises.delete(i),c});return this._activePromises.set(i,l),l}async fetchFileToken(t,r,n,s){var p;let i=Fe("[TokenStore][Fetch]","debug");i(`${t}`);let a=bt.decode(t),l;if(a instanceof _o)l=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId,hash:r,contentType:n,contentLength:s});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(p=this.loginManager.user)==null?void 0:p.token}`,"Relay-Version":"0.6.1","Content-Type":"application/json"},u=this.loginManager.getEndpointManager().getApiUrl(),f=await it(`${u}/file-token`,{method:"POST",headers:c,body:l});if(!f.ok){i(f.status,await f.text());let m=await f.json();throw new Error(m.error)}return await f.json()}async getFileToken(t,r,n,s){let i=`${t}${r}`,a=this.tokenMap.get(i);return a&&a.token&&this.isTokenValid(a)?(this.log("token was valid, cache hit!"),this._activePromises.delete(i),Promise.resolve(a.token)):this.getFileTokenFromNetwork(t,r,n,s)}};var Xx=require("obsidian");var Um=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Fe("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,Xx.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.6.1"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{var t;if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,(t=this.onOffline)==null||t.forEach(r=>r(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},ew=Um;var Yt=class extends st{constructor(t){super();this.observableName=t;this.derivedMapRefCounts=new WeakMap;this.activeDerivedMaps=new Set;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}subscribe(t){let r=null;for(let s of this.activeDerivedMaps)if(s&&s.parentCallback===t){r=s;break}if(r){let s=this.derivedMapRefCounts.get(r)||0;this.derivedMapRefCounts.set(r,s+1)}let n=super.subscribe(t);return()=>{if(r){let i=(this.derivedMapRefCounts.get(r)||0)-1;i<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,i)}n()}}unsubscribe(t){for(let r of this.activeDerivedMaps)if(r&&r.parentCallback===t){let s=(this.derivedMapRefCounts.get(r)||0)-1;s<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,s);break}super.unsubscribe(t)}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Om(this,t);return this._derivedMaps.set(t,n),this.derivedMapRefCounts.set(n,0),this.activeDerivedMaps.add(n),n}},Om=class extends Yt{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.parentCallback=()=>{let n=new Map;this.parentMap.forEach((s,i)=>{this.predicate(s,i)&&n.set(i,s)}),this._map=n,this.notifyListeners()},this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(this.parentCallback))}subscribe(t){return this.sub(),super.subscribe(t)}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsub&&(this.unsub(),this.unsub=void 0),(t=this._listeners)==null||t.clear(),this.parentCallback=null)}};var _i=class extends st{constructor(t,r){super();this.evaluate=t;this.unsubscribes=[];this.subscriberCount=0;this.observableName="ObservablePermission";this.currentValue=this.evaluate(),r.forEach(n=>{let s=n.on(()=>{let i=this.evaluate();i!==this.currentValue&&(this.currentValue=i,this.notifyListeners())});this.unsubscribes.push(s)})}subscribe(t){if(this.destroyed)throw new Error("Cannot subscribe to destroyed ObservablePermission");this.subscriberCount++,t(this.currentValue);let r=this.on(()=>{t(this.currentValue)});return()=>{r(),this.subscriberCount--,this.subscriberCount===0&&this.destroy()}}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsubscribes.forEach(r=>r()),this.unsubscribes.length=0,(t=this._listeners)==null||t.clear())}},jc=class{constructor(e){this.relayManager=e;this.policies=new Map;this.registerBuiltinPolicies()}isAllowed(e){let t=this.getResourceType(e.resource),r=`${t}:${e.action}`,n=this.policies.get(r);if(!n)return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}};try{return{allowed:n.evaluate(e,this.relayManager),policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}catch(s){return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}}can(e,t,r,n){let s=this.getResourceType(r),i=t[1];if(t[0]!==r[0])throw new Error(`unexpected permission/resource mismatch ${t[0]} ${r[0]}`);let a=`${s}:${i}`,l=this.policies.get(a),c={principal:e,action:i,resource:r,context:n},u=l?this.getFilteredCollections(l.dependencies,c):[];return new _i(()=>this.isAllowed(c).allowed,u)}getPolicies(){return Array.from(this.policies.keys()).sort()}registerPolicy(e){let[t,r]=e.permission,n=`${t}:${r}`;this.policies.set(n,e)}getResourceType(e){return e[0]}getResourceId(e){return e[1]}getFilteredCollections(e,t){let r=[];for(let n of Object.keys(e)){let s=this.relayManager.getCollectionMapByName(n);s&&r.push(s)}return r}registerBuiltinPolicies(){this.registerPolicy({permission:["folder","delete"],description:"Delete a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDelete.bind(this)}),this.registerPolicy({permission:["folder","rename"],description:"Rename a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRename.bind(this)}),this.registerPolicy({permission:["folder","read_content"],description:"Read folder contents and add to vault",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRead.bind(this)}),this.registerPolicy({permission:["folder","edit_content"],description:"Edit notes in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderWrite.bind(this)}),this.registerPolicy({permission:["folder","upload"],description:"Upload attachments to folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource),relays:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.id===r.relayId)},storage_quotas:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource)),n=r&&this.relayManager.relays.get(r.relayId);return!!(n&&e.id===n.storageQuotaId)}},evaluate:this.evaluateFolderUpload.bind(this)}),this.registerPolicy({permission:["folder","download"],description:"Download attachments from folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDownload.bind(this)}),this.registerPolicy({permission:["folder","manage_files"],description:"Add/remove/rename files in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageFiles.bind(this)}),this.registerPolicy({permission:["relay","delete"],description:"Delete a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayDelete.bind(this)}),this.registerPolicy({permission:["relay","rename"],description:"Rename a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayRename.bind(this)}),this.registerPolicy({permission:["relay","manage_users"],description:"Manage users in relay server (add/remove/change roles)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageUsers.bind(this)}),this.registerPolicy({permission:["relay","manage_sharing"],description:"Manage relay share keys (enable/disable sharing, rotate keys)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageSharing.bind(this)}),this.registerPolicy({permission:["subscription","manage"],description:"Manage relay subscriptions and plans",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateSubscriptionManage.bind(this)}),this.registerPolicy({permission:["folder","manage_users"],description:"Manage users in folder (add/remove/change roles)",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageUsers.bind(this)})}isFolderCreator(e,t){let r=this.relayManager.remoteFolders.get(t);return(r==null?void 0:r.creatorId)===e}isRelayOwnerForFolder(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwner(e,r.relayId):!1}isRelayOwner(e,t){return!!this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e&&n.role==="Owner")}hasRelayRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.relayRoles.find(i=>i.relayId===t&&i.userId===e&&n.includes(i.role))}hasFolderRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.folderRoles.find(i=>i.sharedFolderId===t&&i.userId===e&&n.includes(i.role))}hasFolderAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.getUserFolderRole(e,t)?!0:r.private?!1:!!this.getUserRelayRole(e,r.relayId):!1}hasFolderWriteAccess(e,t){let r=this.relayManager.remoteFolders.get(t);if(!r)return!1;let n=this.getUserFolderRole(e,t);if(n&&this.roleHasWritePermission(n))return!0;if(!r.private){let s=this.getUserRelayRole(e,r.relayId);if(s&&this.roleHasWritePermission(s))return!0}return!1}hasFolderManagementAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwnerForFolder(e,t)?!0:r.private?this.hasFolderRole(e,t,["Owner"]):this.isFolderCreator(e,t):!1}getUserFolderRole(e,t){let r=this.relayManager.folderRoles.find(n=>n.sharedFolderId===t&&n.userId===e);return(r==null?void 0:r.role)||null}getUserRelayRole(e,t){let r=this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e);return(r==null?void 0:r.role)||null}roleHasWritePermission(e){return["Owner","Member"].includes(e)}hasStorageQuota(e,t){let r=this.relayManager.remoteFolders.get(e);if(!r)return!1;let n=this.relayManager.relays.get(r.relayId);if(!n)return!1;let s=n.storageQuota;return s?s.usage+t<=s.quota:!0}evaluateFolderDelete(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRename(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRead(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderWrite(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderDownload(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderManageFiles(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderUpload(e){var n;let t=this.getResourceId(e.resource),r=((n=e.context)==null?void 0:n.fileSize)||0;return this.hasFolderWriteAccess(e.principal,t)&&this.hasStorageQuota(t,r)}evaluateRelayDelete(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayRename(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageUsers(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageSharing(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateSubscriptionManage(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateFolderManageUsers(e){let t=this.getResourceId(e.resource);return this.relayManager.remoteFolders.get(t)?this.isRelayOwnerForFolder(e.principal,t)?!0:this.hasFolderRole(e.principal,t,["Owner"]):!1}};function Nm(o){return typeof o.id=="string"}function tR(o){return typeof o.name=="string"}var Bm=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function tw(o){return typeof o.aggregate_root=="object"}function $m(o){return o&&Array.isArray(o.permissionParents)}var Ma=class{get aggregate_root(){}get permissionParents(){return[]}},Vm=class extends st{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get name(){return this.storageQuota.name}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get metered(){return this.storageQuota.metered}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}get aggregate_root(){var t;return["relays",(t=this.relays.find(r=>r.storageQuotaId===this.storageQuota.id))==null?void 0:t.id]}},Hm=class{constructor(e,t,r){this.subscribeRecord=e;this.storageQuota=t;this.relays=r;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new Vm(e,this.relays);return this.subscribeRecord(this.collectionName,e.id,[]).then(n=>{r.offRecordSubscription=n}),this.storageQuota.set(e.id,r),r}delete(e){var r;let t=this.storageQuota.get(e);(r=t==null?void 0:t.offRecordSubscription)==null||r.call(t),this.storageQuota.delete(e)}},Wc=class extends Ma{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},qm=class extends st{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}get publicKey(){return this.provider.public_key}get keyType(){return this.provider.key_type}get keyId(){return this.provider.key_id}update(t){return this.provider=t,this}},zm=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new qm(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},jm=class extends st{constructor(t,r,n,s,i,a){super();this.remoteFolder=t;this.relays=r;this.relayRoles=n;this.folderRoles=s;this.users=i;this.user=a}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}set name(t){this.remoteFolder.name=t}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get creatorId(){return this.remoteFolder.creator}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get relayId(){return this.remoteFolder.relay}get role(){var s,i;let t=this.remoteFolder.creator===this.user.id,r=(s=this.relayRoles.find(a=>a.relayId===this.relay.id&&a.userId===this.user.id))==null?void 0:s.role,n=(i=this.folderRoles.find(a=>a.sharedFolderId===this.remoteFolder.id&&a.userId===this.user.id))==null?void 0:i.role;if(this.remoteFolder.private){if(n)return n}else return r||this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":r||"Member";return this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member"}get owner(){return this.role==="Owner"}get aggregate_root(){return["relays",this.remoteFolder.relay]}get permissionParents(){var n,s;let t=[],r=(n=this.relayRoles.find(i=>i.relayId===this.relayId&&i.userId===this.user.id))==null?void 0:n.id;if(r&&t.push(["relay_roles",r]),this.remoteFolder.private){let i=(s=this.folderRoles.find(a=>a.sharedFolderId===this.id&&a.userId===this.user.id))==null?void 0:s.id;i&&t.push(["shared_folder_roles",i])}return t}},Wm=class{constructor(e,t,r,n,s,i){this.remoteFolders=e;this.relays=t;this.folderRoles=r;this.relayRoles=n;this.users=s;this.user=i;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new jm(e,this.relays,this.relayRoles,this.folderRoles,this.users,this.user);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},Km=class{constructor(e,t,r,n,s,i,a,l){this.relays=e;this.relayRoles=t;this.relayInvitations=r;this.remoteFolders=n;this.subscriptions=s;this.storageQuotas=i;this.providers=a;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new nh(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Gm=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new eh(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Jm=class{constructor(e,t,r,n){this.folderRoles=e;this.remoteFolders=t;this.users=r;this.roles=n;this.collectionName="shared_folder_roles"}items(){return this.folderRoles.values()}clear(){this.folderRoles.clear()}get(e){return this.folderRoles.get(e)}ingest(e){let t=this.folderRoles.get(e.id);if(t)return t.update(e),this.folderRoles.notifyListeners(),t;let r=new th(e,this.remoteFolders,this.users,this.roles);return this.folderRoles.set(r.id,r),r}delete(e){this.folderRoles.delete(e)}},Qm=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new rh(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Ym=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new Wc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Zm=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new oh(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Xm=class extends Mt{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);$t.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=$r.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=$r.getInstance();r.beginTransaction();let n=this._ingest(t);return r.commitTransaction(),n}_ingest(t){if(!t)return;let r,n=this.collections.get(t.collectionName);if(n?r=n.ingest(t):this.error("No collection found for record",t),tw(r)){let s=r.aggregate_root;if(s){let i=t.id,a=this.relationships.get(s.join(":"))||new Set;a.add([t.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if($m(r)){let s=r.permissionParents;for(let i of s){let a=t.id,l=this.relationships.get(i.join(":"))||new Set;l.add([t.collectionName,a].join(":")),this.relationships.set(i.join(":"),l)}}if(t.expand)for(let[,s]of Object.entries(t.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,n]of this.collections)for(let s of n.items()){if(!Nm(s)){this.warn("record has no id",s);continue}let i=r+"_"+s.id;if(tR(s)&&(i=r+"_"+s.name),t+=`  ${r}_${s.id} [label="${i}"];
`,Nm(s)&&tw(s)&&s.aggregate_root){let[a,l]=s.aggregate_root;t+=`  ${r}_${s.id} -> ${a}_${l};
`}if(Nm(s)&&$m(s))for(let a of s.permissionParents){let[l,c]=a;t+=`  ${r}_${s.id} -> ${l}_${c} [style=dotted];
`}}return t+="}",t}cascade(t,r){let n=this.collections.get(t),s=this.relationships.get([t,r].join(":")),i=$r.getInstance();i.beginTransaction(),n&&(this.warn("cascade delete parent",t,r),n.delete(r)),this.relationships.delete([t,r].join(":"));for(let a of s||[]){let[l,c]=a.split(":");try{let f=this.getCollection(l).get(c);if($m(f)){let d=f.permissionParents.filter(p=>{let[m,v]=p;try{return!!this.getCollection(m).get(v)}catch(g){return this.warn("Parent collection not found during validation",m,g),!1}});d.length===0?(this.warn("cascade delete child (no valid permission parents)",l,c),this.cascade(l,c)):this.warn("preserving child with valid permission parents",l,c,d)}else this.warn("cascade delete child",l,c),this.cascade(l,c)}catch(u){this.warn("Failed to process child during cascade",l,c,u)}}i.commitTransaction()}},eh=class extends Ma{constructor(t,r,n,s){super();this.users=n,this.roles=s,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get permissionParents(){return[["users",this.relayRole.user]]}},th=class extends Ma{constructor(t,r,n,s){super();this.folderRole=t;this.remoteFolders=r;this.users=n;this.roles=s}update(t){return this.folderRole=t,this}get id(){return this.folderRole.id}get userId(){return this.folderRole.user}get user(){let t=this.users.get(this.folderRole.user);if(!t)throw new Error(`Unable to find user: ${this.folderRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.folderRole.role))==null?void 0:t.name}get sharedFolderId(){return this.folderRole.shared_folder}get sharedFolder(){let t=this.remoteFolders.get(this.folderRole.shared_folder);if(!t)throw new Error(`invalid role: unable to find folder ${this.folderRole.shared_folder} on role ${this.folderRole.id}`);return t}get aggregate_root(){return["shared_folders",this.folderRole.shared_folder]}get permissionParents(){return[["shared_folders",this.folderRole.shared_folder]]}},rh=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},oh=class extends st{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get permissionParents(){return[["users",this.subscription.user]]}},nh=class extends st{constructor(t,r,n,s,i,a,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get version(){return this.relay.version}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get storageQuotaId(){return this.relay.storage_quota}get folders(){return this.remoteFolders.filter(t=>{let r=t.relayId===this.id,n=t.permissionParents.length>0;return r&&n})}get subscriptions(){return this._subscriptions.filter(t=>t.relayId===this.id)}get permissionParents(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;return t?[["relay_roles",t]]:[]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},Kc=class extends Mt{constructor(t){super();this.loginManager=t;this.destroyed=!1;this._handleEvent=(t,r)=>{var n,s;this.debug(`[Event]: ${t}`,r.action,r.record),r.action==="delete"?(n=this.store)==null||n.delete(r.record):(s=this.store)==null||s.ingest(r.record)};this.pb=this.loginManager.pb,this.users=new Yt("users"),this.relays=new Yt("relays"),this.providers=new Yt("providers"),this.remoteFolders=new Yt("remote folders"),this.relayInvitations=new Yt("relay invitations"),this.relayRoles=new Yt("relay roles"),this.folderRoles=new Yt("folder roles"),this.roles=new Yt("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new Yt("subscriptions"),this.storageQuotas=new Yt("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.loginManager.loggedIn?this.login():this.logout()}),this.setUser(),this.user&&($t.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new Bm(this.roles),r=new Ym(this.users),n=new zm(this.providers),s=new Km(this.relays,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),i=new Gm(this.relayRoles,this.relays,this.users,this.roles),a=new Jm(this.folderRoles,this.remoteFolders,this.users,this.roles),l=new Qm(this.relayInvitations,this.relays,this.roles),c=new Wm(this.remoteFolders,this.relays,this.folderRoles,this.relayRoles,this.users,this.user),u=new Zm(this.subscriptions,this.relays,this.users),f=new Hm(this.subscribeRecord.bind(this),this.storageQuotas,this.relays);this.store=new Xm([t,r,s,i,a,l,c,u,f,n]),this.policyManager=new jc(this)}getCollectionMapByName(t){switch(t){case"folder_roles":return this.folderRoles;case"relay_roles":return this.relayRoles;case"shared_folders":return this.remoteFolders;case"relays":return this.relays;case"storage_quotas":return this.storageQuotas;case"subscriptions":return this.subscriptions;default:console.warn(`Unknown collection name: ${t}`);return}}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new Wc(this.authUser),this.users.set(this.user.id,this.user))}login(){var t;this.authUser&&this.authUser==((t=this.pb)==null?void 0:t.authStore.model)||(this.setUser(),this.buildGraph(),this.subscribe(),this.update())}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var s;let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("unable to rotate key");return n})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(n=>{var i;let s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("unable to toggle invitation enable");return s})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(n=>n.relayId===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(i=>{var a;(a=this.store)==null||a.ingest(i)});let s=this.relayInvitations.find(i=>i.relayId===t.id);if(s)return s})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"shared_folder_roles",expand:["user","shared_folder"]},{name:"subscriptions",expand:["user","relay"]}];for(let n of t)this.pb.collection(n.name).subscribe("*",s=>this._handleEvent(n.name,s),{expand:n.expand.join(","),fetch:it})}async subscribeRecord(t,r,n){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}return this.pb.collection(t).subscribe(r,i=>this._handleEvent(t,i),{expand:n.join(","),fetch:it})}async refreshRemoteFolder(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("shared_folders").getOne(t.id,{expand:"shared_folder_roles_via_shared_folder"});!this.destroyed&&this.store&&this.store.ingest(r)}async refreshRelay(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("relays").getOne(t.id,{expand:"relay_roles_via_relay,shared_folders_via_relay,storage_quota"});!this.destroyed&&this.store&&this.store.ingest(r)}async update(){let t=(n,s={})=>{var i;return!this.pb||!this.pb.authStore.isValid||((i=this.pb.authStore.model)==null?void 0:i.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user,role"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("shared_folder_roles",{expand:"user,role"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let i of s)!this.destroyed&&this.store&&this.store.ingest(i)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(i=>{throw i});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var i,a;let r=Qs(),n=await((i=this.pb)==null?void 0:i.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=(a=this.store)==null?void 0:a.ingest(n);if(!s)throw new Error("Failed to create relay");return s}async createSelfHostedRelay(t,r,n){var l;if(!this.pb)throw new Error("Not connected to relay service");let s={};if(r)s.provider=r;else if(t)s.url=t;else throw new Error("Either URL or provider ID must be provided");n&&(s.organization=n);let i=await this.pb.send("/api/collections/relays/self-host",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=(l=this.store)==null?void 0:l.ingest(i);if(!a)throw new Error("Failed to create self-hosted relay");return a}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var r;return await((r=this.pb)==null?void 0:r.collection("shared_folders").delete(t.id)),!0}async createRemoteFolder(t,r,n=!1,s=void 0){var l,c;if(!this.pb)throw new Error("Failed to create folder");let i=await this.pb.collection("shared_folders").create({name:s||t.name,guid:t.guid,relay:r.id,creator:(l=this.user)==null?void 0:l.id,private:n},{expand:"relay"}),a=(c=this.store)==null?void 0:c.ingest(i);if(!a)throw new Error("Failed to create folder");return a}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(i=>{var a;return i.userId===((a=this.user)==null?void 0:a.id)&&i.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}async updateRelayRole(t,r){var a;if(!this.pb)throw new Error("Failed to update relay role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update relay role");let s=await this.pb.collection("relay_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update relay role");return i}async addFolderRole(t,r,n){var l;if(!this.pb)throw new Error("Failed to add folder role");let s=this.roles.find(c=>c.name===n);if(!s)throw new Error("Failed to find role");let i=await this.pb.collection("shared_folder_roles").create({user:r,shared_folder:t.id,role:s.id}),a=(l=this.store)==null?void 0:l.ingest(i);if(!a)throw new Error("Failed to add folder role");return a}async removeFolderRole(t){if(!this.pb)throw new Error("Failed to remove folder role");await this.pb.collection("shared_folder_roles").delete(t.id)}async updateFolderRole(t,r){var a;if(!this.pb)throw new Error("Failed to update folder role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update folder role");let s=await this.pb.collection("shared_folder_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update folder role");return i}async updateFolderPrivacy(t,r){var i;if(!this.pb)throw new Error("Failed to update folder privacy");let n=await this.pb.collection("shared_folders").update(t.id,{private:r}),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder privacy");return s}async updateRemoteFolder(t,r){var i;if(!this.pb)throw new Error("Failed to update folder");let n=await this.pb.collection("shared_folders").update(t.id,r),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder");return s}can(t,r,n,s){if(!this.policyManager)return new _i(()=>!1,[]);let[i]=r,a=[i,n.id];return this.policyManager.can(t,r,a,s)}userCan(t,r,n){return this.user?this.can(this.user.id,t,r,n):new _i(()=>!1,[])}destroy(){var t,r,n;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(n=this.store)==null||n.destroy(),this.pb=null,this.authUser=null,this.store=null,this.policyManager=void 0}};var H1=require("obsidian");var rw=require("obsidian");function Dn(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let i=t[s].match(/\d+/g),a=r[s].match(/\d+/g);if(i&&a){let l=parseInt(i[0]),c=parseInt(a[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}var Gc=class extends Mt{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new _n;this.activeDownloads=new _n;this.syncGroups=new Yt;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;$t.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,i=0,a=0;this.syncGroups.forEach(f=>{t+=f.total,r+=f.completed,n+=f.syncs,s+=f.completedSyncs,i+=f.downloads,a+=f.completedDownloads});let l=t>0?r/t*100:0,c=n>0?s/n*100:0,u=i>0?a/i*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:i,completedDownloads:a}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,i=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(i),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc;n instanceof kn?await this.syncFile(n):await this.syncDocument(n),r.status="completed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.debug(`[Sync Progress] Before: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completedSyncs++,i.completed++,this.debug(`[Sync Progress] After: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completed===i.total&&(i.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,i))}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Sync Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(n=>n.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{r.doc instanceof wt?await this.getCanvas(r.doc):r.doc instanceof kn?await this.getSyncFile(r.doc):await this.getDocument(r.doc),r.status="completed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let s=this.syncGroups.get(r.sharedFolder);s&&(s.completedDownloads++,s.completed++,s.completed===s.total&&(s.status="completed"),this.syncGroups.set(r.sharedFolder,s))}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.error("[processDownloadQueue]",n)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(n=>n.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?new Promise((l,c)=>{a.resolve=l,a.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.total++,s.syncs++,this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let i=new Promise((a,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort(Dn),this.processSyncQueue(),i}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let a=this.downloadCompletionCallbacks.get(t.guid);return a?(this.processDownloadQueue(),new Promise((l,c)=>{a.resolve=l,a.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let i=new Promise((a,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort(Dn),this.processDownloadQueue(),i}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(Xr),n=[...t.files.values()].filter(Go),s=[...t.files.values()].filter(xr),i=[...r,...n,...s],a={sharedFolder:t,total:i.length,completed:0,status:"pending",downloads:0,syncs:i.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let l=[...r].sort(Dn),c=[...n].sort(Dn),u=[...s].sort(Dn);for(let f of l)this.enqueueDocumentForGroupSync(f);for(let f of c)this.enqueueCanvasForGroupSync(f,t);for(let f of u)this.enqueueSyncFileForGroupSync(f);a.status="running",this.syncGroups.set(t,a)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(Dn),this.processSyncQueue(),s}async enqueueSyncFileForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSyncFileForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(Dn),this.processSyncQueue(),s}getAuthHeader(t){return{Authorization:`Bearer ${t.token}`}}getBaseUrl(t,r){var a;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");return s.pop(),s.push(t.docId),n.pathname=s.join("/"),((a=t.baseUrl)==null?void 0:a.replace(/\/$/,""))||n.toString()}async downloadItem(t){let r=u=>u instanceof Yr?u.canvasId:u.documentId,n=t.s3rn;if(this.log("[downloadItem]",t.path,`${bt.encode(n)}`),!(n instanceof vo||n instanceof Yr))throw new Error(`Unable to decode S3RN: ${bt.encode(n)}`);let s=await t.getProviderToken(),i=this.getAuthHeader(s),l=`${this.getBaseUrl(s,n)}/as-update`,c=await(0,rw.requestUrl)({url:l,method:"GET",headers:i,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(n),c.status);else throw this.error("[downloadItem]",r(n),l,c.status,c.text),new Error(`Unable to download item: ${bt.encode(n)}`);return c}async syncDocumentWebsocket(t){let r="",n="",s=null;Go(t)?(s=wt.exportCanvasData(t.ydoc),n=JSON.stringify(s)):Xr(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let i=!1;if(Go(t)&&s){let c=r?JSON.parse(r):{nodes:[],edges:[]};i=In(s,c)}else i=n===r;if(!i&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&await a,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(bt.encode(t.s3rn))),!0}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async enqueueCanvasForGroupSync(t,r){try{if(!r.syncStore.has(t.path)){this.debug("[enqueueCanvasForGroupSync] Skipping canvas, not in sync list",t.path);return}await this.enqueueDownload(t)}catch(n){this.error("[enqueueCanvasForGroupSync]",n)}}async getCanvas(t,r=3,n=3e3){try{let s=wt.exportCanvasData(t.ydoc),i={edges:[],nodes:[]};try{let d=await t.sharedFolder.read(t);i=JSON.parse(d)}catch(d){}let a=In(s.edges,i.edges)&&In(s.nodes,i.nodes),l=i.nodes.length>0,u=(await this.downloadItem(t)).arrayBuffer,f=new Uint8Array(u);if(this.log("[getCanvas] applying content from server"),yo(t.ydoc,f),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(s){throw this.error(s),s}}async getDocument(t,r=3,n=3e3){try{let s=t.text,i="";try{i=await t.sharedFolder.read(t)}catch(v){}let a=s===i,l=i!=="",u=(await this.downloadItem(t)).arrayBuffer,f=new Uint8Array(u),d=new Er;yo(d,f);let p=d.getMap("users");if(d.getText("contents").toString()===""){if(p.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",p.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),yo(t.ydoc,f),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncFile(t){t.sync()}async getSyncFile(t){t.pull()}async syncDocument(t){try{Xr(t)?await this.syncDocumentWebsocket(t):Go(t)&&await this.syncDocumentWebsocket(t)}catch(r){console.error(r);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),i=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),i()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var aw=require("obsidian");var sw=require("obsidian");function rR(o){Ce(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function ow(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function nw(o){let e,t,r,n=o[8]+"",s,i,a,l,c=o[8]+"",u,f,d,p,m,v,g,k,L,I,C,M;function A(){return o[6](o[8])}function E(){return o[7](o[8])}return{c(){e=_("div"),t=_("div"),r=_("div"),s=B(n),i=F(),a=_("div"),l=B("Toggle "),u=B(c),f=B(" on or off"),d=F(),p=_("div"),m=_("div"),v=_("input"),k=F(),L=_("div"),h(r,"class","setting-item-name"),h(a,"class","setting-item-description"),h(t,"class","setting-item-info"),h(v,"type","checkbox"),h(v,"tabindex","-1"),v.checked=g=o[9],h(L,"class","checkbox-toggle"),h(m,"role","checkbox"),h(m,"aria-checked",I=o[9]),h(m,"tabindex","0"),h(m,"class","checkbox-container svelte-4kkvmr"),Te(m,"is-enabled",o[9]),h(p,"class","setting-item-control"),h(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(P,T){w(P,e,T),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),y(a,l),y(a,u),y(a,f),y(e,d),y(e,p),y(p,m),y(m,v),y(m,k),y(m,L),C||(M=[V(m,"keypress",A),V(m,"click",E)],C=!0)},p(P,T){o=P,T&2&&n!==(n=o[8]+"")&&Q(s,n),T&2&&c!==(c=o[8]+"")&&Q(u,c),T&2&&g!==(g=o[9])&&(v.checked=g),T&2&&I!==(I=o[9])&&h(m,"aria-checked",I),T&2&&Te(m,"is-enabled",o[9])},d(P){P&&x(e),C=!1,we(M)}}}function oR(o){let e,t,r,n,s,i,a,l,c,u=xe(Object.entries(o[1]).filter(o[5]).sort()),f=[];for(let d=0;d<u.length;d+=1)f[d]=nw(ow(o,u,d));return{c(){e=_("div"),t=_("h2"),t.textContent="Feature Flags",r=F();for(let d=0;d<f.length;d+=1)f[d].c();n=F(),s=_("div"),i=_("div"),a=_("button"),a.textContent="Apply",h(a,"aria-label","apply flag settings"),h(a,"tabindex","0"),h(i,"class","setting-item-control"),h(s,"class","setting-item"),h(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(d,p){w(d,e,p),y(e,t),y(e,r);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(e,null);y(e,n),y(e,s),y(s,i),y(i,a),l||(c=[V(a,"click",function(){Ge(o[0])&&o[0].apply(this,arguments)}),V(a,"keypress",function(){Ge(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(d,[p]){if(o=d,p&10){u=xe(Object.entries(o[1]).filter(o[5]).sort());let m;for(m=0;m<u.length;m+=1){let v=ow(o,u,m);f[m]?f[m].p(v,p):(f[m]=nw(v),f[m].c(),f[m].m(e,n))}for(;m<f.length;m+=1)f[m].d(1);f.length=u.length}},i:q,o:q,d(d){d&&x(e),qe(f,d),l=!1,we(c)}}}function nR(o,e,t){let r,n,{reload:s}=e,i=_t.getInstance();le(o,i,f=>t(4,n=f));function a(f){let d=!r[f];t(1,r[f]=d,r),i.setFlag(f,r[f])}lt(()=>{Object.keys(r).forEach(f=>{let d=document.getElementById(`toggle-${f}`);d&&(0,sw.setIcon)(d,"check")})});let l=([f,d])=>vl(f),c=f=>{if(!vl(f))throw new Error("Unexpected feature flag!");a(f)},u=f=>{if(!vl(f))throw new Error("Unexpected feature flag!");a(f)};return o.$$set=f=>{"reload"in f&&t(0,s=f.reload)},o.$$.update=()=>{if(o.$$.dirty&16){e:t(1,r=Object.assign({},n.flags))}},[s,r,i,a,n,l,c,u]}var sh=class extends K{constructor(e){super(),G(this,e,nR,oR,W,{reload:0},rR)}},iw=sh;var Jc=class extends aw.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new iw({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var yw=require("obsidian");var hw=require("obsidian");function lw(o,e,t){let r=o.slice();return r[13]=e[t],r}function cw(o,e,t){let r=o.slice();return r[16]=e[t],r}function sR(o){let e,t,r;return{c(){e=_("button"),e.textContent="Refresh"},m(n,s){w(n,e,s),t||(r=V(e,"click",(0,hw.debounce)(o[12])),t=!0)},p:q,d(n){n&&x(e),t=!1,r()}}}function iR(o){let e=navigator.userAgent+"",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p:q,d(r){r&&x(t)}}}function aR(o){let e;return{c(){e=B(o[1])},m(t,r){w(t,e,r)},p(t,r){r&2&&Q(e,t[1])},d(t){t&&x(e)}}}function lR(o){let e;return{c(){e=B(o[2])},m(t,r){w(t,e,r)},p(t,r){r&4&&Q(e,t[2])},d(t){t&&x(e)}}}function cR(o){let e;return{c(){e=B(o[3])},m(t,r){w(t,e,r)},p(t,r){r&8&&Q(e,t[3])},d(t){t&&x(e)}}}function uR(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=B(e)},m(r,n){w(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&Q(t,e)},d(r){r&&x(t)}}}function uw(o){let e,t=`${o[16]}`,r,n;return{c(){e=_("div"),r=B(t),n=F()},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&16&&t!==(t=`${s[16]}`)&&Q(r,t)},d(s){s&&x(e)}}}function fR(o){let e,t=xe(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=uw(cw(o,t,n));return{c(){e=_("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){w(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&16){t=xe(Object.keys(n[4].cancelControllers));let i;for(i=0;i<t.length;i+=1){let a=cw(n,t,i);r[i]?r[i].p(a,s):(r[i]=uw(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&x(e),qe(r,n)}}}function fw(o){let e,t=`${o[13]}`,r,n;return{c(){e=_("div"),r=B(t),n=F()},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&32&&t!==(t=`${s[13]}`)&&Q(r,t)},d(s){s&&x(e)}}}function dR(o){let e,t=xe(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=fw(lw(o,t,n));return{c(){e=_("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){w(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=xe(n[5]);let i;for(i=0;i<t.length;i+=1){let a=lw(n,t,i);r[i]?r[i].p(a,s):(r[i]=fw(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&x(e),qe(r,n)}}}function pR(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v,g,k,L,I,C,M,A,E;return n=new ze({props:{name:"Environment",$$slots:{default:[sR]},$$scope:{ctx:o}}}),i=new Ue({props:{name:"User Agent",description:"",$$slots:{default:[iR]},$$scope:{ctx:o}}}),l=new Ue({props:{name:"Fetch",description:"",$$slots:{default:[aR]},$$scope:{ctx:o}}}),u=new Ue({props:{name:"Response",description:"",$$slots:{default:[lR]},$$scope:{ctx:o}}}),d=new Ue({props:{name:"Blink Fetch",description:"",$$slots:{default:[cR]},$$scope:{ctx:o}}}),m=new Ue({props:{name:"Startup Time",description:"",$$slots:{default:[uR]},$$scope:{ctx:o}}}),g=new ze({props:{name:"Connections"}}),L=new Ue({props:{name:"",description:"",$$slots:{description:[fR]},$$scope:{ctx:o}}}),C=new ze({props:{name:"Log Files"}}),A=new Ue({props:{name:"",description:"",$$slots:{description:[dR]},$$scope:{ctx:o}}}),{c(){e=_("div"),e.textContent="Debug Info",t=F(),r=_("div"),U(n.$$.fragment),s=F(),U(i.$$.fragment),a=F(),U(l.$$.fragment),c=F(),U(u.$$.fragment),f=F(),U(d.$$.fragment),p=F(),U(m.$$.fragment),v=F(),U(g.$$.fragment),k=F(),U(L.$$.fragment),I=F(),U(C.$$.fragment),M=F(),U(A.$$.fragment),h(e,"class","modal-title"),h(r,"class","modal-content")},m(P,T){w(P,e,T),w(P,t,T),w(P,r,T),R(n,r,null),y(r,s),R(i,r,null),y(r,a),R(l,r,null),y(r,c),R(u,r,null),y(r,f),R(d,r,null),y(r,p),R(m,r,null),y(r,v),R(g,r,null),y(r,k),R(L,r,null),y(r,I),R(C,r,null),y(r,M),R(A,r,null),E=!0},p(P,[T]){let $={};T&524288&&($.$$scope={dirty:T,ctx:P}),n.$set($);let J={};T&524288&&(J.$$scope={dirty:T,ctx:P}),i.$set(J);let N={};T&524290&&(N.$$scope={dirty:T,ctx:P}),l.$set(N);let O={};T&524292&&(O.$$scope={dirty:T,ctx:P}),u.$set(O);let te={};T&524296&&(te.$$scope={dirty:T,ctx:P}),d.$set(te);let Z={};T&524289&&(Z.$$scope={dirty:T,ctx:P}),m.$set(Z);let Y={};T&524304&&(Y.$$scope={dirty:T,ctx:P}),L.$set(Y);let ge={};T&524320&&(ge.$$scope={dirty:T,ctx:P}),A.$set(ge)},i(P){E||(b(n.$$.fragment,P),b(i.$$.fragment,P),b(l.$$.fragment,P),b(u.$$.fragment,P),b(d.$$.fragment,P),b(m.$$.fragment,P),b(g.$$.fragment,P),b(L.$$.fragment,P),b(C.$$.fragment,P),b(A.$$.fragment,P),E=!0)},o(P){S(n.$$.fragment,P),S(i.$$.fragment,P),S(l.$$.fragment,P),S(u.$$.fragment,P),S(d.$$.fragment,P),S(m.$$.fragment,P),S(g.$$.fragment,P),S(L.$$.fragment,P),S(C.$$.fragment,P),S(A.$$.fragment,P),E=!1},d(P){P&&(x(e),x(t),x(r)),D(n),D(i),D(l),D(u),D(d),D(m),D(g),D(L),D(C),D(A)}}}function dw(){try{return Response.toString()}catch(o){return"undefined"}}function pw(){try{return fetch.toString()}catch(o){return"undefined"}}function mw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function mR(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=Ie(dw());le(o,c,g=>t(2,n=g));let u=Ie(pw());le(o,u,g=>t(1,r=g));let f=Ie(mw());le(o,f,g=>t(3,s=g));let d=Ie(l.loginManager.pb);le(o,d,g=>t(4,i=g));let p=Ie([]);le(o,p,g=>t(5,a=g)),bl().then(g=>{p.set(g)});function m(){c.set(dw()),u.set(pw()),f.set(mw()),d.set(l.loginManager.pb)}let v=()=>{m()};return o.$$set=g=>{"plugin"in g&&t(0,l=g.plugin)},[l,r,n,s,i,a,c,u,f,d,p,m,v]}var ih=class extends K{constructor(e){super(),G(this,e,mR,pR,W,{plugin:0})}},gw=ih;var Qc=class extends yw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new gw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var bw=require("obsidian"),Yc=class{notify(e){new bw.Notice(e)}},Zc=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var Lw=require("obsidian");var Iw=require("obsidian");function hR(o){Ce(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function vw(o,e,t){let r=o.slice();return r[21]=e[t],r}function gR(o){let e,t,r,n,s,i,a,l,c,u,f,d,p;r=new Ue({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),a=new Ue({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[vR]},$$scope:{ctx:o}}});let m=o[4]&&_w(o);return u=new Ue({props:{name:"",description:"",$$slots:{default:[xR]},$$scope:{ctx:o}}}),{c(){e=_("div"),t=_("div"),U(r.$$.fragment),n=F(),s=_("textarea"),i=F(),U(a.$$.fragment),l=F(),m&&m.c(),c=F(),U(u.$$.fragment),h(s,"placeholder","Describe the issue here..."),h(s,"class","svelte-jmqfac"),h(t,"class","form-content svelte-jmqfac"),h(e,"class","report-container svelte-jmqfac")},m(v,g){w(v,e,g),y(e,t),R(r,t,null),y(t,n),y(t,s),Je(s,o[3]),y(t,i),R(a,t,null),y(t,l),m&&m.m(t,null),y(e,c),R(u,e,null),f=!0,d||(p=V(s,"input",o[13]),d=!0)},p(v,g){g&8&&Je(s,v[3]);let k={};g&16777232&&(k.$$scope={dirty:g,ctx:v}),a.$set(k),v[4]?m?(m.p(v,g),g&16&&b(m,1)):(m=_w(v),m.c(),b(m,1),m.m(t,null)):m&&(ne(),S(m,1,1,()=>{m=null}),se());let L={};g&16777293&&(L.$$scope={dirty:g,ctx:v}),u.$set(L)},i(v){f||(b(r.$$.fragment,v),b(a.$$.fragment,v),b(m),b(u.$$.fragment,v),f=!0)},o(v){S(r.$$.fragment,v),S(a.$$.fragment,v),S(m),S(u.$$.fragment,v),f=!1},d(v){v&&x(e),D(r),D(a),m&&m.d(),D(u),d=!1,p()}}}function yR(o){let e;return{c(){e=_("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',h(e,"class","centered-message svelte-jmqfac")},m(t,r){w(t,e,r)},p:q,i:q,o:q,d(t){t&&x(e)}}}function bR(o){let e,t,r;return t=new Ue({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","centered-message svelte-jmqfac")},m(n,s){w(n,e,s),R(t,e,null),r=!0},p:q,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&x(e),D(t)}}}function vR(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("input"),r=F(),n=_("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),t.checked=o[4],h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[4]),h(e,"tabindex","0"),h(e,"class","checkbox-container"),Te(e,"is-enabled",o[4])},m(a,l){w(a,e,l),y(e,t),y(e,r),y(e,n),s||(i=[V(e,"keypress",SR),V(e,"click",o[14])],s=!0)},p(a,l){l&16&&(t.checked=a[4]),l&16&&h(e,"aria-checked",a[4]),l&16&&Te(e,"is-enabled",a[4])},d(a){a&&x(e),s=!1,we(i)}}}function _w(o){let e,t;return e=new Ue({props:{name:"Logs",description:"",$$slots:{description:[_R]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function xw(o){let e,t=`${o[21]}
`,r,n;return{c(){e=_("div"),r=B(t),n=F()},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&32&&t!==(t=`${s[21]}
`)&&Q(r,t)},d(s){s&&x(e)}}}function _R(o){let e,t=xe(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=xw(vw(o,t,n));return{c(){e=_("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){w(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=xe(n[5]);let i;for(i=0;i<t.length;i+=1){let a=vw(n,t,i);r[i]?r[i].p(a,s):(r[i]=xw(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&x(e),qe(r,n)}}}function xR(o){let e,t,r,n;return{c(){e=_("button"),t=B("Send"),e.disabled=o[2]},m(s,i){w(s,e,i),y(e,t),r||(n=V(e,"click",o[15]),r=!0)},p(s,i){i&4&&(e.disabled=s[2])},d(s){s&&x(e),r=!1,n()}}}function wR(o){let e,t,r,n,s,i,a=[bR,yR,gR],l=[];function c(u,f){return u[1]?0:u[2]&&!u[1]?1:2}return n=c(o,-1),s=l[n]=a[n](o),{c(){e=_("div"),e.textContent="Send Bug Report",t=F(),r=_("div"),s.c(),h(e,"class","modal-title"),h(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,f){w(u,e,f),w(u,t,f),w(u,r,f),l[n].m(r,null),i=!0},p(u,[f]){let d=n;n=c(u,f),n===d?l[n].p(u,f):(ne(),S(l[d],1,1,()=>{l[d]=null}),se(),s=l[n],s?s.p(u,f):(s=l[n]=a[n](u),s.c()),b(s,1),s.m(r,null))},i(u){i||(b(s),i=!0)},o(u){S(s),i=!1},d(u){u&&(x(e),x(t),x(r)),l[n].d()}}}function ww(){try{return Response.toString()}catch(o){return"undefined"}}function Sw(){try{return fetch.toString()}catch(o){return"undefined"}}function kw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var SR=()=>{};function kR(o,e,t){let r,n,s,i,a,l,{plugin:c}=e,u=Ie(ww()),f=Ie(Sw()),d=Ie(kw()),p=Ie("");le(o,p,P=>t(3,s=P));let m=Ie(!1);le(o,m,P=>t(4,i=P));let v=Ie(!1),g=Ie(!1);le(o,g,P=>t(2,n=P));let k=Ie(!1);le(o,k,P=>t(1,r=P));let L=Ie(c.loginManager.pb);le(o,L,P=>t(6,l=P));let I=Ie([]);le(o,I,P=>t(5,a=P)),bl().then(P=>{I.set(P)});function C(){u.set(ww()),f.set(Sw()),d.set(kw()),L.set(c.loginManager.pb)}function M(){s=this.value,p.set(s)}let A=()=>{let P=!i;m.set(P)},E=async()=>{var T;let P=`Bug Report

`;if(P+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(T=l==null?void 0:l.authStore.model)==null?void 0:T.id,loadTime:c.loadTime,description:s},null,2),P+=`

`,m){let $=await Ry();P+=$}(0,Iw.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:P,headers:{"Content-Type":"text/plain"}}).then(()=>{k.set(!0)}),g.set(!0)};return o.$$set=P=>{"plugin"in P&&t(0,c=P.plugin)},[c,r,n,s,i,a,l,p,m,g,k,L,I,M,A,E]}var ah=class extends K{constructor(e){super(),G(this,e,kR,wR,W,{plugin:0},hR)}},Cw=ah;var Xc=class extends Lw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Cw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Uw=require("obsidian");async function Mw(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,i=[],a=0,l=0,c=0,u=0;for(let f of n)if(f.name){try{let d=await new Promise((p,m)=>{let v=indexedDB.open(f.name);v.onerror=()=>m(v.error),v.onsuccess=g=>p(g.target.result)});try{let p=Array.from(d.objectStoreNames);if(!p.includes("updates")||!p.includes("custom"))continue;let m=d.transaction(["updates","custom"],"readonly"),v=m.objectStore("updates"),g=m.objectStore("custom"),k=await new Promise(I=>{let C=g.get("appId");C.onsuccess=()=>I(C.result||"")});a++;let L=await new Promise((I,C)=>{let M=v.count();M.onsuccess=()=>I(M.result),M.onerror=()=>C(M.error)});if(l+=L,L>0){let I=0;if(await new Promise((C,M)=>{let A=v.openCursor();A.onsuccess=E=>{let P=E.target.result;if(P){let T=P.value instanceof Uint8Array?P.value.byteLength:JSON.stringify(P.value).length;I+=T,P.continue()}else C()},A.onerror=()=>M(A.error)}),c+=I,I>1024*1024&&(!t||k===e)){let C=await new Promise(E=>{let P=g.get("path");P.onsuccess=()=>E(P.result||"")}),M=await new Promise(E=>{let P=g.get("relay");P.onsuccess=()=>E(P.result||"")}),A=!f.name.startsWith(`${e}-relay`);i.push({slug:`${f.name}/${v.name}`,path:C,relay:M,appId:k||"unknown",count:L,estimatedSizeMB:Math.round(I/(1024*1024)*100)/100,isLegacy:A})}}}finally{d.close()}}catch(d){console.error(`Error processing database ${f.name}:`,d);continue}u++,r&&r(u/n.length*100)}return{totalStores:a,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:i.sort((f,d)=>d.estimatedSizeMB-f.estimatedSizeMB)}}async function Tw(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let i=indexedDB.open(e);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((i,a)=>{let l=s.clear();l.onsuccess=()=>i(),l.onerror=()=>a(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var iee=require("obsidian");function IR(o){Ce(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function Aw(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function Fw(o,e,t){let r=o.slice();return r[22]=e[t],r}function CR(o){let e,t,r,n,s,i=o[0].databaseCount.toLocaleString()+"",a,l,c,u,f,d,p,m,v=o[0].totalStores+"",g,k,L,I,C,M,A=o[0].totalItems.toLocaleString()+"",E,P,T,$,J,N,O=o[0].totalSizeMB.toFixed(2)+"",te,Z,Y,ge,j;function H(ee,re){if(ee[0].databaseCount>45e3)return AR;if(ee[0].databaseCount>4e4)return TR}let X=H(o,-1),ue=X&&X(o),z=o[0].largeStores.length>0&&Ew(o);return{c(){e=_("div"),t=_("div"),r=_("div"),r.textContent="Global Database Limit",n=F(),s=_("div"),a=B(i),l=B(" / 50,000"),c=F(),ue&&ue.c(),u=F(),f=_("div"),d=_("div"),d.textContent="Relay Databases",p=F(),m=_("div"),g=B(v),k=F(),L=_("div"),I=_("div"),I.textContent="Document Updates",C=F(),M=_("div"),E=B(A),P=F(),T=_("div"),$=_("div"),$.textContent="Total Size",J=F(),N=_("div"),te=B(O),Z=B(" MB"),Y=F(),z&&z.c(),ge=pe(),h(r,"class","system3-stat-label svelte-1n3w4sk"),h(s,"class","system3-stat-value svelte-1n3w4sk"),Te(s,"system3-warning",o[0].databaseCount>4e4),Te(s,"system3-critical",o[0].databaseCount>45e3),h(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),h(d,"class","system3-stat-label svelte-1n3w4sk"),h(m,"class","system3-stat-value svelte-1n3w4sk"),h(f,"class","system3-stat-item svelte-1n3w4sk"),h(I,"class","system3-stat-label svelte-1n3w4sk"),h(M,"class","system3-stat-value svelte-1n3w4sk"),h(L,"class","system3-stat-item svelte-1n3w4sk"),h($,"class","system3-stat-label svelte-1n3w4sk"),h(N,"class","system3-stat-value svelte-1n3w4sk"),h(T,"class","system3-stat-item svelte-1n3w4sk"),h(e,"class","system3-summary-stats svelte-1n3w4sk")},m(ee,re){w(ee,e,re),y(e,t),y(t,r),y(t,n),y(t,s),y(s,a),y(s,l),y(t,c),ue&&ue.m(t,null),y(e,u),y(e,f),y(f,d),y(f,p),y(f,m),y(m,g),y(e,k),y(e,L),y(L,I),y(L,C),y(L,M),y(M,E),y(e,P),y(e,T),y(T,$),y(T,J),y(T,N),y(N,te),y(N,Z),w(ee,Y,re),z&&z.m(ee,re),w(ee,ge,re),j=!0},p(ee,re){(!j||re&1)&&i!==(i=ee[0].databaseCount.toLocaleString()+"")&&Q(a,i),(!j||re&1)&&Te(s,"system3-warning",ee[0].databaseCount>4e4),(!j||re&1)&&Te(s,"system3-critical",ee[0].databaseCount>45e3),X!==(X=H(ee,re))&&(ue&&ue.d(1),ue=X&&X(ee),ue&&(ue.c(),ue.m(t,null))),(!j||re&1)&&v!==(v=ee[0].totalStores+"")&&Q(g,v),(!j||re&1)&&A!==(A=ee[0].totalItems.toLocaleString()+"")&&Q(E,A),(!j||re&1)&&O!==(O=ee[0].totalSizeMB.toFixed(2)+"")&&Q(te,O),ee[0].largeStores.length>0?z?(z.p(ee,re),re&1&&b(z,1)):(z=Ew(ee),z.c(),b(z,1),z.m(ge.parentNode,ge)):z&&(ne(),S(z,1,1,()=>{z=null}),se())},i(ee){j||(b(z),j=!0)},o(ee){S(z),j=!1},d(ee){ee&&(x(e),x(Y),x(ge)),ue&&ue.d(),z&&z.d(ee)}}}function LR(o){let e,t;return{c(){e=_("div"),t=B(o[5]),h(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){w(r,e,n),y(e,t)},p(r,n){n&32&&Q(t,r[5])},i:q,o:q,d(r){r&&x(e)}}}function MR(o){let e,t,r,n,s,i,a;return{c(){e=_("div"),t=_("div"),r=F(),n=_("div"),n.textContent="Analyzing Databases...",s=F(),i=_("div"),a=_("div"),h(t,"class","system3-loading-spinner svelte-1n3w4sk"),h(n,"class","loading-text"),h(a,"class","system3-progress-fill svelte-1n3w4sk"),me(a,"width",o[4]+"%"),h(i,"class","system3-progress-bar svelte-1n3w4sk"),h(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){w(l,e,c),y(e,t),y(e,r),y(e,n),y(e,s),y(e,i),y(i,a)},p(l,c){c&16&&me(a,"width",l[4]+"%")},i:q,o:q,d(l){l&&x(e)}}}function TR(o){let e;return{c(){e=_("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,h(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function AR(o){let e;return{c(){e=_("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,h(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function Ew(o){let e,t,r,n;e=new ze({props:{name:"Large Stores (>1MB)"}});let s=xe(o[2]),i=[];for(let l=0;l<s.length;l+=1)i[l]=Rw(Aw(o,s,l));let a=l=>S(i[l],1,1,()=>{i[l]=null});return{c(){U(e.$$.fragment),t=F();for(let l=0;l<i.length;l+=1)i[l].c();r=pe()},m(l,c){R(e,l,c),w(l,t,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,c);w(l,r,c),n=!0},p(l,c){if(c&2052){s=xe(l[2]);let u;for(u=0;u<s.length;u+=1){let f=Aw(l,s,u);i[u]?(i[u].p(f,c),b(i[u],1)):(i[u]=Rw(f),i[u].c(),b(i[u],1),i[u].m(r.parentNode,r))}for(ne(),u=s.length;u<i.length;u+=1)a(u);se()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(i[c]);n=!0}},o(l){S(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)S(i[c]);n=!1},d(l){l&&(x(t),x(r)),D(e,l),qe(i,l)}}}function FR(o){let e,t,r,n,s;function i(){return o[17](o[22])}return{c(){e=_("div"),t=_("button"),t.textContent="Delete",r=F(),h(t,"class","mod-warning"),h(t,"title","Delete all data in this store"),h(e,"class","system3-actions svelte-1n3w4sk")},m(a,l){w(a,e,l),y(e,t),w(a,r,l),n||(s=V(t,"click",i),n=!0)},p(a,l){o=a},d(a){a&&(x(e),x(r)),n=!1,s()}}}function Pw(o){let e,t;return e=new Ue({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[FR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Rw(o){let e,t,r,n;e=new ze({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=xe(o[19]),i=[];for(let l=0;l<s.length;l+=1)i[l]=Pw(Fw(o,s,l));let a=l=>S(i[l],1,1,()=>{i[l]=null});return{c(){U(e.$$.fragment),t=F();for(let l=0;l<i.length;l+=1)i[l].c();r=pe()},m(l,c){R(e,l,c),w(l,t,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,c);w(l,r,c),n=!0},p(l,c){let u={};if(c&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),c&2052){s=xe(l[19]);let f;for(f=0;f<s.length;f+=1){let d=Fw(l,s,f);i[f]?(i[f].p(d,c),b(i[f],1)):(i[f]=Pw(d),i[f].c(),b(i[f],1),i[f].m(r.parentNode,r))}for(ne(),f=s.length;f<i.length;f+=1)a(f);se()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(i[c]);n=!0}},o(l){S(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)S(i[c]);n=!1},d(l){l&&(x(t),x(r)),D(e,l),qe(i,l)}}}function ER(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,v,g,k,L=[MR,LR,CR],I=[];function C(M,A){return M[3]?0:M[5]?1:M[0]?2:-1}return~(p=C(o,-1))&&(m=I[p]=L[p](o)),{c(){e=_("div"),e.textContent="Relay database analysis",t=F(),r=_("div"),n=_("div"),s=_("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,i=F(),a=_("div"),l=_("div"),c=_("input"),u=F(),f=_("div"),d=F(),m&&m.c(),h(e,"class","modal-title"),h(s,"class","setting-item-info"),h(c,"type","checkbox"),h(c,"tabindex","-1"),c.checked=o[1],h(f,"class","checkbox-toggle"),h(l,"role","checkbox"),h(l,"aria-checked",o[1]),h(l,"tabindex","0"),h(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Te(l,"is-enabled",o[1]),h(a,"class","setting-item-control"),h(n,"class","setting-item"),h(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(M,A){w(M,e,A),w(M,t,A),w(M,r,A),y(r,n),y(n,s),y(n,i),y(n,a),y(a,l),y(l,c),y(l,u),y(l,f),y(r,d),~p&&I[p].m(r,null),v=!0,g||(k=[V(l,"keypress",o[15]),V(l,"click",o[16])],g=!0)},p(M,[A]){(!v||A&2)&&(c.checked=M[1]),(!v||A&2)&&h(l,"aria-checked",M[1]),(!v||A&2)&&Te(l,"is-enabled",M[1]);let E=p;p=C(M,A),p===E?~p&&I[p].p(M,A):(m&&(ne(),S(I[E],1,1,()=>{I[E]=null}),se()),~p?(m=I[p],m?m.p(M,A):(m=I[p]=L[p](M),m.c()),b(m,1),m.m(r,null)):m=null)},i(M){v||(b(m),v=!0)},o(M){S(m),v=!1},d(M){M&&(x(e),x(t),x(r)),~p&&I[p].d(),g=!1,we(k)}}}function PR(o,e,t){let r,n,s,i,a,l;var c;let{plugin:u}=e,f=Ie(!0);le(o,f,M=>t(3,i=M));let d=Ie(0);le(o,d,M=>t(4,a=M));let p=Ie(null);le(o,p,M=>t(0,s=M));let m=Ie(null);le(o,m,M=>t(5,l=M));let v=!1;function g(){return Ae(this,void 0,void 0,function*(){f.set(!0),m.set(null);try{let M=yield Mw({appId:u.appId,filterByAppId:!v,onProgress:A=>d.set(A)});p.set(M)}catch(M){m.set(`Analysis failed: ${M.message}`)}finally{f.set(!1)}})}function k(M){return Ae(this,void 0,void 0,function*(){try{yield Tw(M),s&&Ys(p,s.largeStores=s.largeStores.filter(A=>A.slug!==M),s)}catch(A){m.set(`Failed to delete ${M}: ${A.message}`)}})}lt(()=>{g()});let L=()=>{t(1,v=!v),g()},I=()=>{t(1,v=!v),g()},C=M=>k(M.slug);return o.$$set=M=>{"plugin"in M&&t(12,u=M.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((M,A)=>{let E=A.relay||"local";return M[E]||(M[E]=[]),M[E].push(A),M},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,n=Object.entries(r).sort(([M],[A])=>M==="local"?-1:A==="local"?1:M.localeCompare(A)))}},[s,v,n,i,a,l,f,d,p,m,g,k,u,c,r,L,I,C]}var lh=class extends K{constructor(e){super(),G(this,e,PR,ER,W,{plugin:12},IR)}},Dw=lh;var eu=class extends Uw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Dw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var u1=require("obsidian");var{Boolean:Gw}=rs;function RR(o){Ce(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function Ow(o,e,t){let r=o.slice();return r[20]=e[t],r}function Nw(o,e,t){let r=o.slice();return r[23]=e[t],r}function DR(o){return{c:q,m:q,p:q,i:q,o:q,d:q}}function UR(o){let e,t,r=xe(Kw(o[19].documents)),n=[];for(let i=0;i<r.length;i+=1)n[i]=zw(Ow(o,r,i));let s=i=>S(n[i],1,1,()=>{n[i]=null});return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=pe()},m(i,a){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(i,a);w(i,e,a),t=!0},p(i,a){if(a&8311){r=xe(Kw(i[19].documents));let l;for(l=0;l<r.length;l+=1){let c=Ow(i,r,l);n[l]?(n[l].p(c,a),b(n[l],1)):(n[l]=zw(c),n[l].c(),b(n[l],1),n[l].m(e.parentNode,e))}for(ne(),l=r.length;l<n.length;l+=1)s(l);se()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)b(n[a]);t=!0}},o(i){n=n.filter(Gw);for(let a=0;a<n.length;a+=1)S(n[a]);t=!1},d(i){i&&x(e),qe(n,i)}}}function $w(o){let e,t=Ww(o[23].queueState.timestamp)+"",r;return{c(){e=B("\u2022 "),r=B(t)},m(n,s){w(n,e,s),w(n,r,s)},p(n,s){s&3&&t!==(t=Ww(n[23].queueState.timestamp)+"")&&Q(r,t)},d(n){n&&(x(e),x(r))}}}function Bw(o){let e,t=o[23].queueState.error+"",r;return{c(){e=_("div"),r=B(t),h(e,"class","error-message svelte-18bqwhy")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&Q(r,t)},d(n){n&&x(e)}}}function Vw(o){let e,t,r,n,s,i;t=new Vd({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function a(){return o[10](o[23])}return{c(){e=_("button"),U(t.$$.fragment),r=B(`
							Retry`),h(e,"class","mod-warning svelte-18bqwhy")},m(l,c){w(l,e,c),R(t,e,null),y(e,r),n=!0,s||(i=V(e,"click",a),s=!0)},p(l,c){o=l},i(l){n||(b(t.$$.fragment,l),n=!0)},o(l){S(t.$$.fragment,l),n=!1},d(l){l&&x(e),D(t),s=!1,i()}}}function OR(o){var p,m,v;let e,t,r=o[5](o[23]).text+"",n,s,i,a,l,c,u=((p=o[23].queueState)==null?void 0:p.timestamp)&&$w(o),f=((m=o[23].queueState)==null?void 0:m.error)&&Bw(o),d=((v=o[23].queueState)==null?void 0:v.status)==="failed"&&Vw(o);return{c(){e=_("div"),t=_("span"),n=B(r),s=F(),u&&u.c(),i=F(),f&&f.c(),a=F(),d&&d.c(),l=pe(),h(t,"class","details svelte-18bqwhy"),h(e,"class","details-container svelte-18bqwhy")},m(g,k){w(g,e,k),y(e,t),y(t,n),y(t,s),u&&u.m(t,null),y(t,i),f&&f.m(t,null),w(g,a,k),d&&d.m(g,k),w(g,l,k),c=!0},p(g,k){var L,I,C;(!c||k&3)&&r!==(r=g[5](g[23]).text+"")&&Q(n,r),(L=g[23].queueState)!=null&&L.timestamp?u?u.p(g,k):(u=$w(g),u.c(),u.m(t,i)):u&&(u.d(1),u=null),(I=g[23].queueState)!=null&&I.error?f?f.p(g,k):(f=Bw(g),f.c(),f.m(t,null)):f&&(f.d(1),f=null),((C=g[23].queueState)==null?void 0:C.status)==="failed"?d?(d.p(g,k),k&3&&b(d,1)):(d=Vw(g),d.c(),b(d,1),d.m(l.parentNode,l)):d&&(ne(),S(d,1,1,()=>{d=null}),se())},i(g){c||(b(d),c=!0)},o(g){S(d),c=!1},d(g){g&&(x(e),x(a),x(l)),u&&u.d(),f&&f.d(),d&&d.d(g)}}}function NR(o){let e,t=o[9].default,r=ye(t,o,o[13],null),n=r||OR(o);return{c(){n&&n.c()},m(s,i){n&&n.m(s,i),e=!0},p(s,i){r?r.p&&(!e||i&8192)&&ve(r,t,s,s[13],e?be(t,s[13],i,null):_e(s[13]),null):n&&n.p&&(!e||i&3)&&n.p(s,e?i:-1)},i(s){e||(b(n,s),e=!0)},o(s){S(n,s),e=!1},d(s){n&&n.d(s)}}}function $R(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",i,a;var l=o[5](o[23]).icon;function c(u,f){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=Jo(l,c(o))),{c(){e=_("span"),t&&U(t.$$.fragment),r=F(),n=_("span"),i=B(s),h(e,"slot","name"),h(e,"class","file-name svelte-18bqwhy")},m(u,f){w(u,e,f),t&&R(t,e,null),y(e,r),y(e,n),y(n,i),a=!0},p(u,f){if(f&3&&l!==(l=u[5](u[23]).icon)){if(t){ne();let d=t;S(d.$$.fragment,1,0,()=>{D(d,1)}),se()}l?(t=Jo(l,c(u,f)),U(t.$$.fragment),b(t.$$.fragment,1),R(t,e,r)):t=null}else if(l){let d={};f&3&&(d.class="svg-icon "+u[5](u[23]).iconClass),t.$set(d)}(!a||f&3)&&s!==(s=u[23].path.split("/").pop()+"")&&Q(i,s)},i(u){a||(t&&b(t.$$.fragment,u),a=!0)},o(u){t&&S(t.$$.fragment,u),a=!1},d(u){u&&x(e),t&&D(t)}}}function Hw(o){let e,t;return e=new Ft({props:{$$slots:{name:[$R],default:[NR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function qw(o){let e,t;return e=new Ft({props:{$$slots:{name:[BR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function BR(o){let e,t,r=jw(o[1](o[20]).remainingCount)+"",n,s,i=o[20].title.toLowerCase()+"",a,l,c,u,f,d,p,m;function v(){return o[11](o[20])}function g(...k){return o[12](o[20],...k)}return{c(){var k;e=_("span"),t=B("...and "),n=B(r),s=B(` more
					`),a=B(i),l=F(),c=_("span"),u=B("(show more)"),d=F(),h(c,"class","show-more-link svelte-18bqwhy"),h(c,"role","button"),h(c,"tabindex","0"),h(c,"aria-label",f=`Show ${((k=o[2][o[20].title])==null?void 0:k.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),h(e,"slot","name"),h(e,"class","more-files svelte-18bqwhy")},m(k,L){w(k,e,L),y(e,t),y(e,n),y(e,s),y(e,a),y(e,l),y(e,c),y(c,u),y(e,d),p||(m=[V(c,"click",v),V(c,"keydown",g)],p=!0)},p(k,L){var I;o=k,L&3&&r!==(r=jw(o[1](o[20]).remainingCount)+"")&&Q(n,r),L&1&&i!==(i=o[20].title.toLowerCase()+"")&&Q(a,i),L&1&&f!==(f=`Show ${((I=o[2][o[20].title])==null?void 0:I.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&h(c,"aria-label",f)},d(k){k&&x(e),p=!1,we(m)}}}function zw(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,i;e=new ze({props:{name:o[20].title}});let a=xe(o[1](o[20]).visibleDocs),l=[];for(let f=0;f<a.length;f+=1)l[f]=Hw(Nw(o,a,f));let c=f=>S(l[f],1,1,()=>{l[f]=null}),u=n&&qw(o);return{c(){U(e.$$.fragment),t=F();for(let f=0;f<l.length;f+=1)l[f].c();r=F(),u&&u.c(),s=pe()},m(f,d){R(e,f,d),w(f,t,d);for(let p=0;p<l.length;p+=1)l[p]&&l[p].m(f,d);w(f,r,d),u&&u.m(f,d),w(f,s,d),i=!0},p(f,d){let p={};if(d&1&&(p.name=f[20].title),e.$set(p),d&8291){a=xe(f[1](f[20]).visibleDocs);let m;for(m=0;m<a.length;m+=1){let v=Nw(f,a,m);l[m]?(l[m].p(v,d),b(l[m],1)):(l[m]=Hw(v),l[m].c(),b(l[m],1),l[m].m(r.parentNode,r))}for(ne(),m=a.length;m<l.length;m+=1)c(m);se()}d&3&&(n=f[1](f[20]).remainingCount>0),n?u?(u.p(f,d),d&3&&b(u,1)):(u=qw(f),u.c(),b(u,1),u.m(s.parentNode,s)):u&&(ne(),S(u,1,1,()=>{u=null}),se())},i(f){if(!i){b(e.$$.fragment,f);for(let d=0;d<a.length;d+=1)b(l[d]);b(u),i=!0}},o(f){S(e.$$.fragment,f),l=l.filter(Gw);for(let d=0;d<l.length;d+=1)S(l[d]);S(u),i=!1},d(f){f&&(x(t),x(r),x(s)),D(e,f),qe(l,f),u&&u.d(f)}}}function VR(o){let e;return{c(){e=_("div"),e.textContent="Loading...",h(e,"class","loading")},m(t,r){w(t,e,r)},p:q,i:q,o:q,d(t){t&&x(e)}}}function HR(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:VR,then:UR,catch:DR,value:19,blocks:[,,,]};return Yo(t=o[0],n),{c(){e=pe(),n.block.c()},m(s,i){w(s,e,i),n.block.m(s,n.anchor=i),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[i]){o=s,n.ctx=o,i&1&&t!==(t=o[0])&&Yo(t,n)||ri(n,o,i)},i(s){r||(b(n.block),r=!0)},o(s){for(let i=0;i<3;i+=1){let a=n.blocks[i];S(a)}r=!1},d(s){s&&x(e),n.block.d(s),n.token=null,n=null}}}function jw(o){return new Intl.NumberFormat().format(o)}function Ww(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let i=Math.floor(s/24);return i===1?"yesterday":`${i} days ago`}function Kw(o){let e=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="running"}),t=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="failed"}),r=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="pending"}),n=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function qR(o,e,t){let r,n,s,i,a,{$$slots:l={},$$scope:c}=e,{folder:u}=e,{backgroundSync:f}=e,d={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},p=Ie({}),m=Xe(p,A=>E=>{let P=d[E.title]||d.default,T=A[E.title]||P.initialCount,$=E.documents.slice(0,T),J=E.documents.length-T;return{visibleCount:T,visibleDocs:$,remainingCount:J}});le(o,m,A=>t(1,a=A));function v(A){let E=d[A]||d.default;p.update(P=>Object.assign(Object.assign({},P),{[A]:(P[A]||E.initialCount)+E.incrementCount}))}function g(A){return Ae(this,void 0,void 0,function*(){var E;let P=[],T=Array.from(A.docs.values());for(let $ of T){let J=yield $.getOrigin(),N=yield $.getServerSynced(),O={guid:$.guid,path:A.getPath($.path),doc:$,origin:J||"unknown",serverSynced:N},te=Array.from(r).find(ge=>ge.guid===$.guid),Z=Array.from(n).find(ge=>ge.guid===$.guid),Y=s.find(ge=>ge.guid===$.guid);if(te||Z||Y){let ge=te||Z||Y;O.queueState={status:ge.status,type:"type"in ge?ge.type:"sync",error:"error"in ge?ge.error:void 0,timestamp:"timestamp"in ge?ge.timestamp:Date.now()}}else J==="local"&&!N?O.queueState={status:"pending",type:"sync",timestamp:Date.now()}:N?O.queueState={status:"completed",type:"sync",timestamp:Date.now()}:O.queueState={status:"pending",type:"sync",timestamp:Date.now()};P.push(O)}return{folder:A,documents:P,progress:((E=f.getGroupProgress(A))===null||E===void 0?void 0:E.percent)||0}})}function k(A){let{origin:E,serverSynced:P,queueState:T}=A,$=(T==null?void 0:T.status)||"completed",J=(T==null?void 0:T.type)||"sync";return E==="remote"&&!P&&$==="running"&&J==="download"?{text:"Downloading",description:"Initial acquisition",icon:ma,iconClass:"mod-primary"}:E==="remote"&&!P&&$==="pending"&&J==="download"?{text:"Queued for Download",description:"Waiting to download",icon:pa,iconClass:""}:E==="remote"&&!P&&$==="failed"&&J==="download"?{text:"Download stuck",description:"Needs retry",icon:as,iconClass:"mod-warning"}:E==="local"&&!P&&$==="running"&&J==="sync"?{text:"Uploading",description:"First-time upload",icon:Gd,iconClass:"mod-primary"}:E==="local"&&!P&&$==="pending"&&J==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:pa,iconClass:""}:E==="local"&&!P&&$==="failed"&&J==="sync"?{text:"Upload stuck",description:"Needs retry",icon:as,iconClass:"mod-warning"}:P&&$==="running"&&J==="sync"?{text:"Syncing",description:"Collaborative update",icon:dd,iconClass:"mod-primary"}:P&&$==="pending"&&J==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:pa,iconClass:""}:P&&$==="failed"&&J==="sync"?{text:"Sync stuck",description:"Needs retry",icon:as,iconClass:"mod-warning"}:P&&$==="completed"?{text:"Complete",description:"Fully synchronized",icon:fa,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:ha,iconClass:""}}function L(A){return Ae(this,void 0,void 0,function*(){var E,P;let T={id:A.guid,guid:A.guid,path:A.path,timestamp:((E=A.queueState)===null||E===void 0?void 0:E.timestamp)||Date.now(),type:((P=A.queueState)===null||P===void 0?void 0:P.type)||"sync",status:"failed",sharedFolderGuid:A.doc.sharedFolder.guid};yield f.retryLogItem(T)})}let I=A=>L(A),C=A=>{v(A.title)},M=(A,E)=>E.key==="Enter"&&v(A.title);return o.$$set=A=>{"folder"in A&&t(7,u=A.folder),"backgroundSync"in A&&t(8,f=A.backgroundSync),"$$scope"in A&&t(13,c=A.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(f.activeSync.items())}if(o.$$.dirty&256){e:n=new Set(f.activeDownloads.items())}if(o.$$.dirty&256){e:s=f.getSyncLog()}if(o.$$.dirty&128){e:t(0,i=g(u))}},[i,a,d,m,v,k,L,u,f,l,I,C,M,c]}var ch=class extends K{constructor(e){super(),G(this,e,qR,HR,W,{folder:7,backgroundSync:8},RR)}},uh=ch;var{Map:zR}=rs;function jR(o){Ce(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Jw(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function Qw(o){let e,t;return e=new ze({props:{name:"Sync Status"}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Yw(o){let e,t;return e=new Ue({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[GR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function Zw(o){let e,t,r,n,s,i,a=[KR,WR],l=[];function c(u,f){return u[9]?0:1}return t=c(o,-1),r=l[t]=a[t](o),{c(){e=_("button"),r.c(),h(e,"class","mod-cta")},m(u,f){w(u,e,f),l[t].m(e,null),n=!0,s||(i=V(e,"click",o[16]),s=!0)},p(u,f){let d=t;t=c(u,f),t!==d&&(ne(),S(l[d],1,1,()=>{l[d]=null}),se(),r=l[t],r||(r=l[t]=a[t](u),r.c()),b(r,1),r.m(e,null))},i(u){n||(b(r),n=!0)},o(u){S(r),n=!1},d(u){u&&x(e),l[t].d(),s=!1,i()}}}function WR(o){let e,t,r;return e=new Od({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){U(e.$$.fragment),t=B(`
						Pause`)},m(n,s){R(e,n,s),w(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){n&&x(t),D(e,n)}}}function KR(o){let e,t,r;return e=new $d({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){U(e.$$.fragment),t=B(`
						Resume`)},m(n,s){R(e,n,s),w(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){n&&x(t),D(e,n)}}}function GR(o){let e,t,r=(o[11]||o[10])&&Zw(o);return{c(){r&&r.c(),e=pe()},m(n,s){r&&r.m(n,s),w(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&b(r,1)):(r=Zw(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(ne(),S(r,1,1,()=>{r=null}),se())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&x(e),r&&r.d(n)}}}function JR(o){let e=[],t=new zR,r,n,s=xe(o[6]),i=a=>a[25].guid;for(let a=0;a<s.length;a+=1){let l=Jw(o,s,a),c=i(l);t.set(c,e[a]=n1(c,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=pe()},m(a,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(a,l);w(a,r,l),n=!0},p(a,l){l&32851&&(s=xe(a[6]),ne(),e=eo(e,l,i,1,a,s,t,r.parentNode,ni,n1,r,Jw),se())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(e[l]);n=!0}},o(a){for(let l=0;l<e.length;l+=1)S(e[l]);n=!1},d(a){a&&x(r);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function QR(o){let e,t,r,n;return e=new ze({props:{$$slots:{name:[rD],default:[eD]},$$scope:{ctx:o}}}),r=new uh({props:{folder:o[5],backgroundSync:o[0]}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){R(e,s,i),w(s,t,i),R(r,s,i),n=!0},p(s,i){let a={};i&536875040&&(a.$$scope={dirty:i,ctx:s}),e.$set(a);let l={};i&32&&(l.folder=s[5]),i&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&x(t),D(e,s),D(r,s)}}}function Xw(o){let e,t,r,n,s,i=o[26].progress+"",a,l;return{c(){e=_("div"),t=_("div"),r=_("div"),n=F(),s=_("span"),a=B(i),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),me(r,"width",o[26].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,u){w(c,e,u),y(e,t),y(t,r),y(e,n),y(e,s),y(s,a),y(s,l)},p(c,u){u&80&&me(r,"width",c[26].progress+"%"),u&80&&i!==(i=c[26].progress+"")&&Q(a,i)},d(c){c&&x(e)}}}function YR(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&Xw(o);return{c(){t&&t.c(),e=pe()},m(r,n){t&&t.m(r,n),w(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=Xw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&x(e),t&&t.d(r)}}}function e1(o){let e,t=o[26].running+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&80&&t!==(t=s[26].running+"")&&Q(r,t)},d(s){s&&x(e)}}}function t1(o){let e,t=o[26].failed+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&80&&t!==(t=s[26].failed+"")&&Q(r,t)},d(s){s&&x(e)}}}function r1(o){let e,t=o[26].pending+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&80&&t!==(t=s[26].pending+"")&&Q(r,t)},d(s){s&&x(e)}}}function ZR(o){var C,M,A;let e,t,r,n,s,i=o[25].name+"",a,l,c,u,f,d,p,m,v=((C=o[26])==null?void 0:C.running)>0&&e1(o),g=((M=o[26])==null?void 0:M.failed)>0&&t1(o),k=((A=o[26])==null?void 0:A.pending)>0&&r1(o);function L(){return o[22](o[25])}function I(...E){return o[23](o[25],...E)}return{c(){e=_("div"),t=_("span"),r=B("\u25B6"),s=F(),a=B(i),l=F(),c=_("span"),v&&v.c(),u=F(),g&&g.c(),f=F(),k&&k.c(),h(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),h(c,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-expanded",d=!!o[1][o[25].guid])},m(E,P){w(E,e,P),y(e,t),y(t,r),y(e,s),y(e,a),y(e,l),y(e,c),v&&v.m(c,null),y(c,u),g&&g.m(c,null),y(c,f),k&&k.m(c,null),p||(m=[V(e,"click",L),V(e,"keydown",I)],p=!0)},p(E,P){var T,$,J;o=E,P&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&h(t,"class",n),P&64&&i!==(i=o[25].name+"")&&Q(a,i),((T=o[26])==null?void 0:T.running)>0?v?v.p(o,P):(v=e1(o),v.c(),v.m(c,u)):v&&(v.d(1),v=null),(($=o[26])==null?void 0:$.failed)>0?g?g.p(o,P):(g=t1(o),g.c(),g.m(c,f)):g&&(g.d(1),g=null),((J=o[26])==null?void 0:J.pending)>0?k?k.p(o,P):(k=r1(o),k.c(),k.m(c,null)):k&&(k.d(1),k=null),P&66&&d!==(d=!!o[1][o[25].guid])&&h(e,"aria-expanded",d)},d(E){E&&x(e),v&&v.d(),g&&g.d(),k&&k.d(),p=!1,we(m)}}}function XR(o){let e,t;return e=new xa({props:{folder:o[25],$$slots:{default:[ZR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function o1(o){let e,t;return e=new uh({props:{folder:o[25],backgroundSync:o[0]}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function n1(o,e){let t,r,n,s,i;r=new ze({props:{$$slots:{name:[XR],default:[YR]},$$scope:{ctx:e}}});let a=e[1][e[25].guid]&&o1(e);return{key:o,first:null,c(){t=pe(),U(r.$$.fragment),n=F(),a&&a.c(),s=pe(),this.first=t},m(l,c){w(l,t,c),R(r,l,c),w(l,n,c),a&&a.m(l,c),w(l,s,c),i=!0},p(l,c){e=l;let u={};c&536870994&&(u.$$scope={dirty:c,ctx:e}),r.$set(u),e[1][e[25].guid]?a?(a.p(e,c),c&66&&b(a,1)):(a=o1(e),a.c(),b(a,1),a.m(s.parentNode,s)):a&&(ne(),S(a,1,1,()=>{a=null}),se())},i(l){i||(b(r.$$.fragment,l),b(a),i=!0)},o(l){S(r.$$.fragment,l),S(a),i=!1},d(l){l&&(x(t),x(n),x(s)),D(r,l),a&&a.d(l)}}}function s1(o){let e,t,r,n,s,i=o[12].progress+"",a,l;return{c(){e=_("div"),t=_("div"),r=_("div"),n=F(),s=_("span"),a=B(i),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),me(r,"width",o[12].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,u){w(c,e,u),y(e,t),y(t,r),y(e,n),y(e,s),y(s,a),y(s,l)},p(c,u){u&4096&&me(r,"width",c[12].progress+"%"),u&4096&&i!==(i=c[12].progress+"")&&Q(a,i)},d(c){c&&x(e)}}}function eD(o){let e,t=(o[12].running>0||o[12].failed>0)&&s1(o);return{c(){t&&t.c(),e=pe()},m(r,n){t&&t.m(r,n),w(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=s1(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&x(e),t&&t.d(r)}}}function i1(o){let e,t=o[12].running+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&4096&&t!==(t=s[12].running+"")&&Q(r,t)},d(s){s&&x(e)}}}function a1(o){let e,t=o[12].failed+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&4096&&t!==(t=s[12].failed+"")&&Q(r,t)},d(s){s&&x(e)}}}function l1(o){let e,t=o[12].pending+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i&4096&&t!==(t=s[12].pending+"")&&Q(r,t)},d(s){s&&x(e)}}}function tD(o){let e,t=o[5].name+"",r,n,s,i,a,l=o[12].running>0&&i1(o),c=o[12].failed>0&&a1(o),u=o[12].pending>0&&l1(o);return{c(){e=_("div"),r=B(t),n=F(),s=_("span"),l&&l.c(),i=F(),c&&c.c(),a=F(),u&&u.c(),h(s,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf")},m(f,d){w(f,e,d),y(e,r),y(e,n),y(e,s),l&&l.m(s,null),y(s,i),c&&c.m(s,null),y(s,a),u&&u.m(s,null)},p(f,d){d&32&&t!==(t=f[5].name+"")&&Q(r,t),f[12].running>0?l?l.p(f,d):(l=i1(f),l.c(),l.m(s,i)):l&&(l.d(1),l=null),f[12].failed>0?c?c.p(f,d):(c=a1(f),c.c(),c.m(s,a)):c&&(c.d(1),c=null),f[12].pending>0?u?u.p(f,d):(u=l1(f),u.c(),u.m(s,null)):u&&(u.d(1),u=null)},d(f){f&&x(e),l&&l.d(),c&&c.d(),u&&u.d()}}}function rD(o){let e,t;return e=new xa({props:{folder:o[5],$$slots:{default:[tD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function oD(o){let e,t,r,n,s,i,a=!o[5]&&Qw(o),l=!o[5]&&Yw(o),c=[QR,JR],u=[];function f(d,p){return d[5]&&d[12]?0:1}return n=f(o,-1),s=u[n]=c[n](o),{c(){e=_("div"),a&&a.c(),t=F(),l&&l.c(),r=F(),s.c(),h(e,"class","setting-item-container")},m(d,p){w(d,e,p),a&&a.m(e,null),y(e,t),l&&l.m(e,null),y(e,r),u[n].m(e,null),i=!0},p(d,[p]){d[5]?a&&(ne(),S(a,1,1,()=>{a=null}),se()):a?p&32&&b(a,1):(a=Qw(d),a.c(),b(a,1),a.m(e,t)),d[5]?l&&(ne(),S(l,1,1,()=>{l=null}),se()):l?(l.p(d,p),p&32&&b(l,1)):(l=Yw(d),l.c(),b(l,1),l.m(e,r));let m=n;n=f(d,p),n===m?u[n].p(d,p):(ne(),S(u[m],1,1,()=>{u[m]=null}),se(),s=u[n],s?s.p(d,p):(s=u[n]=c[n](d),s.c()),b(s,1),s.m(e,null))},i(d){i||(b(a),b(l),b(s),i=!0)},o(d){S(a),S(l),S(s),i=!1},d(d){d&&x(e),a&&a.d(),l&&l.d(),u[n].d()}}}function nD(o,e,t){let r,n,s,i,a,l,c,u,f,d,p,{backgroundSync:m}=e,{sharedFolders:v}=e,{focusedFolderGuid:g}=e,k={},L=0,I=0,C=0,M=0,{activeSync:A,activeDownloads:E}=m;le(o,A,N=>t(21,p=N)),le(o,E,N=>t(20,d=N));function P(N){t(1,k[N]=!k[N],k),t(1,k),t(6,r),t(17,v)}function T(){l?m.resume():m.pause()}let $=N=>P(N.guid),J=(N,O)=>O.key==="Enter"&&P(N.guid);return o.$$set=N=>{"backgroundSync"in N&&t(0,m=N.backgroundSync),"sharedFolders"in N&&t(17,v=N.sharedFolders),"focusedFolderGuid"in N&&t(18,g=N.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=v.items().sort((N,O)=>N.name.localeCompare(O.name)))}if(o.$$.dirty&66){e:r.forEach(N=>{N.guid in k||t(1,k[N.guid]=!0,k)}),t(1,k),t(6,r),t(17,v)}if(o.$$.dirty&393216){e:t(5,n=g?v.items().find(N=>N.guid===g):void 0)}if(o.$$.dirty&3145793){e:t(4,s=new Map(r.map(N=>{var O,te;return[N.guid,{progress:((O=m.getGroupProgress(N))===null||O===void 0?void 0:O.percent)||0,running:[...p.items(),...d.items()].filter(Z=>Z.sharedFolder.guid===N.guid).length,failed:((te=m.syncGroups.get(N))===null||te===void 0?void 0:te.status)==="failed"?1:0,pending:[...m.pendingSyncs,...m.pendingDownloads].filter(Z=>Z.sharedFolder.guid===N.guid).length,completed:(()=>{let Z=m.syncGroups.get(N);return((Z==null?void 0:Z.completedSyncs)||0)+((Z==null?void 0:Z.completedDownloads)||0)})(),sharedFolder:N}]})))}if(o.$$.dirty&48){e:t(12,i=n?s.get(n.guid):void 0)}if(o.$$.dirty&1){e:t(19,a=m.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=a.isPaused)}if(o.$$.dirty&524288){e:c=a.syncsActive>0||a.downloadsActive>0}if(o.$$.dirty&16){e:{let N=0,O=0,te=0,Z=0;for(let Y of s.values())N+=Y.running,O+=Y.failed,te+=Y.pending,Z+=Y.completed;t(2,L=N),t(7,I=O),t(3,C=te),t(8,M=Z)}}if(o.$$.dirty&4){e:t(11,u=L>0)}if(o.$$.dirty&8){e:t(10,f=C>0)}},[m,k,L,C,s,n,r,I,M,l,f,u,i,A,E,P,T,v,g,a,d,p,$,J]}var fh=class extends K{constructor(e){super(),G(this,e,nD,oD,W,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},jR)}},c1=fh;var Ta=class extends u1.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new c1({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function dh(o){return o.startsWith("v")?o.slice(1):o}function sD(o,e){return o.map((t,r)=>[t,e[r]])}function iD(o,e){try{let t=dh(o).split(".").map(parseInt),r=dh(e).split(".").map(parseInt);for(let[n,s]of sD(t,r))if(n>s)return!0}catch(t){}return!1}var tu=class extends st{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.observableName="UpdateManager";this.githubReleases=new Wo("system3-relay/releases"),this.releaseChannels=new Wo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await it("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return Ze().enableNetworkLogging&&this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await it(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(this.debug("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),n=new Set([...this.githubReleases.keys()]),s=new Set;r.forEach(a=>{this.githubReleases.set(a.tag_name,a),s.add(a.tag_name)}),n.forEach(a=>{s.has(a)||this.githubReleases.delete(a)});let i=await this.fetchLatestRelease();i&&(i.latest=!0,this.githubReleases.set(i.tag_name,i)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let i=await this.fetchLatestTagFromChannel(s);if(!i)return null;let a=n.find(l=>dh(l.tag_name)===i);return a?(this.releaseChannels.set(s,a),this.notifyListeners(),a):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let i=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${i}`);let a=await it(i);if(!a.ok)throw new Error("unable to fetch manifest");return await a.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(i=>i.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await it(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return Ze().enableNetworkLogging&&this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&iD(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var M1=require("obsidian");var C1=require("obsidian");function aD(o){Ce(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function f1(o,e,t){let r=o.slice();return r[66]=e[t],r}function d1(o){let e,t;return e=new Ft({props:{name:"Show all releases",$$slots:{default:[lD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&128&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function lD(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("input"),r=F(),n=_("div"),h(t,"type","checkbox"),t.checked=o[6],h(n,"class","checkbox-toggle"),h(e,"class","checkbox-container svelte-12doke6"),h(e,"role","checkbox"),h(e,"aria-checked",o[6]),h(e,"tabindex","0"),Te(e,"is-enabled",o[6])},m(a,l){w(a,e,l),y(e,t),y(e,r),y(e,n),s||(i=[V(e,"click",o[41]),V(e,"keydown",o[42])],s=!0)},p(a,l){l[0]&64&&(t.checked=a[6]),l[0]&64&&h(e,"aria-checked",a[6]),l[0]&64&&Te(e,"is-enabled",a[6])},d(a){a&&x(e),s=!1,we(i)}}}function cD(o){let e,t,r=!o[1]&&p1(o);function n(a,l){if(a[11])return mD;if(a[16])return pD}let s=n(o,[-1,-1,-1]),i=s&&s(o);return{c(){r&&r.c(),e=F(),i&&i.c(),t=pe()},m(a,l){r&&r.m(a,l),w(a,e,l),i&&i.m(a,l),w(a,t,l)},p(a,l){a[1]?r&&(r.d(1),r=null):r?r.p(a,l):(r=p1(a),r.c(),r.m(e.parentNode,e)),s===(s=n(a,l))&&i?i.p(a,l):(i&&i.d(1),i=s&&s(a),i&&(i.c(),i.m(t.parentNode,t)))},d(a){a&&(x(e),x(t)),r&&r.d(a),i&&i.d(a)}}}function uD(o){let e;return{c(){e=_("div"),e.textContent="No matching releases found with the current filter",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function fD(o){let e;return{c(){e=_("div"),e.textContent="No GitHub releases found",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function dD(o){let e;return{c(){e=_("div"),e.textContent="Loading GitHub releases...",h(e,"class","loading-text svelte-12doke6")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function p1(o){let e,t,r,n=!o[8].some(o[40]),s,i=o[5]&&m1(o),a=o[4]&&h1(o),l=n&&g1(o),c=!o[1]&&y1(o);return{c(){e=_("div"),i&&i.c(),t=F(),a&&a.c(),r=F(),l&&l.c(),s=F(),c&&c.c(),h(e,"class","release-tags-container svelte-12doke6")},m(u,f){w(u,e,f),i&&i.m(e,null),y(e,t),a&&a.m(e,null),y(e,r),l&&l.m(e,null),y(e,s),c&&c.m(e,null)},p(u,f){u[5]?i?i.p(u,f):(i=m1(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null),u[4]?a?a.p(u,f):(a=h1(u),a.c(),a.m(e,r)):a&&(a.d(1),a=null),f[0]&256&&(n=!u[8].some(u[40])),n?l?l.p(u,f):(l=g1(u),l.c(),l.m(e,s)):l&&(l.d(1),l=null),u[1]?c&&(c.d(1),c=null):c?c.p(u,f):(c=y1(u),c.c(),c.m(e,null))},d(u){u&&x(e),i&&i.d(),a&&a.d(),l&&l.d(),c&&c.d()}}}function m1(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),t.textContent="Stable",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="stable"),h(e,"tabindex","0")},m(i,a){w(i,e,a),y(e,t),n||(s=[V(e,"click",o[43]),V(e,"keydown",o[44])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="stable")&&h(e,"aria-selected",r)},d(i){i&&x(e),n=!1,we(s)}}}function h1(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),t.textContent="Beta",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="beta"),h(e,"tabindex","0")},m(i,a){w(i,e,a),y(e,t),n||(s=[V(e,"click",o[45]),V(e,"keydown",o[46])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="beta")&&h(e,"aria-selected",r)},d(i){i&&x(e),n=!1,we(s)}}}function g1(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),t.textContent="Dev",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item development-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[10]===o[0].version),h(e,"tabindex","0")},m(i,a){w(i,e,a),y(e,t),n||(s=[V(e,"click",o[47]),V(e,"keydown",o[48])],n=!0)},p(i,a){a[0]&1025&&r!==(r=i[10]===i[0].version)&&h(e,"aria-selected",r)},d(i){i&&x(e),n=!1,we(s)}}}function y1(o){let e,t=xe(o[8]),r=[];for(let n=0;n<t.length;n+=1)r[n]=b1(f1(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=pe()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);w(n,e,s)},p(n,s){if(s[0]&268436736|s[1]&17){t=xe(n[8]);let i;for(i=0;i<t.length;i+=1){let a=f1(n,t,i);r[i]?r[i].p(a,s):(r[i]=b1(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&x(e),qe(r,n)}}}function b1(o){let e,t,r=o[66].tag_name+"",n,s,i,a,l,c;function u(){return o[49](o[66])}function f(...d){return o[50](o[66],...d)}return{c(){e=_("div"),t=_("div"),n=B(r),s=F(),h(t,"class","tag-name svelte-12doke6"),h(e,"class",i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(I1(o[66])?"pre-release":"")+" svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",a=o[10]===o[66].tag_name),h(e,"tabindex","0")},m(d,p){w(d,e,p),y(e,t),y(t,n),y(e,s),l||(c=[V(e,"click",u),V(e,"keydown",f)],l=!0)},p(d,p){o=d,p[0]&256&&r!==(r=o[66].tag_name+"")&&Q(n,r),p[0]&256&&i!==(i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(I1(o[66])?"pre-release":"")+" svelte-12doke6")&&h(e,"class",i),p[0]&1280&&a!==(a=o[10]===o[66].tag_name)&&h(e,"aria-selected",a)},d(d){d&&x(e),l=!1,we(c)}}}function pD(o){let e,t,r,n,s,i,a;return{c(){e=_("div"),t=_("div"),r=B(o[16]),n=F(),s=_("button"),s.textContent="Close",h(t,"class","manifest-error-message svelte-12doke6"),h(s,"class","manifest-close-btn svelte-12doke6"),h(e,"class","manifest-error svelte-12doke6")},m(l,c){w(l,e,c),y(e,t),y(t,r),y(e,n),y(e,s),i||(a=V(s,"click",o[37]),i=!0)},p(l,c){c[0]&65536&&Q(r,l[16])},d(l){l&&x(e),i=!1,a()}}}function mD(o){var N;let e,t,r,n,s,i,a=(N=o[38](o[10]))==null?void 0:N.prerelease,l,c,u,f,d,p,m,v,g,k,L=a&&v1(o),I=o[12][o[10]]==="beta-alias"&&_1(o),C=o[12][o[10]]==="stable-alias"&&x1(o);function M(O,te){if(te[0]&9216&&(d=null),te[0]&1024&&(p=null),d==null&&(d=!!((O[38](O[10])||O[13][O[10]]==="stable-alias"||O[13][O[10]]==="beta-alias")&&!O[28](O[10]))),d)return gD;if(p==null&&(p=!!O[28](O[10])),p)return hD}let A=M(o,[-1,-1,-1]),E=A&&A(o);function P(O,te){return O[13][O[10]]==="stable-alias"||O[13][O[10]]==="beta-alias"||O[9]==="development"?xD:O[10]?_D:vD}let T=P(o,[-1,-1,-1]),$=T(o),J=o[15]&&w1(o);return{c(){e=_("div"),t=_("div"),r=_("h3"),n=B("Release Details: "),s=B(o[10]),i=F(),L&&L.c(),l=F(),I&&I.c(),c=F(),C&&C.c(),u=F(),f=_("div"),E&&E.c(),m=F(),v=_("div"),g=_("div"),$.c(),k=F(),J&&J.c(),h(r,"class","svelte-12doke6"),h(f,"class","manifest-header-actions svelte-12doke6"),h(t,"class","manifest-header svelte-12doke6"),h(g,"class","release-changelog-content svelte-12doke6"),h(v,"class","release-changelog svelte-12doke6"),h(e,"class","manifest-container svelte-12doke6")},m(O,te){w(O,e,te),y(e,t),y(t,r),y(r,n),y(r,s),y(r,i),L&&L.m(r,null),y(r,l),I&&I.m(r,null),y(r,c),C&&C.m(r,null),y(t,u),y(t,f),E&&E.m(f,null),y(e,m),y(e,v),y(v,g),$.m(g,null),y(e,k),J&&J.m(e,null)},p(O,te){var Z;te[0]&1024&&Q(s,O[10]),te[0]&1024&&(a=(Z=O[38](O[10]))==null?void 0:Z.prerelease),a?L||(L=v1(O),L.c(),L.m(r,l)):L&&(L.d(1),L=null),O[12][O[10]]==="beta-alias"?I||(I=_1(O),I.c(),I.m(r,c)):I&&(I.d(1),I=null),O[12][O[10]]==="stable-alias"?C||(C=x1(O),C.c(),C.m(r,null)):C&&(C.d(1),C=null),A===(A=M(O,te))&&E?E.p(O,te):(E&&E.d(1),E=A&&A(O),E&&(E.c(),E.m(f,null))),T===(T=P(O,te))&&$?$.p(O,te):($.d(1),$=T(O),$&&($.c(),$.m(g,null))),O[15]?J?J.p(O,te):(J=w1(O),J.c(),J.m(e,null)):J&&(J.d(1),J=null)},d(O){O&&x(e),L&&L.d(),I&&I.d(),C&&C.d(),E&&E.d(),$.d(),J&&J.d()}}}function v1(o){let e;return{c(){e=_("span"),e.textContent="Pre-release",h(e,"class","prerelease-badge svelte-12doke6")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function _1(o){let e;return{c(){e=_("span"),e.textContent="Beta",h(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function x1(o){let e;return{c(){e=_("span"),e.textContent="Stable",h(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function hD(o){let e;return{c(){e=_("span"),e.textContent="Installed",h(e,"class","currently-installed svelte-12doke6")},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function gD(o){let e,t,r,n;function s(l,c){return l[14]===l[10]?bD:yD}let i=s(o,[-1,-1,-1]),a=i(o);return{c(){e=_("button"),a.c(),h(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[14]===o[10]||o[2]},m(l,c){w(l,e,c),a.m(e,null),r||(n=V(e,"click",o[51]),r=!0)},p(l,c){i!==(i=s(l,c))&&(a.d(1),a=i(l),a&&(a.c(),a.m(e,null))),c[0]&17412&&t!==(t=l[14]===l[10]||l[2])&&(e.disabled=t)},d(l){l&&x(e),a.d(),r=!1,n()}}}function yD(o){let e;return{c(){e=B("Install")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function bD(o){let e;return{c(){e=B("Installing...")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function vD(o){let e;return{c(){e=B('"No changelog available"')},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function _D(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:kD,then:SD,catch:wD,value:65};return Yo(t=o[34](((n=o[38](o[10]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=pe(),r.block.c()},m(s,i){w(s,e,i),r.block.m(s,r.anchor=i),r.mount=()=>e.parentNode,r.anchor=e},p(s,i){var a;o=s,r.ctx=o,i[0]&1024&&t!==(t=o[34](((a=o[38](o[10]))==null?void 0:a.body)||"No changelog available"))&&Yo(t,r)||ri(r,o,i)},d(s){s&&x(e),r.block.d(s),r.token=null,r=null}}}function xD(o){let e;function t(s,i){if(s[13][s[10]]==="stable-alias")return LD;if(s[13][s[10]]==="beta-alias")return CD;if(s[10]===s[0].version)return ID}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=pe()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,i){r!==(r=t(s,i))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&x(e),n&&n.d(s)}}}function wD(o){return{c:q,m:q,p:q,d:q}}function SD(o){let e,t=o[65]+"",r;return{c(){e=new Cn(!1),r=pe(),e.a=r},m(n,s){e.m(t,n,s),w(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[65]+"")&&e.p(t)},d(n){n&&(x(r),e.d())}}}function kD(o){let e;return{c(){e=B('"loading..."')},m(t,r){w(t,e,r)},p:q,d(t){t&&x(e)}}}function ID(o){let e;return{c(){e=_("p"),e.textContent="Current development version"},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function CD(o){let e;return{c(){e=_("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function LD(o){let e;return{c(){e=_("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function w1(o){let e,t,r,n,s,i=o[11].version+"",a,l,c=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),u,f,d,p,m,v=o[11].name+"",g,k,L,I,C,M,A=o[11].author+"",E,P,T,$,J,N,O=o[11].description+"",te,Z,Y,ge,j,H,X=o[11].isDesktopOnly?"Yes":"No",ue,z,ee,re,fe,Le,de=o[11].minAppVersion+"",Ee,Oe=c&&S1(o);return{c(){e=_("div"),t=_("div"),r=_("span"),r.textContent="Version:",n=F(),s=_("span"),a=B(i),l=F(),Oe&&Oe.c(),u=F(),f=_("div"),d=_("span"),d.textContent="Name:",p=F(),m=_("span"),g=B(v),k=F(),L=_("div"),I=_("span"),I.textContent="Author:",C=F(),M=_("span"),E=B(A),P=F(),T=_("div"),$=_("span"),$.textContent="Description:",J=F(),N=_("span"),te=B(O),Z=F(),Y=_("div"),ge=_("span"),ge.textContent="isDesktopOnly:",j=F(),H=_("span"),ue=B(X),z=F(),ee=_("div"),re=_("span"),re.textContent="minAppVersion:",fe=F(),Le=_("span"),Ee=B(de),h(r,"class","manifest-label svelte-12doke6"),h(s,"class","manifest-value svelte-12doke6"),h(t,"class","manifest-field svelte-12doke6"),h(d,"class","manifest-label svelte-12doke6"),h(m,"class","manifest-value svelte-12doke6"),h(f,"class","manifest-field svelte-12doke6"),h(I,"class","manifest-label svelte-12doke6"),h(M,"class","manifest-value svelte-12doke6"),h(L,"class","manifest-field svelte-12doke6"),h($,"class","manifest-label svelte-12doke6"),h(N,"class","manifest-value svelte-12doke6"),h(T,"class","manifest-field svelte-12doke6"),h(ge,"class","manifest-label svelte-12doke6"),h(H,"class","manifest-value svelte-12doke6"),h(Y,"class","manifest-field svelte-12doke6"),h(re,"class","manifest-label svelte-12doke6"),h(Le,"class","manifest-value svelte-12doke6"),h(ee,"class","manifest-field svelte-12doke6"),h(e,"class","manifest-content svelte-12doke6")},m(Me,ot){w(Me,e,ot),y(e,t),y(t,r),y(t,n),y(t,s),y(s,a),y(t,l),Oe&&Oe.m(t,null),y(e,u),y(e,f),y(f,d),y(f,p),y(f,m),y(m,g),y(e,k),y(e,L),y(L,I),y(L,C),y(L,M),y(M,E),y(e,P),y(e,T),y(T,$),y(T,J),y(T,N),y(N,te),y(e,Z),y(e,Y),y(Y,ge),y(Y,j),y(Y,H),y(H,ue),y(e,z),y(e,ee),y(ee,re),y(ee,fe),y(ee,Le),y(Le,Ee)},p(Me,ot){ot[0]&2048&&i!==(i=Me[11].version+"")&&Q(a,i),ot[0]&3072&&(c=Me[10]!==Me[11].version&&!Me[10].startsWith("v"+Me[11].version)),c?Oe||(Oe=S1(Me),Oe.c(),Oe.m(t,null)):Oe&&(Oe.d(1),Oe=null),ot[0]&2048&&v!==(v=Me[11].name+"")&&Q(g,v),ot[0]&2048&&A!==(A=Me[11].author+"")&&Q(E,A),ot[0]&2048&&O!==(O=Me[11].description+"")&&Q(te,O),ot[0]&2048&&X!==(X=Me[11].isDesktopOnly?"Yes":"No")&&Q(ue,X),ot[0]&2048&&de!==(de=Me[11].minAppVersion+"")&&Q(Ee,de)},d(Me){Me&&x(e),Oe&&Oe.d()}}}function S1(o){let e;return{c(){e=_("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,h(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function MD(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,i,a,l,c,u,f=!o[1]&&d1(o);function d(v,g){return v[7]?dD:v[3].length===0?fD:v[8].length===0?uD:cD}let p=d(o,[-1,-1,-1]),m=p(o);return{c(){e=_("div"),r=B(t),n=F(),s=_("div"),i=_("div"),a=F(),l=_("div"),f&&f.c(),c=F(),m.c(),h(e,"class","modal-title"),h(i,"class","settings-spacer svelte-12doke6"),h(l,"class","settings-container svelte-12doke6"),h(s,"class","modal-content svelte-12doke6")},m(v,g){w(v,e,g),y(e,r),w(v,n,g),w(v,s,g),y(s,i),y(s,a),y(s,l),f&&f.m(l,null),y(s,c),m.m(s,null),u=!0},p(v,g){(!u||g[0]&2)&&t!==(t=v[1]?"Relay installer":"Relay releases")&&Q(r,t),v[1]?f&&(ne(),S(f,1,1,()=>{f=null}),se()):f?(f.p(v,g),g[0]&2&&b(f,1)):(f=d1(v),f.c(),b(f,1),f.m(l,null)),p===(p=d(v,g))&&m?m.p(v,g):(m.d(1),m=p(v),m&&(m.c(),m.m(s,null)))},i(v){u||(b(f),u=!0)},o(v){S(f),u=!1},d(v){v&&(x(e),x(n),x(s)),f&&f.d(),m.d()}}}var k1="system3-relay";function ps(o){return o.startsWith("v")?o.substring(1):o}function I1(o){return(o==null?void 0:o.prerelease)===!0}function TD(o,e,t){let r,n,s,i,a,l,c,u,f,d,p,m,v,g,k,L,{plugin:I}=e,{version:C}=e,M=Ie(I.manifest.version),A=Ie(!1),E=Ie(""),P=Ie(""),T=Ie(!1);le(o,T,ae=>t(7,c=ae));let $=Ie(!1);le(o,$,ae=>t(6,l=ae));let J=Ie(null);le(o,J,ae=>t(11,p=ae));let N=Ie("");le(o,N,ae=>t(10,d=ae));let O=Ie(null),te=Ie(null);le(o,te,ae=>t(16,L=ae));let Z=Ie(!1);le(o,Z,ae=>t(15,k=ae));let Y=Ie(null);le(o,Y,ae=>t(5,s=ae));let ge=Ie(null);le(o,ge,ae=>t(4,n=ae));let j=Ie(null);le(o,j,ae=>t(53,a=ae));let H=Ie(null);le(o,H,ae=>t(52,i=ae));let X=Ie(!1),ue=!1,z=Ie(null);le(o,z,ae=>t(14,g=ae));let ee=I.app;function re(ae){let Ne=ps(ae),dt=ps(I.version);return Ne===dt}let fe=Ie({});le(o,fe,ae=>t(13,v=ae));let Le=Ie({});le(o,Le,ae=>t(12,m=ae));let de=Ie(I.releaseSettings.get().channel);le(o,de,ae=>t(9,f=ae)),lt(()=>{ot(),Ee(),!C&&!r.some(ae=>{ae.tag_name,I.version})?de.set(null):de.set(I.releaseSettings.get().channel),J.set({version:C||I.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),N.set(C||I.version)});function Ee(){return Ae(this,void 0,void 0,function*(){X.set(!0);try{let ae=yield I.updateManager.fetchRepoManifest("manifest.json");ae&&(Y.set(ae),j.set(ae.version));let Ne=yield I.updateManager.fetchRepoManifest("manifest-beta.json");Ne&&(ge.set(Ne),H.set(Ne.version))}catch(ae){I.error("Error fetching main branch manifests:",ae)}finally{X.set(!1)}})}let Oe=Xe(I.updateManager,()=>I.updateManager.releases);le(o,Oe,ae=>t(3,r=ae));let Me=Xe([Oe,$],()=>r&&r.length>0?Dt(l).sort():[]);le(o,Me,ae=>t(8,u=ae)),r.forEach(ae=>Ae(void 0,void 0,void 0,function*(){try{let Ne=yield I.updateManager.fetchReleaseManifest(ae);Ne&&fe.update(dt=>Object.assign(Object.assign({},dt),{[ae.tag_name]:Ne.version}))}catch(Ne){}}));function ot(){return Ae(this,void 0,void 0,function*(){T.set(!0);try{yield I.updateManager.getReleases(),Dt(l)}catch(ae){I.error("Error refreshing GitHub releases:",ae)}finally{T.set(!1)}})}function at(ae){return Ae(this,void 0,void 0,function*(){let Ne=document.createElement("div");return yield C1.MarkdownRenderer.render(I.app,ae,Ne,"",I),Ne.innerHTML})}function Dt(ae){return ae?r:C?r.filter(Ne=>C===ps(Ne.tag_name)):r.filter(Ne=>{let dt=Ne.tag_name;return Eo(Ne)})}function Eo(ae){if(ae.prerelease||ae.draft)return!1;if(ae.latest||ps(ae.tag_name)===a||ps(ae.tag_name)===i)return!0;let Ne=new Date(ae.created_at),dt=new Date;return dt.setMonth(dt.getMonth()-3),Ne>dt}function Ir(ae){return Ae(this,void 0,void 0,function*(){te.set(null),O.set(ae);try{let Ne=qt(ae);if(!Ne){te.set(`Could not find release for ${ae}`);return}let dt=yield I.updateManager.fetchReleaseManifest(Ne);dt?(J.set(dt),N.set(ae),Z.set(!1),fe.update(Vr=>Object.assign(Object.assign({},Vr),{[ae]:dt.version}))):te.set(`Could not find manifest for ${ae}`)}catch(Ne){I.error("Error fetching manifest:",Ne),te.set(`Error fetching manifest: ${Ne.message||"Unknown error"}`)}finally{O.set(null)}})}function Cr(ae){let Ne=ae==="stable"?s:n;if(Ne){let dt=Ne.version;de.set(ae);let Vr=[...r.values()].find(ir=>ps(ir.tag_name)===ps(dt));Vr?(ae==="stable"?Le.update(ir=>Object.assign(Object.assign({},ir),{[Vr.tag_name]:"stable-alias"})):Le.update(ir=>Object.assign(Object.assign({},ir),{[Vr.tag_name]:"beta-alias"})),Ir(Vr.tag_name)):(J.set(Ne),N.set(dt),ae==="stable"?Le.update(ir=>Object.assign(Object.assign({},ir),{[dt]:"stable-alias"})):Le.update(ir=>Object.assign(Object.assign({},ir),{[dt]:"beta-alias"})),Z.set(!1))}else te.set(`Could not find ${ae} manifest`)}function io(){J.set(null),N.set(""),te.set(null)}function qt(ae){return[...r.values()].find(Ne=>Ne.tag_name===ae)}function on(ae){return Ae(this,void 0,void 0,function*(){try{z.set(ae);let Ne=qt(ae);if(!Ne)throw new Error(`Could not find release for ${ae}`);let dt=yield I.updateManager.fetchReleaseManifest(Ne);if(!dt)throw new Error(`Could not find manifest for ${ae}`);t(2,ue=!0),yield ee.plugins.installPlugin(I.repo,ae,dt),yield ee.plugins.disablePlugin(k1),yield ee.plugins.enablePlugin(k1)}catch(Ne){console.error(`Error installing version ${ae}:`,Ne),I&&I.error(`Error installing version ${ae}:`,Ne)}finally{I&&(t(2,ue=!1),z.set(null))}})}let ms=ae=>re(ae.tag_name),yr=()=>{$.update(ae=>!ae)},Lr=ae=>{(ae.key==="Enter"||ae.key===" ")&&$.update(Ne=>!Ne)},ao=()=>{I.releaseSettings.update(ae=>({...ae,channel:"stable"})),de.set("stable"),Cr("stable")},Un=ae=>{(ae.key==="Enter"||ae.key===" ")&&(I.releaseSettings.update(Ne=>({...Ne,channel:"stable"})),de.set("stable"),Cr("stable"))},lo=()=>{I.releaseSettings.update(ae=>({...ae,channel:"beta"})),de.set("beta"),Cr("beta")},On=ae=>{(ae.key==="Enter"||ae.key===" ")&&(I.releaseSettings.update(Ne=>({...Ne,channel:"beta"})),de.set("beta"),Cr("beta"))},ke=()=>{de.set(null),J.set({version:I.manifest.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),N.set(I.version),Z.set(!1)},Ke=ae=>{(ae.key==="Enter"||ae.key===" ")&&(de.set(null),J.set({version:I.manifest.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),N.set(I.version),Z.set(!1))},et=ae=>{de.set(null),Ir(ae.tag_name)},Mr=(ae,Ne)=>{(Ne.key==="Enter"||Ne.key===" ")&&(de.set(null),Ir(ae.tag_name))},nn=async()=>{on(d)};return o.$$set=ae=>{"plugin"in ae&&t(0,I=ae.plugin),"version"in ae&&t(1,C=ae.version)},[I,C,ue,r,n,s,l,c,u,f,d,p,m,v,g,k,L,T,$,J,N,te,Z,Y,ge,j,H,z,re,fe,Le,de,Oe,Me,at,Ir,Cr,io,qt,on,ms,yr,Lr,ao,Un,lo,On,ke,Ke,et,Mr,nn]}var ph=class extends K{constructor(e){super(),G(this,e,TD,MD,W,{plugin:0,version:1},aD,[-1,-1,-1])}},L1=ph;var Aa=class extends M1.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new L1({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var AD=`
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyDIav6xzBzyi6eQu8aJA
O8DufA/MyTMDsD9d6PmjhuPTSlVPharZSjxRkHi6sK50ZmRedQbyiBuNp0g6so30
+zunoqT9XUpvZD0+USlGvi0J48Cop+DQbbpTlAlsmX6BxhHJLUrmgU0AhHjvJLNL
rRuzzQxrn/Oi0byUHu/moitUypX1hSYrKH5meRy8zoyGb8b0qIOEKpcpVKGyD/ne
+u0Bhh6tI8t2vQDQK0RL87dc+EqlQXxtijXBSClqvJi7o3JYTtWtuaWcZ2pQdg5y
+gDMii2hZYLNdgDM+/NcJlp3fkPztVeVRpiV20gZDhqANSjWjx9iN1Jt9A97rCSH
XQIDAQAB
-----END PUBLIC KEY-----
`.trim();var Ht=class extends Error{constructor(t,r,n){super(t);this.type=r;this.details=n;this.name="ValidationError"}};function mh(o){return typeof o=="object"&&o!==null&&"license"in o&&typeof o.license=="string"}function ru(o){return Array.isArray(o)&&o.every(mh)}var ou=class{constructor(e){this.settings=e;this.log=Fe("[EndpointManager]")}isStaging(){return!1}sanitizeUrlForLog(e){try{let t=new URL(e);return t.search="",t.toString()}catch(t){return e}}validateUrl(e){if(!e||typeof e!="string")throw new Ht("URL must be a non-empty string","URL_INVALID");let t;try{t=new URL(e)}catch(s){throw new Ht("Invalid URL format","URL_INVALID")}let r=this.isStaging();if(r){if(t.protocol!=="https:"&&t.protocol!=="http:")throw new Ht("Only HTTP and HTTPS URLs are allowed in development","URL_INVALID")}else if(t.protocol!=="https:")throw new Ht("Only HTTPS URLs are allowed in production","URL_INVALID");let n=t.hostname.toLowerCase();if((n==="localhost"||n==="127.0.0.1"||n==="::1")&&this.log(`Warning: Using localhost endpoint (development build: ${r})`),!n||n.length<3)throw new Ht("Invalid hostname","URL_INVALID")}async getPublicKey(){if(this._publicKeyCache)return this._publicKeyCache;try{return this._publicKeyCache=await Tm(AD,"RS256"),this._publicKeyCache}catch(e){throw new Ht("Failed to import public key","JWT_VERIFICATION_FAILED",e)}}getApiUrl(){return this._validatedApiUrl||"https://api.system3.md"}getAuthUrl(){return this._validatedAuthUrl||"https://auth.system3.md"}getDefaultUrls(){return{apiUrl:"https://api.system3.md",authUrl:"https://auth.system3.md",environment:"production"}}async validateAndSetEndpoints(e=1e4){let t=this.settings.get(),r=this.getActiveTenant(t);if(!r)return this.log("No active enterprise tenant configured, using defaults"),this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,{success:!0};try{let n=this.performTenantValidation(r.tenantUrl),s=new Promise((a,l)=>setTimeout(()=>l(new Error(`Validation timed out after ${e}ms`)),e));return await Promise.race([n,s])}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("Failed to validate tenant:",s),{success:!1,error:s}}}async performTenantValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return!n.apiUrl||!n.authUrl?{success:!1,error:"License missing required apiUrl or authUrl"}:n.authUrl!==e?{success:!1,error:`Tenant URL mismatch: expected ${e}, license has ${n.authUrl}`}:(this._validatedApiUrl=n.apiUrl,this._validatedAuthUrl=n.authUrl,this.log("Successfully validated enterprise tenant",{tenant:e,apiUrl:this._validatedApiUrl,authUrl:this._validatedAuthUrl,customer:n.customer}),{success:!0,licenseInfo:r.licenseInfo})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchTenantLicense(e){try{let t=new URL(e),r=`${t.protocol}//${t.host}/.well-known/relay.md/license`;this.log("Fetching tenant license from:",r);let n=await it(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`License fetch failed: ${n.status} ${n.statusText}`);let s=await n.json(),i=[];if(ru(s))i=s;else if(s&&typeof s=="object"&&"licenses"in s&&ru(s.licenses))i=s.licenses;else if(mh(s))i=[s];else throw new Ht("No valid licenses found in response","LICENSE_NOT_FOUND");if(i.length===0)throw new Error("Empty license list");return{success:!0,license:i[0].license}}catch(t){let r=t instanceof Error?t.message:"Unknown error";return r.includes("Failed to fetch")||r.includes("NetworkError")||r.includes("ERR_")||r.includes("ECONNREFUSED")?r=`Unable to connect to ${e}. Please check the URL and ensure the server is running.`:r.includes("404")?r=`No tenant license found at ${e}. This may not be a valid Enterprise Relay tenant.`:r.includes("License fetch failed"),this.log("Tenant license fetch error:",r),{success:!1,error:r}}}findMatchingEndpointLicense(e,t,r){this.log(`Searching for ${r} license for ${this.sanitizeUrlForLog(t)}`);for(let n of e)try{let s=La(n.license);if(s.endpointType===r&&s.url===t)return this.log(`Found matching license for ${r}: ${this.sanitizeUrlForLog(t)}`),n}catch(s){continue}return null}async validateTenantLicense(e,t){this.log(`Tenant license validation starting: ${this.sanitizeUrlForLog(t)}`);try{let r=await this.verifyJWT(e);if(r.iss!=="https://auth.system3.md")throw new Ht(`Invalid token issuer: expected https://auth.system3.md, got ${r.iss}`,"LICENSE_INVALID");if(r.sub!=="endpoint-certificate")throw new Ht(`Invalid token subject: expected "endpoint-certificate", got ${r.sub}`,"LICENSE_INVALID");let n={issuer:r.iss||"Unknown",subject:r.sub||"Unknown",validFrom:r.iat?new Date(r.iat*1e3).toISOString():"Unknown",validTo:r.exp?new Date(r.exp*1e3).toISOString():"Unknown",isValid:!0};return this.log(`Tenant license validation successful: ${this.sanitizeUrlForLog(t)}`),{success:!0,licenseInfo:n}}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log(`Tenant license validation failed: ${this.sanitizeUrlForLog(t)} - ${n}`),{success:!1,error:n}}}validateLicenseClaims(e,t,r){if(e.iss!=="https://auth.system3.md")throw new Ht(`Invalid token issuer: expected https://auth.system3.md, got ${e.iss}`,"LICENSE_INVALID");if(e.sub!=="endpoint-certificate")throw new Ht(`Invalid token subject: expected "endpoint-certificate", got ${e.sub}`,"LICENSE_INVALID");if(e.endpointType!==t)throw new Ht(`License endpoint type mismatch: expected ${t}, got ${e.endpointType}`,"LICENSE_INVALID");if(e.url!==r)throw new Ht(`License URL mismatch: expected ${r}, got ${e.url}`,"LICENSE_INVALID")}async verifyJWT(e){try{let t=await this.getPublicKey(),{payload:r}=await Rm(e,t,{algorithms:["RS256"]});return r}catch(t){throw this.log("JWT verification failed:",t),new Ht(`JWT verification failed: ${t instanceof Error?t.message:"Unknown error"}`,"JWT_VERIFICATION_FAILED",t)}}clearValidatedEndpoints(){this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,this.log("Cleared validated endpoints, reverted to defaults")}hasValidatedEndpoints(){return!!(this._validatedApiUrl&&this._validatedAuthUrl)}getActiveTenant(e){if(!(!e.activeTenantId||!e.tenants))return e.tenants.find(t=>t.id===e.activeTenantId)}generateTenantId(e){try{let t=new URL(e);return`${t.hostname}:${t.port||(t.protocol==="https:"?"443":"80")}`}catch(t){return e.replace(/[^a-zA-Z0-9]/g,"_")}}async addTenant(e,t=!0){var r;try{this.validateUrl(e);let n=this.generateTenantId(e);if((r=this.settings.get().tenants)!=null&&r.some(l=>l.id===n))return{success:!1,error:"This tenant is already configured"};let i={id:n,name:e,tenantUrl:e,isValidated:!1},a;if(t){let l=await this.fetchTenantLicense(e);if(!l.success)return{success:!1,error:l.error||"Failed to fetch tenant license"};let c=await this.validateTenantLicense(l.license,e);if(!c.success)return{success:!1,error:c.error||"Tenant license validation failed"};a=c;let u=await this.verifyJWT(l.license);i={...i,name:u.customer||e,apiUrl:u.apiUrl,authUrl:u.authUrl,customer:u.customer,logo:u.logo,environment:u.environment,isValidated:!0,lastValidated:Date.now()}}return await this.settings.update(l=>({...l,tenants:[...l.tenants||[],i]})),{success:!0,tenantId:n,licenseInfo:a==null?void 0:a.licenseInfo}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async removeTenant(e){let t=this.settings.get(),r=t.tenants||[];if(!r.some(s=>s.id===e))return!1;let n={tenants:r.filter(s=>s.id!==e)};return t.activeTenantId===e&&(n.activeTenantId=void 0,this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),await this.settings.update(s=>({...s,...n})),!0}async switchToTenant(e){var n;let r=(n=this.settings.get().tenants)==null?void 0:n.find(s=>s.id===e);return r?(await this.settings.update(s=>({...s,activeTenantId:e})),r.isValidated&&r.apiUrl&&r.authUrl?(this._validatedApiUrl=r.apiUrl,this._validatedAuthUrl=r.authUrl):(this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),{success:!0}):{success:!1,error:"Tenant not found"}}async getCustomerInfo(){if(!this.hasValidatedEndpoints())return null;let e=this.settings.get(),t=this.getActiveTenant(e);if(!t)return null;try{if(t.isValidated&&t.customer)return{customer:t.customer,logo:t.logo};let r=await this.fetchTenantLicense(t.tenantUrl);if(r.success&&r.license){let n=await this.verifyJWT(r.license);return{customer:n.customer,logo:n.logo}}}catch(r){this.log("Failed to get customer info:",r)}return null}async getDefaultTenantInfo(){try{let e=await this.fetchTenantLicense("https://auth.system3.md");if(e.success&&e.license){let t=await this.verifyJWT(e.license);return{customer:t.customer,logo:t.logo,environment:"production"}}}catch(e){this.log("Failed to get default tenant info:",e)}return null}async testValidateTenant(e,t=1e4){try{let r=this.performTestValidation(e),n=new Promise((i,a)=>setTimeout(()=>a(new Error(`Validation timed out after ${t}ms`)),t));return await Promise.race([r,n])}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log("Failed to test validate endpoints:",n),{success:!1,error:n}}}async performTestValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return this.log("Test validation successful for tenant",{tenantUrl:e,apiUrl:n.apiUrl,authUrl:n.authUrl}),{success:!0,licenseInfo:r.licenseInfo}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchEndpointLicenseForUrl(e,t,r){try{let n=new URL(e),s=`${n.protocol}//${n.host}/.well-known/relay.md/license`;this.log(`Fetching ${t.toUpperCase()} licenses for test validation from:`,s);let i=await it(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error(`License fetch failed: ${i.status} ${i.statusText}`);let a=await i.json();this.log("License response received from:",s);let l=[];if(ru(a))l=a;else if(a&&typeof a=="object"&&"licenses"in a&&ru(a.licenses))l=a.licenses;else if(mh(a))l=[a];else throw new Ht("No valid licenses found in response","LICENSE_NOT_FOUND");if(this.log(`Parsed ${l.length} licenses`),l.length===0)throw new Error("Empty license list");let c=this.findMatchingEndpointLicense(l,r,t);if(!c)throw new Ht(`No valid ${t.toUpperCase()} license found for: ${r}`,"LICENSE_NOT_FOUND");return{success:!0,license:c.license}}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("License fetch error:",s),{success:!1,error:`License fetch failed: ${s}`}}}};var $1=require("obsidian");function FD(o){Ce(o,"svelte-1yric5k",".self-host-modal.svelte-1yric5k{padding:0 0 20px 0}.host-list-section.svelte-1yric5k{margin:16px 0}.public-key-section.svelte-1yric5k{margin:16px 0}.loading-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.host-list.svelte-1yric5k{display:flex;flex-direction:column;margin-top:8px}.host-card.svelte-1yric5k{display:flex;align-items:center;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.host-card.svelte-1yric5k:hover{background:var(--background-modifier-hover)}.host-card.active.svelte-1yric5k{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.host-info.svelte-1yric5k{display:flex;flex-direction:column;gap:4px;flex:1}.host-url.svelte-1yric5k{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.host-key-indicator.svelte-1yric5k{font-size:0.8em;color:var(--text-faint)}.add-host-card.svelte-1yric5k{border-style:dashed;opacity:0.8}.add-host-card.svelte-1yric5k:hover{opacity:1}.host-url-input.svelte-1yric5k{width:100%;border:none;background:transparent;color:var(--text-muted);font-size:0.85em;font-family:var(--font-monospace);padding:0;outline:none}.host-url-input.svelte-1yric5k:focus{color:var(--text-normal)}.host-url-input.svelte-1yric5k::placeholder{color:var(--text-faint);opacity:0.8}.host-input-invalid.svelte-1yric5k{color:var(--text-error) !important}.error-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}.modal-button-container.svelte-1yric5k{display:flex;justify-content:flex-end;align-items:center;margin-top:24px;gap:12px}.loading-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.error-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}")}function T1(o,e,t){let r=o.slice();return r[30]=e[t],r}function A1(o,e,t){let r=o.slice();return r[33]=e[t],r}function F1(o){let e,t=o[0].user.name+"",r,n;return{c(){e=_("option"),r=B(t),n=B(" (Personal)"),e.__value="user",Je(e,e.__value)},m(s,i){w(s,e,i),y(e,r),y(e,n)},p(s,i){i[0]&1&&t!==(t=s[0].user.name+"")&&Q(r,t)},d(s){s&&x(e)}}}function E1(o){let e,t=o[33].name+"",r,n;return{c(){e=_("option"),r=B(t),e.__value=n=o[33].id,Je(e,e.__value)},m(s,i){w(s,e,i),y(e,r)},p(s,i){i[0]&8&&t!==(t=s[33].name+"")&&Q(r,t),i[0]&8&&n!==(n=s[33].id)&&(e.__value=n,Je(e,e.__value))},d(s){s&&x(e)}}}function ED(o){let e,t,r,n,s,i,a=o[0].user&&F1(o),l=xe(o[3]),c=[];for(let u=0;u<l.length;u+=1)c[u]=E1(A1(o,l,u));return{c(){e=_("select"),a&&a.c(),t=pe();for(let u=0;u<c.length;u+=1)c[u].c();h(e,"class","owner-select"),e.disabled=n=o[8]<=1},m(u,f){w(u,e,f),a&&a.m(e,null),y(e,t);for(let d=0;d<c.length;d+=1)c[d]&&c[d].m(e,null);Ln(e,o[16]()),s||(i=V(e,"change",o[15]),s=!0)},p(u,f){if(u[0].user?a?a.p(u,f):(a=F1(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),f[0]&8){l=xe(u[3]);let d;for(d=0;d<l.length;d+=1){let p=A1(u,l,d);c[d]?c[d].p(p,f):(c[d]=E1(p),c[d].c(),c[d].m(e,null))}for(;d<c.length;d+=1)c[d].d(1);c.length=l.length}f[0]&256&&n!==(n=u[8]<=1)&&(e.disabled=n)},d(u){u&&x(e),a&&a.d(),qe(c,u),s=!1,i()}}}function P1(o){let e,t=o[2].submit+"",r;return{c(){e=_("div"),r=B(t),h(e,"class","error-message svelte-1yric5k")},m(n,s){w(n,e,s),y(e,r)},p(n,s){s[0]&4&&t!==(t=n[2].submit+"")&&Q(r,t)},d(n){n&&x(e)}}}function R1(o){let e;return{c(){e=_("div"),e.textContent="Legacy host",h(e,"class","host-key-indicator svelte-1yric5k")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function D1(o,e){let t,r,n,s=e[30].url+"",i,a,l,c,u,f=e[30].keyType==="legacy"&&R1(e);function d(){return e[22](e[30])}function p(...m){return e[23](e[30],...m)}return{key:o,first:null,c(){var m;t=_("div"),r=_("div"),n=_("div"),i=B(s),a=F(),f&&f.c(),l=F(),h(n,"class","host-url svelte-1yric5k"),h(r,"class","host-info svelte-1yric5k"),h(t,"class","host-card svelte-1yric5k"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to select this host"),Te(t,"active",((m=e[10])==null?void 0:m.id)===e[30].id),this.first=t},m(m,v){w(m,t,v),y(t,r),y(r,n),y(n,i),y(r,a),f&&f.m(r,null),y(t,l),c||(u=[V(t,"click",d),V(t,"keydown",p)],c=!0)},p(m,v){var g;e=m,v[0]&2049&&s!==(s=e[30].url+"")&&Q(i,s),e[30].keyType==="legacy"?f||(f=R1(e),f.c(),f.m(r,null)):f&&(f.d(1),f=null),v[0]&3073&&Te(t,"active",((g=e[10])==null?void 0:g.id)===e[30].id)},d(m){m&&x(t),f&&f.d(),c=!1,we(u)}}}function U1(o){let e,t,r,n,s,i,a,l,c=[UD,DD,RD,PD],u=[];function f(d,p){return d[5]?0:d[6]?1:d[7]?2:3}return i=f(o,[-1,-1]),a=u[i]=c[i](o),{c(){e=_("div"),t=_("div"),t.textContent="Relay Server Configuration",r=F(),n=_("div"),n.textContent="Copy this configuration to your Relay Server's TOML file.",s=F(),a.c(),h(t,"class","setting-item-name"),h(n,"class","setting-item-description"),h(e,"class","public-key-section svelte-1yric5k")},m(d,p){w(d,e,p),y(e,t),y(e,r),y(e,n),y(e,s),u[i].m(e,null),l=!0},p(d,p){let m=i;i=f(d,p),i===m?u[i].p(d,p):(ne(),S(u[m],1,1,()=>{u[m]=null}),se(),a=u[i],a?a.p(d,p):(a=u[i]=c[i](d),a.c()),b(a,1),a.m(e,null))},i(d){l||(b(a),l=!0)},o(d){S(a),l=!1},d(d){d&&x(e),u[i].d()}}}function PD(o){let e;return{c(){e=_("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-1yric5k")},m(t,r){w(t,e,r)},p:q,i:q,o:q,d(t){t&&x(e)}}}function RD(o){let e,t;return e=new _c({props:{toml:o[7]}}),{c(){U(e.$$.fragment)},m(r,n){R(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.toml=r[7]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){D(e,r)}}}function DD(o){let e,t;return{c(){e=_("div"),t=B(o[6]),h(e,"class","error-message svelte-1yric5k")},m(r,n){w(r,e,n),y(e,t)},p(r,n){n[0]&64&&Q(t,r[6])},i:q,o:q,d(r){r&&x(e)}}}function UD(o){let e;return{c(){e=_("div"),e.textContent="Loading configuration...",h(e,"class","loading-message svelte-1yric5k")},m(t,r){w(t,e,r)},p:q,i:q,o:q,d(t){t&&x(e)}}}function OD(o){let e;return{c(){e=B("Create Relay Server")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function ND(o){let e;return{c(){e=B("Creating...")},m(t,r){w(t,e,r)},d(t){t&&x(e)}}}function $D(o){let e,t,r,n,s,i,a,l,c,u,f,d,p=[],m=new Map,v,g,k,L,I,C,M,A,E,P,T,$,J;n=new Ue({props:{name:"Owner",description:"Select who will own this self-hosted relay server.",$$slots:{default:[ED]},$$scope:{ctx:o}}});let N=o[2].submit&&P1(o),O=xe(o[11].values().filter(o[21])),te=H=>H[30].id;for(let H=0;H<O.length;H+=1){let X=T1(o,O,H),ue=te(X);m.set(ue,p[H]=D1(ue,X))}let Z=!o[10]&&U1(o);function Y(H,X){return H[4]?ND:OD}let ge=Y(o,[-1,-1]),j=ge(o);return{c(){e=_("div"),t=_("div"),t.innerHTML=`<p>Create a new self-hosted Relay Server. Select an existing host or add a
			new one.</p>`,r=F(),U(n.$$.fragment),s=F(),N&&N.c(),i=F(),a=_("div"),l=_("div"),l.textContent="Relay Server URL",c=F(),u=_("div"),u.textContent=`This should be accessible to users within your private network, but not
			exposed to the public internet.`,f=F(),d=_("div");for(let H=0;H<p.length;H+=1)p[H].c();v=F(),g=_("div"),k=_("div"),L=_("input"),C=F(),Z&&Z.c(),M=F(),A=_("div"),E=_("button"),j.c(),h(t,"class","setting-item-description"),me(t,"margin-bottom","16px"),h(l,"class","setting-item-name"),h(u,"class","setting-item-description"),h(L,"type","url"),h(L,"placeholder","https://relay.my-corp.ts.net"),h(L,"class","host-url-input svelte-1yric5k"),h(L,"title",I=o[2].url),Te(L,"host-input-invalid",o[2].url),h(k,"class","host-info svelte-1yric5k"),h(g,"class","host-card add-host-card svelte-1yric5k"),h(d,"class","host-list svelte-1yric5k"),h(a,"class","host-list-section svelte-1yric5k"),h(E,"class","mod-cta"),E.disabled=P=o[4]||!o[10]&&(!o[1].trim()||!!o[2].url),h(A,"class","modal-button-container svelte-1yric5k"),h(e,"class","self-host-modal svelte-1yric5k")},m(H,X){w(H,e,X),y(e,t),y(e,r),R(n,e,null),y(e,s),N&&N.m(e,null),y(e,i),y(e,a),y(a,l),y(a,c),y(a,u),y(a,f),y(a,d);for(let ue=0;ue<p.length;ue+=1)p[ue]&&p[ue].m(d,null);y(d,v),y(d,g),y(g,k),y(k,L),Je(L,o[1]),y(e,C),Z&&Z.m(e,null),y(e,M),y(e,A),y(A,E),j.m(E,null),T=!0,$||(J=[V(L,"click",o[24]),V(L,"input",o[25]),V(E,"click",o[14])],$=!0)},p(H,X){let ue={};X[0]&265|X[1]&32&&(ue.$$scope={dirty:X,ctx:H}),n.$set(ue),H[2].submit?N?N.p(H,X):(N=P1(H),N.c(),N.m(e,i)):N&&(N.d(1),N=null),X[0]&11265&&(O=xe(H[11].values().filter(H[21])),p=eo(p,X,te,1,H,O,m,d,oi,D1,v,T1)),(!T||X[0]&4&&I!==(I=H[2].url))&&h(L,"title",I),X[0]&2&&L.value!==H[1]&&Je(L,H[1]),(!T||X[0]&4)&&Te(L,"host-input-invalid",H[2].url),H[10]?Z&&(ne(),S(Z,1,1,()=>{Z=null}),se()):Z?(Z.p(H,X),X[0]&1024&&b(Z,1)):(Z=U1(H),Z.c(),b(Z,1),Z.m(e,M)),ge!==(ge=Y(H,X))&&(j.d(1),j=ge(H),j&&(j.c(),j.m(E,null))),(!T||X[0]&1046&&P!==(P=H[4]||!H[10]&&(!H[1].trim()||!!H[2].url)))&&(E.disabled=P)},i(H){T||(b(n.$$.fragment,H),b(Z),T=!0)},o(H){S(n.$$.fragment,H),S(Z),T=!1},d(H){H&&x(e),D(n),N&&N.d();for(let X=0;X<p.length;X+=1)p[X].d();Z&&Z.d(),j.d(),$=!1,we(J)}}}function O1(o){if(!o.trim())return"URL is required";try{let e=new URL(o);return["http:","https:"].includes(e.protocol)?void 0:"URL must use http or https protocol"}catch(e){return"Please enter a valid URL"}}function BD(o,e,t){let r,n,s,i,a,l=q,c=()=>(l(),l=At(r,H=>t(11,a=H)),r);o.$$.on_destroy.push(()=>l());let{onConfirm:u}=e,{relayManager:f}=e,d="",p=!1,m={},v=Ie(null);le(o,v,H=>t(10,i=H));let g=null,k=!1,L=!1,I=null,C="",M="",A=null;function E(){t(2,m={});let H=O1(d);return H&&t(2,m.url=H,m),Object.keys(m).length===0}function P(H){v.set(H)}function T(){v.set(null),t(1,d=""),t(2,m={})}function $(){return Ae(this,void 0,void 0,function*(){m.submit&&(delete m.submit,t(2,m),t(1,d),t(18,g));let H=(A==null?void 0:A.type)==="org"?A.org.id:void 0;if(i){t(4,p=!0);try{yield u(void 0,i.id,H)}catch(X){t(2,m.submit=X instanceof Error?X.message:"Failed to create relay: Unknown error",m),t(2,m),t(1,d),t(18,g)}finally{t(4,p=!1)}}else{if(!E()||p)return;t(4,p=!0);try{yield u(d.trim(),void 0,H)}catch(X){t(2,m.submit=X instanceof Error?X.message:"Failed to create relay: Unknown error",m),t(2,m),t(1,d),t(18,g)}finally{t(4,p=!1)}}})}function J(H){H.target.value==="user"&&f.user&&t(20,A={type:"user",user:f.user})}function N(){return A?A.type==="user"?"user":A.org.id:""}function O(){return Ae(this,void 0,void 0,function*(){if(!(f!=null&&f.pb)){t(6,I="Not connected to relay service");return}t(5,L=!0),t(6,I=null);try{let H=f.pb.baseUrl+"/templates/relay.toml",X=yield it(H,{method:"GET",headers:{Authorization:f.pb.authStore.token?`Bearer ${f.pb.authStore.token}`:""}});t(19,M=yield X.text())}catch(H){t(6,I=H instanceof Error?H.message:"Failed to fetch configuration")}finally{t(5,L=!1)}})}lt(()=>{O();let H=f.providers.values().filter(X=>X.selfHosted&&f.relays.some((ue,z)=>ue.providerId===X.id));H.length>0&&v.set(H[0])});let te=H=>H.selfHosted&&f.relays.some((X,ue)=>X.providerId===H.id),Z=H=>P(H),Y=(H,X)=>X.key==="Enter"||X.key===" "?P(H):null,ge=()=>P(null);function j(){d=this.value,t(1,d)}o.$$set=H=>{"onConfirm"in H&&t(17,u=H.onConfirm),"relayManager"in H&&t(0,f=H.relayManager)},o.$$.update=()=>{if(o.$$.dirty[0]&1){e:c(t(9,r=f.providers))}if(o.$$.dirty[0]&1048577){e:!A&&f.user&&t(20,A={type:"user",user:f.user})}if(o.$$.dirty[0]&9){e:t(8,s=(f.user?1:0)+n.length)}if(o.$$.dirty[0]&262150){e:d.trim()?(k=!0,g&&clearTimeout(g),t(18,g=setTimeout(()=>{let H=O1(d);H?t(2,m.url=H,m):m.url&&(delete m.url,t(2,m),t(1,d),t(18,g))},500))):(m.url&&(delete m.url,t(2,m),t(1,d),t(18,g)),k=!1)}if(o.$$.dirty[0]&524290){e:t(7,C=M?M.replace(/\{url\}/g,d||""):"")}};e:t(3,n=[]);return[f,d,m,n,p,L,I,C,s,r,i,a,v,P,$,J,N,u,g,M,A,te,Z,Y,ge,j]}var hh=class extends K{constructor(e){super(),G(this,e,BD,$D,W,{onConfirm:17,relayManager:0},FD,[-1,-1])}},N1=hh;var nu=class extends $1.Modal{constructor(t,r,n){super(t);this.relayManager=r;this.onSuccess=n;this.setTitle("Self Host Relay Server")}onOpen(){let{contentEl:t}=this;this.component=new N1({target:t,props:{relayManager:this.relayManager,onConfirm:async(r,n,s)=>{let i=await this.relayManager.createSelfHostedRelay(r,n,s);this.close(),this.onSuccess(i)}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var VD={debugging:!1},HD={release:{channel:"stable"},sharedFolders:[],endpoints:{},...Qi,...VD},su=class extends H1.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.6.1";this.repo="No-Instructions/Relay"}enableDebugging(t){yl(!0),console.warn("RelayInstances",$t),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){yl(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return yl(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return this.loginManager.getEndpointManager().getApiUrl()+t}openEndpointConfigurationModal(){new Mc(this.app,this,()=>{this.reload()}).open()}async validateAndApplyEndpoints(){var n;let t=this.endpointSettings.get();if(!t.activeTenantId||!((n=t.tenants)!=null&&n.length)){new rt.Notice("Please configure an enterprise tenant first",4e3);return}let r=new rt.Notice("Validating endpoints...",0);try{let s=await this.loginManager.validateAndApplyEndpoints();r.hide(),s.success?(await this.endpointSettings.update(i=>({...i,_lastValidationError:void 0,_lastValidationAttempt:void 0})),new rt.Notice("\u2713 Endpoints validated and applied successfully!",5e3),s.licenseInfo&&this.log("License validation successful:",s.licenseInfo)):(await this.endpointSettings.update(i=>({...i,_lastValidationError:s.error,_lastValidationAttempt:Date.now()})),new rt.Notice(`\u274C Validation failed: ${s.error}`,8e3))}catch(s){r.hide();let i=s instanceof Error?s.message:"Unknown error";await this.endpointSettings.update(a=>({...a,_lastValidationError:i,_lastValidationAttempt:Date.now()})),new rt.Notice(`\u274C Validation error: ${i}`,8e3)}}resetToDefaultEndpoints(){this.loginManager.getEndpointManager().clearValidatedEndpoints(),this.endpointSettings.update(()=>({})),new rt.Notice("Reset to default endpoints",3e3)}async validateEndpointsOnStartup(t){var s;let r=this.endpointSettings.get();if(!r.activeTenantId||!((s=r.tenants)!=null&&s.length)){this.log("No active enterprise tenant configured, using defaults");return}let n=r.tenants.find(i=>i.id===r.activeTenantId);if(!n){this.log("Active tenant not found, using defaults");return}this.log("Enterprise tenant configured, validating on startup...",{tenantId:n.id,tenantUrl:n.tenantUrl,tenantName:n.name});try{let i=await t.validateAndSetEndpoints(5e3);i.success?(await this.endpointSettings.update(a=>({...a,_lastValidationError:void 0,_lastValidationAttempt:void 0})),this.log("\u2713 Enterprise tenant validated and applied on startup",{licenseInfo:i.licenseInfo})):(this.error("\u274C Enterprise tenant validation failed on startup",i.error),await this.endpointSettings.update(a=>({...a,_lastValidationError:i.error,_lastValidationAttempt:Date.now()})),new rt.Notice(`\u274C Custom endpoints failed validation: ${i.error}`,8e3))}catch(i){let a=i instanceof Error?i.message:"Unknown error";this.error("Startup endpoint validation error:",a),await this.endpointSettings.update(l=>({...l,_lastValidationError:a,_lastValidationAttempt:Date.now()})),new rt.Notice(`\u274C Endpoint validation error: ${a}`,8e3)}}async onload(){this.appId=this.app.appId;let t=rt.moment.now();$t.set(this,"plugin"),this.timeProvider=new Ks,this.register(()=>{this.timeProvider.destroy()}),Py(new Zc(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new Yc,this.debug=Fe("[System 3][Relay]","debug"),this.log=Fe("[System 3][Relay]","log"),this.warn=Fe("[System 3][Relay]","warn"),this.error=Fe("[System 3][Relay]","error"),this.settings=new Al(this,HD),await this.settings.load(),this.featureSettings=new or(this.settings,"(enable*)"),this.debugSettings=new or(this.settings,"(debugging)"),this.folderSettings=new or(this.settings,"sharedFolders"),this.releaseSettings=new or(this.settings,"release"),this.loginSettings=new or(this.settings,"login"),this.endpointSettings=new or(this.settings,"endpoints"),_t.getInstance().setSettings(this.featureSettings),this.settingsTab=new kc(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new tu(this,this.timeProvider,this.releaseSettings),this.register(this.debugSettings.subscribe(a=>{a.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let l=new Jc(this.app,()=>{this.reload()});this.openModals.push(l),l.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let l=new Xc(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let l=new Qc(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let l=new Aa(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let l=new eu(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let l=new Ta(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(l),l.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}));let n=`async function() {
			const app = window.app;
			await app.plugins.disablePlugin("system3-relay");
			await app.plugins.enablePlugin("system3-relay");
		}`;this.app.reloadRelay=new Function("return "+n),this.addCommand({id:"reload",name:"Reload Relay",callback:this.app.reloadRelay()}),this.addCommand({id:"open-settings",name:"Open settings",callback:()=>{this.openSettings()}}),this.addCommand({id:"configure-endpoints",name:"Configure enterprise tenant",callback:()=>{this.openEndpointConfigurationModal()}}),Ze().enableSelfManageHosts&&this.addCommand({id:"register-host",name:"Register self-hosted Relay Server",callback:()=>{let a=new nu(this.app,this.relayManager,l=>{this.openSettings(`/relays?id=${l.id}`)});this.openModals.push(a),a.open()}}),this.register(this.updateManager.subscribe(()=>{let a=this.updateManager.getNewRelease();a?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${a.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(a)}}),this.log(`Update available: v${this.version} \u2192 ${a.tag_name}`)):this.removeCommand("update-plugin")})),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new Fl(this.appId);let i=new ou(this.endpointSettings);await this.validateEndpointsOnStartup(i),this.loginManager=new Lc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this),this.loginSettings,i),this.relayManager=new Kc(this.loginManager),this.sharedFolders=new Pl(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new zc(this.loginManager,this.timeProvider,s,3),this.networkStatus=new ew(this.timeProvider,"https://api.system3.md/health?version=0.6.1"),this.backgroundSync=new Gc(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new rt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new oc(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),B1.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(a=>a.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(ii,a=>new Zl(a)),this.registerEvent(this.app.workspace.on("file-menu",(a,l)=>{if(l instanceof rt.TFolder){let c=this.sharedFolders.find(u=>u.path===l.path);if(!c)return;c.relayId?(a.addItem(u=>{u.setTitle("Relay: Relay settings").setIcon("gear").onClick(()=>{this.openSettings(`/relays?id=${c.relayId}`)})}),a.addItem(u=>{u.setTitle("Relay: Local folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${c.guid}`)})}),a.addItem(u=>{u.setTitle(c.connected?"Relay: Disconnect":"Relay: Connect").setIcon("satellite").onClick(()=>{c.connected?(c.shouldConnect=!1,c.disconnect()):(c.shouldConnect=!0,c.connect()),this._liveViews.refresh("folder connection toggle")})})):a.addItem(u=>{u.setTitle("Relay: Local folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${c.guid}`)})}),c.relayId&&Ze().enableSyncModal&&a.addItem(u=>{u.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new Ta(this.app,this.backgroundSync,this.sharedFolders,c.guid);this.openModals.push(f),f.open()})}),c.relayId&&c.connected&&a.addItem(u=>{u.setTitle("Relay: Sync").setIcon("folder-sync").onClick(()=>{c.netSync()})})}else if(l instanceof rt.TFile){let c=this.sharedFolders.lookup(l.path),u=c==null?void 0:c.getFile(l);u&&xr(u)&&(a.addItem(f=>{f.setTitle("Relay: Download").setIcon("cloud-download").onClick(async()=>{await u.pull(),new rt.Notice(`Download complete: ${u.name}`)})}),this.debugSettings.get().debugging&&a.addItem(f=>{f.setTitle("Relay: Verify upload").setIcon("search-check").onClick(async()=>{let d=await u.verifyUpload();new rt.Notice(`${u.name} ${d?"on server":"missing from server"}`)})}),a.addItem(f=>{f.setTitle("Relay: Upload").setIcon("cloud-upload").onClick(async()=>{await u.push(!0);let d=await u.verifyUpload();new rt.Notice(`${d?"File uploaded:":"File upload failed:"} ${u.name}`)})}))}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=rt.moment.now()-t})}async reload(){this.app.reloadRelay()()}_createSharedFolder(t,r,n,s){let i=new or(this.settings,`sharedFolders/[guid=${r}]`),a={guid:r,path:t};return n&&(a.relay=n),i.update(c=>({...c,path:t,guid:r,...n?{relay:n}:{},sync:c.sync?c.sync:Sn.defaultFlags}),!0),new El(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.hashStore,this.backgroundSync,i,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let i=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=i==null?void 0:i.instance)!=null&&s.options)||!i.enabled){this.warn("Webviewer plugin not found or not initialized");return}let a=i.instance.options,l=Object.getOwnPropertyDescriptor(a,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(a,"openExternalURLs",{get(){var p;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((p=d==null?void 0:d.detail)!=null&&p.url)){let m=d.detail.url;for(let v of t.interceptedUrls)if(typeof v=="string"&&m.startsWith(v)||v instanceof RegExp&&v.test(m))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(a,"openExternalURLs",l)}),this.loginManager.getWebviewIntercepts().forEach(d=>{this.debug("Intercepting Webviewer for URL pattern",d.source),this.interceptedUrls.push(d)});let u=this.loginManager.getEndpointManager().getApiUrl(),f=new RegExp(u.replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(i){this.error("Failed to patch webviewer:",i)}}setup(){this.folderNavDecorations=new ic(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Fe("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Fe("[System 3][Relay][Vault]","log"),n=c=>{},s=c=>n(c);window.addEventListener("unhandledrejection",s,!0),this.register(()=>window.removeEventListener("unhandledrejection",s,!0)),this.registerEvent(this.app.vault.on("create",c=>{let u=this.sharedFolders.lookup(c.path);u&&(u.placeHold([c]).length>0?u.uploadFile(c):u.whenReady().then(d=>{d.getFile(c)}))})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof rt.TFolder){let f=this.sharedFolders.find(d=>d.path===c.path);if(f){this.sharedFolders.delete(f);return}}let u=this.sharedFolders.lookup(c.path);u&&(r("Delete",c.path),u.whenReady().then(f=>{f.proxy.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,u)=>{if(c instanceof rt.TFolder){let m=this.sharedFolders.find(v=>v.path==u);if(m){m.move(c.path),this.sharedFolders.update();return}}let f=this.sharedFolders.lookup(u),d=this.sharedFolders.lookup(c.path),p=f||d;f&&d?(r("Rename",c.path,u),f.renameFile(c,u),d.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):p&&(r("Rename",c.path,u),p.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",c=>{let u=this.sharedFolders.lookup(c.path);if(u){r("Modify",c.path);let f=u.proxy.getFile(c);f&&xr(f)&&f.sync(),this.timeProvider.setTimeout(()=>{this.app.metadataCache.trigger("resolve",f)},10)}}));let i=this,a=Xo(rt.MarkdownView.prototype,{onUnloadFile(c){return function(u){return i._liveViews.wipe(),c.call(this,u)}}});this.register(a);let l=Xo(this.app.vault,{process(c){return function(u,f,d){try{let p=i.sharedFolders.lookup(u.path);if(p){let m=p.proxy.getFile(u);u instanceof rt.TFile&&m&&Xr(m)&&m.process(f)}}catch(p){i.log(p)}return c.call(this,u,f,d)}}});this.register(l),this.patchWebviewer(),bn(qo.enableNewLinkFormat,()=>{let c=Xo(rt.MetadataCache.prototype,{fileToLinktext(u){return function(f,d,p){if(i.sharedFolders.lookup(f.path)){p===void 0&&(p=!0);let v=f.extension==="md"&&p?f.basename:f.name,g=(0,rt.normalizePath)(f.name),k=i.app.metadataCache.uniqueFileLookup.get(g.toLowerCase());if(k&&k.length===1&&k[0]===f)return v;{let L=f.extension==="md"&&p?f.path.slice(0,f.path.length-3):f.path,I=(0,V1.relative)(d,L);return I==="../"+v?"./"+v:I}}return u.call(this,f,d,p)}}});this.register(c)}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let u=c,f=new URLSearchParams({...u}).toString(),d=`/${u.action.split("/").slice(-1)}?${f}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let u=c,f=new URLSearchParams({...u}).toString(),d=`/${u.action.split("/").slice(-1)}?${f}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/upgrade",async c=>{var d;let f=(d=c.version)==null?void 0:d.trim();this.installVersion(f)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new Aa(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,rt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,i,a,l,c,u,f,d,p,m,v;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(ii),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(i=this.tokenStore)==null||i.stop(),(a=this.tokenStore)==null||a.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(g=>{g.close()}),this.openModals.length=0,(f=this.sharedFolders)==null||f.destroy(),this.sharedFolders=null,(d=this.settingsTab)==null||d.destroy(),this.settingsTab=null,(p=this.loginManager)==null||p.destroy(),this.loginManager=null,(m=this.backgroundSync)==null||m.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(v=this.app)==null||v.workspace.updateOptions(),this.app.reloadRelay=void 0,this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,_t.destroy(),this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.loginSettings.destroy(),this.loginSettings=null,this.endpointSettings.destroy(),this.endpointSettings=null,this.interceptedUrls.length=0,$r.destroy(),this.notifier=null,Uy(),wf()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/check.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder-lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder-open.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/home.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/square-pen.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/x.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */